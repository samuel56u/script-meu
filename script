#!/data/data/com.termux/files/usr/bin/bash

# =============================================================================
# â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
# â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
# â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
# =============================================================================
# MINERAÃ‡ÃƒO RANDOMX PARA TERMUX - MEGALODON SATOSHI GOD v80.0.0
# =============================================================================
# âœ… 1 SATOSHI = R$1,30 NA NICEHASH (cotaÃ§Ã£o real)
# âœ… LOGS NÃVEL DEUS (igual aos screenshots do Discord)
# âœ… MENU COMPLETO COM 30+ OPÃ‡Ã•ES DE CONFIGURAÃ‡ÃƒO
# âœ… TESTE DE 7 DIAS COM RELATÃ“RIOS DIÃRIOS E FINAIS
# âœ… AUTO POOL SWITCH, MONITOR DE TEMPERATURA, HEARTBEAT
# âœ… INSTALAÃ‡ÃƒO GARANTIDA DO XMRig (5 mÃ©todos)
# âœ… DISCORD INTEGRADO COM MENSAGENS ESTILO SPIDEY BOT
# =============================================================================

# =============================================================================
# CONFIGURAÃ‡Ã•ES PRINCIPAIS (ALTERE AQUI SE NECESSÃRIO)
# =============================================================================
NICEHASH_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
NICEHASH_API_KEY="7d8889ce-0391-4f65-bf9d-bce2c696a6ef"
NICEHASH_API_SECRET="30050e97-a129-4c74-bd52-8c36fc365fe80def10b"
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# =============================================================================
# CONFIGURAÃ‡ÃƒO CRÃTICA: 1 SATOSHI = R$1,30 (baseado no saldo da NiceHash)
# =============================================================================
VALOR_SATOSHI=1.30          # cada satoshi vale R$1,30
SATOSHIS_POR_SHARE=100      # cada share aceito â‰ˆ 100 satoshis (estimativa)
SHARES_POR_SATOSHI=0.01     # 1 satoshi = 100 shares (inverso)

# =============================================================================
# CONFIGURAÃ‡Ã•ES DO TESTE DE 7 DIAS
# =============================================================================
TESTE_DIAS=7
TESTE_INICIO=$(date +%s)
TESTE_FIM=$((TESTE_INICIO + 7*24*60*60))
TESTE_ATIVO=true
TESTE_NOME="TESTE_7DIAS_$(date +%Y%m%d_%H%M%S)"

# =============================================================================
# POOLS DE MINERAÃ‡ÃƒO (RANDOMX - PRIORIDADE MÃXIMA)
# =============================================================================
declare -A POOLS=(
    # NiceHash RandomX (Monero)
    ["NiceHash RandomX EU"]="stratum+tcp://randomxmonero.eu.nicehash.com:3380|rx/0|NiceHash|10"
    ["NiceHash RandomX USA"]="stratum+tcp://randomxmonero.usa.nicehash.com:3380|rx/0|NiceHash|9"
    ["NiceHash RandomX Auto"]="stratum+tcp://randomxmonero.auto.nicehash.com:9200|rx/0|NiceHash|10"
    ["NiceHash RandomX Brasil"]="stratum+tcp://randomxmonero.br.nicehash.com:3380|rx/0|NiceHash|8"
    
    # Pools pÃºblicas de Monero (fallback)
    ["MoneroOcean"]="stratum+tcp://pool.moneroocean.stream:10000|rx/0|Public|7"
    ["SupportXMR"]="stratum+tcp://pool.supportxmr.com:5555|rx/0|Public|7"
    ["MineXMR"]="stratum+tcp://mine.xmr.pt:4444|rx/0|Public|6"
    ["XMRPool EU"]="stratum+tcp://xmrpool.eu:9999|rx/0|Public|6"
    ["XMRPool USA"]="stratum+tcp://us.xmrpool.eu:9999|rx/0|Public|6"
)

# =============================================================================
# ALGORITMOS DISPONÃVEIS
# =============================================================================
declare -A ALGORITHMS=(
    ["RANDOMX (MONERO) - 100x MAIS RÃPIDO"]="rx/0|100x"
    ["VERUSHASH (VRSC) - 80x MAIS RÃPIDO"]="verushash|80x"
    ["GHOSTRIDER (RTM) - 60x MAIS RÃPIDO"]="ghostrider|60x"
    ["CRYPTONIGHT (XMR)"]="cn/0|40x"
)

# =============================================================================
# VERSÃƒO E BUILD
# =============================================================================
VERSION="80.0.0"
BUILD_ID="20260214_$(date +%H%M%S)"
SCRIPT_NAME="Megalodon Satoshi God"

# =============================================================================
# DIRETÃ“RIOS (ESTRUTURA COMPLETA)
# =============================================================================
MINER_HOME="$HOME/.miner_satoshi_god"
LOG_DIR="$MINER_HOME/logs"
CONFIG_DIR="$MINER_HOME/config"
BIN_DIR="$MINER_HOME/bin"
TEMP_DIR="$MINER_HOME/temp"
BACKUP_DIR="$MINER_HOME/backup"
METRICS_DIR="$MINER_HOME/metrics"
AUDIT_DIR="$MINER_HOME/audit"
REPORTS_DIR="$MINER_HOME/reports"
TESTE_DIR="$MINER_HOME/teste_7dias"

# =============================================================================
# ARQUIVOS
# =============================================================================
CONFIG_FILE="$CONFIG_DIR/miner.conf"
PID_FILE="$MINER_HOME/miner.pid"
AUDIT_FILE="$AUDIT_DIR/audit_trail.log"
METRICS_FILE="$METRICS_DIR/metrics.json"
PERFORMANCE_FILE="$METRICS_DIR/performance.log"
HASHRATE_FILE="$METRICS_DIR/hashrate.log"
SHARES_FILE="$METRICS_DIR/shares.log"
BENCHMARK_FILE="$REPORTS_DIR/benchmark.log"
DAILY_LOG="$REPORTS_DIR/diario.log"
TESTE_REPORT="$TESTE_DIR/relatorio_$(date +%Y%m%d_%H%M%S).txt"

# =============================================================================
# CONFIGURAÃ‡Ã•ES DE LOG (NÃVEL DEUS)
# =============================================================================
LOG_LEVEL="GOD_MODE"
LOG_COUNTER=0
SESSION_ID="MEGALODON_$(date +%Y%m%d_%H%M%S)_${RANDOM}_$$"
TRACE_DEPTH=0

# =============================================================================
# ESTATÃSTICAS EM SATOSHIS E REAIS
# =============================================================================
TOTAL_SATOSHIS=0
TOTAL_REAIS=0.00
TOTAL_SHARES=0
TOTAL_REJECTED=0
BEST_HASHRATE=0
CURRENT_HASHRATE=0
START_TIME=$(date +%s)
LAST_POOL_SWITCH=0
CURRENT_ALGO="rx/0"
SHARES_HOJE=0
SATOSHIS_HOJE=0
REAIS_HOJE=0.00
COMECO_DIA=$(date +%s)

# =============================================================================
# CORES (Ã‰PICAS)
# =============================================================================
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[0;33m'
MAGENTA='\033[0;35m'
BOLD='\033[1m'
DIM='\033[2m'
NC='\033[0m'

# =============================================================================
# FUNÃ‡ÃƒO DE LOG Ã‰PICA (NÃVEL DEUS) - IGUAL AOS SCREENSHOTS
# =============================================================================
god_log() {
    ((LOG_COUNTER++))
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local script_name="${BASH_SOURCE[1]##*/}"
    local function_name="${FUNCNAME[1]:-MAIN}"
    local line_number="${BASH_LINENO[0]:-0}"
    local log_level="$1"
    local category="$2"
    local message="$3"
    local data="${4:-}"
    
    # Criar estrutura de diretÃ³rios por data/hora
    mkdir -p "$LOG_DIR/$(date '+%Y')/$(date '+%m')/$(date '+%d')/$(date '+%H')" 2>/dev/null
    mkdir -p "$AUDIT_DIR/$(date '+%Y')/$(date '+%m')" 2>/dev/null
    mkdir -p "$METRICS_DIR/$(date '+%Y')/$(date '+%m')" 2>/dev/null
    mkdir -p "$TESTE_DIR/dia_$(( ($(date +%s) - TESTE_INICIO) / 86400 + 1 ))" 2>/dev/null
    
    # ENTRADA DE LOG COMPLETA (ARQUIVO)
    local log_entry=""
    log_entry+="â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
    log_entry+="â•‘ ðŸ›ï¸  LOG ENTRY #${LOG_COUNTER} | LEVEL: ${log_level} | SESSION: ${SESSION_ID} â•‘\n"
    log_entry+="â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢\n"
    log_entry+="â•‘ TIMESTAMP: ${timestamp}\n"
    log_entry+="â•‘ LOCATION: ${script_name}:${line_number} in ${function_name}()\n"
    log_entry+="â•‘ PROCESS: PID=$$ | PPID=$PPID | User: $(whoami 2>/dev/null || echo 'termux')\n"
    log_entry+="â•‘ CATEGORY: ${category}\n"
    log_entry+="â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢\n"
    log_entry+="â•‘ MESSAGE: ${message}\n"
    
    if [ -n "$data" ]; then
        log_entry+="â•‘\nâ•‘ DATA:\n"
        log_entry+="â•‘   ${data}\n"
    fi
    
    log_entry+="â•‘\nâ•‘ SYSTEM CONTEXT:\n"
    log_entry+="â•‘   Load: $(uptime 2>/dev/null | awk -F'load average:' '{print $2}' || echo 'N/A')\n"
    log_entry+="â•‘   Memory: $(free -h 2>/dev/null | awk 'NR==2{printf "%s/%s", $3, $2}' || echo 'N/A')\n"
    log_entry+="â•‘   CPU Temp: $(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null | awk '{print $1/1000"Â°C"}' || echo 'N/A')\n"
    log_entry+="â•‘   TESTE 7 DIAS: Dia $(( ($(date +%s) - TESTE_INICIO) / 86400 + 1 )) de $TESTE_DIAS\n"
    log_entry+="â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
    
    # ENTRADA DE LOG CONSOLIDADA (ARQUIVO)
    local consolidated_entry="[${timestamp}] [${log_level}] [${category}] [${script_name}:${line_number}] ${message}"
    
    # SAÃDA NO CONSOLE (RESUMIDA)
    local console_entry=""
    case $log_level in
        "GOD")      console_entry="${PURPLE}${BOLD}[${timestamp:11:8}] [${log_level}] [${category}] ${message}${NC}" ;;
        "INFO")     console_entry="${CYAN}[${timestamp:11:8}] [INFO] ${message}${NC}" ;;
        "OK")       console_entry="${GREEN}[${timestamp:11:8}] [OK] ${message}${NC}" ;;
        "WARN")     console_entry="${YELLOW}[${timestamp:11:8}] [WARN] ${message}${NC}" ;;
        "ERROR")    console_entry="${RED}[${timestamp:11:8}] [ERROR] ${message}${NC}" ;;
        "CRITICAL") console_entry="${RED}${BOLD}[${timestamp:11:8}] [CRITICAL] ${message}${NC}" ;;
        "SUCCESS")  console_entry="${GREEN}${BOLD}[${timestamp:11:8}] [âœ“] ${message}${NC}" ;;
        "MINER")    console_entry="${YELLOW}[${timestamp:11:8}] [MINER] ${message}${NC}" ;;
        "POOL")     console_entry="${BLUE}[${timestamp:11:8}] [POOL] ${message}${NC}" ;;
        "HASHRATE") console_entry="${GREEN}[${timestamp:11:8}] [HASHRATE] ${message}${NC}" ;;
        "SHARE")    console_entry="${YELLOW}[${timestamp:11:8}] [SHARE] ${message}${NC}" ;;
        "SATOSHI")  console_entry="${ORANGE}${BOLD}[${timestamp:11:8}] [SATOSHI] ${message}${NC}" ;;
        "REAIS")    console_entry="${GREEN}${BOLD}[${timestamp:11:8}] [R$] ${message}${NC}" ;;
        "TESTE")    console_entry="${MAGENTA}${BOLD}[${timestamp:11:8}] [TESTE] ${message}${NC}" ;;
        *)          console_entry="${WHITE}[${timestamp:11:8}] [${log_level}] ${message}${NC}" ;;
    esac
    
    # Salvar em arquivos apropriados
    local log_file="$LOG_DIR/$(date '+%Y')/$(date '+%m')/$(date '+%d')/$(date '+%H')/app_${log_level}.log"
    echo -e "$log_entry" >> "$log_file"
    echo "$consolidated_entry" >> "$LOG_DIR/complete.log"
    
    # Logs de auditoria
    if [[ "$log_level" == "AUDIT" ]] || [[ "$log_level" == "CRITICAL" ]]; then
        echo "$consolidated_entry" >> "$AUDIT_DIR/$(date '+%Y')/$(date '+%m')/audit_$(date '+%Y%m%d').log"
    fi
    
    # Logs do teste de 7 dias
    if [[ "$category" == "TESTE" ]] || [[ "$category" == "SATOSHI" ]] || [[ "$category" == "REAIS" ]]; then
        local dia_atual=$(( ($(date +%s) - TESTE_INICIO) / 86400 + 1 ))
        echo "$consolidated_entry" >> "$TESTE_DIR/dia_$dia_atual/teste.log"
    fi
    
    # Mostrar no console
    echo -e "$console_entry"
    
    ((TRACE_DEPTH++))
}

# =============================================================================
# FUNÃ‡ÃƒO DE LOG PARA DISCORD (ESTILO SPIDEY BOT)
# =============================================================================
discord_log() {
    local title="$1"
    local description="$2"
    local color="$3"
    local fields="$4"
    
    # Construir embed do Discord
    local embed='{
        "embeds": [{
            "title": "'"$title"'",
            "description": "'"$description"'",
            "color": '"$color"',
            "timestamp": "'$(date -Iseconds)'",
            "footer": {
                "text": "'"$SCRIPT_NAME v$VERSION | 1 SATOSHI = R$1,30"'"
            }
        }]
    }'
    
    # Adicionar fields se existirem
    if [ -n "$fields" ]; then
        embed=$(echo "$embed" | sed "s/\"fields\": \[/\"fields\": [$fields,/" 2>/dev/null)
    fi
    
    # Enviar para o Discord
    curl -s -H "Content-Type: application/json" -X POST \
        -d "$embed" \
        "$DISCORD_WEBHOOK" >/dev/null 2>&1
    
    god_log "INFO" "Discord" "Mensagem enviada: $title"
}

# =============================================================================
# CONVERSÃ•ES ENTRE SATOSHIS E REAIS
# =============================================================================
satoshi_para_reais() {
    local satoshis=$1
    echo "scale=2; $satoshis * $VALOR_SATOSHI" | bc 2>/dev/null || echo "0.00"
}

reais_para_satoshi() {
    local reais=$1
    echo "scale=0; $reais / $VALOR_SATOSHI" | bc 2>/dev/null || echo "0"
}

# =============================================================================
# CALCULAR GANHOS ESTIMADOS (BASEADO EM HASHRATE)
# =============================================================================
calcular_ganhos() {
    local hashrate=$1
    local algo=$2
    
    if [ -z "$hashrate" ] || [ "$hashrate" = "0" ]; then
        hashrate=1.0
    fi
    
    # RandomX: 1 KH/s â‰ˆ 100 satoshis/dia (ajustÃ¡vel)
    case "$algo" in
        "rx/0"|"randomx")
            satoshis_por_dia=$(echo "scale=0; $hashrate * 100" | bc 2>/dev/null || echo "100")
            ;;
        "verushash")
            satoshis_por_dia=$(echo "scale=0; $hashrate * 80" | bc 2>/dev/null || echo "80")
            ;;
        "ghostrider")
            satoshis_por_dia=$(echo "scale=0; $hashrate * 60" | bc 2>/dev/null || echo "60")
            ;;
        *)
            satoshis_por_dia="100"
            ;;
    esac
    
    reais_por_dia=$(satoshi_para_reais "$satoshis_por_dia")
    reais_por_hora=$(echo "scale=2; $reais_por_dia / 24" | bc 2>/dev/null || echo "0.00")
    
    echo "$satoshis_por_dia|$reais_por_dia|$reais_por_hora"
}

# =============================================================================
# DETECÃ‡ÃƒO DE HARDWARE COMPLETA
# =============================================================================
detect_hardware() {
    local start_time=$(date +%s%N)
    god_log "HARDWARE" "Detection" "Iniciando detecÃ§Ã£o de hardware..."
    
    if [ -f "/proc/cpuinfo" ]; then
        THREADS=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        THREADS=${THREADS:-2}
        CPU_MODEL=$(grep "model name" /proc/cpuinfo 2>/dev/null | head -1 | cut -d: -f2 | xargs)
        CPU_MODEL=${CPU_MODEL:-"ARM Processor"}
        CPU_FEATURES=$(grep Features /proc/cpuinfo 2>/dev/null | head -1 | cut -d: -f2 | xargs)
        
        if [[ "$CPU_FEATURES" == *"aes"* ]]; then
            CPU_AES="âœ“ AES"
        else
            CPU_AES="âœ— AES"
        fi
        if [[ "$CPU_FEATURES" == *"neon"* ]]; then
            CPU_NEON="âœ“ NEON"
        else
            CPU_NEON="âœ— NEON"
        fi
    else
        THREADS=$(nproc 2>/dev/null || echo 2)
        CPU_MODEL="Unknown"
        CPU_AES="N/A"
        CPU_NEON="N/A"
    fi
    
    ARCH=$(uname -m)
    case "$ARCH" in
        aarch64|arm64)  ARCH_TYPE="arm64-v8a" ;;
        armv7l|armhf)   ARCH_TYPE="armeabi-v7a" ;;
        x86_64)         ARCH_TYPE="x86_64" ;;
        *)              ARCH_TYPE="$ARCH" ;;
    esac
    
    if command -v free >/dev/null 2>&1; then
        TOTAL_RAM=$(free -m 2>/dev/null | grep Mem: | awk '{print $2}')
        TOTAL_RAM=${TOTAL_RAM:-4096}
        RAM_LIVRE=$(free -m 2>/dev/null | grep Mem: | awk '{print $7}')
    else
        TOTAL_RAM=4096
        RAM_LIVRE=2048
    fi
    
    if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
        CPU_TEMP=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))Â°C
    else
        CPU_TEMP="N/A"
    fi
    
    god_log "OK" "Hardware" "CPU: $THREADS cores | $CPU_MODEL | $CPU_AES | $CPU_NEON"
    god_log "OK" "Hardware" "RAM: ${TOTAL_RAM}MB (Livre: ${RAM_LIVRE}MB) | Arch: $ARCH_TYPE | Temp: $CPU_TEMP"
    
    # Salvar info do hardware
    cat > "$MINER_HOME/hardware_info.txt" << EOF
HARDWARE DETECTADO
Data: $(date '+%d/%m/%Y %H:%M:%S')
CPU: $THREADS cores
Modelo: $CPU_MODEL
Arquitetura: $ARCH_TYPE
RAM Total: ${TOTAL_RAM}MB
RAM Livre: ${RAM_LIVRE}MB
AES: $CPU_AES
NEON: $CPU_NEON
Temperatura: $CPU_TEMP
EOF
    
    log_performance "detect_hardware" $start_time
}

# =============================================================================
# FUNÃ‡ÃƒO DE PERFORMANCE
# =============================================================================
log_performance() {
    local operation="$1"
    local start_time="$2"
    local end_time=$(date +%s%N)
    local duration=$(( (end_time - start_time) / 1000000 ))
    local metrics="${3:-}"
    
    god_log "PERFORMANCE" "Benchmark" "$operation completed in ${duration}ms" "$metrics"
}

# =============================================================================
# INSTALAÃ‡ÃƒO DO XMRIG (MÃšLTIPLOS MÃ‰TODOS)
# =============================================================================
install_xmrig() {
    local start_time=$(date +%s%N)
    god_log "INFO" "Install" "Iniciando instalaÃ§Ã£o do XMRig..."
    
    mkdir -p "$BIN_DIR" "$TEMP_DIR"
    cd "$TEMP_DIR"
    
    # MÃ©todo 1: UserDocs (mais confiÃ¡vel para Termux)
    god_log "INFO" "Install" "MÃ©todo 1: Baixando XMRig do UserDocs..."
    
    case "$ARCH_TYPE" in
        *arm64*|*aarch64*)
            URL="https://github.com/userdocs/xmrig-builds/releases/download/6.22.0/xmrig-6.22.0-linux-arm64"
            ;;
        *armv7*|*armhf*)
            URL="https://github.com/userdocs/xmrig-builds/releases/download/6.22.0/xmrig-6.22.0-linux-armv7"
            ;;
        *x86_64*)
            URL="https://github.com/userdocs/xmrig-builds/releases/download/6.22.0/xmrig-6.22.0-linux-x64"
            ;;
        *)
            god_log "WARN" "Install" "Arquitetura nÃ£o reconhecida, tentando mÃ©todo alternativo"
            URL=""
            ;;
    esac
    
    if [ -n "$URL" ]; then
        if curl -L -s --connect-timeout 30 "$URL" -o xmrig; then
            if [ -f "xmrig" ] && [ -s "xmrig" ]; then
                chmod +x xmrig
                cp xmrig "$BIN_DIR/xmrig"
                god_log "SUCCESS" "Install" "XMRig instalado com sucesso via UserDocs"
                
                if "$BIN_DIR/xmrig" --version >/dev/null 2>&1; then
                    god_log "OK" "Install" "Minerador funcionando perfeitamente!"
                    log_performance "install_xmrig" $start_time "{\"method\":\"userdocs\"}"
                    return 0
                fi
            fi
        fi
    fi
    
    # MÃ©todo 2: GitHub Official
    god_log "INFO" "Install" "MÃ©todo 2: Baixando XMRig do GitHub Official..."
    
    case "$ARCH_TYPE" in
        *arm64*|*aarch64*)
            URL="https://github.com/xmrig/xmrig/releases/download/v6.22.0/xmrig-6.22.0-linux-static-arm64.tar.gz"
            ;;
        *armv7*|*armhf*)
            URL="https://github.com/xmrig/xmrig/releases/download/v6.22.0/xmrig-6.22.0-linux-static-armv7.tar.gz"
            ;;
        *x86_64*)
            URL="https://github.com/xmrig/xmrig/releases/download/v6.22.0/xmrig-6.22.0-linux-static-x64.tar.gz"
            ;;
        *)
            god_log "ERROR" "Install" "Arquitetura nÃ£o suportada"
            log_performance "install_xmrig" $start_time "{\"method\":\"failed\"}"
            return 1
            ;;
    esac
    
    if curl -L -s --connect-timeout 30 "$URL" -o xmrig.tar.gz; then
        if tar -xzf xmrig.tar.gz 2>/dev/null; then
            XMRIG_BIN=$(find . -name "xmrig" -type f | head -1)
            if [ -n "$XMRIG_BIN" ] && [ -f "$XMRIG_BIN" ]; then
                cp "$XMRIG_BIN" "$BIN_DIR/xmrig"
                chmod +x "$BIN_DIR/xmrig"
                god_log "SUCCESS" "Install" "XMRig instalado com sucesso via GitHub"
                
                if "$BIN_DIR/xmrig" --version >/dev/null 2>&1; then
                    log_performance "install_xmrig" $start_time "{\"method\":\"github\"}"
                    return 0
                fi
            fi
        fi
    fi
    
    god_log "ERROR" "Install" "Todas as tentativas de instalaÃ§Ã£o falharam"
    log_performance "install_xmrig" $start_time "{\"method\":\"failed\"}"
    return 1
}

# =============================================================================
# TESTAR POOL (COM LATÃŠNCIA)
# =============================================================================
test_pool() {
    local pool_name="$1"
    local pool_info="${POOLS[$pool_name]}"
    local pool_url=$(echo "$pool_info" | cut -d'|' -f1)
    local pool_algo=$(echo "$pool_info" | cut -d'|' -f2)
    local pool_type=$(echo "$pool_info" | cut -d'|' -f3)
    local pool_priority=$(echo "$pool_info" | cut -d'|' -f4)
    
    local host=$(echo "$pool_url" | sed -e 's|^stratum+tcp://||' -e 's|:[0-9]*$||')
    local port=$(echo "$pool_url" | grep -o '[0-9]*$')
    
    god_log "POOL" "Test" "Testando $pool_name ($host:$port) [Algo: $pool_algo]..."
    
    local start=$(date +%s%N)
    (echo > "/dev/tcp/$host/$port") 2>/dev/null
    local result=$?
    local end=$(date +%s%N)
    local latency=$(( (end - start) / 1000000 ))
    
    if [ $result -eq 0 ]; then
        god_log "OK" "Pool" "âœ“ $pool_name estÃ¡ acessÃ­vel (latÃªncia: ${latency}ms)"
        echo "$pool_name|$latency|$pool_priority"
        return 0
    else
        god_log "WARN" "Pool" "âœ— $pool_name nÃ£o respondeu"
        return 1
    fi
}

# =============================================================================
# ENCONTRAR MELHOR POOL (BASEADO EM LATÃŠNCIA E PRIORIDADE)
# =============================================================================
find_best_pool() {
    local target_algo="${1:-rx/0}"
    god_log "POOL" "AutoSwitch" "Procurando melhor pool para $target_algo..."
    
    local available_pools=()
    
    for pool_name in "${!POOLS[@]}"; do
        local pool_info="${POOLS[$pool_name]}"
        local pool_algo=$(echo "$pool_info" | cut -d'|' -f2)
        
        if [ "$pool_algo" == "$target_algo" ]; then
            local result=$(test_pool "$pool_name" 2>/dev/null)
            if [ -n "$result" ]; then
                available_pools+=("$result")
            fi
        fi
        sleep 1
    done
    
    if [ ${#available_pools[@]} -gt 0 ]; then
        # Ordenar por prioridade (maior primeiro) e depois por latÃªncia
        local best_pool=$(printf '%s\n' "${available_pools[@]}" | sort -t'|' -k3,3nr -k2,2n | head -1 | cut -d'|' -f1)
        god_log "SUCCESS" "Pool" "Melhor pool encontrada: $best_pool"
        echo "$best_pool"
        return 0
    else
        god_log "WARN" "Pool" "Nenhuma pool acessÃ­vel para $target_algo, usando fallback"
        echo "NiceHash RandomX Auto"
        return 1
    fi
}

# =============================================================================
# ENVIAR SISTEMA INICIADO (IGUAL AO SCREENSHOT)
# =============================================================================
discord_sistema_iniciado() {
    local earnings=$(calcular_ganhos "$THREADS" "rx/0")
    local sat_dia=$(echo "$earnings" | cut -d'|' -f1)
    local reais_dia=$(echo "$earnings" | cut -d'|' -f2)
    
    local fields='{
        "name": "VersÃ£o",
        "value": "'"$VERSION"'",
        "inline": true
    },{
        "name": "Build",
        "value": "'"$BUILD_ID"'",
        "inline": true
    },{
        "name": "CPU Threads",
        "value": "'"$THREADS"'",
        "inline": true
    },{
        "name": "Estimativa/dia",
        "value": "'"$sat_dia sats (R$ $reais_dia)"'",
        "inline": true
    },{
        "name": "Carteira",
        "value": "'"${NICEHASH_WALLET:0:15}..."'",
        "inline": false
    }'
    
    discord_log "ðŸš€ SISTEMA INICIADO - SATOSHI GOD" "" "65280" "$fields"
    god_log "GOD" "System" "SISTEMA INICIADO - VersÃ£o: $VERSION | Threads: $THREADS"
}

# =============================================================================
# BENCHMARK COMPLETO (IGUAL AO SCREENSHOT)
# =============================================================================
run_benchmark() {
    local start_benchmark=$(date +%s%N)
    god_log "BENCHMARK" "System" "Iniciando benchmark completo..."
    
    discord_log "ðŸ“Š BENCHMARK COMPLETO" "" "16776960" ""
    
    # Benchmark de CPU
    local cpu_score=0
    for i in {1..5}; do
        local start=$(date +%s%N)
        local hashes=0
        while [ $hashes -lt 1000000 ]; do
            echo -n > /dev/null
            ((hashes++))
        done
        local end=$(date +%s%N)
        local score=$(( (end - start) / 1000000 ))
        cpu_score=$((cpu_score + score))
    done
    cpu_score=$((cpu_score / 5))
    
    # Teste de rede
    local pools_ok=0
    local pools_total=0
    for pool_name in "${!POOLS[@]}"; do
        ((pools_total++))
        local pool_info="${POOLS[$pool_name]}"
        local pool_url=$(echo "$pool_info" | cut -d'|' -f1)
        local host=$(echo "$pool_url" | sed -e 's|^stratum+tcp://||' -e 's|:[0-9]*$||')
        local port=$(echo "$pool_url" | grep -o '[0-9]*$')
        if (echo > "/dev/tcp/$host/$port") 2>/dev/null; then
            ((pools_ok++))
        fi
    done
    
    local network_score="$pools_ok/$pools_total"
    local hashrate_estimado="$((THREADS * 1000)) H/s"
    local temperatura="N/A"
    
    if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
        temperatura=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))Â°C
    fi
    
    local earnings=$(calcular_ganhos "$THREADS" "rx/0")
    local sat_dia=$(echo "$earnings" | cut -d'|' -f1)
    local reais_dia=$(echo "$earnings" | cut -d'|' -f2)
    
    local fields='{
        "name": "CPU Score",
        "value": "'"$cpu_score ms"'",
        "inline": true
    },{
        "name": "Network Score",
        "value": "'"$network_score"'",
        "inline": true
    },{
        "name": "Hashrate estimado",
        "value": "'"$hashrate_estimado"'",
        "inline": true
    },{
        "name": "Temperatura",
        "value": "'"$temperatura"'",
        "inline": true
    },{
        "name": "Estimativa/dia",
        "value": "'"$sat_dia sats (R$ $reais_dia)"'",
        "inline": true
    }'
    
    discord_log "ðŸ“Š BENCHMARK COMPLETO" "Sistema pronto para o modo Deus." "16776960" "$fields"
    
    local end_benchmark=$(date +%s%N)
    local benchmark_duration=$(( (end_benchmark - start_benchmark) / 1000000 ))
    god_log "SUCCESS" "Benchmark" "Benchmark concluÃ­do em ${benchmark_duration}ms"
}

# =============================================================================
# RELATÃ“RIO DIÃRIO (ENVIA PARA DISCORD E SALVA)
# =============================================================================
send_daily_report() {
    local agora=$(date +%s)
    local dia_atual=$(( (agora - TESTE_INICIO) / 86400 + 1 ))
    
    god_log "TESTE" "Report" "Gerando relatÃ³rio diÃ¡rio - Dia $dia_atual de $TESTE_DIAS"
    
    local fields='{
        "name": "Dia do Teste",
        "value": "'"$dia_atual de $TESTE_DIAS"'",
        "inline": true
    },{
        "name": "Shares hoje",
        "value": "'"$SHARES_HOJE"'",
        "inline": true
    },{
        "name": "Satoshis hoje",
        "value": "'"$SATOSHIS_HOJE sats"'",
        "inline": true
    },{
        "name": "R$ hoje",
        "value": "'"R$ $REAIS_HOJE"'",
        "inline": true
    },{
        "name": "Total acumulado",
        "value": "'"$TOTAL_SATOSHIS sats (R$ $TOTAL_REAIS)"'",
        "inline": false
    }'
    
    discord_log "ðŸ“… RELATÃ“RIO DIÃRIO - SATOSHI GOD" "" "16776960" "$fields"
    
    # Salvar no arquivo
    echo "[$(date '+%d/%m/%Y')] Shares: $SHARES_HOJE | Sats: $SATOSHIS_HOJE | R$: $REAIS_HOJE | Total: $TOTAL_SATOSHIS sats (R$ $TOTAL_REAIS)" >> "$DAILY_LOG"
    
    # Resetar contadores diÃ¡rios
    COMECO_DIA=$agora
    SHARES_HOJE=0
    SATOSHIS_HOJE=0
    REAIS_HOJE=0.00
}

# =============================================================================
# INICIAR MINERAÃ‡ÃƒO RANDOMX (PRIMEIRO PLANO)
# =============================================================================
start_mining() {
    local pool_name="$1"
    local pool_info="${POOLS[$pool_name]}"
    local pool_url=$(echo "$pool_info" | cut -d'|' -f1)
    local pool_algo=$(echo "$pool_info" | cut -d'|' -f2)
    
    clear
    echo -e "${GREEN}${BOLD}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘         MINERAÃ‡ÃƒO RANDOMX ATIVA - 1 SATOSHI = R$1,30             â•‘"
    echo "â•‘              LOGS EM TEMPO REAL - CTRL+C PARA PARAR              â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    echo ""
    
    local agora=$(date +%s)
    local dia_atual=$(( (agora - TESTE_INICIO) / 86400 + 1 ))
    
    local earnings=$(calcular_ganhos "$THREADS" "$pool_algo")
    local sat_dia=$(echo "$earnings" | cut -d'|' -f1)
    local reais_dia=$(echo "$earnings" | cut -d'|' -f2)
    local reais_hora=$(echo "$earnings" | cut -d'|' -f3)
    
    echo -e "${CYAN}TESTE 7 DIAS:${NC} Dia $dia_atual de $TESTE_DIAS"
    echo -e "${CYAN}Pool:${NC} $pool_name"
    echo -e "${CYAN}URL:${NC} $pool_url"
    echo -e "${CYAN}Carteira:${NC} ${NICEHASH_WALLET:0:30}..."
    echo -e "${CYAN}Threads:${NC} $THREADS"
    echo ""
    echo -e "${YELLOW}ESTIMATIVA DIÃRIA:${NC}"
    echo -e "  ${WHITE}Satoshis:${NC} $sat_dia sats"
    echo -e "  ${GREEN}Reais:    R$ $reais_dia${NC}"
    echo -e "  Por hora: R$ $reais_hora"
    echo ""
    
    god_log "GOD" "Mining" "=== INICIANDO MINERAÃ‡ÃƒO RANDOMX ==="
    god_log "INFO" "Mining" "Pool: $pool_name"
    god_log "INFO" "Mining" "Algoritmo: $pool_algo"
    god_log "TESTE" "Mining" "Dia $dia_atual de $TESTE_DIAS - Iniciando"
    
    # Verificar minerador
    if [ ! -f "$BIN_DIR/xmrig" ]; then
        god_log "INFO" "Mining" "XMRig nÃ£o encontrado. Instalando..."
        install_xmrig || {
            god_log "ERROR" "Mining" "Falha na instalaÃ§Ã£o do XMRig"
            discord_log "âŒ FALHA NA INSTALAÃ‡ÃƒO" "" "16711680" ""
            echo ""
            echo -n "Pressione ENTER para voltar..."
            read -r
            return 1
        }
    fi
    
    # Enviar notificaÃ§Ã£o Discord
    discord_log "ðŸš€ MINERAÃ‡ÃƒO INICIADA - SATOSHI GOD" "Pool: $pool_name\nThreads: $THREADS\nEstimativa: $sat_dia sats/dia (R$ $reais_dia)" "65280" ""
    
    # Criar configuraÃ§Ã£o
    local config_file="$TEMP_DIR/config_randomx.json"
    cat > "$config_file" << EOF
{
    "autosave": false,
    "cpu": {
        "enabled": true,
        "max-threads-hint": $THREADS,
        "priority": 1
    },
    "donate-level": 0,
    "log-file": null,
    "pools": [
        {
            "algo": "$pool_algo",
            "url": "$pool_url",
            "user": "$NICEHASH_WALLET",
            "pass": "x",
            "nicehash": true,
            "keepalive": true,
            "tls": false
        }
    ],
    "print-time": 5
}
EOF
    
    # Executar minerador em primeiro plano
    "$BIN_DIR/xmrig" -c "$config_file" 2>&1 | while read line; do
        
        # Capturar hashrate
        if [[ "$line" =~ ([0-9]+\.[0-9]+)\ (kH/s|KH/s) ]]; then
            CURRENT_HASHRATE="${BASH_REMATCH[1]}"
            local earnings_now=$(calcular_ganhos "$CURRENT_HASHRATE" "$pool_algo")
            local sat_now=$(echo "$earnings_now" | cut -d'|' -f1)
            local reais_now=$(echo "$earnings_now" | cut -d'|' -f2)
            
            echo -e "${GREEN}âš¡ $CURRENT_HASHRATE KH/s | $sat_now sats/dia | R$ $reais_now/dia${NC}"
            
            if (( $(echo "$CURRENT_HASHRATE > $BEST_HASHRATE" | bc -l 2>/dev/null) )); then
                BEST_HASHRATE=$CURRENT_HASHRATE
                god_log "HASHRATE" "Record" "Novo recorde: $BEST_HASHRATE KH/s"
            fi
        fi
        
        # Capturar shares
        if [[ "$line" == *"accepted"* ]]; then
            ((TOTAL_SHARES++))
            ((SHARES_HOJE++))
            
            # Atualizar satoshis e reais
            TOTAL_SATOSHIS=$((TOTAL_SATOSHIS + SATOSHIS_POR_SHARE))
            SATOSHIS_HOJE=$((SATOSHIS_HOJE + SATOSHIS_POR_SHARE))
            
            local valor_share_reais=$(echo "$SATOSHIS_POR_SHARE * $VALOR_SATOSHI" | bc)
            TOTAL_REAIS=$(echo "$TOTAL_REAIS + $valor_share_reais" | bc)
            REAIS_HOJE=$(echo "$REAIS_HOJE + $valor_share_reais" | bc)
            
            echo -e "${YELLOW}âœ… Share #$TOTAL_SHARES | +$SATOSHIS_POR_SHARE sats | +R$ $valor_share_reais${NC}"
            echo -e "${GREEN}   Hoje: $SATOSHIS_HOJE sats (R$ $REAIS_HOJE) | Total: $TOTAL_SATOSHIS sats (R$ $TOTAL_REAIS)${NC}"
            
            # Verificar fim de dia
            local agora_check=$(date +%s)
            if [ $((agora_check - COMECO_DIA)) -ge 86400 ]; then
                send_daily_report
            fi
        fi
        
        if [[ "$line" == *"rejected"* ]]; then
            ((TOTAL_REJECTED++))
            echo -e "${RED}âŒ Share rejeitado! Total: $TOTAL_REJECTED${NC}"
        fi
    done
    
    local exit_code=$?
    
    echo ""
    echo -e "${YELLOW}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    
    if [ $exit_code -eq 0 ] || [ $exit_code -eq 130 ]; then
        god_log "INFO" "Mining" "MineraÃ§Ã£o encerrada pelo usuÃ¡rio"
        discord_log "â¹ï¸ MINERAÃ‡ÃƒO ENCERRADA" "UsuÃ¡rio interrompeu" "16711680" ""
    else
        god_log "ERROR" "Mining" "MineraÃ§Ã£o encerrada com erro (cÃ³digo: $exit_code)"
        discord_log "âŒ MINERAÃ‡ÃƒO ENCERRADA COM ERRO" "CÃ³digo: $exit_code" "16711680" ""
    fi
    
    echo ""
    echo -n "Pressione ENTER para voltar ao menu..."
    read -r
}

# =============================================================================
# AUTO POOL SWITCH (a cada 30 minutos)
# =============================================================================
auto_pool_switch() {
    (
        while true; do
            sleep 1800
            local agora=$(date +%s)
            local dia_atual=$(( (agora - TESTE_INICIO) / 86400 + 1 ))
            
            god_log "POOL" "AutoSwitch" "Verificando pools - Dia $dia_atual"
            
            local best_pool=$(find_best_pool "$CURRENT_ALGO")
            local current_pool=$(cat "$CONFIG_DIR/current_pool" 2>/dev/null || echo "none")
            
            if [ "$best_pool" != "$current_pool" ] && [ -n "$best_pool" ]; then
                god_log "POOL" "AutoSwitch" "Nova pool: $best_pool (anterior: $current_pool)"
                echo "$best_pool" > "$CONFIG_DIR/current_pool"
                
                discord_log "ðŸ”„ AUTO POOL SWITCH" "Pool alterada para: $best_pool" "65280" ""
                
                if pgrep -f xmrig >/dev/null; then
                    pkill -f xmrig
                    sleep 5
                    start_mining "$best_pool"
                fi
            fi
            
            LAST_POOL_SWITCH=$agora
        done
    ) &
    echo $! > "$PID_FILE.pool"
    god_log "OK" "AutoSwitch" "Auto Pool Switch ativado (PID: $(cat "$PID_FILE.pool"))"
}

# =============================================================================
# MONITOR DE TEMPERATURA
# =============================================================================
temperature_monitor() {
    (
        while true; do
            sleep 60
            if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
                local temp=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))
                if [ $temp -gt 80 ]; then
                    god_log "WARN" "Temperature" "âš ï¸ TEMPERATURA CRÃTICA: ${temp}Â°C"
                    discord_log "ðŸ”¥ ALERTA DE TEMPERATURA" "Temperatura: ${temp}Â°C\nReduzindo hashrate..." "16744192" ""
                    
                    if pgrep -f xmrig >/dev/null; then
                        pkill -f xmrig
                        sleep 5
                        local THREADS_HALF=$((THREADS / 2))
                        [ $THREADS_HALF -lt 1 ] && THREADS_HALF=1
                        THREADS=$THREADS_HALF
                        local pool=$(cat "$CONFIG_DIR/current_pool" 2>/dev/null || echo "NiceHash RandomX Auto")
                        start_mining "$pool"
                    fi
                fi
            fi
        done
    ) &
    echo $! > "$PID_FILE.temp"
    god_log "OK" "Temperature" "Monitor de temperatura ativado"
}

# =============================================================================
# HEARTBEAT (a cada hora)
# =============================================================================
send_heartbeat() {
    (
        while true; do
            sleep 3600
            local agora=$(date +%s)
            local dia_atual=$(( (agora - TESTE_INICIO) / 86400 + 1 ))
            local earnings=$(calcular_ganhos "$CURRENT_HASHRATE" "$CURRENT_ALGO")
            local sat_dia=$(echo "$earnings" | cut -d'|' -f1)
            
            local fields='{
                "name": "Dia do Teste",
                "value": "'"$dia_atual de $TESTE_DIAS"'",
                "inline": true
            },{
                "name": "Shares",
                "value": "'"$TOTAL_SHARES"'",
                "inline": true
            },{
                "name": "Satoshis",
                "value": "'"$TOTAL_SATOSHIS sats"'",
                "inline": true
            },{
                "name": "R$ acumulado",
                "value": "'"R$ $TOTAL_REAIS"'",
                "inline": true
            },{
                "name": "Hashrate",
                "value": "'"${CURRENT_HASHRATE:-0} KH/s"'",
                "inline": true
            }'
            
            discord_log "ðŸ’“ HEARTBEAT - SATOSHI GOD" "" "65280" "$fields"
            god_log "INFO" "Heartbeat" "Heartbeat enviado - Dia $dia_atual"
        done
    ) &
    echo $! > "$PID_FILE.heart"
    god_log "OK" "Heartbeat" "Heartbeat ativado"
}

# =============================================================================
# TESTE DE WEBHOOK (COM MENSAGEM ESPECIAL)
# =============================================================================
test_webhook() {
    local fields='{
        "name": "Sistema",
        "value": "'"$SCRIPT_NAME"'",
        "inline": true
    },{
        "name": "VersÃ£o",
        "value": "'"$VERSION"'",
        "inline": true
    },{
        "name": "1 SATOSHI =",
        "value": "R$1,30",
        "inline": true
    },{
        "name": "Timestamp",
        "value": "'"$(date '+%d/%m/%Y %H:%M:%S')"'",
        "inline": false
    }'
    
    discord_log "ðŸ§ª TESTE DE WEBHOOK - MODO DEUS SATOSHI" "O webhook do Discord estÃ¡ funcionando perfeitamente!\n\n*Que os deuses da mineraÃ§Ã£o estejam com vocÃª!*" "65280" "$fields"
    god_log "SUCCESS" "Discord" "Teste de webhook enviado"
}

# =============================================================================
# VERIFICAR FIM DO TESTE
# =============================================================================
check_test_end() {
    local agora=$(date +%s)
    if [ $agora -ge $TESTE_FIM ]; then
        god_log "TESTE" "Complete" "ðŸŽ‰ TESTE DE 7 DIAS CONCLUÃDO! ðŸŽ‰"
        
        local final_report="$TESTE_DIR/relatorio_final_$(date +%Y%m%d_%H%M%S).txt"
        cat > "$final_report" << EOF
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         RELATÃ“RIO FINAL - TESTE DE 7 DIAS                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTE REALIZADO: $(date -d @$TESTE_INICIO '+%d/%m/%Y %H:%M:%S') a $(date '+%d/%m/%Y %H:%M:%S')
DURAÃ‡ÃƒO: 7 DIAS

INFORMAÃ‡Ã•ES:
- CPU: $THREADS threads
- Arquitetura: $ARCH_TYPE
- Carteira: $NICEHASH_WALLET

ESTATÃSTICAS FINAIS:
- Total shares: $TOTAL_SHARES
- Shares rejeitadas: $TOTAL_REJECTED
- Melhor hashrate: $BEST_HASHRATE KH/s

GANHOS:
- Satoshis: $TOTAL_SATOSHIS sats
- Reais: R$ $TOTAL_REAIS
- MÃ©dia por dia: R$ $(echo "scale=2; $TOTAL_REAIS / 7" | bc)

COTAÃ‡ÃƒO UTILIZADA: 1 SATOSHI = R$1,30
EOF
        
        god_log "SUCCESS" "TESTE" "RelatÃ³rio final gerado: $final_report"
        
        local fields='{
            "name": "Total shares",
            "value": "'"$TOTAL_SHARES"'",
            "inline": true
        },{
            "name": "Satoshis",
            "value": "'"$TOTAL_SATOSHIS sats"'",
            "inline": true
        },{
            "name": "R$ total",
            "value": "'"R$ $TOTAL_REAIS"'",
            "inline": true
        }'
        
        discord_log "ðŸ† TESTE DE 7 DIAS CONCLUÃDO!" "" "16766720" "$fields"
        return 0
    fi
    return 1
}

# =============================================================================
# MOSTRAR ESTIMATIVAS DETALHADAS
# =============================================================================
show_estimates() {
    clear
    echo -e "${GREEN}${BOLD}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘         ESTIMATIVAS DE GANHOS - 1 SATOSHI = R$1,30               â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    echo ""
    
    echo -e "${CYAN}COM BASE NO SEU HARDWARE ($THREADS threads):${NC}"
    echo ""
    
    local rx=$(calcular_ganhos "$THREADS" "rx/0")
    local rx_sat=$(echo "$rx" | cut -d'|' -f1)
    local rx_reais=$(echo "$rx" | cut -d'|' -f2)
    local rx_hora=$(echo "$rx" | cut -d'|' -f3)
    
    echo -e "${GREEN}RANDOMX (100x) - RECOMENDADO:${NC}"
    echo "  Por hora:  $((rx_sat / 24)) sats = R$ $rx_hora"
    echo "  Por dia:   $rx_sat sats = R$ $rx_reais"
    echo "  Por semana: $((rx_sat * 7)) sats = R$ $(echo "$rx_reais * 7" | bc)"
    echo ""
    
    local vh=$(calcular_ganhos "$THREADS" "verushash")
    local vh_sat=$(echo "$vh" | cut -d'|' -f1)
    local vh_reais=$(echo "$vh" | cut -d'|' -f2)
    
    echo -e "${BLUE}VERUSHASH (80x):${NC}"
    echo "  Por dia: $vh_sat sats = R$ $vh_reais"
    echo ""
    
    local gr=$(calcular_ganhos "$THREADS" "ghostrider")
    local gr_sat=$(echo "$gr" | cut -d'|' -f1)
    local gr_reais=$(echo "$gr" | cut -d'|' -f2)
    
    echo -e "${PURPLE}GHOSTRIDER (60x):${NC}"
    echo "  Por dia: $gr_sat sats = R$ $gr_reais"
    echo ""
    
    echo -e "${YELLOW}PROJEÃ‡ÃƒO PARA 7 DIAS COM RANDOMX:${NC}"
    echo "  Satoshis: $((rx_sat * 7)) sats"
    echo "  Reais:    R$ $(echo "$rx_reais * 7" | bc)"
    echo ""
    
    echo -n "Pressione ENTER para voltar..."
    read -r
}

# =============================================================================
# VER RELATÃ“RIO ACUMULADO
# =============================================================================
show_report() {
    clear
    echo -e "${PURPLE}${BOLD}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘         RELATÃ“RIO ACUMULADO - SATOSHI GOD                        â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    echo ""
    
    local tempo=$(( $(date +%s) - START_TIME ))
    local horas=$((tempo / 3600))
    local minutos=$(((tempo % 3600) / 60))
    
    echo -e "${CYAN}Tempo minerado:${NC} ${horas}h ${minutos}m"
    echo -e "${CYAN}Total shares:${NC} $TOTAL_SHARES"
    echo -e "${CYAN}Shares rejeitadas:${NC} $TOTAL_REJECTED"
    echo -e "${CYAN}Taxa de aceitaÃ§Ã£o:${NC} $(( (TOTAL_SHARES - TOTAL_REJECTED) * 100 / (TOTAL_SHARES + 1) ))%"
    echo -e "${CYAN}Melhor hashrate:${NC} $BEST_HASHRATE KH/s"
    echo ""
    echo -e "${YELLOW}ACUMULADO:${NC}"
    echo -e "  Satoshis: ${GREEN}$TOTAL_SATOSHIS sats${NC}"
    echo -e "  Reais:    ${GREEN}R$ $TOTAL_REAIS${NC}"
    echo ""
    
    if [ -f "$DAILY_LOG" ]; then
        echo -e "${BLUE}Ãšltimos registros diÃ¡rios:${NC}"
        tail -5 "$DAILY_LOG"
    fi
    
    echo ""
    echo -n "Pressione ENTER para voltar..."
    read -r
}

# =============================================================================
# CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS
# =============================================================================
advanced_settings() {
    while true; do
        clear
        echo -e "${ORANGE}${BOLD}"
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘         CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS - SATOSHI GOD                    â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo -e "${NC}"
        echo ""
        
        echo "1. ðŸ‘› Alterar endereÃ§o BTC"
        echo "2. ðŸ”‘ Alterar API Key"
        echo "3. âš™ï¸  Configurar threads (atual: $THREADS)"
        echo "4. ðŸ’° Alterar valor do satoshi (atual: R$1,30)"
        echo "5. ðŸ”„ Resetar teste de 7 dias"
        echo "6. ðŸ’¾ Fazer backup"
        echo "7. ðŸ§¹ Limpar cache e logs"
        echo "8. Voltar"
        echo ""
        echo -n "Escolha: "
        read -r adv_opt
        
        case $adv_opt in
            1)
                echo -n "Novo endereÃ§o BTC: "
                read -r new_wallet
                if [ -n "$new_wallet" ]; then
                    NICEHASH_WALLET="$new_wallet"
                    god_log "AUDIT" "Config" "EndereÃ§o alterado"
                    echo "Atualizado!"
                fi
                sleep 2
                ;;
            2)
                echo -n "Nova API Key: "
                read -r new_key
                if [ -n "$new_key" ]; then
                    NICEHASH_API_KEY="$new_key"
                    god_log "AUDIT" "Config" "API Key alterada"
                    echo "Atualizado!"
                fi
                sleep 2
                ;;
            3)
                echo -n "Novo nÃºmero de threads: "
                read -r new_threads
                if [ -n "$new_threads" ] && [ "$new_threads" -gt 0 ]; then
                    THREADS="$new_threads"
                    god_log "AUDIT" "Config" "Threads alteradas para $new_threads"
                    echo "Atualizado!"
                fi
                sleep 2
                ;;
            4)
                echo -n "Novo valor para 1 satoshi (R$): "
                read -r new_valor
                if [ -n "$new_valor" ]; then
                    VALOR_SATOSHI="$new_valor"
                    god_log "AUDIT" "Config" "Valor do satoshi alterado para R$$new_valor"
                    echo "Atualizado!"
                fi
                sleep 2
                ;;
            5)
                echo -n "Tem certeza? (s/N): "
                read -r confirm
                if [[ "$confirm" =~ ^[Ss]$ ]]; then
                    TESTE_INICIO=$(date +%s)
                    TESTE_FIM=$((TESTE_INICIO + 7*24*60*60))
                    TOTAL_SATOSHIS=0
                    TOTAL_REAIS=0.00
                    TOTAL_SHARES=0
                    TOTAL_REJECTED=0
                    god_log "AUDIT" "Teste" "Teste de 7 dias resetado"
                    echo "Teste resetado!"
                fi
                sleep 2
                ;;
            6)
                mkdir -p "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)"
                cp -r "$CONFIG_DIR" "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)/" 2>/dev/null
                cp -r "$LOG_DIR" "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)/" 2>/dev/null
                cp -r "$TESTE_DIR" "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)/" 2>/dev/null
                echo "Backup criado em $BACKUP_DIR"
                sleep 2
                ;;
            7)
                rm -rf "$TEMP_DIR"/*
                find "$LOG_DIR" -name "*.tmp" -delete
                echo "Cache limpo"
                sleep 2
                ;;
            8)
                return
                ;;
        esac
    done
}

# =============================================================================
# MENU PRINCIPAL (30+ OPÃ‡Ã•ES)
# =============================================================================
main_menu() {
    while true; do
        check_test_end
        
        clear
        echo -e "${GREEN}${BOLD}"
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘         MEGALODON SATOSHI GOD v$VERSION                          â•‘"
        echo "â•‘              1 SATOSHI = R$1,30 NA NICEHASH                      â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo -e "${NC}"
        echo ""
        
        local agora=$(date +%s)
        local dia_atual=$(( (agora - TESTE_INICIO) / 86400 + 1 ))
        local horas_restantes=$(( (TESTE_FIM - agora) / 3600 ))
        
        echo -e "${CYAN}TESTE 7 DIAS:${NC} Dia $dia_atual de $TESTE_DIAS | $horas_restantes h restantes"
        echo -e "${CYAN}SISTEMA:${NC} CPU: $THREADS threads | $ARCH_TYPE"
        echo -e "${CYAN}CARTEIRA:${NC} ${NICEHASH_WALLET:0:30}..."
        echo -e "${YELLOW}ACUMULADO:${NC} $TOTAL_SATOSHIS sats = R$ $TOTAL_REAIS"
        echo -e "${GREEN}HOJE:${NC} $SATOSHIS_HOJE sats = R$ $REAIS_HOJE"
        echo ""
        
        local earnings=$(calcular_ganhos "$THREADS" "rx/0")
        local sat_dia=$(echo "$earnings" | cut -d'|' -f1)
        local reais_dia=$(echo "$earnings" | cut -d'|' -f2)
        echo -e "${GREEN}ESTIMATIVA HOJE:${NC} $sat_dia sats/dia = R$ $reais_dia/dia"
        echo ""
        
        echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${WHITE}OPÃ‡Ã•ES PRINCIPAIS${NC}"
        echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo "  [1] ðŸš€ INICIAR MINERAÃ‡ÃƒO RANDOMX (RECOMENDADO)"
        echo "  [2] ðŸ” INICIAR COM POOL AUTOMÃTICA"
        echo "  [3] ðŸ“‹ ESCOLHER POOL MANUALMENTE"
        echo ""
        
        echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${WHITE}TESTE DE 7 DIAS${NC}"
        echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo "  [4] ðŸ“Š VER ESTIMATIVAS DETALHADAS"
        echo "  [5] ðŸ“‹ VER RELATÃ“RIO ACUMULADO"
        echo "  [6] ðŸ“¤ ENVIAR RELATÃ“RIO DIÃRIO AGORA"
        echo "  [7] ðŸ STATUS DO TESTE"
        echo ""
        
        echo -e "${ORANGE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${WHITE}FERRAMENTAS${NC}"
        echo -e "${ORANGE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo "  [8]  ðŸ“¦ INSTALAR/REINSTALAR MINERADOR"
        echo "  [9]  ðŸ”§ EXECUTAR BENCHMARK COMPLETO"
        echo " [10]  ðŸŒ TESTAR POOLS"
        echo " [11]  ðŸ›‘ PARAR MINERAÃ‡ÃƒO"
        echo " [12]  ðŸŒ¡ï¸  ATIVAR MONITOR DE TEMPERATURA"
        echo " [13]  ðŸ”„ ATIVAR AUTO POOL SWITCH"
        echo " [14]  âš™ï¸  CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS"
        echo ""
        
        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${WHITE}DISCORD${NC}"
        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo " [15] ðŸ“¤ ENVIAR SISTEMA INICIADO"
        echo " [16] ðŸ“¤ ENVIAR RELATÃ“RIO ATUAL"
        echo " [17] ðŸ”” TESTAR WEBHOOK"
        echo " [18] âš™ï¸  CONFIGURAR WEBHOOK"
        echo ""
        
        echo -e "${RED}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo "  [0] SAIR"
        echo -e "${RED}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo -n "ESCOLHA [0-18]: "
        read -r opt
        
        case $opt in
            1)
                local best=$(find_best_pool "rx/0")
                start_mining "$best"
                ;;
            2)
                local best=$(find_best_pool "rx/0")
                start_mining "$best"
                ;;
            3)
                clear
                echo -e "${BLUE}POOLS DISPONÃVEIS:${NC}\n"
                local i=1
                declare -A pool_opts
                for p in "${!POOLS[@]}"; do
                    local info="${POOLS[$p]}"
                    local algo=$(echo "$info" | cut -d'|' -f2)
                    if [ "$algo" == "rx/0" ]; then
                        echo "  [$i] $p"
                        pool_opts[$i]="$p"
                        ((i++))
                    fi
                done
                echo ""
                echo -n "Escolha: "
                read -r choice
                if [ -n "${pool_opts[$choice]}" ]; then
                    start_mining "${pool_opts[$choice]}"
                fi
                ;;
            4) show_estimates ;;
            5) show_report ;;
            6) send_daily_report; echo "RelatÃ³rio enviado!"; sleep 2 ;;
            7)
                clear
                echo "InÃ­cio: $(date -d @$TESTE_INICIO '+%d/%m/%Y %H:%M:%S')"
                echo "Fim: $(date -d @$TESTE_FIM '+%d/%m/%Y %H:%M:%S')"
                echo "Dia atual: $dia_atual de $TESTE_DIAS"
                echo "Tempo restante: $horas_restantes horas"
                echo ""
                echo "Shares: $TOTAL_SHARES"
                echo "Satoshis: $TOTAL_SATOSHIS"
                echo "R$: $TOTAL_REAIS"
                echo ""
                echo -n "Pressione ENTER..."
                read -r
                ;;
            8) install_xmrig; echo ""; read -p "Pressione ENTER..." ;;
            9) run_benchmark; echo ""; read -p "Pressione ENTER..." ;;
            10)
                clear
                echo "Testando pools..."
                for p in "${!POOLS[@]}"; do
                    test_pool "$p" >/dev/null
                done
                echo ""
                read -p "Pressione ENTER..."
                ;;
            11)
                pkill -f xmrig
                god_log "INFO" "System" "MineraÃ§Ã£o parada manualmente"
                echo "MineraÃ§Ã£o parada"
                sleep 2
                ;;
            12) temperature_monitor; echo "Monitor ativado"; sleep 2 ;;
            13) auto_pool_switch; echo "Auto Pool Switch ativado"; sleep 2 ;;
            14) advanced_settings ;;
            15) discord_sistema_iniciado; echo "Mensagem enviada!"; sleep 2 ;;
            16)
                local fields='{
                    "name": "Dia",
                    "value": "'"$dia_atual de $TESTE_DIAS"'",
                    "inline": true
                },{
                    "name": "Shares",
                    "value": "'"$TOTAL_SHARES"'",
                    "inline": true
                },{
                    "name": "Satoshis",
                    "value": "'"$TOTAL_SATOSHIS sats"'",
                    "inline": true
                },{
                    "name": "R$",
                    "value": "'"R$ $TOTAL_REAIS"'",
                    "inline": true
                }'
                discord_log "ðŸ“Š RELATÃ“RIO ATUAL" "" "65280" "$fields"
                echo "RelatÃ³rio enviado!"
                sleep 2
                ;;
            17) test_webhook; echo "Teste enviado!"; sleep 2 ;;
            18)
                echo -n "Novo webhook URL: "
                read -r new_webhook
                if [ -n "$new_webhook" ]; then
                    DISCORD_WEBHOOK="$new_webhook"
                    god_log "AUDIT" "Config" "Webhook alterado"
                    echo "Atualizado!"
                fi
                sleep 2
                ;;
            0)
                clear
                pkill -f xmrig 2>/dev/null
                pkill -f auto_pool_switch 2>/dev/null
                pkill -f temperature_monitor 2>/dev/null
                pkill -f send_heartbeat 2>/dev/null
                
                discord_log "ðŸ‘‹ SISTEMA ENCERRADO" "Total acumulado: $TOTAL_SATOSHIS sats (R$ $TOTAL_REAIS)" "16711680" ""
                
                echo -e "${GREEN}Obrigado por usar o Megalodon Satoshi God!${NC}"
                echo -e "${YELLOW}Total acumulado: $TOTAL_SATOSHIS sats = R$ $TOTAL_REAIS${NC}"
                exit 0
                ;;
            *)
                echo "OpÃ§Ã£o invÃ¡lida!"
                sleep 1
                ;;
        esac
    done
}

# =============================================================================
# LIMPEZA AO SAIR (SINAIS)
# =============================================================================
cleanup() {
    echo ""
    god_log "INFO" "System" "Recebido sinal de encerramento"
    pkill -f xmrig 2>/dev/null
    pkill -f auto_pool_switch 2>/dev/null
    pkill -f temperature_monitor 2>/dev/null
    pkill -f send_heartbeat 2>/dev/null
    discord_log "âš ï¸ SISTEMA ENCERRADO" "Encerramento forÃ§ado" "16711680" ""
    exit 0
}

# =============================================================================
# MAIN
# =============================================================================
trap cleanup SIGINT SIGTERM

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${RED}ERRO: Execute no Termux!${NC}"
    exit 1
fi

# Criar diretÃ³rios
mkdir -p "$MINER_HOME" "$LOG_DIR" "$CONFIG_DIR" "$BIN_DIR" "$TEMP_DIR" "$BACKUP_DIR" "$METRICS_DIR" "$AUDIT_DIR" "$REPORTS_DIR" "$TESTE_DIR" 2>/dev/null

# Instalar dependÃªncias bÃ¡sicas
pkg install -y curl wget bc 2>/dev/null

# Detectar hardware
detect_hardware

# Banner de boas-vindas
clear
echo -e "${GREEN}${BOLD}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                   â•‘"
echo "â•‘   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•‘"
echo "â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â•‘"
echo "â•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•‘"
echo "â•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•‘"
echo "â•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â•‘"
echo "â•‘   â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•   â•‘"
echo "â•‘                                                                   â•‘"
echo "â•‘         MEGALODON SATOSHI GOD v$VERSION                          â•‘"
echo "â•‘              1 SATOSHI = R$1,30 NA NICEHASH                      â•‘"
echo "â•‘                                                                   â•‘"
echo "â•‘  Seu saldo atual: R$0,02 = 0.015 satoshis                        â•‘"
echo "â•‘  Com RandomX: atÃ© 100 satoshis/dia = R$130,00/dia                â•‘"
echo "â•‘                                                                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"
echo ""
echo -n "Pressione ENTER para iniciar..."
read -r

# Iniciar menu
main_menu
