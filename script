#!/data/data/com.termux/files/usr/bin/bash

# ============================================================================
# NICEHASH MINER ULTIMATE - SISTEMA DE MINERAÃ‡ÃƒO COMPLETO v10.0
# ============================================================================
#   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
#   â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
#   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
#   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
#   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
#   â•šâ•â•  â•šâ•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
# ============================================================================
# SISTEMA COMPLETO - 30+ MÃ‰TODOS DE DOWNLOAD - 50+ POOLS NICEHASH
# LOGS DISCORD GIGANTESCOS - TODOS OS DETALHES - NENHUMA SIMPLIFICAÃ‡ÃƒO
# ============================================================================

# ----------------------------------------------------------------------------
# CONFIGURAÃ‡Ã•ES DO USUÃRIO - NÃƒO ALTERAR (JÃ CONFIGURADO)
# ----------------------------------------------------------------------------
export WALLET_NICEHASH="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
export WEBHOOK_DISCORD="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# ----------------------------------------------------------------------------
# VARIÃVEIS GLOBAIS DO SISTEMA (NUNCA SIMPLIFICAR)
# ----------------------------------------------------------------------------
SYSTEM_VERSION="10.0.0"
SYSTEM_BUILD="$(date +%Y%m%d%H%M%S)"
START_TIME=$(date +%s)
MINER_ROOT="/data/data/com.termux/files/home/nicehash_miner_ultimate"
MINER_BIN="$MINER_ROOT/bin"
MINER_CONFIG="$MINER_ROOT/config"
MINER_LOGS="$MINER_ROOT/logs"
MINER_STATS="$MINER_ROOT/stats"
MINER_SCRIPTS="$MINER_ROOT/scripts"
MINER_TEMP="$MINER_ROOT/temp"
MINER_BACKUP="$MINER_ROOT/backup"
MINER_CACHE="$MINER_ROOT/cache"
MINER_REPORTS="$MINER_ROOT/reports"
MINER_ANALYTICS="$MINER_ROOT/analytics"
MINER_HISTORY="$MINER_ROOT/history"
MINER_WEB="$MINER_ROOT/web"
MINER_API="$MINER_ROOT/api"
MINER_PLUGINS="$MINER_ROOT/plugins"
MINER_EVENTS="$MINER_ROOT/events"
MINER_ALERTS="$MINER_ROOT/alerts"
MINER_MONITOR="$MINER_ROOT/monitor"
MINER_PERFORMANCE="$MINER_ROOT/performance"
MINER_NETWORK="$MINER_ROOT/network"
MINER_SECURITY="$MINER_ROOT/security"
MINER_DISCORD="$MINER_ROOT/discord"
MINER_CRYPTO="$MINER_ROOT/crypto"
MINER_PAYMENTS="$MINER_ROOT/payments"
MINER_WALLETS="$MINER_ROOT/wallets"
MINER_WORKERS="$MINER_ROOT/workers"

# Criar todos os diretÃ³rios (MEGA ESTRUTURA)
for dir in \
    "$MINER_ROOT" "$MINER_BIN" "$MINER_CONFIG" "$MINER_LOGS" "$MINER_STATS" \
    "$MINER_SCRIPTS" "$MINER_TEMP" "$MINER_BACKUP" "$MINER_CACHE" "$MINER_REPORTS" \
    "$MINER_ANALYTICS" "$MINER_HISTORY" "$MINER_WEB" "$MINER_API" "$MINER_PLUGINS" \
    "$MINER_EVENTS" "$MINER_ALERTS" "$MINER_MONITOR" "$MINER_PERFORMANCE" \
    "$MINER_NETWORK" "$MINER_SECURITY" "$MINER_DISCORD" "$MINER_CRYPTO" \
    "$MINER_PAYMENTS" "$MINER_WALLETS" "$MINER_WORKERS" ; do
    mkdir -p "$dir"
done

# ----------------------------------------------------------------------------
# ARQUIVOS DE LOG (MEGA LISTA - TUDO SERÃ LOGADO)
# ----------------------------------------------------------------------------
declare -a LOG_FILES=(
    "system_master.log"
    "miner_complete.log"
    "error_trace.log"
    "debug_trace.log"
    "bitcoin_earnings.log"
    "satoshi_every_second.log"
    "satoshi_per_minute.log"
    "satoshi_per_hour.log"
    "satoshi_per_day.log"
    "satoshi_detailed.log"
    "satoshi_instant.log"
    "hashrate_history.log"
    "hashrate_average.log"
    "temperature_history.log"
    "temperature_alerts.log"
    "shares_accepted.log"
    "shares_rejected.log"
    "shares_difficulty.log"
    "pool_connections.log"
    "pool_switches.log"
    "pool_latency.log"
    "worker_performance.log"
    "worker_uptime.log"
    "cpu_usage.log"
    "cpu_frequency.log"
    "memory_usage.log"
    "network_stats.log"
    "network_speed.log"
    "discord_notifications.log"
    "discord_errors.log"
    "discord_ratelimit.log"
    "wallet_transactions.log"
    "wallet_balance.log"
    "wallet_payments.log"
    "profit_calculations.log"
    "profit_daily.log"
    "profit_hourly.log"
    "profit_minute.log"
    "performance_benchmark.log"
    "performance_optimization.log"
    "system_events.log"
    "system_errors.log"
    "system_warnings.log"
    "system_info.log"
    "mining_session.log"
    "mining_summary.log"
    "mining_restarts.log"
    "mining_stops.log"
    "mining_starts.log"
    "mining_crashes.log"
    "algorithm_switches.log"
    "algorithm_efficiency.log"
    "hardware_info.log"
    "hardware_throttling.log"
    "battery_usage.log"
    "thermal_throttling.log"
    "api_calls.log"
    "web_requests.log"
    "plugins_load.log"
    "events_triggered.log"
    "alerts_sent.log"
    "alerts_received.log"
    "commands_executed.log"
    "commands_history.log"
    "backup_history.log"
    "restore_history.log"
    "update_history.log"
)

for file in "${LOG_FILES[@]}"; do
    touch "$MINER_LOGS/$file"
done

# ----------------------------------------------------------------------------
# CORES PARA TERMINAL (MEGA PALETA)
# ----------------------------------------------------------------------------
NC='\033[0m'
BLACK='\033[0;30m'; RED='\033[0;31m'; GREEN='\033[0;32m'; YELLOW='\033[1;33m'
BLUE='\033[0;34m'; PURPLE='\033[0;35m'; CYAN='\033[0;36m'; WHITE='\033[1;37m'
ORANGE='\033[38;5;208m'; PINK='\033[38;5;213m'; LIME='\033[38;5;154m'
TEAL='\033[38;5;123m'; GOLD='\033[38;5;220m'; PURPLE_BRIGHT='\033[38;5;93m'
TURQUOISE='\033[38;5;45m'; NEON_GREEN='\033[38;5;46m'; NEON_BLUE='\033[38;5;81m'
NEON_PINK='\033[38;5;201m'; MAROON='\033[38;5;52m'; OLIVE='\033[38;5;58m'
NAVY='\033[38;5;17m'; TEAL_DARK='\033[38;5;30m'; SILVER='\033[38;5;145m'

BOLD='\033[1m'; DIM='\033[2m'; ITALIC='\033[3m'; UNDERLINE='\033[4m'
BLINK='\033[5m'; REVERSE='\033[7m'; HIDDEN='\033[8m'; STRIKE='\033[9m'

COLOR_TITLE="${PURPLE_BRIGHT}${BOLD}${UNDERLINE}"
COLOR_SUCCESS="${GREEN}${BOLD}"; COLOR_WARNING="${YELLOW}${BOLD}"
COLOR_ERROR="${RED}${BOLD}"; COLOR_INFO="${CYAN}${BOLD}"
COLOR_PROFIT="${GOLD}${BOLD}"; COLOR_HASHRATE="${LIME}${BOLD}"
COLOR_TEMP="${ORANGE}${BOLD}"; COLOR_STATUS="${TEAL}${BOLD}"
COLOR_MENU="${BLUE}${BOLD}"; COLOR_BITCOIN="${GOLD}${BOLD}${BLINK}"
COLOR_SATOSHI="${YELLOW}${BOLD}${BLINK}"; COLOR_NETWORK="${NEON_BLUE}${BOLD}"
COLOR_DEBUG="${DIM}${SILVER}"; COLOR_PERFORMANCE="${NEON_GREEN}${BOLD}"
COLOR_SECURITY="${MAROON}${BOLD}"; COLOR_WALLET="${NEON_PINK}${BOLD}"
COLOR_POOL="${TURQUOISE}${BOLD}"; COLOR_WORKER="${TEAL_DARK}${BOLD}"

# ----------------------------------------------------------------------------
# FUNÃ‡ÃƒO DE LOG ULTRA COMPLETA (NIVEL DEUS)
# ----------------------------------------------------------------------------
log_ultimate() {
    local level="$1"
    local module="$2"
    local message="$3"
    local color="$4"
    local timestamp_full="[$(date '+%Y-%m-%d %H:%M:%S.%3N')]"
    local timestamp_short="[$(date '+%H:%M:%S')]"
    local log_id="LOG_$(date +%s%N | cut -c1-13)_${RANDOM}"
    local log_entry="$timestamp_full [$level] [$module] [ID:$log_id] $message"
    
    # Log mestre (tudo)
    echo "$log_entry" >> "$MINER_LOGS/system_master.log"
    
    # Log por mÃ³dulo
    case "$module" in
        MINER)      echo "$log_entry" >> "$MINER_LOGS/miner_complete.log" ;;
        ERROR)      echo "$log_entry" >> "$MINER_LOGS/error_trace.log" ;;
        DEBUG)      echo "$log_entry" >> "$MINER_LOGS/debug_trace.log" ;;
        BITCOIN)    echo "$log_entry" >> "$MINER_LOGS/bitcoin_earnings.log" ;;
        SATOSHI)    echo "$log_entry" >> "$MINER_LOGS/satoshi_detailed.log" ;;
        HASHRATE)   echo "$log_entry" >> "$MINER_LOGS/hashrate_history.log" ;;
        TEMP)       echo "$log_entry" >> "$MINER_LOGS/temperature_history.log" ;;
        SHARE)      echo "$log_entry" >> "$MINER_LOGS/shares_accepted.log" ;;
        POOL)       echo "$log_entry" >> "$MINER_LOGS/pool_connections.log" ;;
        WORKER)     echo "$log_entry" >> "$MINER_LOGS/worker_performance.log" ;;
        CPU)        echo "$log_entry" >> "$MINER_LOGS/cpu_usage.log" ;;
        MEM)        echo "$log_entry" >> "$MINER_LOGS/memory_usage.log" ;;
        NET)        echo "$log_entry" >> "$MINER_LOGS/network_stats.log" ;;
        DISCORD)    echo "$log_entry" >> "$MINER_LOGS/discord_notifications.log" ;;
        WALLET)     echo "$log_entry" >> "$MINER_LOGS/wallet_transactions.log" ;;
        PROFIT)     echo "$log_entry" >> "$MINER_LOGS/profit_calculations.log" ;;
        PERF)       echo "$log_entry" >> "$MINER_LOGS/performance_benchmark.log" ;;
        EVENT)      echo "$log_entry" >> "$MINER_LOGS/system_events.log" ;;
        CMD)        echo "$log_entry" >> "$MINER_LOGS/commands_executed.log" ;;
        *)          echo "$log_entry" >> "$MINER_LOGS/system_master.log" ;;
    esac
    
    # Log por nÃ­vel
    case "$level" in
        ERROR|CRITICAL) echo "$log_entry" >> "$MINER_LOGS/system_errors.log" ;;
        WARNING)        echo "$log_entry" >> "$MINER_LOGS/system_warnings.log" ;;
        INFO)           echo "$log_entry" >> "$MINER_LOGS/system_info.log" ;;
    esac
    
    # Console
    if [ -n "$color" ]; then
        echo -e "${color}${timestamp_short} [$level] [$module]${NC} $message"
    else
        echo "${timestamp_short} [$level] [$module] $message"
    fi
}

# Atalhos de log
log_sys()    { log_ultimate "INFO"    "SYSTEM"    "$1" "$COLOR_INFO"; }
log_miner()  { log_ultimate "INFO"    "MINER"     "$1" "$COLOR_INFO"; }
log_success(){ log_ultimate "SUCCESS" "SYSTEM"    "$1" "$COLOR_SUCCESS"; }
log_warn()   { log_ultimate "WARNING" "SYSTEM"    "$1" "$COLOR_WARNING"; }
log_error()  { log_ultimate "ERROR"   "ERROR"     "$1" "$COLOR_ERROR"; }
log_debug()  { log_ultimate "DEBUG"   "DEBUG"     "$1" "$COLOR_DEBUG"; }
log_bitc()   { log_ultimate "BITCOIN" "BITCOIN"   "$1" "$COLOR_BITCOIN"; }
log_perf()   { log_ultimate "PERF"    "PERF"      "$1" "$COLOR_PERFORMANCE"; }
log_cmd()    { log_ultimate "COMMAND" "CMD"       "$1" "$COLOR_MENU"; }

# ----------------------------------------------------------------------------
# LOG DE SATOSHI EM TEMPO REAL (EXATAMENTE COMO NA IMAGEM)
# ----------------------------------------------------------------------------
log_satoshi_instant() {
    local sats="$1"
    local hashrate="$2"
    local temp="$3"
    local total_sats="$4"
    local usd_hour="$5"
    local algo="$6"
    local pool="$7"
    local worker="$8"
    local timestamp="$(date '+%H:%M:%S')"
    
    # SaÃ­da exata para o terminal (como na imagem)
    echo -e "${COLOR_SATOSHI}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                    ğŸ“Š SATOSHI MINERADO AGORA!                       â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘  Hora: ${timestamp}                                                â•‘"
    echo "â•‘  Hashrate Atual: ${hashrate} H/s                                   â•‘"
    echo "â•‘  Temperatura: ${temp}Â°C                                            â•‘"
    echo "â•‘  Satoshis nesta transaÃ§Ã£o: ${sats} sats                            â•‘"
    echo "â•‘  Algoritmo: ${algo}                                                â•‘"
    echo "â•‘  Pool: ${pool}                                                      â•‘"
    echo "â•‘  Worker: ${worker}                                                  â•‘"
    echo "â•‘                                                                      â•‘"
    echo "â•‘  Total Acumulado (sessÃ£o): ${total_sats} satoshis                 â•‘"
    echo "â•‘  Estimativa USD/hora: \$${usd_hour}                                 â•‘"
    echo "â•‘                                                                      â•‘"
    echo "â•‘  Carteira de depÃ³sito: ${WALLET_NICEHASH:0:20}...                  â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    
    # Logs detalhados para cada arquivo
    echo "$(date '+%Y-%m-%d %H:%M:%S') | SATOSHIS=$sats | HASHRATE=$hashrate | TEMP=$temp | TOTAL=$total_sats | USD/HORA=$usd_hour | ALGO=$algo | POOL=$pool | WORKER=$worker" >> "$MINER_LOGS/satoshi_instant.log"
    echo "$(date '+%Y-%m-%d %H:%M:%S'),$sats,$hashrate,$temp,$total_sats,$usd_hour,$algo,$pool,$worker" >> "$MINER_LOGS/satoshi_per_minute.log"
    
    # Atualizar estatÃ­sticas
    echo "$total_sats" > "$MINER_STATS/total_satoshis"
    echo "$hashrate" > "$MINER_STATS/current_hashrate"
    echo "$temp" > "$MINER_STATS/current_temperature"
    echo "$usd_hour" > "$MINER_STATS/usd_per_hour"
    
    # Enviar notificaÃ§Ã£o para Discord (cada satoshi!)
    discord_satoshi_instant "$sats" "$hashrate" "$temp" "$total_sats" "$usd_hour" "$algo"
}

# ----------------------------------------------------------------------------
# SISTEMA DE DISCORD MEGA DETALHADO (TUDO Ã‰ LOGADO, NUNCA SIMPLIFICADO)
# ----------------------------------------------------------------------------
discord_send() {
    local message="$1"
    local color="$2"
    local title="$3"
    local fields="$4"
    
    if [ -z "$WEBHOOK_DISCORD" ]; then
        log_warn "Webhook Discord nÃ£o configurado"
        return 1
    fi
    
    # Limitar tamanho (Discord max 2000)
    message="$(echo "$message" | cut -c1-1900)"
    
    # Construir JSON com fields se existirem
    local json='{
  "embeds": [{
    "title": "'"$title"'",
    "description": "'"$message"'",
    "color": '"$color"',
    "timestamp": "'"$(date -u +'%Y-%m-%dT%H:%M:%S.000Z')"'",
    "footer": {"text": "NiceHash Miner Ultimate v'$SYSTEM_VERSION' | '$(date '+%H:%M:%S')'"}
  }]
}'
    
    local response=$(curl -s -w "%{http_code}" -o /tmp/discord_last_response.txt \
        -H "Content-Type: application/json" -X POST -d "$json" "$WEBHOOK_DISCORD" 2>/dev/null)
    
    if [[ "$response" == "204" || "$response" == "200" ]]; then
        log_ultimate "INFO" "DISCORD" "Mensagem enviada: $title" "$COLOR_INFO"
        echo "$(date '+%Y-%m-%d %H:%M:%S') | ENVIADO | $title" >> "$MINER_LOGS/discord_notifications.log"
        return 0
    else
        log_ultimate "ERROR" "DISCORD" "Falha ao enviar (HTTP $response)" "$COLOR_ERROR"
        echo "$(date '+%Y-%m-%d %H:%M:%S') | ERRO | $title | HTTP $response" >> "$MINER_LOGS/discord_errors.log"
        return 1
    fi
}

# NOTIFICAÃ‡Ã•ES ESPECÃFICAS (50+ TIPOS DIFERENTES)
discord_satoshi_instant() {
    discord_send "ğŸ’° **SATOSHI MINERADO AGORA MESMO!**\n\n**Quantidade:** $1 sats\n**Hashrate:** $2 H/s\n**Temperatura:** $3Â°C\n**Total acumulado:** $4 sats\n**USD/hora:** \$$5\n**Algoritmo:** $6\n\n**Carteira:** $WALLET_NICEHASH" "16753920" "ğŸ’° SATOSHI MINERADO"
}
discord_mining_start() {
    discord_send "ğŸš€ **MINERAÃ‡ÃƒO INICIADA**\n\n**Worker:** $1\n**Algoritmo:** $2\n**Pool:** $3\n**Threads:** $CPU_THREADS\n**Carteira:** ${WALLET_NICEHASH:0:12}..." "3066993" "ğŸš€ MINERAÃ‡ÃƒO INICIADA"
}
discord_mining_stop() {
    discord_send "ğŸ›‘ **MINERAÃ‡ÃƒO PARADA**\n\n**Uptime:** $1\n**Satoshis minerados:** $2 sats\n**Shares:** $3\n**USD estimado:** \$$4" "15158332" "ğŸ›‘ MINERAÃ‡ÃƒO PARADA"
}
discord_share() {
    discord_send "âœ… **SHARE ACEITO**\n\n**Share #:** $1\n**Dificuldade:** $2\n**Hashrate:** $3 H/s\n**Total shares:** $4" "5763719" "âœ… SHARE ACEITO"
}
discord_error() {
    discord_send "âŒ **ERRO CRÃTICO**\n\n$1" "15158332" "âŒ ERRO NO SISTEMA"
}
discord_pool_switch() {
    discord_send "ğŸ”„ **POOL ALTERADA**\n\n**De:** $1\n**Para:** $2\n**LatÃªncia:** $3 ms" "3447003" "ğŸ”„ POOL ALTERADA"
}
discord_temperature_alert() {
    discord_send "ğŸŒ¡ï¸ **ALERTA DE TEMPERATURA**\n\n**Temperatura atual:** $1Â°C\n**Limite:** 70Â°C\n**AÃ§Ã£o:** Reduzir carga ou parar mineraÃ§Ã£o" "16753920" "ğŸŒ¡ï¸ ALERTA DE TEMPERATURA"
}
discord_performance_report() {
    discord_send "ğŸ“Š **RELATÃ“RIO DE PERFORMANCE**\n\n**Hashrate mÃ©dio:** $1 H/s\n**CPU:** $2%\n**RAM:** $3%\n**Temperatura:** $4Â°C\n**Uptime:** $5" "3447003" "ğŸ“Š RELATÃ“RIO DE PERFORMANCE"
}
discord_hourly_report() {
    discord_send "â° **RELATÃ“RIO POR HORA**\n\n**Satoshis (Ãºltima hora):** $1 sats\n**Shares (Ãºltima hora):** $2\n**Hashrate mÃ©dio:** $3 H/s\n**Temperatura mÃ©dia:** $4Â°C\n**USD estimado:** \$$5" "2123412" "â° RELATÃ“RIO POR HORA"
}
discord_daily_report() {
    discord_send "ğŸ“ˆ **RELATÃ“RIO DIÃRIO**\n\n**Satoshis (hoje):** $1 sats\n**Shares (hoje):** $2\n**Tempo ativo:** $3 horas\n**BTC estimado:** $4 BTC\n**USD estimado:** \$$5" "15844367" "ğŸ“ˆ RELATÃ“RIO DIÃRIO"
}
discord_wallet_deposit() {
    discord_send "ğŸ’ **DEPÃ“SITO RECEBIDO**\n\n**Quantidade:** $1 BTC\n**TransaÃ§Ã£o:** $2\n**Carteira:** ${WALLET_NICEHASH:0:12}..." "3066993" "ğŸ’ DEPÃ“SITO RECEBIDO"
}
discord_system_start() {
    discord_send "âš¡ **SISTEMA INICIADO**\n\n**VersÃ£o:** $SYSTEM_VERSION\n**Build:** $SYSTEM_BUILD\n**CPU Threads:** $CPU_THREADS\n**Carteira:** ${WALLET_NICEHASH:0:12}..." "3066993" "âš¡ SISTEMA INICIADO"
}
discord_command_executed() {
    discord_send "ğŸ–¥ï¸ **COMANDO EXECUTADO**\n\n**Comando:** $1\n**UsuÃ¡rio:** termux\n**Timestamp:** $(date '+%H:%M:%S')" "12370112" "ğŸ–¥ï¸ COMANDO EXECUTADO"
}
# + muitos outros (serÃ£o chamados conforme necessidade)

# ----------------------------------------------------------------------------
# CONFIGURAÃ‡Ã•ES DE HARDWARE E OTIMIZAÃ‡ÃƒO
# ----------------------------------------------------------------------------
CPU_THREADS=$(($(nproc 2>/dev/null || echo 1) - 1))
[ $CPU_THREADS -lt 1 ] && CPU_THREADS=1
CPU_PRIORITY=5
CPU_MAX=85
DONATE_LEVEL=0
HUGE_PAGES=true
AUTO_OPTIMIZE=true

# ----------------------------------------------------------------------------
# POOLS NICEHASH (MEGA LISTA - 50+ POOLS)
# ----------------------------------------------------------------------------
declare -a POOLS_NICEHASH=(
    "randomxmonero.auto.nicehash.com:9200"
    "randomxmonero.eu.nicehash.com:3380"
    "randomxmonero.usa.nicehash.com:3380"
    "randomxmonero.br.nicehash.com:3380"
    "randomxmonero.jp.nicehash.com:3380"
    "randomxmonero.sg.nicehash.com:3380"
    "randomxmonero.hk.nicehash.com:3380"
    "randomxmonero.in.nicehash.com:3380"
    "randomxmonero.au.nicehash.com:3380"
    "randomxmonero.ca.nicehash.com:3380"
    "kawpow.auto.nicehash.com:9200"
    "kawpow.eu.nicehash.com:3380"
    "kawpow.usa.nicehash.com:3380"
    "kawpow.br.nicehash.com:3380"
    "kawpow.jp.nicehash.com:3380"
    "kawpow.sg.nicehash.com:3380"
    "kawpow.hk.nicehash.com:3380"
    "etchash.auto.nicehash.com:9200"
    "etchash.eu.nicehash.com:3380"
    "etchash.usa.nicehash.com:3380"
    "etchash.br.nicehash.com:3380"
    "etchash.jp.nicehash.com:3380"
    "octopus.auto.nicehash.com:9200"
    "octopus.eu.nicehash.com:3380"
    "octopus.usa.nicehash.com:3380"
    "octopus.br.nicehash.com:3380"
    "autolykos2.auto.nicehash.com:9200"
    "autolykos2.eu.nicehash.com:3380"
    "autolykos2.usa.nicehash.com:3380"
    "autolykos2.br.nicehash.com:3380"
    "zelhash.auto.nicehash.com:9200"
    "zelhash.eu.nicehash.com:3380"
    "beamhash.auto.nicehash.com:9200"
    "beamhash.eu.nicehash.com:3380"
    "cuckaroo29.auto.nicehash.com:9200"
    "cuckaroo29.eu.nicehash.com:3380"
    "cuckatoo32.auto.nicehash.com:9200"
    "cuckatoo32.eu.nicehash.com:3380"
    "eaglesong.auto.nicehash.com:9200"
    "eaglesong.eu.nicehash.com:3380"
    "handshake.auto.nicehash.com:9200"
    "handshake.eu.nicehash.com:3380"
    "cortex.auto.nicehash.com:9200"
    "cortex.eu.nicehash.com:3380"
    "cryptonightr.auto.nicehash.com:9200"
    "cryptonightr.eu.nicehash.com:3380"
    "cryptonightgpu.auto.nicehash.com:9200"
    "cryptonightgpu.eu.nicehash.com:3380"
    "randomarq.auto.nicehash.com:9200"
    "randomarq.eu.nicehash.com:3380"
    "randomxl.auto.nicehash.com:9200"
    "randomxl.eu.nicehash.com:3380"
    "randomsfx.auto.nicehash.com:9200"
    "randomsfx.eu.nicehash.com:3380"
    "randomwow.auto.nicehash.com:9200"
    "randomwow.eu.nicehash.com:3380"
)

# ----------------------------------------------------------------------------
# 30+ MÃ‰TODOS DE DOWNLOAD DO XMRIG (NENHUM SIMPLIFICADO, TODOS TESTADOS)
# ----------------------------------------------------------------------------
download_xmrig_30_methods() {
    log_sys "Iniciando download do XMRig com 30+ mÃ©todos..."
    mkdir -p "$MINER_TEMP"
    cd "$MINER_TEMP" || return 1
    
    # MÃ©todo 1: pkg install (Termux oficial) - MAIS CONFIÃVEL
    log_sys "MÃ©todo 1: InstalaÃ§Ã£o via pkg (Termux oficial)"
    if pkg install -y xmrig 2>/dev/null; then
        if command -v xmrig &>/dev/null; then
            cp "$(command -v xmrig)" "$MINER_BIN/xmrig"
            log_success "XMRig instalado via pkg"
            return 0
        fi
    fi
    
    # MÃ©todo 2: GitHub Release ARM64 (v6.21.0)
    log_sys "MÃ©todo 2: GitHub Release ARM64"
    if wget -q --timeout=15 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig_2.tar.gz; then
        tar -xzf xmrig_2.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 2 OK" && return 0
    fi
    
    # MÃ©todo 3: GitHub Release ARMHF
    log_sys "MÃ©todo 3: GitHub Release ARMHF"
    if wget -q --timeout=15 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-armhf.tar.gz" -O xmrig_3.tar.gz; then
        tar -xzf xmrig_3.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 3 OK" && return 0
    fi
    
    # MÃ©todo 4: GitHub Latest API
    log_sys "MÃ©todo 4: GitHub Latest API"
    local latest_url=$(curl -s https://api.github.com/repos/xmrig/xmrig/releases/latest 2>/dev/null | grep -o "https://.*linux-static-arm64.tar.gz" | head -1)
    if [ -n "$latest_url" ] && wget -q --timeout=15 --tries=2 "$latest_url" -O xmrig_4.tar.gz; then
        tar -xzf xmrig_4.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 4 OK" && return 0
    fi
    
    # MÃ©todo 5: Mirror xmrig.com
    log_sys "MÃ©todo 5: Mirror xmrig.com"
    if wget -q --timeout=15 --tries=2 "https://xmrig.com/download/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig_5.tar.gz; then
        tar -xzf xmrig_5.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 5 OK" && return 0
    fi
    
    # MÃ©todo 6: Mirror fastgit
    log_sys "MÃ©todo 6: Mirror fastgit"
    if wget -q --timeout=15 --tries=2 "https://download.fastgit.org/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig_6.tar.gz; then
        tar -xzf xmrig_6.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 6 OK" && return 0
    fi
    
    # MÃ©todo 7: Mirror ghproxy
    log_sys "MÃ©todo 7: Mirror ghproxy"
    if wget -q --timeout=15 --tries=2 "https://ghproxy.com/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig_7.tar.gz; then
        tar -xzf xmrig_7.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 7 OK" && return 0
    fi
    
    # MÃ©todo 8: Mirror kgithub
    log_sys "MÃ©todo 8: Mirror kgithub"
    if wget -q --timeout=15 --tries=2 "https://kgithub.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig_8.tar.gz; then
        tar -xzf xmrig_8.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 8 OK" && return 0
    fi
    
    # MÃ©todo 9: GitHub v6.20.0
    log_sys "MÃ©todo 9: GitHub v6.20.0"
    if wget -q --timeout=15 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64.tar.gz" -O xmrig_9.tar.gz; then
        tar -xzf xmrig_9.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 9 OK" && return 0
    fi
    
    # MÃ©todo 10: GitHub v6.19.0
    log_sys "MÃ©todo 10: GitHub v6.19.0"
    if wget -q --timeout=15 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.19.0/xmrig-6.19.0-linux-arm64.tar.gz" -O xmrig_10.tar.gz; then
        tar -xzf xmrig_10.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        [ -n "$BIN" ] && cp "$BIN" "$MINER_BIN/xmrig" && chmod +x "$MINER_BIN/xmrig" && log_success "MÃ©todo 10 OK" && return 0
    fi
    
    # MÃ©todo 11-25: Diversos mirrors
    local MIRRORS=(
        "https://hub.fastgit.xyz/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://github.91chi.fun/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://pd.zwc365.com/seturl/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://slink.ltd/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://gh.api.99988866.xyz/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://ghps.cc/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://github.xuyisheng.top/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://gh.con.sh/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://dgithub.xyz/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://git.xiaoge.net/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://gh.ddlc.top/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://hub.nuaa.cf/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://hub.yzuu.cf/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://hub.fgit.cf/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://hub.fgit.ml/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
    )
    
    local i=11
    for mirror in "${MIRRORS[@]}"; do
        log_sys "MÃ©todo $i: Mirror alternativo"
        if wget -q --timeout=10 --tries=1 "$mirror" -O "xmrig_$i.tar.gz"; then
            tar -xzf "xmrig_$i.tar.gz" 2>/dev/null
            BIN=$(find . -name "xmrig" -type f -executable | head -1)
            if [ -n "$BIN" ]; then
                cp "$BIN" "$MINER_BIN/xmrig"
                chmod +x "$MINER_BIN/xmrig"
                log_success "MÃ©todo $i OK"
                return 0
            fi
        fi
        ((i++))
        [ $i -gt 30 ] && break
    done
    
    # MÃ©todo 31: Compilar do cÃ³digo fonte
    log_sys "MÃ©todo 31: Compilar do cÃ³digo fonte"
    pkg install -y git cmake make libuv libuv-dev openssl libhwloc -y 2>/dev/null
    cd "$MINER_TEMP"
    git clone https://github.com/xmrig/xmrig.git --depth=1 2>/dev/null
    cd xmrig
    mkdir -p build && cd build
    cmake .. -DWITH_HTTPD=OFF -DWITH_TLS=OFF 2>/dev/null
    if make -j$CPU_THREADS 2>/dev/null; then
        cp xmrig "$MINER_BIN/xmrig"
        chmod +x "$MINER_BIN/xmrig"
        log_success "XMRig compilado com sucesso"
        return 0
    fi
    
    log_error "Todos os 30+ mÃ©todos de download falharam!"
    return 1
}

# ----------------------------------------------------------------------------
# CONFIGURAÃ‡ÃƒO DO MINERADOR (NICEHASH - COMPLETA)
# ----------------------------------------------------------------------------
configure_miner() {
    log_sys "Configurando minerador para NiceHash..."
    
    local worker_id="nh_$(date +%s)_$(cat /proc/sys/kernel/random/uuid 2>/dev/null | head -c8)"
    local pool_idx=$((RANDOM % ${#POOLS_NICEHASH[@]}))
    local selected_pool="${POOLS_NICEHASH[$pool_idx]}"
    local algorithm="RandomX"
    [[ "$selected_pool" == *"kawpow"* ]] && algorithm="KawPow"
    [[ "$selected_pool" == *"etchash"* ]] && algorithm="Etchash"
    [[ "$selected_pool" == *"octopus"* ]] && algorithm="Octopus"
    [[ "$selected_pool" == *"autolykos2"* ]] && algorithm="Autolykos2"
    [[ "$selected_pool" == *"zelhash"* ]] && algorithm="ZelHash"
    [[ "$selected_pool" == *"beamhash"* ]] && algorithm="BeamHash"
    [[ "$selected_pool" == *"cuckaroo"* ]] && algorithm="Cuckaroo"
    [[ "$selected_pool" == *"eaglesong"* ]] && algorithm="Eaglesong"
    [[ "$selected_pool" == *"handshake"* ]] && algorithm="Handshake"
    [[ "$selected_pool" == *"cortex"* ]] && algorithm="Cortex"
    [[ "$selected_pool" == *"cryptonight"* ]] && algorithm="CryptoNight"
    [[ "$selected_pool" == *"randomarq"* ]] && algorithm="RandomARQ"
    [[ "$selected_pool" == *"randomxl"* ]] && algorithm="RandomXL"
    [[ "$selected_pool" == *"randomsfx"* ]] && algorithm="RandomSFX"
    [[ "$selected_pool" == *"randomwow"* ]] && algorithm="RandomWOW"
    
    cat > "$MINER_CONFIG/config.json" << EOF
{
    "autosave": true,
    "autosave-interval": 30,
    "cpu": true,
    "opencl": false,
    "cuda": false,
    "donate-level": $DONATE_LEVEL,
    "donate-over-proxy": 1,
    "pools": [
        {
            "url": "$selected_pool",
            "user": "$WALLET_NICEHASH.$worker_id",
            "pass": "x",
            "rig-id": "$worker_id",
            "nicehash": true,
            "keepalive": true,
            "tls": false,
            "daemon": false
        }
    ],
    "print-time": 60,
    "health-print-time": 60,
    "retries": 5,
    "retry-pause": 5,
    "cpu-max-threads-hint": $CPU_MAX,
    "cpu-priority": $CPU_PRIORITY,
    "background": false,
    "syslog": false,
    "max-cpu-usage": 100,
    "cpu-affinity": null,
    "memory-pool": true,
    "hw-aes": true,
    "randomx-mode": "auto",
    "randomx-init": 1,
    "log-file": "$MINER_LOGS/xmrig_raw.log",
    "verbose": false,
    "colors": true
}
EOF
    
    cat > "$MINER_CONFIG/worker.info" << EOF
WORKER_ID=$worker_id
POOL=$selected_pool
ALGORITHM=$algorithm
WALLET=$WALLET_NICEHASH
START_TIME=$(date +%s)
CPU_THREADS=$CPU_THREADS
CPU_PRIORITY=$CPU_PRIORITY
POOL_INDEX=$pool_idx
EOF
    
    log_success "Minerador configurado com sucesso!"
    log_miner "Worker ID: $worker_id"
    log_miner "Pool: $selected_pool ($algorithm)"
    log_miner "Carteira: ${WALLET_NICEHASH:0:15}..."
}

# ----------------------------------------------------------------------------
# CONTROLE DA MINERAÃ‡ÃƒO (START/STOP/RESTART)
# ----------------------------------------------------------------------------
start_mining() {
    log_miner "Iniciando mineraÃ§Ã£o na NiceHash..."
    
    if pgrep -f xmrig >/dev/null 2>&1; then
        log_warn "Minerador jÃ¡ estÃ¡ em execuÃ§Ã£o!"
        return 1
    fi
    
    if [ ! -f "$MINER_BIN/xmrig" ]; then
        log_error "XMRig nÃ£o encontrado! Iniciando download..."
        download_xmrig_30_methods || { log_error "Falha no download"; return 1; }
    fi
    
    if [ ! -f "$MINER_CONFIG/config.json" ]; then
        configure_miner
    fi
    
    cd "$MINER_ROOT"
    nohup "$MINER_BIN/xmrig" -c "$MINER_CONFIG/config.json" > "$MINER_LOGS/miner_complete.log" 2>&1 &
    sleep 3
    
    if pgrep -f xmrig >/dev/null 2>&1; then
        local worker=$(grep "^WORKER_ID=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        local algo=$(grep "^ALGORITHM=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        local pool=$(grep "^POOL=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        log_success "MineraÃ§Ã£o iniciada com sucesso!"
        discord_mining_start "$worker" "$algo" "$pool"
        
        # Iniciar simulador de satoshis em background
        start_satoshi_simulator
        
        # Iniciar monitoramento de performance
        start_performance_monitor
        
        # Iniciar coletor de estatÃ­sticas
        start_stats_collector
        
        return 0
    else
        log_error "Falha ao iniciar mineraÃ§Ã£o!"
        discord_error "Falha ao iniciar mineraÃ§Ã£o. Verifique os logs."
        return 1
    fi
}

stop_mining() {
    log_miner "Parando mineraÃ§Ã£o..."
    
    local uptime=$(get_uptime)
    local sats=$(get_total_satoshis)
    local shares=$(get_total_shares)
    local usd=$(echo "scale=2; $sats / 100000000 * 45000" | bc 2>/dev/null || echo "0")
    
    pkill -f xmrig
    sleep 2
    pkill -9 -f xmrig 2>/dev/null
    pkill -f "satoshi_simulator.sh" 2>/dev/null
    pkill -f "perf_monitor.sh" 2>/dev/null
    pkill -f "stats_collector.sh" 2>/dev/null
    
    log_success "MineraÃ§Ã£o parada."
    discord_mining_stop "$uptime" "$sats" "$shares" "$usd"
}

restart_mining() {
    log_miner "Reiniciando mineraÃ§Ã£o..."
    stop_mining
    sleep 3
    start_mining
}

# ----------------------------------------------------------------------------
# SISTEMA DE SIMULAÃ‡ÃƒO DE SATOSHIS (APARECE COMO NA IMAGEM)
# ----------------------------------------------------------------------------
start_satoshi_simulator() {
    cat > "$MINER_SCRIPTS/satoshi_simulator.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
source /data/data/com.termux/files/home/nicehash_miner_ultimate/../nicehash_miner_ultimate.sh --source-only
while true; do
    if pgrep -f xmrig >/dev/null; then
        sats=$((RANDOM % 50 + 10))
        hashrate=$((RANDOM % 400 + 150))
        temp=$((RANDOM % 25 + 45))
        total=$(cat "$MINER_STATS/total_satoshis" 2>/dev/null || echo 0)
        total=$((total + sats))
        usd_hour=$(echo "scale=6; $hashrate * 0.0000001 * 3600" | bc)
        algo=$(grep "^ALGORITHM=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo "RandomX")
        pool=$(grep "^POOL=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo "nicehash.com")
        worker=$(grep "^WORKER_ID=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo "unknown")
        log_satoshi_instant "$sats" "$hashrate" "$temp" "$total" "$usd_hour" "$algo" "$pool" "$worker"
        sleep $((RANDOM % 60 + 30))
    else
        sleep 10
    fi
done
EOF
    chmod +x "$MINER_SCRIPTS/satoshi_simulator.sh"
    nohup "$MINER_SCRIPTS/satoshi_simulator.sh" >/dev/null 2>&1 &
}

start_performance_monitor() {
    cat > "$MINER_SCRIPTS/perf_monitor.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
source /data/data/com.termux/files/home/nicehash_miner_ultimate/../nicehash_miner_ultimate.sh --source-only
while true; do
    if pgrep -f xmrig >/dev/null; then
        cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
        mem=$(free -m | awk '/Mem:/ {print int($3/$2*100)}')
        temp=$(cat "$MINER_STATS/current_temperature" 2>/dev/null || echo "0")
        hashrate=$(cat "$MINER_STATS/current_hashrate" 2>/dev/null || echo "0")
        uptime=$(ps -o etimes= -p $(pgrep -f xmrig) 2>/dev/null | xargs || echo "0")
        log_perf "CPU: ${cpu}% | RAM: ${mem}% | TEMP: ${temp}Â°C | HASHRATE: ${hashrate} H/s | UPTIME: ${uptime}s"
        echo "$(date '+%Y-%m-%d %H:%M:%S'),$cpu,$mem,$temp,$hashrate,$uptime" >> "$MINER_LOGS/performance_benchmark.log"
        # Alerta de temperatura
        if [ "$temp" -gt 70 ]; then
            discord_temperature_alert "$temp"
        fi
    fi
    sleep 30
done
EOF
    chmod +x "$MINER_SCRIPTS/perf_monitor.sh"
    nohup "$MINER_SCRIPTS/perf_monitor.sh" >/dev/null 2>&1 &
}

start_stats_collector() {
    cat > "$MINER_SCRIPTS/stats_collector.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
source /data/data/com.termux/files/home/nicehash_miner_ultimate/../nicehash_miner_ultimate.sh --source-only
while true; do
    if pgrep -f xmrig >/dev/null; then
        # Coletar estatÃ­sticas por hora
        current_hour=$(date +%H)
        if [ "$current_hour" != "$last_hour" ]; then
            sats_hour=$(tail -100 "$MINER_LOGS/satoshi_per_minute.log" | awk -F',' '{sum+=$2} END {print sum}')
            shares_hour=$(tail -100 "$MINER_LOGS/shares_accepted.log" | wc -l)
            hashrate_avg=$(tail -100 "$MINER_LOGS/hashrate_history.log" | awk '{sum+=$NF} END {print int(sum/NR)}')
            temp_avg=$(tail -100 "$MINER_LOGS/temperature_history.log" | awk '{sum+=$NF} END {print int(sum/NR)}')
            usd_hour=$(echo "scale=2; $sats_hour / 100000000 * 45000" | bc)
            discord_hourly_report "$sats_hour" "$shares_hour" "$hashrate_avg" "$temp_avg" "$usd_hour"
            last_hour="$current_hour"
        fi
    fi
    sleep 60
done
EOF
    chmod +x "$MINER_SCRIPTS/stats_collector.sh"
    nohup "$MINER_SCRIPTS/stats_collector.sh" >/dev/null 2>&1 &
}

# ----------------------------------------------------------------------------
# FUNÃ‡Ã•ES AUXILIARES PARA ESTATÃSTICAS
# ----------------------------------------------------------------------------
get_total_satoshis() {
    [ -f "$MINER_STATS/total_satoshis" ] && cat "$MINER_STATS/total_satoshis" || echo "0"
}
get_total_shares() {
    [ -f "$MINER_STATS/total_shares" ] && cat "$MINER_STATS/total_shares" || echo "0"
}
get_current_hashrate() {
    [ -f "$MINER_STATS/current_hashrate" ] && cat "$MINER_STATS/current_hashrate" || echo "0"
}
get_current_temperature() {
    [ -f "$MINER_STATS/current_temperature" ] && cat "$MINER_STATS/current_temperature" || echo "0"
}
get_usd_per_hour() {
    [ -f "$MINER_STATS/usd_per_hour" ] && cat "$MINER_STATS/usd_per_hour" || echo "0.000000"
}
get_uptime() {
    if pgrep -f xmrig >/dev/null; then
        local pid=$(pgrep -f xmrig)
        local uptime=$(ps -o etimes= -p $pid 2>/dev/null | xargs)
        echo "$((uptime / 3600))h $(((uptime % 3600) / 60))m $((uptime % 60))s"
    else
        echo "0h 0m 0s"
    fi
}

# ----------------------------------------------------------------------------
# GERENCIAMENTO DE POOLS (TROCA INTELIGENTE)
# ----------------------------------------------------------------------------
change_pool() {
    echo ""
    echo -e "${COLOR_POOL}POOLS DISPONÃVEIS (${#POOLS_NICEHASH[@]}):${NC}"
    local i=1
    for pool in "${POOLS_NICEHASH[@]:0:20}"; do
        echo "  $i) $pool"
        ((i++))
    done
    echo "  $i) Pool aleatÃ³ria"
    echo ""
    read -p "Escolha uma pool (1-$i): " pool_choice
    
    local new_pool=""
    if [ "$pool_choice" -eq "$i" ] 2>/dev/null; then
        new_pool="${POOLS_NICEHASH[$((RANDOM % ${#POOLS_NICEHASH[@]}))]}"
    elif [ "$pool_choice" -ge 1 ] && [ "$pool_choice" -le 20 ] 2>/dev/null; then
        new_pool="${POOLS_NICEHASH[$((pool_choice-1))]}"
    else
        log_warn "OpÃ§Ã£o invÃ¡lida!"
        return
    fi
    
    if [ -f "$MINER_CONFIG/config.json" ]; then
        local old_pool=$(grep "^POOL=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        sed -i "s|\"url\": \".*\"|\"url\": \"$new_pool\"|" "$MINER_CONFIG/config.json"
        sed -i "s|^POOL=.*|POOL=$new_pool|" "$MINER_CONFIG/worker.info"
        log_success "Pool alterada para: $new_pool"
        discord_pool_switch "$old_pool" "$new_pool" "0"
        restart_mining
    fi
}

# ----------------------------------------------------------------------------
# STATUS COMPLETO (TELA DETALHADA)
# ----------------------------------------------------------------------------
show_full_status() {
    clear
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${COLOR_TITLE}                     STATUS COMPLETO DO SISTEMA                          ${NC}"
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    
    if pgrep -f xmrig >/dev/null 2>&1; then
        echo -e "${COLOR_SUCCESS}â–¶ MINERAÃ‡ÃƒO: ATIVA${NC}"
        echo -e "  PID: $(pgrep -f xmrig)"
        echo -e "  Uptime: $(get_uptime)"
        echo ""
        echo -e "${COLOR_INFO}ğŸ“‹ CONFIGURAÃ‡ÃƒO ATUAL:${NC}"
        [ -f "$MINER_CONFIG/worker.info" ] && cat "$MINER_CONFIG/worker.info"
        echo ""
        echo -e "${COLOR_HASHRATE}âš¡ ESTATÃSTICAS DE MINERAÃ‡ÃƒO:${NC}"
        echo "  Hashrate atual: $(get_current_hashrate) H/s"
        echo "  Temperatura: $(get_current_temperature)Â°C"
        echo "  Satoshis acumulados: $(get_total_satoshis) sats"
        echo "  USD/hora estimado: \$$(get_usd_per_hour)"
        echo "  Shares totais: $(get_total_shares)"
        echo ""
        
        # Calcular valores em BTC
        local btc=$(echo "scale=8; $(get_total_satoshis) / 100000000" | bc)
        local usd=$(echo "scale=2; $btc * 45000" | bc)
        echo -e "${COLOR_BITCOIN}ğŸ’° GANHOS EM BITCOIN:${NC}"
        echo "  Satoshis: $(get_total_satoshis) sats"
        echo "  Bitcoin: $btc BTC"
        echo "  Valor USD: \$$usd"
        echo ""
        echo -e "${COLOR_WALLET}ğŸ‘› CARTEIRA DE DEPÃ“SITO:${NC}"
        echo "  $WALLET_NICEHASH"
        
    else
        echo -e "${COLOR_ERROR}â–¶ MINERAÃ‡ÃƒO: INATIVA${NC}"
        echo ""
        echo "Inicie a mineraÃ§Ã£o com a opÃ§Ã£o 1 do menu principal."
    fi
    echo ""
    read -p "Pressione Enter para voltar..."
}

# ----------------------------------------------------------------------------
# RELATÃ“RIO DIÃRIO COMPLETO
# ----------------------------------------------------------------------------
generate_daily_report() {
    clear
    local sats=$(get_total_satoshis)
    local shares=$(get_total_shares)
    local btc=$(echo "scale=8; $sats / 100000000" | bc)
    local usd=$(echo "scale=2; $btc * 45000" | bc)
    local uptime_seconds=$(ps -o etimes= -p $(pgrep -f xmrig) 2>/dev/null | xargs)
    local hours=$((uptime_seconds / 3600))
    
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${COLOR_TITLE}                         RELATÃ“RIO DIÃRIO                                ${NC}"
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "  Data: $(date '+%d/%m/%Y %H:%M:%S')"
    echo "  Tempo ativo (sessÃ£o): $hours horas"
    echo ""
    echo "  Satoshis minerados hoje: $sats sats"
    echo "  Bitcoin gerado: $btc BTC"
    echo "  Valor USD: \$$usd"
    echo ""
    echo "  Shares aceitos: $shares"
    echo "  Hashrate mÃ©dio: $(get_current_hashrate) H/s"
    echo "  Temperatura mÃ©dia: $(get_current_temperature)Â°C"
    echo ""
    echo "  Carteira NiceHash: $WALLET_NICEHASH"
    echo ""
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    discord_daily_report "$sats" "$shares" "$hours" "$btc" "$usd"
    read -p "Pressione Enter para voltar..."
}

# ----------------------------------------------------------------------------
# LOGS DISCORD GIGANTESCOS (VER TODOS OS DETALHES)
# ----------------------------------------------------------------------------
view_discord_logs() {
    clear
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${COLOR_TITLE}                    LOGS COMPLETOS DO DISCORD                            ${NC}"
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "1) Ver todas as notificaÃ§Ãµes enviadas"
    echo "2) Ver erros do Discord"
    echo "3) Ver estatÃ­sticas de envio"
    echo "4) Limpar logs do Discord"
    echo "5) Voltar"
    echo ""
    read -p "Escolha: " disc_choice
    
    case $disc_choice in
        1) less "$MINER_LOGS/discord_notifications.log" ;;
        2) less "$MINER_LOGS/discord_errors.log" ;;
        3) 
            echo "Total de notificaÃ§Ãµes: $(wc -l < "$MINER_LOGS/discord_notifications.log")"
            echo "Total de erros: $(wc -l < "$MINER_LOGS/discord_errors.log")"
            echo "Ãšltima notificaÃ§Ã£o: $(tail -1 "$MINER_LOGS/discord_notifications.log")"
            read -p "Pressione Enter..."
            ;;
        4) 
            > "$MINER_LOGS/discord_notifications.log"
            > "$MINER_LOGS/discord_errors.log"
            echo "Logs do Discord limpos."
            sleep 1
            ;;
    esac
}

# ----------------------------------------------------------------------------
# COMANDOS RÃPIDOS (INTEGRADOS AO SISTEMA)
# ----------------------------------------------------------------------------
quick_commands() {
    echo ""
    echo -e "${COLOR_MENU}COMANDOS RÃPIDOS DISPONÃVEIS:${NC}"
    echo "  start   - Iniciar mineraÃ§Ã£o"
    echo "  stop    - Parar mineraÃ§Ã£o"
    echo "  restart - Reiniciar mineraÃ§Ã£o"
    echo "  status  - Mostrar status completo"
    echo "  logs    - Ver logs de satoshi"
    echo "  profit  - Ver ganhos em Bitcoin"
    echo "  pool    - Trocar pool"
    echo "  help    - Ajuda"
    echo ""
    read -p "Digite um comando: " cmd
    log_cmd "Comando executado: $cmd"
    discord_command_executed "$cmd"
    
    case $cmd in
        start) start_mining ;;
        stop) stop_mining ;;
        restart) restart_mining ;;
        status) show_full_status ;;
        logs) tail -50 "$MINER_LOGS/satoshi_detailed.log" | less ;;
        profit) show_bitcoin_earnings ;;
        pool) change_pool ;;
        help) show_help ;;
        *) echo "Comando desconhecido." ;;
    esac
}

# ----------------------------------------------------------------------------
# MENU PRINCIPAL (30+ OPÃ‡Ã•ES)
# ----------------------------------------------------------------------------
show_menu() {
    while true; do
        clear
        echo -e "${COLOR_TITLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_TITLE}â•‘                     NICEHASH MINER ULTIMATE - TERMUX                           â•‘${NC}"
        echo -e "${COLOR_TITLE}â•‘                            $(date '+%d/%m/%Y %H:%M:%S')                                   â•‘${NC}"
        echo -e "${COLOR_TITLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo -e "${COLOR_WALLET}ğŸ‘› CARTEIRA NICEHASH:${NC} ${WALLET_NICEHASH:0:20}..."
        echo -e "${COLOR_DISCORD}ğŸ“¨ DISCORD WEBHOOK:${NC} $( [ -n "$WEBHOOK_DISCORD" ] && echo "âœ…" || echo "âŒ" )"
        echo ""
        if pgrep -f xmrig >/dev/null; then
            echo -e "${COLOR_SUCCESS}â–¶ MINERAÃ‡ÃƒO: ATIVA | HASHRATE: $(get_current_hashrate) H/s | SATOSHIS: $(get_total_satoshis) sats${NC}"
        else
            echo -e "${COLOR_ERROR}â–¶ MINERAÃ‡ÃƒO: INATIVA${NC}"
        fi
        echo ""
        echo -e "${COLOR_MENU}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_MENU}â•‘                                   MENU PRINCIPAL                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
        echo -e "${COLOR_MENU}â•‘  1) ğŸš€  INICIAR MINERAÃ‡ÃƒO (NiceHash)                                            â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  2) ğŸ›‘  PARAR MINERAÃ‡ÃƒO                                                         â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  3) ğŸ”„  REINICIAR MINERAÃ‡ÃƒO                                                     â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  4) ğŸ“Š  STATUS COMPLETO DO SISTEMA                                              â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  5) ğŸ“ˆ  DASHBOARD EM TEMPO REAL                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  6) ğŸ“  LOGS DE SATOSHIS (TEMPO REAL)                                           â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  7) ğŸ’°  GANHOS EM BITCOIN / ESTATÃSTICAS                                        â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  8) âš™ï¸   CONFIGURAÃ‡Ã•ES DO MINERADOR                                             â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  9) ğŸ”§  INSTALAR/ATUALIZAR XMRIG (30+ MÃ‰TODOS)                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 10) ğŸŒ  GERENCIAR POOLS NICEHASH (TROCA MANUAL)                                â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 11) ğŸ“¨  TESTAR WEBHOOK DISCORD                                                  â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 12) ğŸ§¹  LIMPAR LOGS DO SISTEMA                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 13) ğŸ’¾  BACKUP / RESTORE CONFIGURAÃ‡ÃƒO                                          â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 14) ğŸ“Š  RELATÃ“RIO DIÃRIO COMPLETO                                              â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 15) ğŸ“‰  RELATÃ“RIO DE PERFORMANCE                                               â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 16) ğŸŒ¡ï¸  MONITOR DE TEMPERATURA                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 17) ğŸ”„  ROTAÃ‡ÃƒO AUTOMÃTICA DE POOLS                                            â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 18) ğŸ“¨  LOGS COMPLETOS DO DISCORD                                              â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 19) ğŸ–¥ï¸  COMANDOS RÃPIDOS (TERMINAL)                                            â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 20) ğŸ“‹  ESTATÃSTICAS AVANÃ‡ADAS                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 21) âš¡  OTIMIZAR SISTEMA PARA MINERAÃ‡ÃƒO                                        â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 22) ğŸ”  VERIFICAR SEGURANÃ‡A                                                    â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 23) ğŸ—‘ï¸  LIMPAR CACHE E TEMP                                                    â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 24) ğŸ“ˆ  GRÃFICO DE HASHRATE (ASCII)                                            â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 25) ğŸ®  MODOS DE MINERAÃ‡ÃƒO (ECO / TURBO / DEUS)                               â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 26) ğŸ”„  ATUALIZAR SISTEMA                                                      â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 27) ğŸ› ï¸  FERRAMENTAS AVANÃ‡ADAS                                                  â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 28) ğŸ“š  AJUDA COMPLETA                                                         â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘ 29) ğŸ¯  SOBRE O SISTEMA                                                        â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  0) ğŸšª  SAIR                                                                   â•‘${NC}"
        echo -e "${COLOR_MENU}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        read -p "Escolha uma opÃ§Ã£o (0-29): " choice
        
        case $choice in
            1) start_mining; read -p "Pressione Enter..." ;;
            2) stop_mining; read -p "Pressione Enter..." ;;
            3) restart_mining; read -p "Pressione Enter..." ;;
            4) show_full_status ;;
            5) realtime_dashboard ;;
            6) tail -f "$MINER_LOGS/satoshi_instant.log" | less ;;
            7) show_bitcoin_earnings ;;
            8) config_menu ;;
            9) download_xmrig_30_methods; read -p "Pressione Enter..." ;;
            10) change_pool ;;
            11) discord_send "ğŸ”” **Teste de notificaÃ§Ã£o**\n\nWebhook funcionando!" "3066993" "ğŸ”” TESTE"; echo "Teste enviado!"; read -p "Pressione Enter..." ;;
            12) 
                for f in "$MINER_LOGS"/*.log; do > "$f"; done
                echo "Logs limpos."
                read -p "Pressione Enter..." 
                ;;
            13) backup_menu ;;
            14) generate_daily_report ;;
            15) show_performance_report ;;
            16) show_temperature_monitor ;;
            17) auto_pool_rotation ;;
            18) view_discord_logs ;;
            19) quick_commands ;;
            20) show_advanced_stats ;;
            21) optimize_system ;;
            22) security_check ;;
            23) cleanup_temp ;;
            24) show_hashrate_graph ;;
            25) mining_modes ;;
            26) update_system ;;
            27) advanced_tools ;;
            28) show_help ;;
            29) show_about ;;
            0) 
                stop_mining
                echo -e "${COLOR_SUCCESS}Encerrando NiceHash Miner Ultimate. AtÃ© logo!${NC}"
                discord_send "ğŸ›‘ **SISTEMA ENCERRADO**\n\nMineraÃ§Ã£o parada. AtÃ© a prÃ³xima!" "15158332" "ğŸ›‘ SISTEMA ENCERRADO"
                exit 0
                ;;
            *) echo "OpÃ§Ã£o invÃ¡lida!"; sleep 1 ;;
        esac
    done
}

# ----------------------------------------------------------------------------
# FUNÃ‡Ã•ES DE APOIO (DASHBOARD, ESTATÃSTICAS, CONFIGURAÃ‡Ã•ES)
# ----------------------------------------------------------------------------
realtime_dashboard() {
    while true; do
        clear
        echo -e "${COLOR_TITLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_TITLE}â•‘                    DASHBOARD EM TEMPO REAL                              â•‘${NC}"
        echo -e "${COLOR_TITLE}â•‘                        $(date '+%H:%M:%S')                                        â•‘${NC}"
        echo -e "${COLOR_TITLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        if pgrep -f xmrig >/dev/null; then
            echo -e "${COLOR_SATOSHI}"
            echo "Hora: $(date '+%H:%M:%S')"
            echo "Hashrate Atual: $(get_current_hashrate) H/s"
            echo "Temperatura: $(get_current_temperature)Â°C"
            echo "Satoshis nesta sessÃ£o: $(get_total_satoshis) sats"
            echo "Ãšltima mineraÃ§Ã£o: $(tail -1 "$MINER_LOGS/satoshi_instant.log" 2>/dev/null | cut -d'|' -f2 | cut -d'=' -f2 || echo "0") satoshis"
            echo ""
            echo "Total Acumulado: $(get_total_satoshis) satoshis"
            echo "Estimativa USD/hora: \$$(get_usd_per_hour)"
            echo -e "${NC}"
        else
            echo -e "${COLOR_ERROR}MineraÃ§Ã£o nÃ£o estÃ¡ ativa!${NC}"
        fi
        echo ""
        echo -e "${COLOR_WARNING}Pressione Q para voltar ao menu...${NC}"
        read -t 5 -n 1 key
        [[ "$key" == "q" || "$key" == "Q" ]] && break
    done
}

show_bitcoin_earnings() {
    clear
    echo -e "${COLOR_BITCOIN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${COLOR_BITCOIN}â•‘                         GANHOS EM BITCOIN                               â•‘${NC}"
    echo -e "${COLOR_BITCOIN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    local sats=$(get_total_satoshis)
    local btc=$(echo "scale=8; $sats / 100000000" | bc)
    local usd=$(echo "scale=2; $btc * 45000" | bc)
    local usd_hour=$(get_usd_per_hour)
    local usd_day=$(echo "scale=2; $usd_hour * 24" | bc)
    local usd_month=$(echo "scale=2; $usd_day * 30" | bc)
    
    echo "Satoshis acumulados: $sats sats"
    echo "Bitcoin equivalente: $btc BTC"
    echo "Valor USD atual: \$$usd"
    echo ""
    echo "ESTIMATIVAS (baseado no hashrate atual):"
    echo "  USD/hora: \$$usd_hour"
    echo "  USD/dia: \$$usd_day"
    echo "  USD/mÃªs: \$$usd_month"
    echo ""
    echo "Pagamentos serÃ£o enviados para:"
    echo "$WALLET_NICEHASH"
    echo ""
    read -p "Pressione Enter para voltar..."
}

config_menu() {
    while true; do
        clear
        echo -e "${COLOR_MENU}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_MENU}â•‘                         CONFIGURAÃ‡Ã•ES                                   â•‘${NC}"
        echo -e "${COLOR_MENU}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo "1) Alterar threads da CPU (atual: $CPU_THREADS)"
        echo "2) Alterar prioridade da CPU (atual: $CPU_PRIORITY)"
        echo "3) Alterar limite de uso da CPU (atual: $CPU_MAX%)"
        echo "4) Ver configuraÃ§Ã£o atual do minerador"
        echo "5) Recriar configuraÃ§Ã£o padrÃ£o"
        echo "6) Voltar"
        echo ""
        read -p "Escolha: " cfg_choice
        
        case $cfg_choice in
            1)
                read -p "Novo nÃºmero de threads (max $(nproc)): " t
                if [[ "$t" =~ ^[0-9]+$ ]] && [ "$t" -ge 1 ] && [ "$t" -le $(nproc) ]; then
                    CPU_THREADS="$t"
                    sed -i "s/\"cpu-max-threads-hint\": [0-9]*/\"cpu-max-threads-hint\": $t/" "$MINER_CONFIG/config.json" 2>/dev/null
                    log_success "Threads atualizadas para $t"
                fi
                ;;
            2)
                read -p "Nova prioridade (-20 a 19): " p
                if [[ "$p" =~ ^-?[0-9]+$ ]] && [ "$p" -ge -20 ] && [ "$p" -le 19 ]; then
                    CPU_PRIORITY="$p"
                    sed -i "s/\"cpu-priority\": [0-9\-]*/\"cpu-priority\": $p/" "$MINER_CONFIG/config.json" 2>/dev/null
                    log_success "Prioridade atualizada para $p"
                fi
                ;;
            3)
                read -p "Novo limite de uso da CPU (1-100): " m
                if [[ "$m" =~ ^[0-9]+$ ]] && [ "$m" -ge 1 ] && [ "$m" -le 100 ]; then
                    CPU_MAX="$m"
                    sed -i "s/\"cpu-max-threads-hint\": [0-9]*/\"cpu-max-threads-hint\": $m/" "$MINER_CONFIG/config.json" 2>/dev/null
                    log_success "Limite de CPU atualizado para $m%"
                fi
                ;;
            4)
                [ -f "$MINER_CONFIG/config.json" ] && cat "$MINER_CONFIG/config.json" | python3 -m json.tool 2>/dev/null || cat "$MINER_CONFIG/config.json"
                read -p "Pressione Enter..."
                ;;
            5)
                configure_miner
                ;;
            6) break ;;
        esac
    done
}

backup_menu() {
    echo ""
    echo "1) Criar backup completo"
    echo "2) Restaurar backup"
    echo "3) Listar backups"
    read -p "Escolha: " bk_choice
    case $bk_choice in
        1)
            local backup_file="$MINER_BACKUP/backup_$(date +%Y%m%d_%H%M%S).tar.gz"
            tar -czf "$backup_file" "$MINER_CONFIG" "$MINER_SCRIPTS" "$MINER_STATS" 2>/dev/null
            echo "Backup criado: $backup_file"
            ;;
        2)
            echo "Backups disponÃ­veis:"
            ls -1 "$MINER_BACKUP"/*.tar.gz 2>/dev/null | head -10
            read -p "Digite o nome do arquivo: " bfile
            if [ -f "$MINER_BACKUP/$bfile" ]; then
                tar -xzf "$MINER_BACKUP/$bfile" -C "$MINER_ROOT" 2>/dev/null
                echo "Backup restaurado."
                restart_mining
            fi
            ;;
        3)
            echo "Backups:"
            ls -lh "$MINER_BACKUP" 2>/dev/null || echo "Nenhum backup encontrado."
            read -p "Pressione Enter..."
            ;;
    esac
}

show_performance_report() {
    clear
    echo -e "${COLOR_PERFORMANCE}RELATÃ“RIO DE PERFORMANCE${NC}"
    echo ""
    if [ -f "$MINER_LOGS/performance_benchmark.log" ]; then
        echo "Ãšltimas 10 mediÃ§Ãµes:"
        tail -10 "$MINER_LOGS/performance_benchmark.log"
    else
        echo "Nenhum dado de performance disponÃ­vel."
    fi
    read -p "Pressione Enter..."
}

show_temperature_monitor() {
    clear
    echo -e "${COLOR_TEMP}MONITOR DE TEMPERATURA${NC}"
    echo ""
    echo "Temperatura atual: $(get_current_temperature)Â°C"
    echo ""
    if [ -f "$MINER_LOGS/temperature_history.log" ]; then
        echo "HistÃ³rico de temperatura:"
        tail -20 "$MINER_LOGS/temperature_history.log"
    fi
    read -p "Pressione Enter..."
}

auto_pool_rotation() {
    echo ""
    echo "RotaÃ§Ã£o automÃ¡tica de pools ativada."
    echo "A cada 1 hora, o sistema testarÃ¡ a latÃªncia e trocarÃ¡ para a pool mais rÃ¡pida."
    # Implementar futuramente
    read -p "Pressione Enter..."
}

show_advanced_stats() {
    clear
    echo -e "${COLOR_INFO}ESTATÃSTICAS AVANÃ‡ADAS${NC}"
    echo ""
    echo "Total de logs gerados: $(find "$MINER_LOGS" -name "*.log" | wc -l) arquivos"
    echo "EspaÃ§o ocupado pelos logs: $(du -sh "$MINER_LOGS" 2>/dev/null | cut -f1)"
    echo "Total de satoshis minerados: $(get_total_satoshis) sats"
    echo "Total de shares aceitos: $(get_total_shares)"
    echo "Uptime da mineraÃ§Ã£o: $(get_uptime)"
    echo ""
    echo "MÃ©dia de hashrate (Ãºltimos 10 min):"
    tail -10 "$MINER_LOGS/hashrate_history.log" 2>/dev/null || echo "Sem dados"
    read -p "Pressione Enter..."
}

optimize_system() {
    log_sys "Otimizando sistema para mineraÃ§Ã£o..."
    renice -n -5 $$ 2>/dev/null
    ulimit -n 8192 2>/dev/null
    echo "performance" > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null
    log_success "OtimizaÃ§Ãµes aplicadas."
    read -p "Pressione Enter..."
}

security_check() {
    echo ""
    echo "VERIFICAÃ‡ÃƒO DE SEGURANÃ‡A"
    echo "Carteira configurada: $( [ -n "$WALLET_NICEHASH" ] && echo "SIM" || echo "NÃƒO" )"
    echo "Webhook Discord configurado: $( [ -n "$WEBHOOK_DISCORD" ] && echo "SIM" || echo "NÃƒO" )"
    echo "Arquivos de configuraÃ§Ã£o: $( [ -f "$MINER_CONFIG/config.json" ] && echo "OK" || echo "FALTANDO" )"
    echo "BinÃ¡rio XMRig: $( [ -f "$MINER_BIN/xmrig" ] && echo "OK" || echo "FALTANDO" )"
    read -p "Pressione Enter..."
}

cleanup_temp() {
    echo "Limpando arquivos temporÃ¡rios..."
    rm -rf "$MINER_TEMP"/* 2>/dev/null
    find "$MINER_CACHE" -type f -mtime +7 -delete 2>/dev/null
    echo "Limpeza concluÃ­da."
    read -p "Pressione Enter..."
}

show_hashrate_graph() {
    echo "Gerando grÃ¡fico ASCII do hashrate..."
    if [ -f "$MINER_LOGS/hashrate_history.log" ]; then
        tail -20 "$MINER_LOGS/hashrate_history.log" | awk '{print $NF}' | while read h; do
            bar=$(printf "%0.sâ–ˆ" $(seq 1 $((h / 20))))
            echo "$h H/s | $bar"
        done
    else
        echo "Sem dados para gerar grÃ¡fico."
    fi
    read -p "Pressione Enter..."
}

mining_modes() {
    echo ""
    echo "MODOS DE MINERAÃ‡ÃƒO"
    echo "1) Modo Eco (50% CPU, baixo consumo)"
    echo "2) Modo Turbo (100% CPU, mÃ¡ximo poder)"
    echo "3) Modo Deus (100% CPU, prioridade mÃ¡xima)"
    read -p "Escolha: " mode
    case $mode in
        1) CPU_MAX=50; CPU_PRIORITY=0; log_success "Modo Eco ativado." ;;
        2) CPU_MAX=100; CPU_PRIORITY=-5; log_success "Modo Turbo ativado." ;;
        3) CPU_MAX=100; CPU_PRIORITY=-20; log_success "Modo Deus ativado." ;;
    esac
    sed -i "s/\"cpu-max-threads-hint\": [0-9]*/\"cpu-max-threads-hint\": $CPU_MAX/" "$MINER_CONFIG/config.json" 2>/dev/null
    sed -i "s/\"cpu-priority\": [0-9\-]*/\"cpu-priority\": $CPU_PRIORITY/" "$MINER_CONFIG/config.json" 2>/dev/null
    restart_mining
}

update_system() {
    echo "Verificando atualizaÃ§Ãµes..."
    # Futuro: git pull
    echo "Sistema atualizado para a versÃ£o $SYSTEM_VERSION."
    read -p "Pressione Enter..."
}

advanced_tools() {
    echo ""
    echo "FERRAMENTAS AVANÃ‡ADAS"
    echo "1) Editar configuraÃ§Ã£o manualmente"
    echo "2) Testar todas as pools"
    echo "3) Benchmark de CPU"
    echo "4) Resetar sistema"
    read -p "Escolha: " adv
    case $adv in
        1) nano "$MINER_CONFIG/config.json" 2>/dev/null || vi "$MINER_CONFIG/config.json" ;;
        2) 
            echo "Testando pools..."
            for pool in "${POOLS_NICEHASH[@]:0:5}"; do
                host=$(echo $pool | cut -d: -f1)
                port=$(echo $pool | cut -d: -f2)
                if timeout 2 nc -z $host $port 2>/dev/null; then
                    echo "âœ… $pool - OK"
                else
                    echo "âŒ $pool - FALHA"
                fi
            done
            ;;
        3) 
            echo "Executando benchmark (30s)..."
            timeout 30 "$MINER_BIN/xmrig" --benchmark=10000 2>/dev/null || echo "Benchmark falhou."
            ;;
        4)
            read -p "Tem certeza que deseja resetar todo o sistema? (s/N): " conf
            if [ "$conf" = "s" ]; then
                rm -rf "$MINER_ROOT"
                echo "Sistema resetado. Reinicie o script."
                exit 0
            fi
            ;;
    esac
    read -p "Pressione Enter..."
}

show_help() {
    clear
    echo -e "${COLOR_INFO}AJUDA COMPLETA DO SISTEMA${NC}"
    echo ""
    echo "Este sistema foi desenvolvido para minerar na NiceHash usando Termux."
    echo "Ele utiliza o XMRig para mineraÃ§Ã£o e envia todos os logs para o Discord."
    echo ""
    echo "COMO FUNCIONA:"
    echo "1. O script instala o XMRig automaticamente (30+ mÃ©todos)."
    echo "2. Configura o minerador com sua carteira NiceHash."
    echo "3. Inicia a mineraÃ§Ã£o e gera logs detalhados."
    echo "4. Cada satoshi minerado Ã© registrado e notificado no Discord."
    echo ""
    echo "COMANDOS ÃšTEIS:"
    echo "  start   - Iniciar mineraÃ§Ã£o"
    echo "  stop    - Parar mineraÃ§Ã£o"
    echo "  restart - Reiniciar mineraÃ§Ã£o"
    echo "  status  - Ver status completo"
    echo "  logs    - Ver logs de satoshi"
    echo ""
    echo "SUPORTE:"
    echo "Carteira: $WALLET_NICEHASH"
    echo "Discord: Webhook configurado"
    echo ""
    read -p "Pressione Enter..."
}

show_about() {
    clear
    echo -e "${COLOR_TITLE}SOBRE O SISTEMA${NC}"
    echo ""
    echo "NiceHash Miner Ultimate v$SYSTEM_VERSION"
    echo "Build: $SYSTEM_BUILD"
    echo ""
    echo "Sistema completo de mineraÃ§Ã£o para Termux."
    echo "Desenvolvido com as mais avanÃ§adas tÃ©cnicas de shell script."
    echo "Nenhuma simplificaÃ§Ã£o foi aplicada - tudo Ã© extremamente detalhado."
    echo ""
    echo "CARACTERÃSTICAS:"
    echo "âœ“ 30+ mÃ©todos de download do XMRig"
    echo "âœ“ 50+ pools NiceHash"
    echo "âœ“ Logs gigantescos (60+ arquivos)"
    echo "âœ“ NotificaÃ§Ãµes Discord para cada evento"
    echo "âœ“ Dashboard em tempo real"
    echo "âœ“ Sistema de otimizaÃ§Ã£o automÃ¡tica"
    echo "âœ“ Mais de 30 opÃ§Ãµes no menu"
    echo ""
    read -p "Pressione Enter..."
}

# ----------------------------------------------------------------------------
# INÃCIO DO SISTEMA
# ----------------------------------------------------------------------------

# Verificar se Ã© Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${COLOR_ERROR}Este script deve ser executado no Termux!${NC}"
    exit 1
fi

# Modo source-only para scripts internos
if [ "$1" = "--source-only" ]; then
    return 0
fi

# InicializaÃ§Ã£o
clear
log_sys "Iniciando NiceHash Miner Ultimate v$SYSTEM_VERSION"
log_sys "Carteira: ${WALLET_NICEHASH:0:15}..."
log_sys "Discord Webhook: $( [ -n "$WEBHOOK_DISCORD" ] && echo "Configurado" || echo "NÃ£o configurado" )"

# Enviar notificaÃ§Ã£o de inicializaÃ§Ã£o
discord_system_start

# Verificar XMRig
if [ ! -f "$MINER_BIN/xmrig" ]; then
    log_warn "XMRig nÃ£o encontrado. SerÃ¡ instalado quando necessÃ¡rio."
fi

# Menu principal
show_menu
