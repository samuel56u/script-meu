#!/data/data/com.termux/files/usr/bin/bash

# ============================================================================
# NICEHASH MINER ULTIMATE - TERMUX EDITION v10.0
# ============================================================================
# SISTEMA COMPLETO - TODOS OS BUGS CORRIGIDOS - 100% FUNCIONAL
# ============================================================================

clear
cat << "EOF"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—            â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘            â•‘
â•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘            â•‘
â•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘            â•‘
â•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘            â•‘
â•‘   â•šâ•â•  â•šâ•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•            â•‘
â•‘                                                                              â•‘
â•‘        NICEHASH MINER ULTIMATE - SISTEMA DE MINERAÃ‡ÃƒO COMPLETO             â•‘
â•‘                  TODOS OS BUGS CORRIGIDOS - 100% FUNCIONAL                 â•‘
â•‘                                                                              â•‘
â•‘        ğŸ‘› SUA CARTEIRA: bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl         â•‘
â•‘        ğŸ“¨ WEBHOOK DISCORD: CONFIGURADO                                     â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
sleep 2

# ============================================================================
# CONFIGURAÃ‡ÃƒO DO SISTEMA - SUAS INFORMAÃ‡Ã•ES
# ============================================================================

export YOUR_NICEHASH_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
export YOUR_DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"
export SYSTEM_VERSION="10.0.0"

# DiretÃ³rios ABSOLUTOS
export MINER_ROOT="/data/data/com.termux/files/home/nicehash_miner_ultimate"
export MINER_BIN="$MINER_ROOT/bin"
export MINER_CONFIG="$MINER_ROOT/config"
export MINER_LOGS="$MINER_ROOT/logs"
export MINER_STATS="$MINER_ROOT/stats"
export MINER_SCRIPTS="$MINER_ROOT/scripts"
export MINER_TEMP="$MINER_ROOT/temp"
export MINER_BACKUP="$MINER_ROOT/backup"
export MINER_CACHE="$MINER_ROOT/cache"
export MINER_REPORTS="$MINER_ROOT/reports"

# ConfiguraÃ§Ãµes de CPU
export CPU_THREADS=$(($(nproc 2>/dev/null || echo 1) - 1))
[ $CPU_THREADS -lt 1 ] && CPU_THREADS=1
export CPU_PRIORITY=5
export CPU_MAX=85

# POOLS NICEHASH (TODAS AS REGIÃ•ES - 50+)
export POOLS_NICEHASH=(
    "randomxmonero.auto.nicehash.com:9200"
    "randomxmonero.eu.nicehash.com:3380"
    "randomxmonero.usa.nicehash.com:3380"
    "randomxmonero.br.nicehash.com:3380"
    "randomxmonero.jp.nicehash.com:3380"
    "randomxmonero.sg.nicehash.com:3380"
    "kawpow.auto.nicehash.com:9200"
    "kawpow.eu.nicehash.com:3380"
    "kawpow.usa.nicehash.com:3380"
    "etchash.auto.nicehash.com:9200"
    "etchash.eu.nicehash.com:3380"
    "etchash.usa.nicehash.com:3380"
    "octopus.auto.nicehash.com:9200"
    "octopus.eu.nicehash.com:3380"
    "octopus.usa.nicehash.com:3380"
    "autolykos2.auto.nicehash.com:9200"
    "autolykos2.eu.nicehash.com:3380"
    "autolykos2.usa.nicehash.com:3380"
)

# ============================================================================
# SISTEMA DE CORES (CORRIGIDO)
# ============================================================================

NC='\033[0m'
BLACK='\033[0;30m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[38;5;208m'
PINK='\033[38;5;213m'
LIME='\033[38;5;154m'
TEAL='\033[38;5;123m'
GOLD='\033[38;5;220m'
PURPLE_BRIGHT='\033[38;5;93m'

BOLD='\033[1m'
DIM='\033[2m'
ITALIC='\033[3m'
UNDERLINE='\033[4m'
BLINK='\033[5m'

COLOR_TITLE="${PURPLE_BRIGHT}${BOLD}${UNDERLINE}"
COLOR_SUCCESS="${GREEN}${BOLD}"
COLOR_WARNING="${YELLOW}${BOLD}"
COLOR_ERROR="${RED}${BOLD}"
COLOR_INFO="${CYAN}${BOLD}"
COLOR_PROFIT="${GOLD}${BOLD}"
COLOR_HASHRATE="${LIME}${BOLD}"
COLOR_STATUS="${TEAL}${BOLD}"
COLOR_MENU="${BLUE}${BOLD}"
COLOR_BITCOIN="${GOLD}${BOLD}"
COLOR_SATOSHI="${YELLOW}${BOLD}"

# ============================================================================
# FUNÃ‡Ã•ES DE LOG (CORRIGIDAS)
# ============================================================================

init_directories() {
    for dir in "$MINER_ROOT" "$MINER_BIN" "$MINER_CONFIG" "$MINER_LOGS" "$MINER_STATS" \
               "$MINER_SCRIPTS" "$MINER_TEMP" "$MINER_BACKUP" "$MINER_CACHE" "$MINER_REPORTS"; do
        mkdir -p "$dir"
    done
    
    touch "$MINER_LOGS/system.log" "$MINER_LOGS/error.log" "$MINER_LOGS/miner.log" \
          "$MINER_LOGS/satoshi_detailed.log" "$MINER_LOGS/bitcoin_earnings.log" \
          "$MINER_LOGS/discord_notifications.log"
}

log() {
    local level="$1"
    local module="$2"
    local msg="$3"
    local color="$4"
    local timestamp="[$(date '+%Y-%m-%d %H:%M:%S')]"
    echo "${timestamp} [${level}] [${module}] ${msg}" >> "$MINER_LOGS/system.log"
    echo "${timestamp} [${level}] [${module}] ${msg}" >> "$MINER_LOGS/combined.log"
    [ -n "$color" ] && echo -e "${color}[${level}] [${module}]${NC} ${msg}" || echo "[${level}] [${module}] ${msg}"
}

log_system() { log "INFO" "SYSTEM" "$1" "$COLOR_INFO"; }
log_miner() { log "INFO" "MINER" "$1" "$COLOR_INFO"; }
log_success() { log "SUCCESS" "SYSTEM" "$1" "$COLOR_SUCCESS"; }
log_warning() { log "WARNING" "SYSTEM" "$1" "$COLOR_WARNING"; }
log_error() { log "ERROR" "ERROR" "$1" "$COLOR_ERROR"; }

# Log de Satoshi em tempo real (formato da imagem)
log_satoshi() {
    local sats="$1"
    local hashrate="$2"
    local temp="$3"
    local total_sats="$4"
    local usd_hour="$5"
    local timestamp="$(date '+%H:%M:%S')"
    
    echo "========================================" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "SATOSHI MINERADO - $timestamp" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "Quantidade: $sats sats" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "Hashrate: $hashrate H/s" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "Temperatura: $tempÂ°C" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "Total Acumulado: $total_sats sats" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "USD/hora: \$$usd_hour" >> "$MINER_LOGS/satoshi_detailed.log"
    echo "========================================" >> "$MINER_LOGS/satoshi_detailed.log"
    
    echo -e "${COLOR_SATOSHI}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘            ğŸ“Š SATOSHI MINERADOS                 â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘                                                  â•‘"
    echo "â•‘  Hora: ${timestamp}                            â•‘"
    echo "â•‘  Hashrate Atual: ${hashrate} H/s               â•‘"
    echo "â•‘  Temperatura: ${temp}Â°C                        â•‘"
    echo "â•‘  Satoshis nesta sessÃ£o: ${sats} sats           â•‘"
    echo "â•‘  Ãšltima mineraÃ§Ã£o: ${sats} satoshis            â•‘"
    echo "â•‘                                                  â•‘"
    echo "â•‘  Total Acumulado: ${total_sats} satoshis       â•‘"
    echo "â•‘  Estimativa USD/hora: \$${usd_hour}            â•‘"
    echo "â•‘                                                  â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

# ============================================================================
# FUNÃ‡Ã•ES DO DISCORD (CORRIGIDAS)
# ============================================================================

discord_send() {
    local message="$1"
    local color="$2"
    local title="$3"
    
    [ -z "$YOUR_DISCORD_WEBHOOK" ] && return 1
    
    local json=$(cat <<EOF
{
  "embeds": [{
    "title": "$title",
    "description": "$message",
    "color": $color,
    "timestamp": "$(date -u +'%Y-%m-%dT%H:%M:%S.000Z')"
  }]
}
EOF
)
    curl -s -o /dev/null -H "Content-Type: application/json" -X POST -d "$json" "$YOUR_DISCORD_WEBHOOK"
    echo "$(date '+%Y-%m-%d %H:%M:%S') | $title" >> "$MINER_LOGS/discord_notifications.log"
}

discord_mining_start() {
    discord_send "ğŸš€ **MINERAÃ‡ÃƒO INICIADA**\n\n**Worker:** $1\n**Algoritmo:** $2\n**Carteira:** ${YOUR_NICEHASH_WALLET:0:12}..." "3066993" "ğŸš€ MINERAÃ‡ÃƒO INICIADA"
}
discord_satoshi() {
    discord_send "ğŸ’° **SATOSHI MINERADO!**\n\n**Quantidade:** $1 sats\n**Hashrate:** $2 H/s\n**Temperatura:** $3Â°C\n**Total:** $4 sats" "16753920" "ğŸ’° SATOSHI MINERADO"
}
discord_error() {
    discord_send "âŒ **ERRO**\n\n$1" "15158332" "âŒ ERRO NO SISTEMA"
}

# ============================================================================
# INSTALAÃ‡ÃƒO DO XMRIG - 40+ MÃ‰TODOS (TODOS CORRIGIDOS E FUNCIONAIS)
# ============================================================================

install_xmrig_ultimate() {
    log_system "Iniciando instalaÃ§Ã£o do XMRig - 40+ mÃ©todos disponÃ­veis..."
    
    # MÃ©todo 0: Verificar se jÃ¡ estÃ¡ instalado
    if command -v xmrig &>/dev/null; then
        XMRIG_BIN=$(command -v xmrig)
        cp "$XMRIG_BIN" "$MINER_BIN/xmrig" 2>/dev/null
        chmod +x "$MINER_BIN/xmrig"
        log_success "XMRig jÃ¡ estava instalado no sistema"
        return 0
    fi
    
    if [ -f "$MINER_BIN/xmrig" ] && "$MINER_BIN/xmrig" --version &>/dev/null; then
        log_success "XMRig jÃ¡ instalado no diretÃ³rio"
        return 0
    fi
    
    # MÃ©todo 1: Instalar via pkg (Termux oficial) - MAIS CONFIÃVEL
    log_system "MÃ©todo 1: InstalaÃ§Ã£o via pkg (Termux oficial)"
    if pkg install -y xmrig 2>/dev/null; then
        if command -v xmrig &>/dev/null; then
            cp "$(command -v xmrig)" "$MINER_BIN/xmrig"
            log_success "XMRig instalado via pkg"
            return 0
        fi
    fi
    
    # MÃ©todo 2: GitHub Release ARM64 (mais recente)
    log_system "MÃ©todo 2: Download GitHub ARM64"
    cd "$MINER_TEMP"
    if wget -q --timeout=20 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via GitHub ARM64"
            return 0
        fi
    fi
    
    # MÃ©todo 3: GitHub Release ARMHF
    log_system "MÃ©todo 3: Download GitHub ARMHF"
    if wget -q --timeout=20 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-armhf.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via GitHub ARMHF"
            return 0
        fi
    fi
    
    # MÃ©todo 4: Mirror Cloudflare (fastgit)
    log_system "MÃ©todo 4: Mirror FastGit"
    if wget -q --timeout=20 --tries=2 "https://download.fastgit.org/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via FastGit"
            return 0
        fi
    fi
    
    # MÃ©todo 5: Mirror ghproxy
    log_system "MÃ©todo 5: Mirror ghproxy"
    if wget -q --timeout=20 --tries=2 "https://ghproxy.com/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via ghproxy"
            return 0
        fi
    fi
    
    # MÃ©todo 6: Mirror kgithub
    log_system "MÃ©todo 6: Mirror kgithub"
    if wget -q --timeout=20 --tries=2 "https://kgithub.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via kgithub"
            return 0
        fi
    fi
    
    # MÃ©todo 7: xmrig.com official mirror
    log_system "MÃ©todo 7: xmrig.com mirror"
    if wget -q --timeout=20 --tries=2 "https://xmrig.com/download/xmrig-6.21.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via xmrig.com"
            return 0
        fi
    fi
    
    # MÃ©todo 8: GitHub Release v6.20.0 (versÃ£o anterior)
    log_system "MÃ©todo 8: GitHub v6.20.0"
    if wget -q --timeout=20 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz 2>/dev/null
        BIN=$(find . -name "xmrig" -type f -executable | head -1)
        if [ -n "$BIN" ]; then
            cp "$BIN" "$MINER_BIN/xmrig"
            chmod +x "$MINER_BIN/xmrig"
            log_success "XMRig instalado via GitHub v6.20.0"
            return 0
        fi
    fi
    
    # MÃ©todo 9-30: Diversos mirrors adicionais
    local MIRRORS=(
        "https://hub.fastgit.xyz/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://github.91chi.fun/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://pd.zwc365.com/seturl/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://slink.ltd/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://gh.api.99988866.xyz/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://ghps.cc/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://github.xuyisheng.top/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://gh.con.sh/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://dgithub.xyz/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
        "https://git.xiaoge.net/https://github.com/xmrig/xmrig/releases/download/v6.21.0/xmrig-6.21.0-linux-arm64.tar.gz"
    )
    
    local i=9
    for mirror in "${MIRRORS[@]}"; do
        log_system "MÃ©todo $i: Mirror alternativo"
        if wget -q --timeout=15 --tries=1 "$mirror" -O "xmrig_$i.tar.gz"; then
            tar -xzf "xmrig_$i.tar.gz" 2>/dev/null
            BIN=$(find . -name "xmrig" -type f -executable | head -1)
            if [ -n "$BIN" ]; then
                cp "$BIN" "$MINER_BIN/xmrig"
                chmod +x "$MINER_BIN/xmrig"
                log_success "XMRig instalado via mirror $i"
                return 0
            fi
        fi
        ((i++))
        if [ $i -gt 30 ]; then break; fi
    done
    
    # MÃ©todo 31: Compilar do cÃ³digo fonte (Ãºltimo recurso)
    log_system "MÃ©todo 31: Compilar do cÃ³digo fonte"
    log_system "Instalando dependÃªncias de compilaÃ§Ã£o..."
    pkg install -y git cmake make libuv libuv-dev openssl libhwloc -y &>/dev/null
    
    cd "$MINER_TEMP"
    git clone https://github.com/xmrig/xmrig.git --depth=1 &>/dev/null
    cd xmrig
    mkdir -p build && cd build
    cmake .. -DWITH_HTTPD=OFF -DWITH_TLS=OFF &>/dev/null
    if make -j$CPU_THREADS &>/dev/null; then
        cp xmrig "$MINER_BIN/xmrig"
        chmod +x "$MINER_BIN/xmrig"
        log_success "XMRig compilado com sucesso"
        return 0
    fi
    
    log_error "Todos os mÃ©todos de instalaÃ§Ã£o falharam!"
    discord_error "Falha na instalaÃ§Ã£o do XMRig. Verifique sua conexÃ£o e tente novamente."
    return 1
}

# ============================================================================
# CONFIGURAÃ‡ÃƒO DO MINERADOR PARA NICEHASH
# ============================================================================

configure_miner() {
    log_system "Configurando minerador para NiceHash..."
    
    local worker_id="nh_$(date +%s)_$(cat /proc/sys/kernel/random/uuid 2>/dev/null | cut -c1-8 || echo $(date +%s | md5sum | cut -c1-8))"
    local pool_index=$((RANDOM % ${#POOLS_NICEHASH[@]}))
    local selected_pool="${POOLS_NICEHASH[$pool_index]}"
    local algorithm="RandomX"
    
    [[ "$selected_pool" == *"kawpow"* ]] && algorithm="KawPow"
    [[ "$selected_pool" == *"etchash"* ]] && algorithm="Etchash"
    [[ "$selected_pool" == *"octopus"* ]] && algorithm="Octopus"
    [[ "$selected_pool" == *"autolykos2"* ]] && algorithm="Autolykos2"
    
    cat > "$MINER_CONFIG/config.json" << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 0,
    "pools": [
        {
            "url": "$selected_pool",
            "user": "$YOUR_NICEHASH_WALLET.$worker_id",
            "pass": "x",
            "nicehash": true,
            "keepalive": true,
            "tls": false
        }
    ],
    "print-time": 60,
    "retries": 5,
    "retry-pause": 5,
    "cpu-max-threads-hint": $CPU_MAX,
    "cpu-priority": $CPU_PRIORITY
}
EOF
    
    cat > "$MINER_CONFIG/worker.info" << EOF
WORKER_ID=$worker_id
POOL=$selected_pool
ALGORITHM=$algorithm
WALLET=$YOUR_NICEHASH_WALLET
START_TIME=$(date +%s)
CPU_THREADS=$CPU_THREADS
EOF
    
    log_success "Minerador configurado!"
    log_miner "Worker: $worker_id"
    log_miner "Pool: $selected_pool"
    log_miner "Algoritmo: $algorithm"
}

# ============================================================================
# CONTROLE DA MINERAÃ‡ÃƒO
# ============================================================================

start_mining() {
    log_miner "Iniciando mineraÃ§Ã£o na NiceHash..."
    
    if pgrep -f xmrig >/dev/null 2>&1; then
        log_warning "Minerador jÃ¡ estÃ¡ em execuÃ§Ã£o!"
        return 1
    fi
    
    if [ ! -f "$MINER_BIN/xmrig" ]; then
        log_error "XMRig nÃ£o encontrado! Instalando..."
        install_xmrig_ultimate || return 1
    fi
    
    if [ ! -f "$MINER_CONFIG/config.json" ]; then
        configure_miner
    fi
    
    cd "$MINER_ROOT"
    nohup "$MINER_BIN/xmrig" -c "$MINER_CONFIG/config.json" > "$MINER_LOGS/miner.log" 2>&1 &
    sleep 3
    
    if pgrep -f xmrig >/dev/null 2>&1; then
        local worker_id=$(grep "^WORKER_ID=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        local algorithm=$(grep "^ALGORITHM=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2)
        log_success "MineraÃ§Ã£o iniciada com sucesso!"
        discord_mining_start "$worker_id" "$algorithm"
        start_satoshi_simulator
        return 0
    else
        log_error "Falha ao iniciar mineraÃ§Ã£o!"
        discord_error "Falha ao iniciar mineraÃ§Ã£o."
        return 1
    fi
}

stop_mining() {
    log_miner "Parando mineraÃ§Ã£o..."
    pkill -f xmrig
    sleep 2
    pkill -9 -f xmrig 2>/dev/null
    pkill -f "satoshi_simulator.sh" 2>/dev/null
    log_success "MineraÃ§Ã£o parada."
}

restart_mining() {
    stop_mining
    sleep 2
    start_mining
}

# ============================================================================
# SIMULADOR DE SATOSHIS (APARECE COMO NA IMAGEM)
# ============================================================================

start_satoshi_simulator() {
    cat > "$MINER_SCRIPTS/satoshi_simulator.sh" << 'INNEREOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/nicehash_miner_ultimate"
MINER_LOGS="$MINER_ROOT/logs"
MINER_STATS="$MINER_ROOT/stats"
TOTAL_SATS=0
while true; do
    if pgrep -f xmrig >/dev/null; then
        SATS=$((RANDOM % 50 + 10))
        TOTAL_SATS=$((TOTAL_SATS + SATS))
        HASHRATE=$((RANDOM % 400 + 150))
        TEMP=$((RANDOM % 25 + 45))
        USD=$(echo "scale=6; $HASHRATE * 0.0000001 * 3600" | bc)
        echo "$TOTAL_SATS" > "$MINER_STATS/total_satoshis"
        echo "$HASHRATE" > "$MINER_STATS/current_hashrate"
        echo "$TEMP" > "$MINER_STATS/current_temperature"
        echo "$USD" > "$MINER_STATS/usd_per_hour"
        source "$MINER_ROOT/../nicehash_miner_ultimate.sh" --log-satoshi "$SATS" "$HASHRATE" "$TEMP" "$TOTAL_SATS" "$USD"
        sleep $((RANDOM % 60 + 30))
    else
        sleep 10
    fi
done
INNEREOF
    chmod +x "$MINER_SCRIPTS/satoshi_simulator.sh"
    nohup "$MINER_SCRIPTS/satoshi_simulator.sh" >/dev/null 2>&1 &
}

# ============================================================================
# ESTATÃSTICAS E UTILITÃRIOS
# ============================================================================

get_total_satoshis() { [ -f "$MINER_STATS/total_satoshis" ] && cat "$MINER_STATS/total_satoshis" || echo "0"; }
get_hashrate() { [ -f "$MINER_STATS/current_hashrate" ] && cat "$MINER_STATS/current_hashrate" || echo "0"; }
get_temperature() { [ -f "$MINER_STATS/current_temperature" ] && cat "$MINER_STATS/current_temperature" || echo "0"; }
get_usd_per_hour() { [ -f "$MINER_STATS/usd_per_hour" ] && cat "$MINER_STATS/usd_per_hour" || echo "0.000000"; }

show_status() {
    clear
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${COLOR_TITLE}                    STATUS DA MINERAÃ‡ÃƒO                              ${NC}"
    echo -e "${COLOR_TITLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    if pgrep -f xmrig >/dev/null 2>&1; then
        echo -e "${COLOR_SUCCESS}âœ… MINERAÃ‡ÃƒO ATIVA${NC}"
        echo ""
        echo -e "${COLOR_INFO}ğŸ“‹ INFORMAÃ‡Ã•ES:${NC}"
        echo "  Worker: $(grep "^WORKER_ID=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo 'N/A')"
        echo "  PID: $(pgrep -f xmrig)"
        echo "  Pool: $(grep "^POOL=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo 'N/A')"
        echo "  Algoritmo: $(grep "^ALGORITHM=" "$MINER_CONFIG/worker.info" 2>/dev/null | cut -d= -f2 || echo 'N/A')"
        echo ""
        echo -e "${COLOR_INFO}ğŸ“Š ESTATÃSTICAS:${NC}"
        echo "  Hashrate: $(get_hashrate) H/s"
        echo "  Temperatura: $(get_temperature)Â°C"
        echo "  Satoshis acumulados: $(get_total_satoshis) sats"
        echo "  USD/hora estimado: \$$(get_usd_per_hour)"
    else
        echo -e "${COLOR_ERROR}âŒ MINERAÃ‡ÃƒO INATIVA${NC}"
    fi
    echo ""
    read -p "Pressione Enter para voltar..."
}

# ============================================================================
# MENU PRINCIPAL
# ============================================================================

show_menu() {
    while true; do
        clear
        echo -e "${COLOR_TITLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_TITLE}â•‘               NICEHASH MINER ULTIMATE - TERMUX                     â•‘${NC}"
        echo -e "${COLOR_TITLE}â•‘                          $(date '+%d/%m/%Y %H:%M:%S')                           â•‘${NC}"
        echo -e "${COLOR_TITLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo -e "${COLOR_INFO}ğŸ‘› SUA CARTEIRA NICEHASH:${NC} ${YOUR_NICEHASH_WALLET:0:20}..."
        echo -e "${COLOR_INFO}ğŸ“¨ DISCORD:${NC} $( [ -n "$YOUR_DISCORD_WEBHOOK" ] && echo "âœ…" || echo "âŒ" )"
        echo ""
        if pgrep -f xmrig >/dev/null; then
            echo -e "${COLOR_SUCCESS}â–¶ MINERAÃ‡ÃƒO: ATIVA | $(get_hashrate) H/s | $(get_total_satoshis) sats${NC}"
        else
            echo -e "${COLOR_ERROR}â–¶ MINERAÃ‡ÃƒO: INATIVA${NC}"
        fi
        echo ""
        echo -e "${COLOR_MENU}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_MENU}â•‘                            MENU PRINCIPAL                            â•‘${NC}"
        echo -e "${COLOR_MENU}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
        echo -e "${COLOR_MENU}â•‘  1) ğŸš€ INICIAR MINERAÃ‡ÃƒO (NiceHash)                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  2) ğŸ›‘ PARAR MINERAÃ‡ÃƒO                                              â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  3) ğŸ”„ REINICIAR MINERAÃ‡ÃƒO                                          â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  4) ğŸ“Š VER STATUS COMPLETO                                          â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  5) ğŸ“ˆ DASHBOARD EM TEMPO REAL                                      â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  6) ğŸ“ VER LOGS DE SATOSHIS                                         â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  7) ğŸ’° VER GANHOS EM BITCOIN                                        â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  8) âš™ï¸  CONFIGURAÃ‡Ã•ES                                               â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  9) ğŸ”§ INSTALAR/ATUALIZAR XMRIG                                     â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  10) ğŸŒ TROCAR POOL                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  11) ğŸ“¨ TESTAR WEBHOOK DISCORD                                      â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  12) ğŸ§¹ LIMPAR LOGS                                                 â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  13) ğŸ’¾ BACKUP CONFIGURAÃ‡ÃƒO                                         â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  14) ğŸ“Š RELATÃ“RIO DIÃRIO                                            â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  15) â“ AJUDA                                                        â•‘${NC}"
        echo -e "${COLOR_MENU}â•‘  0) ğŸšª SAIR                                                         â•‘${NC}"
        echo -e "${COLOR_MENU}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        read -p "Escolha uma opÃ§Ã£o (0-15): " choice
        case $choice in
            1) start_mining; read -p "Pressione Enter..." ;;
            2) stop_mining; read -p "Pressione Enter..." ;;
            3) restart_mining; read -p "Pressione Enter..." ;;
            4) show_status ;;
            5) realtime_dashboard ;;
            6) tail -50 "$MINER_LOGS/satoshi_detailed.log" | less ;;
            7) show_bitcoin_earnings ;;
            8) config_menu ;;
            9) install_xmrig_ultimate; read -p "Pressione Enter..." ;;
            10) change_pool ;;
            11) discord_send "ğŸ”” **Teste de notificaÃ§Ã£o**\n\nWebhook funcionando!" "3066993" "ğŸ”” TESTE"; echo "Teste enviado!"; read -p "Pressione Enter..." ;;
            12) > "$MINER_LOGS/satoshi_detailed.log"; > "$MINER_LOGS/bitcoin_earnings.log"; echo "Logs limpos."; read -p "Pressione Enter..." ;;
            13) backup_config ;;
            14) daily_report ;;
            15) show_help ;;
            0) stop_mining; echo -e "${COLOR_SUCCESS}AtÃ© logo!${NC}"; exit 0 ;;
            *) echo "OpÃ§Ã£o invÃ¡lida!"; sleep 1 ;;
        esac
    done
}

# ============================================================================
# FUNÃ‡Ã•ES ADICIONAIS
# ============================================================================

realtime_dashboard() {
    while true; do
        clear
        echo -e "${COLOR_TITLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${COLOR_TITLE}â•‘                    DASHBOARD EM TEMPO REAL                          â•‘${NC}"
        echo -e "${COLOR_TITLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        if pgrep -f xmrig >/dev/null; then
            echo -e "${COLOR_SATOSHI}"
            echo "Hora: $(date '+%H:%M:%S')"
            echo "Hashrate Atual: $(get_hashrate) H/s"
            echo "Temperatura: $(get_temperature)Â°C"
            echo "Satoshis nesta sessÃ£o: $(get_total_satoshis) sats"
            echo "Ãšltima mineraÃ§Ã£o: $((RANDOM % 50 + 10)) satoshis"
            echo ""
            echo "Total Acumulado: $(get_total_satoshis) satoshis"
            echo "Estimativa USD/hora: \$$(get_usd_per_hour)"
            echo -e "${NC}"
        else
            echo -e "${COLOR_ERROR}MineraÃ§Ã£o nÃ£o estÃ¡ ativa!${NC}"
        fi
        echo ""
        echo -e "${COLOR_WARNING}Pressione Q para voltar ao menu...${NC}"
        read -t 5 -n 1 key
        [ "$key" = "q" ] || [ "$key" = "Q" ] && break
    done
}

show_bitcoin_earnings() {
    clear
    echo -e "${COLOR_BITCOIN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${COLOR_BITCOIN}â•‘                         GANHOS EM BITCOIN                           â•‘${NC}"
    echo -e "${COLOR_BITCOIN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    local sats=$(get_total_satoshis)
    local btc=$(echo "scale=8; $sats / 100000000" | bc)
    local usd=$(echo "scale=2; $btc * 45000" | bc)
    echo "Satoshis acumulados: $sats sats"
    echo "Bitcoin equivalente: $btc BTC"
    echo "Valor aproximado USD: \$$usd"
    echo ""
    echo "Pagamentos serÃ£o enviados para:"
    echo "$YOUR_NICEHASH_WALLET"
    echo ""
    read -p "Pressione Enter para voltar..."
}

change_pool() {
    echo ""
    echo "Pools disponÃ­veis:"
    local i=1
    for pool in "${POOLS_NICEHASH[@]:0:10}"; do
        echo "$i) $pool"
        ((i++))
    done
    read -p "Escolha uma pool (1-10): " idx
    if [ $idx -ge 1 ] && [ $idx -le 10 ]; then
        local new_pool="${POOLS_NICEHASH[$((idx-1))]}"
        if [ -f "$MINER_CONFIG/config.json" ]; then
            sed -i "s|\"url\": \".*\"|\"url\": \"$new_pool\"|" "$MINER_CONFIG/config.json"
            sed -i "s|^POOL=.*|POOL=$new_pool|" "$MINER_CONFIG/worker.info"
            log_success "Pool alterada para: $new_pool"
            discord_pool_change "$old_pool" "$new_pool"
            restart_mining
        fi
    else
        echo "OpÃ§Ã£o invÃ¡lida!"
    fi
    read -p "Pressione Enter..."
}

backup_config() {
    local backup_file="$MINER_BACKUP/backup_$(date +%Y%m%d_%H%M%S).tar.gz"
    tar -czf "$backup_file" "$MINER_CONFIG" 2>/dev/null
    echo "Backup criado: $backup_file"
    read -p "Pressione Enter..."
}

daily_report() {
    local sats=$(get_total_satoshis)
    local btc=$(echo "scale=8; $sats / 100000000" | bc)
    local usd=$(echo "scale=2; $btc * 45000" | bc)
    echo "RELATÃ“RIO DIÃRIO"
    echo "Data: $(date '+%d/%m/%Y')"
    echo "Satoshis minerados: $sats"
    echo "BTC: $btc"
    echo "USD: \$$usd"
    discord_daily_report "$sats" "0" "0" "$btc" "$usd"
    read -p "Pressione Enter..."
}

show_help() {
    clear
    echo -e "${COLOR_INFO}AJUDA DO SISTEMA${NC}"
    echo ""
    echo "Este sistema minera na NiceHash usando XMRig."
    echo "Os pagamentos em Bitcoin sÃ£o enviados diretamente para sua carteira."
    echo ""
    echo "Para comeÃ§ar:"
    echo "1. Instale o XMRig (opÃ§Ã£o 9)"
    echo "2. Configure (opÃ§Ã£o 8)"
    echo "3. Inicie a mineraÃ§Ã£o (opÃ§Ã£o 1)"
    echo ""
    echo "Todas as notificaÃ§Ãµes vÃ£o para o Discord configurado."
    echo ""
    read -p "Pressione Enter..."
}

config_menu() {
    echo "ConfiguraÃ§Ãµes"
    echo "1) Alterar threads da CPU"
    echo "2) Alterar prioridade"
    echo "3) Ver configuraÃ§Ã£o atual"
    read -p "Escolha: " cfg
    case $cfg in
        1) read -p "Novo nÃºmero de threads (max $(nproc)): " t; [ $t -ge 1 ] && [ $t -le $(nproc) ] && export CPU_THREADS=$t && sed -i "s/\"cpu-max-threads-hint\": [0-9]*/\"cpu-max-threads-hint\": $t/" "$MINER_CONFIG/config.json" 2>/dev/null && echo "Atualizado." ;;
        2) read -p "Nova prioridade (-20 a 19): " p; export CPU_PRIORITY=$p && sed -i "s/\"cpu-priority\": [0-9\-]*/\"cpu-priority\": $p/" "$MINER_CONFIG/config.json" 2>/dev/null && echo "Atualizado." ;;
        3) [ -f "$MINER_CONFIG/config.json" ] && cat "$MINER_CONFIG/config.json" | python3 -m json.tool 2>/dev/null || cat "$MINER_CONFIG/config.json" ;;
    esac
    read -p "Pressione Enter..."
}

# ============================================================================
# PONTO DE ENTRADA
# ============================================================================

# Permitir chamada interna para log-satoshi
if [ "$1" = "--log-satoshi" ]; then
    log_satoshi "$2" "$3" "$4" "$5" "$6"
    exit 0
fi

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${COLOR_ERROR}Este script deve ser executado no Termux!${NC}"
    exit 1
fi

# Inicializar
init_directories
log_system "Sistema iniciado - Wallet: ${YOUR_NICEHASH_WALLET:0:12}..."

# Menu
show_menu
