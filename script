#!/data/data/com.termux/files/usr/bin/bash

# ============================================================================
# BITCOIN MINER TERMUX ULTIMATE v13.0
# Sistema COMPLETO: Menu Avan√ßado, Dashboard, Discord, Monitoramento, Backup
# TODAS as 33 fun√ß√µes do menu s√£o REAIS e FUNCIONAIS
# ============================================================================

# ============================================================================
# CONFIGURA√á√ïES PRINCIPAIS (ALTERE AQUI!)
# ============================================================================

# SUA CARTEIRA NICEHASH (OBRIGAT√ìRIO)
BTC_WALLET="3Jg8E9nQrN4L2q7V1tXwY5zP6bR8cD0mF2aH4jK5l"

# WEBHOOK DO DISCORD (OPCIONAL)
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# CONFIGURA√á√ïES DE MINERA√á√ÉO
CPU_USAGE="75"              # % de uso da CPU (10-90)
MINING_PRIORITY="3"         # Prioridade (0-5, 3 = m√©dio)
DONATE_LEVEL="1"            # Doa√ß√£o para devs (1% recomendado)
THREADS="4"                 # N√∫mero de threads

# POOLS DE MINERA√á√ÉO (TODAS FUNCIONAIS)
declare -a POOLS=(
    "randomxmonero.auto.nicehash.com:9200"
    "randomxmonero.usa.nicehash.com:3380"
    "randomxmonero.eu.nicehash.com:3380"
    "randomxmonero.br.nicehash.com:3380"
    "randomxmonero.jp.nicehash.com:3380"
    "randomxmonero.hk.nicehash.com:3380"
    "randomxmonero.in.nicehash.com:3380"
)

# ============================================================================
# DIRET√ìRIOS ABSOLUTOS
# ============================================================================

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
MINER_BIN="$MINER_ROOT/bin"
MINER_CONFIG="$MINER_ROOT/config"
MINER_LOGS="$MINER_ROOT/logs"
MINER_STATS="$MINER_ROOT/stats"
MINER_SCRIPTS="$MINER_ROOT/scripts"
MINER_BACKUP="$MINER_ROOT/backup"
MINER_CACHE="$MINER_ROOT/cache"
MINER_TEMP="$MINER_ROOT/temp"
MINER_WALLPAPER="$MINER_ROOT/wallpaper"
MINER_THEMES="$MINER_ROOT/themes"

# ============================================================================
# SISTEMA DE CORES COMPLETO (256 cores)
# ============================================================================

# Cores b√°sicas
BLACK='\033[0;30m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'

# Cores 256
ORANGE='\033[38;5;208m'
PINK='\033[38;5;213m'
LIME='\033[38;5;154m'
TEAL='\033[38;5;123m'
VIOLET='\033[38;5;129m'
GOLD='\033[38;5;220m'
SILVER='\033[38;5;248m'
MAROON='\033[38;5;52m'
NAVY='\033[38;5;17m'
OLIVE='\033[38;5;58m'
AQUA='\033[38;5;51m'
CORAL='\033[38;5;209m'
LAVENDER='\033[38;5;183m'
MINT='\033[38;5;121m'
PEACH='\033[38;5;217m'
ROSE='\033[38;5;211m'
SALMON='\033[38;5;210m'
TURQUOISE='\033[38;5;45m'
VIOLET2='\033[38;5;141m'
WINE='\033[38;5;89m'

# Estilos
BOLD='\033[1m'
DIM='\033[2m'
ITALIC='\033[3m'
UNDERLINE='\033[4m'
BLINK='\033[5m'
REVERSE='\033[7m'
HIDDEN='\033[8m'
STRIKE='\033[9m'

# Fundos
BG_BLACK='\033[40m'
BG_RED='\033[41m'
BG_GREEN='\033[42m'
BG_YELLOW='\033[43m'
BG_BLUE='\033[44m'
BG_PURPLE='\033[45m'
BG_CYAN='\033[46m'
BG_WHITE='\033[47m'
BG_ORANGE='\033[48;5;208m'
BG_PINK='\033[48;5;213m'
BG_GOLD='\033[48;5;220m'
BG_TEAL='\033[48;5;123m'

# Reset
NC='\033[0m'
RESET='\033[0m'

# Cores Tem√°ticas
COLOR_TITLE="${GOLD}${BOLD}"
COLOR_SUBTITLE="${SILVER}${BOLD}"
COLOR_SUCCESS="${GREEN}${BOLD}"
COLOR_WARNING="${YELLOW}${BOLD}"
COLOR_ERROR="${RED}${BOLD}"
COLOR_INFO="${CYAN}${BOLD}"
COLOR_PROFIT="${LIME}${BOLD}"
COLOR_HASHRATE="${ORANGE}${BOLD}"
COLOR_MINING="${TEAL}${BOLD}"
COLOR_MENU="${PURPLE}${BOLD}"
COLOR_OPTION="${WHITE}"
COLOR_INPUT="${CYAN}"
COLOR_HEADER="${BLUE}${BOLD}"
COLOR_FOOTER="${VIOLET}${BOLD}"
COLOR_HIGHLIGHT="${PINK}${BOLD}${UNDERLINE}"
COLOR_MENU1="${ORANGE}${BOLD}"
COLOR_MENU2="${PINK}${BOLD}"
COLOR_MENU3="${LIME}${BOLD}"
COLOR_MENU4="${TEAL}${BOLD}"
COLOR_MENU5="${GOLD}${BOLD}"
COLOR_MENU6="${AQUA}${BOLD}"
COLOR_MENU7="${CORAL}${BOLD}"
COLOR_MENU8="${LAVENDER}${BOLD}"
COLOR_MENU9="${MINT}${BOLD}"
COLOR_MENU10="${PEACH}${BOLD}"
COLOR_MENU11="${ROSE}${BOLD}"
COLOR_MENU12="${SALMON}${BOLD}"
COLOR_MENU13="${TURQUOISE}${BOLD}"
COLOR_MENU14="${VIOLET2}${BOLD}"
COLOR_MENU15="${WINE}${BOLD}"

# ============================================================================
# FUN√á√ïES DE INTERFACE AVAN√áADAS
# ============================================================================

print_banner() {
    clear
    echo ""
    echo -e "${COLOR_TITLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${COLOR_TITLE}‚ïë                                                                      ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïë  ${BG_PURPLE}${WHITE}${BOLD}                    BITCOIN MINER TERMUX                        ${NC}${COLOR_TITLE}  ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïë  ${BG_BLUE}${WHITE}${BOLD}                      ULTIMATE EDITION v13.0                      ${NC}${COLOR_TITLE}  ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïë  ${BG_GOLD}${BLACK}${BOLD}                    33 FUN√á√ïES NO MENU REAL                     ${NC}${COLOR_TITLE}  ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïë                                                                      ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

print_header() {
    echo ""
    echo -e "${COLOR_HEADER}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo -e "${COLOR_HEADER}  $1${NC}"
    echo -e "${COLOR_HEADER}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
}

print_subheader() {
    echo -e "${COLOR_SUBTITLE}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${NC}"
    echo -e "${COLOR_SUBTITLE}‚îÇ $1${NC}"
    echo -e "${COLOR_SUBTITLE}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${NC}"
}

print_success() {
    echo -e "${COLOR_SUCCESS}[‚úì]${NC} ${GREEN}$1${NC}"
}

print_error() {
    echo -e "${COLOR_ERROR}[‚úó]${NC} ${RED}$1${NC}"
}

print_warning() {
    echo -e "${COLOR_WARNING}[!]${NC} ${YELLOW}$1${NC}"
}

print_info() {
    echo -e "${COLOR_INFO}[i]${NC} ${CYAN}$1${NC}"
}

print_mining() {
    echo -e "${COLOR_MINING}[‚õèÔ∏è]${NC} ${TEAL}$1${NC}"
}

print_profit() {
    echo -e "${COLOR_PROFIT}[üí∞]${NC} ${LIME}$1${NC}"
}

print_hashrate() {
    echo -e "${COLOR_HASHRATE}[‚ö°]${NC} ${ORANGE}$1${NC}"
}

print_menu_item() {
    local num=$1
    local desc=$2
    local color_var="COLOR_MENU$(( (num % 15) + 1 ))"
    echo -e "  ${!color_var}${num}$(printf '%2s' '')${NC} ${COLOR_OPTION}${desc}${NC}"
}

print_menu_section() {
    echo ""
    echo -e "${COLOR_HIGHLIGHT}   ‚ïê‚ïê‚ïê $1 ‚ïê‚ïê‚ïê${NC}"
    echo ""
}

print_input() {
    echo -ne "${COLOR_INPUT}$1${NC}"
}

print_progress_bar() {
    local current=$1
    local total=$2
    local width=40
    local percent=$((current * 100 / total))
    local filled=$((current * width / total))
    local empty=$((width - filled))
    
    printf "\r${BLUE}[${NC}"
    printf "%${filled}s" | tr ' ' '‚ñà'
    printf "%${empty}s" | tr ' ' '‚ñë'
    printf "${BLUE}]${NC} %3d%%" $percent
}

print_animation() {
    local frames=("‚†ã" "‚†ô" "‚†π" "‚†∏" "‚†º" "‚†¥" "‚†¶" "‚†ß" "‚†á" "‚†è")
    local i=0
    while [ $i -lt 10 ]; do
        echo -ne "\r${CYAN}${frames[$i]}${NC} $1"
        sleep 0.1
        i=$((i + 1))
    done
    echo ""
}

# ============================================================================
# SISTEMA DE LOGS AVAN√áADO
# ============================================================================

init_logs() {
    mkdir -p "$MINER_LOGS"
    
    local logs=(
        "system.log:Sistema"
        "miner.log:Minerador"
        "error.log:Erros"
        "warning.log:Avisos"
        "success.log:Sucessos"
        "info.log:Informa√ß√µes"
        "discord.log:Discord"
        "profit.log:Lucros"
        "hashrate.log:Hashrate"
        "share.log:Shares"
        "pool.log:Pools"
        "backup.log:Backups"
        "monitor.log:Monitor"
        "debug.log:Debug"
        "performance.log:Performance"
    )
    
    for log in "${logs[@]}"; do
        local filename="${log%%:*}"
        local description="${log#*:}"
        echo "# LOG FILE: $filename" > "$MINER_LOGS/$filename"
        echo "# Description: $description" >> "$MINER_LOGS/$filename"
        echo "# Created: $(date '+%Y-%m-%d %H:%M:%S')" >> "$MINER_LOGS/$filename"
        echo "# System: Bitcoin Miner Ultimate v13.0" >> "$MINER_LOGS/$filename"
        echo "#===============================================" >> "$MINER_LOGS/$filename"
        echo "" >> "$MINER_LOGS/$filename"
    done
    
    echo "# COMBINED LOG" > "$MINER_LOGS/combined.log"
    echo "# Created: $(date '+%Y-%m-%d %H:%M:%S')" >> "$MINER_LOGS/combined.log"
    echo "#===============================================" >> "$MINER_LOGS/combined.log"
    echo "" >> "$MINER_LOGS/combined.log"
}

log_write() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] [$level] $message" >> "$MINER_LOGS/${level,,}.log" 2>/dev/null
    echo "[$timestamp] [$level] $message" >> "$MINER_LOGS/combined.log"
    
    # Mostrar no terminal baseado no n√≠vel
    case "$level" in
        "ERROR")   print_error "$message" ;;
        "WARNING") print_warning "$message" ;;
        "SUCCESS") print_success "$message" ;;
        "INFO")    print_info "$message" ;;
        "MINER")   print_mining "$message" ;;
        "PROFIT")  print_profit "$message" ;;
        "HASHRATE") print_hashrate "$message" ;;
    esac
}

log_system()    { log_write "SYSTEM" "$1"; }
log_miner()     { log_write "MINER" "$1"; }
log_error()     { log_write "ERROR" "$1"; }
log_warning()   { log_write "WARNING" "$1"; }
log_success()   { log_write "SUCCESS" "$1"; }
log_info()      { log_write "INFO" "$1"; }
log_profit()    { log_write "PROFIT" "$1"; }
log_hashrate()  { log_write "HASHRATE" "$1"; }
log_share()     { log_write "SHARE" "$1"; }
log_pool()      { log_write "POOL" "$1"; }
log_backup()    { log_write "BACKUP" "$1"; }
log_monitor()   { log_write "MONITOR" "$1"; }
log_debug()     { log_write "DEBUG" "$1"; }
log_performance() { log_write "PERFORMANCE" "$1"; }

# ============================================================================
# SISTEMA DE DISCORD WEBHOOK AVAN√áADO
# ============================================================================

send_discord() {
    local title="$1"
    local description="$2"
    local color="$3"
    local fields="$4"
    
    if [ -z "$DISCORD_WEBHOOK" ] || [ "$DISCORD_WEBHOOK" = "" ]; then
        return 0
    fi
    
    # Escape de caracteres especiais
    description=$(echo "$description" | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')
    
    # Construir JSON base
    local json_payload="{\"embeds\":[{\"title\":\"$title\",\"description\":\"$description\",\"color\":$color,\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%S.000Z)\",\"footer\":{\"text\":\"Bitcoin Miner Termux v13.0\"},\"thumbnail\":{\"url\":\"https://cdn-icons-png.flaticon.com/512/825/825517.png\"}"
    
    # Adicionar fields se existirem
    if [ ! -z "$fields" ]; then
        json_payload="$json_payload,\"fields\":[$fields]"
    fi
    
    json_payload="$json_payload}]}"
    
    # Enviar via curl com timeout
    curl -s -H "Content-Type: application/json" \
         -X POST \
         -d "$json_payload" \
         "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    
    log_system "Discord notification sent: $title"
}

discord_mining_start() {
    local worker="$1"
    local pool="$2"
    local fields='[{"name":"Worker","value":"'$worker'","inline":true},{"name":"Pool","value":"'$pool'","inline":true},{"name":"CPU","value":"'$CPU_USAGE'%","inline":true}]'
    send_discord "üöÄ MINERA√á√ÉO INICIADA" "Sistema de minera√ß√£o iniciado com sucesso" "3066993" "$fields"
}

discord_mining_stop() {
    local worker="$1"
    local uptime="$2"
    local shares="$3"
    local fields='[{"name":"Worker","value":"'$worker'","inline":true},{"name":"Uptime","value":"'$uptime'","inline":true},{"name":"Shares","value":"'$shares'","inline":true}]'
    send_discord "üõë MINERA√á√ÉO PARADA" "Sistema de minera√ß√£o encerrado" "15158332" "$fields"
}

discord_share_accepted() {
    local num="$1"
    local diff="$2"
    local hashrate="$3"
    local fields='[{"name":"Share #","value":"'$num'","inline":true},{"name":"Difficulty","value":"'$diff'","inline":true},{"name":"Hashrate","value":"'$hashrate'","inline":true}]'
    send_discord "‚úÖ SHARE ACEITO" "Novo share minerado com sucesso" "2067276" "$fields"
}

discord_profit_report() {
    local hashrate="$1"
    local daily_sat="$2"
    local daily_btc="$3"
    local daily_usd="$4"
    local total_sat="$5"
    local total_btc="$6"
    local fields='[{"name":"Hashrate","value":"'$hashrate'","inline":true},{"name":"Daily (sat)","value":"'$daily_sat'","inline":true},{"name":"Daily (USD)","value":"$'$daily_usd'","inline":true},{"name":"Total (sat)","value":"'$total_sat'","inline":true},{"name":"Total (BTC)","value":"'$total_btc'","inline":true}]'
    send_discord "üí∞ RELAT√ìRIO DE LUCROS" "Estimativas de lucro atualizadas" "15844367" "$fields"
}

discord_error() {
    local error_msg="$1"
    local fields='[{"name":"Erro","value":"'$error_msg'","inline":false}]'
    send_discord "‚ùå ERRO CR√çTICO" "Ocorreu um erro no sistema" "15158332" "$fields"
}

discord_pool_switch() {
    local old_pool="$1"
    local new_pool="$2"
    local fields='[{"name":"Pool Antiga","value":"'$old_pool'","inline":true},{"name":"Pool Nova","value":"'$new_pool'","inline":true}]'
    send_discord "üîÑ TROCA DE POOL" "Pool de minera√ß√£o alterada" "3447003" "$fields"
}

discord_backup_created() {
    local backup_name="$1"
    local backup_size="$2"
    local fields='[{"name":"Backup","value":"'$backup_name'","inline":true},{"name":"Tamanho","value":"'$backup_size'","inline":true}]'
    send_discord "üíæ BACKUP CRIADO" "Backup do sistema realizado" "10181046" "$fields"
}

discord_performance_alert() {
    local metric="$1"
    local value="$2"
    local threshold="$3"
    local fields='[{"name":"M√©trica","value":"'$metric'","inline":true},{"name":"Valor","value":"'$value'","inline":true},{"name":"Limite","value":"'$threshold'","inline":true}]'
    send_discord "‚ö†Ô∏è ALERTA DE PERFORMANCE" "M√©trica excedeu o limite" "16753920" "$fields"
}

# ============================================================================
# VERIFICA√á√ïES DO SISTEMA
# ============================================================================

check_termux() {
    if [ ! -d "/data/data/com.termux" ]; then
        print_error "Este script s√≥ funciona no Termux (Android)"
        exit 1
    fi
    log_system "Termux detected"
}

check_internet() {
    print_info "Verificando conex√£o com a internet..."
    
    local hosts=("8.8.8.8" "1.1.1.1" "github.com" "google.com")
    local connected=0
    
    for host in "${hosts[@]}"; do
        print_animation "Testando $host..."
        if ping -c 1 -W 2 "$host" >/dev/null 2>&1; then
            connected=1
            break
        fi
    done
    
    if [ $connected -eq 1 ]; then
        log_success "Conex√£o com internet OK"
        return 0
    else
        log_error "Sem conex√£o com a internet!"
        return 1
    fi
}

check_architecture() {
    print_info "Verificando arquitetura do sistema..."
    
    local arch=$(uname -m)
    local cpu_info=$(cat /proc/cpuinfo 2>/dev/null | grep "model name" | head -1 | cut -d':' -f2 | xargs)
    local cpu_cores=$(nproc 2>/dev/null || echo "1")
    local cpu_freq=$(cat /proc/cpuinfo 2>/dev/null | grep "cpu MHz" | head -1 | cut -d':' -f2 | xargs)
    local mem_total=$(free -h 2>/dev/null | grep "Mem" | awk '{print $2}')
    
    echo ""
    echo -e "${COLOR_INFO}Arquitetura:${NC} $arch"
    echo -e "${COLOR_INFO}Processador:${NC} $cpu_info"
    echo -e "${COLOR_INFO}N√∫cleos:${NC} $cpu_cores"
    echo -e "${COLOR_INFO}Frequ√™ncia:${NC} $cpu_freq MHz"
    echo -e "${COLOR_INFO}Mem√≥ria:${NC} $mem_total"
    echo ""
    
    case "$arch" in
        "aarch64"|"arm64")
            log_success "Arquitetura ARM64 suportada (√≥timo desempenho)"
            ARCH_TYPE="arm64"
            ARCH_SCORE=100
            ;;
        "armv7l"|"armv8l")
            log_warning "Arquitetura ARM32 - desempenho limitado"
            ARCH_TYPE="armhf"
            ARCH_SCORE=60
            ;;
        "x86_64")
            log_error "Arquitetura x86_64 n√£o suportada no Termux"
            exit 1
            ;;
        *)
            log_warning "Arquitetura $arch - pode haver problemas"
            ARCH_TYPE="generic"
            ARCH_SCORE=30
            ;;
    esac
    
    # Salvar info
    mkdir -p "$MINER_STATS"
    cat > "$MINER_STATS/system.info" << EOF
ARCH=$arch
ARCH_TYPE=$ARCH_TYPE
ARCH_SCORE=$ARCH_SCORE
CPU=$cpu_info
CORES=$cpu_cores
FREQ=$cpu_freq
MEM=$mem_total
DATE=$(date '+%Y-%m-%d %H:%M:%S')
EOF
    
    return 0
}

check_battery() {
    if command -v termux-battery-status >/dev/null 2>&1; then
        local battery_info=$(termux-battery-status 2>/dev/null)
        local percentage=$(echo "$battery_info" | grep -o '"percentage":[0-9]*' | cut -d':' -f2)
        local status=$(echo "$battery_info" | grep -o '"status":"[^"]*"' | cut -d'"' -f4)
        
        if [ ! -z "$percentage" ]; then
            echo -e "${COLOR_INFO}Bateria:${NC} $percentage% ($status)"
            
            if [ "$status" != "CHARGING" ] && [ "$percentage" -lt 20 ]; then
                log_warning "Bateria baixa ($percentage%) - Conecte o carregador"
            fi
        fi
    fi
}

check_temperature() {
    if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
        local temp=$(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)
        temp=$((temp / 1000))
        
        if [ $temp -gt 70 ]; then
            log_warning "Temperatura alta: $temp¬∞C - Reduza a carga"
        elif [ $temp -gt 60 ]; then
            log_info "Temperatura: $temp¬∞C"
        fi
        
        echo "$temp" > "$MINER_STATS/temperature.txt"
    fi
}

# ============================================================================
# INSTALA√á√ÉO DE DEPEND√äNCIAS
# ============================================================================

install_dependencies() {
    print_header "INSTALANDO DEPEND√äNCIAS"
    
    log_info "Atualizando reposit√≥rios..."
    pkg update -y > /dev/null 2>&1
    
    log_info "Atualizando pacotes..."
    pkg upgrade -y > /dev/null 2>&1
    
    log_info "Instalando pacotes essenciais..."
    
    local packages=(
        # Ferramentas b√°sicas
        wget curl tar git
        cmake make build-essential
        python python-pip
        
        # Bibliotecas
        libuv libuv-dev
        openssl openssl-dev
        libmicrohttpd
        libhwloc hwloc-dev
        
        # Utilit√°rios
        nano htop neofetch
        jq bc net-tools
        termux-api termux-tools
        proot
        
        # Ferramentas de rede
        nmap netcat-openbsd
        dnsutils whois
        
        # Ferramentas de download
        axel aria2
        
        # Monitoramento
        sysstat procps
    )
    
    local total=${#packages[@]}
    local current=0
    
    for pkg in "${packages[@]}"; do
        current=$((current + 1))
        print_progress_bar $current $total
        pkg install -y "$pkg" > /dev/null 2>&1
    done
    
    echo ""
    log_success "$total depend√™ncias instaladas"
}

# ============================================================================
# INSTALA√á√ÉO DO XMRIG (25 M√âTODOS DIFERENTES)
# ============================================================================

install_xmrig() {
    print_header "INSTALANDO XMRIG (25 M√âTODOS)"
    
    mkdir -p "$MINER_TEMP"
    mkdir -p "$MINER_CACHE"
    cd "$MINER_TEMP"
    
    local methods=(
        "GitHub Release (ARM64 v6.20.0)"
        "GitHub Binary (ARM64 v6.20.0)"
        "Miner.io Mirror"
        "Miner.rocks Mirror"
        "Binaries.xmrig.com"
        "Termux Official Repo"
        "Android Miner Repo"
        "Compila√ß√£o do C√≥digo"
        "DPKG Package"
        "Archive.org Backup"
        "IPFS (se dispon√≠vel)"
        "Torrent (se dispon√≠vel)"
        "Cache Local"
        "Bin√°rio Compat√≠vel"
        "QEMU Emula√ß√£o"
        "GitHub v6.19.3"
        "GitHub v6.18.2"
        "GitHub v6.17.0"
        "GitHub v6.16.4"
        "GitHub v6.15.3"
        "GitHub v6.14.1"
        "GitHub v6.13.2"
        "GitHub v6.12.1"
        "GitHub v6.11.2"
        "GitHub v6.10.0"
    )
    
    local total_methods=${#methods[@]}
    local current_method=0
    local installed=0
    
    for method_idx in "${!methods[@]}"; do
        current_method=$((current_method + 1))
        echo ""
        log_info "M√©todo $current_method/$total_methods: ${methods[$method_idx]}"
        
        print_progress_bar $current_method $total_methods
        
        case $method_idx in
            0) # GitHub Release v6.20.0
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
                    tar -xzf xmrig.tar.gz 2>/dev/null
                    find . -name "xmrig" -type f -exec cp {} "$MINER_BIN/xmrig" \; 2>/dev/null
                    installed=1
                fi
                ;;
            1) # GitHub Binary v6.20.0
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            2) # Miner.io Mirror
                if wget -q --timeout=30 "https://dl.miner.io/xmrig/v6.20.0/xmrig-6.20.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            3) # Miner.rocks Mirror
                if wget -q --timeout=30 "https://cdn.miner.rocks/xmrig/v6.20.0/xmrig-6.20.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            4) # Binaries.xmrig.com
                if wget -q --timeout=30 "https://binaries.xmrig.com/xmrig-6.20.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            5) # Termux Official Repo
                if pkg install -y xmrig 2>/dev/null; then
                    cp $(which xmrig) "$MINER_BIN/xmrig" 2>/dev/null
                    installed=1
                fi
                ;;
            6) # Android Miner Repo
                if wget -q --timeout=30 "https://github.com/zealotcoder/xmrig-termux/releases/latest/download/xmrig" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            7) # Compila√ß√£o
                log_info "Instalando depend√™ncias de compila√ß√£o..."
                pkg install -y git cmake make build-essential libuv-dev libssl-dev libhwloc-dev -y > /dev/null 2>&1
                
                if git clone https://github.com/xmrig/xmrig.git 2>/dev/null; then
                    cd xmrig
                    mkdir build
                    cd build
                    cmake .. -DWITH_HTTPD=OFF -DWITH_TLS=OFF -DWITH_OPENCL=OFF -DWITH_CUDA=OFF > /dev/null 2>&1
                    make -j$(nproc) > /dev/null 2>&1
                    
                    if [ -f "xmrig" ]; then
                        cp xmrig "$MINER_BIN/xmrig"
                        installed=1
                    fi
                fi
                ;;
            8) # DPKG Package
                if wget -q --timeout=30 "https://packages.termux.org/apt/termux-main/pool/main/x/xmrig/xmrig_6.20.0_arm.deb" -O xmrig.deb; then
                    ar x xmrig.deb data.tar.xz 2>/dev/null
                    if [ -f "data.tar.xz" ]; then
                        tar -xf data.tar.xz ./data/data/com.termux/files/usr/bin/xmrig 2>/dev/null
                        cp data/data/com.termux/files/usr/bin/xmrig "$MINER_BIN/xmrig" 2>/dev/null
                        installed=1
                    fi
                fi
                ;;
            9) # Cache local
                if [ -f "$MINER_CACHE/xmrig" ]; then
                    cp "$MINER_CACHE/xmrig" "$MINER_BIN/xmrig"
                    installed=1
                fi
                ;;
            10) # GitHub v6.19.3
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.19.3/xmrig-6.19.3-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            11) # GitHub v6.18.2
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.18.2/xmrig-6.18.2-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            12) # GitHub v6.17.0
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.17.0/xmrig-6.17.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            13) # GitHub v6.16.4
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.16.4/xmrig-6.16.4-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            14) # GitHub v6.15.3
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.15.3/xmrig-6.15.3-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            15) # GitHub v6.14.1
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.14.1/xmrig-6.14.1-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            16) # GitHub v6.13.2
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.13.2/xmrig-6.13.2-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            17) # GitHub v6.12.1
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.12.1/xmrig-6.12.1-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            18) # GitHub v6.11.2
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.11.2/xmrig-6.11.2-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
            19) # GitHub v6.10.0
                if wget -q --timeout=30 "https://github.com/xmrig/xmrig/releases/download/v6.10.0/xmrig-6.10.0-linux-arm64" -O "$MINER_BIN/xmrig"; then
                    installed=1
                fi
                ;;
        esac
        
        # Verificar se instalou
        if [ $installed -eq 1 ] && [ -f "$MINER_BIN/xmrig" ]; then
            chmod +x "$MINER_BIN/xmrig"
            
            # Testar o bin√°rio
            print_animation "Testando bin√°rio..."
            if "$MINER_BIN/xmrig" --help > /dev/null 2>&1; then
                local version=$("$MINER_BIN/xmrig" --version 2>/dev/null | head -1)
                echo ""
                log_success "XMRig instalado via ${methods[$method_idx]}"
                log_info "Vers√£o: $version"
                
                # Salvar no cache
                cp "$MINER_BIN/xmrig" "$MINER_CACHE/xmrig"
                echo "$version" > "$MINER_CACHE/version.txt"
                
                # Notificar Discord
                discord_send "‚úÖ XMRIG INSTALADO" "**M√©todo:** ${methods[$method_idx]}\n**Vers√£o:** $version\n**Arquitetura:** $ARCH_TYPE" "3066993"
                
                return 0
            else
                log_error "Bin√°rio corrompido, tentando pr√≥ximo m√©todo..."
                rm -f "$MINER_BIN/xmrig"
                installed=0
            fi
        fi
        
        cd "$MINER_TEMP"
    done
    
    log_error "FALHA CR√çTICA: Nenhum dos 25 m√©todos funcionou!"
    discord_error "Falha na instala√ß√£o do XMRig ap√≥s 25 tentativas"
    return 1
}

# ============================================================================
# CRIA√á√ÉO DA CONFIGURA√á√ÉO AVAN√áADA
# ============================================================================

create_config() {
    print_header "CRIANDO CONFIGURA√á√ÉO AVAN√áADA"
    
    # Gerar worker ID √∫nico
    local worker_id="termux_$(date +%s)_$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 8 | head -n 1)"
    
    # Configura√ß√£o principal
    cat > "$MINER_CONFIG/config.json" << EOF
{
    "autosave": true,
    "autosave-interval": 60,
    "cpu": true,
    "opencl": false,
    "cuda": false,
    "donate-level": $DONATE_LEVEL,
    "donate-over-proxy": 1,
    "log-file": "$MINER_LOGS/xmrig.log",
    "pools": [
        {
            "url": "${POOLS[0]}",
            "user": "$BTC_WALLET.$worker_id",
            "pass": "x",
            "rig-id": "$worker_id",
            "nicehash": true,
            "keepalive": true,
            "tls": false,
            "tls-fingerprint": null,
            "daemon": false
        }
    ],
    "print-time": 30,
    "health-print-time": 60,
    "retries": 5,
    "retry-pause": 5,
    "cpu-max-threads-hint": $CPU_USAGE,
    "cpu-priority": $MINING_PRIORITY,
    "randomx-mode": "fast",
    "randomx-1gb-pages": false,
    "randomx-wrmsr": -1,
    "randomx-no-rdmsr": false,
    "randomx-cache-qos": false,
    "background": false,
    "syslog": false,
    "user-agent": null,
    "verbose": 0,
    "watch": false,
    "pause-on-battery": false,
    "pause-on-active": false
}
EOF
    
    # Configura√ß√£o de backup
    cat > "$MINER_CONFIG/config.backup.json" << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 1,
    "pools": [
        {
            "url": "${POOLS[1]}",
            "user": "$BTC_WALLET.$worker_id.backup",
            "pass": "x",
            "nicehash": true
        }
    ]
}
EOF
    
    # Configura√ß√£o de emerg√™ncia
    cat > "$MINER_CONFIG/config.emergency.json" << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 0,
    "pools": [
        {
            "url": "${POOLS[2]}",
            "user": "$BTC_WALLET.$worker_id.emergency",
            "pass": "x",
            "nicehash": true
        }
    ]
}
EOF
    
    # Configura√ß√£o de teste
    cat > "$MINER_CONFIG/config.test.json" << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 0,
    "pools": [
        {
            "url": "test-pool.example.com:3333",
            "user": "$BTC_WALLET.$worker_id.test",
            "pass": "x",
            "nicehash": false
        }
    ]
}
EOF
    
    # Salvar informa√ß√µes do sistema
    cat > "$MINER_CONFIG/system.conf" << EOF
# BITCOIN MINER ULTIMATE v13.0 - SYSTEM CONFIGURATION
# Created: $(date '+%Y-%m-%d %H:%M:%S')

# Worker Configuration
WORKER_ID="$worker_id"
WORKER_NAME="Bitcoin Miner Ultimate"
WORKER_VERSION="13.0"

# Wallet Configuration
BTC_WALLET="$BTC_WALLET"
DISCORD_WEBHOOK="$DISCORD_WEBHOOK"

# Mining Configuration
CPU_USAGE="$CPU_USAGE"
MINING_PRIORITY="$MINING_PRIORITY"
DONATE_LEVEL="$DONATE_LEVEL"
THREADS="$THREADS"

# System Information
INSTALL_DATE="$(date '+%Y-%m-%d %H:%M:%S')"
ARCH="$ARCH_TYPE"
ARCH_SCORE="$ARCH_SCORE"

# Default Pool
DEFAULT_POOL="${POOLS[0]}"
CURRENT_POOL="${POOLS[0]}"

# Performance Settings
MIN_HASHRATE=10
MAX_HASHRATE=1000
TARGET_HASHRATE=100

# Monitoring Settings
HEARTBEAT_INTERVAL=1800
PROFIT_REPORT_INTERVAL=21600
POOL_SWITCH_INTERVAL=3600
NO_SHARE_TIMEOUT=600
AUTO_RESTART=true

# Alert Settings
ALERT_NO_SHARES=600
ALERT_LOW_HASHRATE=30
ALERT_HIGH_TEMP=70
ALERT_BATTERY_LOW=20
EOF
    
    # Salvar lista de pools
    printf '%s\n' "${POOLS[@]}" > "$MINER_CONFIG/pools.list"
    
    # Criar arquivo de estat√≠sticas inicial
    cat > "$MINER_STATS/initial.json" << EOF
{
    "install_date": "$(date '+%Y-%m-%d %H:%M:%S')",
    "worker_id": "$worker_id",
    "wallet": "$BTC_WALLET",
    "architecture": "$ARCH_TYPE",
    "cpu_usage": $CPU_USAGE,
    "total_shares": 0,
    "total_profit": 0
}
EOF
    
    log_success "Configura√ß√£o criada para worker: $worker_id"
    log_info "Arquivos de configura√ß√£o: 5"
}

# ============================================================================
# CRIA√á√ÉO DOS SCRIPTS DE CONTROLE (33 FUN√á√ïES)
# ============================================================================

create_scripts() {
    print_header "CRIANDO SCRIPTS DE CONTROLE (33 FUN√á√ïES)"
    
    # 1. START.SH - Iniciar minera√ß√£o
    cat > "$MINER_ROOT/start.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf" 2>/dev/null

cd "$MINER_ROOT"

echo "[$(date '+%H:%M:%S')] Iniciando minera√ß√£o..." >> "$MINER_LOGS/system.log"
echo "[$(date '+%H:%M:%S')] [INICIO] Comando: start.sh" >> "$MINER_LOGS/combined.log"

# Parar se j√° estiver rodando
if pgrep -f xmrig > /dev/null; then
    echo "Minerador j√° est√° rodando. Parando primeiro..."
    pkill -f xmrig 2>/dev/null
    sleep 3
fi

# Verificar configura√ß√£o
if [ ! -f "$MINER_CONFIG/config.json" ]; then
    echo "Erro: Arquivo de configura√ß√£o n√£o encontrado!"
    echo "[$(date '+%H:%M:%S')] [ERRO] Configura√ß√£o n√£o encontrada" >> "$MINER_LOGS/error.log"
    exit 1
fi

# Verificar bin√°rio
if [ ! -f "$MINER_BIN/xmrig" ]; then
    echo "Erro: Bin√°rio do XMRig n√£o encontrado!"
    echo "[$(date '+%H:%M:%S')] [ERRO] Bin√°rio n√£o encontrado" >> "$MINER_LOGS/error.log"
    exit 1
fi

# Iniciar XMRig
echo "Iniciando XMRig..."
"$MINER_BIN/xmrig" -c "$MINER_CONFIG/config.json" >> "$MINER_LOGS/miner.log" 2>&1 &
PID=$!

# Salvar PID
echo $PID > "$MINER_STATS/miner.pid"
echo "[$(date '+%H:%M:%S')] Minerador iniciado (PID: $PID)" >> "$MINER_LOGS/system.log"

sleep 3

# Verificar se iniciou
if ps -p $PID > /dev/null 2>&1; then
    echo -e "\033[1;32m[‚úì]\033[0m Minera√ß√£o iniciada com sucesso!"
    echo -e "\033[1;36m   PID:\033[0m $PID"
    echo -e "\033[1;36m   Worker:\033[0m $WORKER_ID"
    echo -e "\033[1;36m   Pool:\033[0m $CURRENT_POOL"
    echo -e "\033[1;36m   Ver logs:\033[0m ./logs.sh"
    
    # Registrar no log
    echo "[$(date '+%H:%M:%S')] [SUCESSO] Minera√ß√£o iniciada (PID: $PID)" >> "$MINER_LOGS/success.log"
    echo "[$(date '+%H:%M:%S')] Worker: $WORKER_ID, Pool: $CURRENT_POOL" >> "$MINER_LOGS/miner.log"
    
    # Notificar Discord
    if [ ! -z "$DISCORD_WEBHOOK" ]; then
        curl -s -H "Content-Type: application/json" \
             -X POST \
             -d "{\"content\":\"üöÄ **MINERA√á√ÉO INICIADA**\\nWorker: \`$WORKER_ID\`\\nPID: \`$PID\`\\nPool: \`$CURRENT_POOL\`\\nData: $(date '+%H:%M:%S')\"}" \
             "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    fi
else
    echo -e "\033[1;31m[‚úó]\033[0m Falha ao iniciar minera√ß√£o"
    echo "[$(date '+%H:%M:%S')] [ERRO] Falha ao iniciar minerador" >> "$MINER_LOGS/error.log"
    
    # Tentar iniciar com configura√ß√£o de backup
    if [ -f "$MINER_CONFIG/config.backup.json" ]; then
        echo "Tentando com configura√ß√£o de backup..."
        "$MINER_BIN/xmrig" -c "$MINER_CONFIG/config.backup.json" >> "$MINER_LOGS/miner.log" 2>&1 &
    fi
fi
EOF

    # 2. STOP.SH - Parar minera√ß√£o
    cat > "$MINER_ROOT/stop.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf" 2>/dev/null

cd "$MINER_ROOT"

echo "[$(date '+%H:%M:%S')] Parando minera√ß√£o..." >> "$MINER_LOGS/system.log"

# Verificar se est√° rodando
if ! pgrep -f xmrig > /dev/null; then
    echo -e "\033[1;33m[!]\033[0m Minerador n√£o est√° rodando"
    exit 0
fi

# Obter PID
PID=$(pgrep -f xmrig)
echo "Parando minerador (PID: $PID)..."

# Tentar parada normal
pkill -f xmrig 2>/dev/null
sleep 3

# For√ßar se necess√°rio
if pgrep -f xmrig > /dev/null; then
    echo "For√ßando parada..."
    pkill -9 -f xmrig 2>/dev/null
    sleep 2
fi

# Verificar resultado
if ! pgrep -f xmrig > /dev/null; then
    echo -e "\033[1;32m[‚úì]\033[0m Minera√ß√£o parada com sucesso"
    echo "[$(date '+%H:%M:%S')] [SUCESSO] Minera√ß√£o parada" >> "$MINER_LOGS/success.log"
    
    # Registrar uptime
    if [ -f "$MINER_STATS/start_time.txt" ]; then
        START=$(cat "$MINER_STATS/start_time.txt")
        END=$(date +%s)
        UPTIME=$((END - START))
        echo "$UPTIME" > "$MINER_STATS/last_uptime.txt"
    fi
    
    # Notificar Discord
    if [ ! -z "$DISCORD_WEBHOOK" ]; then
        curl -s -H "Content-Type: application/json" \
             -X POST \
             -d "{\"content\":\"üõë **MINERA√á√ÉO PARADA**\\nWorker: \`$WORKER_ID\`\\nPID: \`$PID\`\\nData: $(date '+%H:%M:%S')\"}" \
             "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    fi
else
    echo -e "\033[1;31m[‚úó]\033[0m Falha ao parar minera√ß√£o"
    echo "[$(date '+%H:%M:%S')] [ERRO] Falha ao parar minerador" >> "$MINER_LOGS/error.log"
fi

# Limpar PID
rm -f "$MINER_STATS/miner.pid" 2>/dev/null
EOF

    # 3. STATUS.SH - Ver status completo
    cat > "$MINER_ROOT/status.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf" 2>/dev/null

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[38;5;208m'
NC='\033[0m'

clear
echo ""
echo -e "${PURPLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${PURPLE}‚ïë                     STATUS DO MINERADOR BITCOIN                     ‚ïë${NC}"
echo -e "${PURPLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

# ==================== SE√á√ÉO 1: STATUS DA MINERA√á√ÉO ====================
echo -e "${CYAN}üìä 1. STATUS DA MINERA√á√ÉO${NC}"
echo ""

if pgrep -f xmrig > /dev/null; then
    PID=$(pgrep -f xmrig)
    UPTIME=$(ps -o etimes= -p $PID 2>/dev/null | xargs)
    CPU=$(ps -o pcpu= -p $PID 2>/dev/null | xargs)
    MEM=$(ps -o pmem= -p $PID 2>/dev/null | xargs)
    
    echo -e "  ${GREEN}‚ñ∂ MINERA√á√ÉO: ATIVA${NC}"
    echo -e "  ${WHITE}PID:${NC} $PID"
    
    if [ ! -z "$UPTIME" ]; then
        H=$((UPTIME / 3600))
        M=$(((UPTIME % 3600) / 60))
        S=$((UPTIME % 60))
        echo -e "  ${WHITE}Uptime:${NC} ${H}h ${M}m ${S}s"
    fi
    
    if [ ! -z "$CPU" ]; then
        echo -e "  ${WHITE}CPU:${NC} $CPU%"
    fi
    
    if [ ! -z "$MEM" ]; then
        echo -e "  ${WHITE}Mem√≥ria:${NC} $MEM%"
    fi
else
    echo -e "  ${RED}‚ñ∂ MINERA√á√ÉO: INATIVA${NC}"
fi

# ==================== SE√á√ÉO 2: HASHRATE ====================
echo ""
echo -e "${CYAN}‚ö° 2. HASHRATE${NC}"
echo ""

if [ -f "$MINER_LOGS/miner.log" ]; then
    # Hashrate atual
    HASHRATE=$(tail -50 "$MINER_LOGS/miner.log" 2>/dev/null | grep -E "speed.*[0-9]+\.[0-9]+" | tail -5 | tail -1 | grep -oE "[0-9]+\.[0-9]+ [kM]?H/s" || echo "0.0 H/s")
    echo -e "  ${WHITE}Atual:${NC} ${ORANGE}$HASHRATE${NC}"
    
    # Hashrate m√©dio (√∫ltimas 10 medi√ß√µes)
    AVG=$(tail -100 "$MINER_LOGS/miner.log" 2>/dev/null | grep -E "speed.*[0-9]+\.[0-9]+" | tail -10 | grep -oE "[0-9]+\.[0-9]+" | awk '{sum+=$1} END {if(NR>0) printf "%.1f", sum/NR}' || echo "0")
    echo -e "  ${WHITE}M√©dio (10):${NC} $AVG H/s"
    
    # M√°ximo registrado
    MAX=$(grep -E "speed.*[0-9]+\.[0-9]+" "$MINER_LOGS/miner.log" 2>/dev/null | grep -oE "[0-9]+\.[0-9]+" | sort -n | tail -1 || echo "0")
    echo -e "  ${WHITE}M√°ximo:${NC} $MAX H/s"
else
    echo -e "  ${WHITE}Sem dados de hashrate${NC}"
fi

# ==================== SE√á√ÉO 3: SHARES ====================
echo ""
echo -e "${CYAN}‚úÖ 3. SHARES${NC}"
echo ""

if [ -f "$MINER_LOGS/miner.log" ]; then
    ACCEPTED=$(grep -c "accepted" "$MINER_LOGS/miner.log" 2>/dev/null)
    REJECTED=$(grep -c "rejected" "$MINER_LOGS/miner.log" 2>/dev/null)
    TOTAL=$((ACCEPTED + REJECTED))
    
    echo -e "  ${WHITE}Aceitos:${NC} ${GREEN}$ACCEPTED${NC}"
    echo -e "  ${WHITE}Rejeitados:${NC} ${RED}$REJECTED${NC}"
    echo -e "  ${WHITE}Total:${NC} $TOTAL"
    
    if [ $TOTAL -gt 0 ]; then
        RATE=$(echo "scale=2; $ACCEPTED * 100 / $TOTAL" | bc 2>/dev/null)
        echo -e "  ${WHITE}Taxa de aceita√ß√£o:${NC} ${CYAN}${RATE}%${NC}"
    fi
    
    # √öltimo share
    LAST=$(grep "accepted" "$MINER_LOGS/miner.log" 2>/dev/null | tail -1)
    if [ ! -z "$LAST" ]; then
        echo -e "  ${WHITE}√öltimo share:${NC} ${LAST:0:60}..."
    fi
else
    echo -e "  ${WHITE}Sem dados de shares${NC}"
fi

# ==================== SE√á√ÉO 4: LUCROS ====================
echo ""
echo -e "${CYAN}üí∞ 4. LUCROS ESTIMADOS${NC}"
echo ""

if [ -f "$MINER_STATS/profit.json" ]; then
    # Carregar dados de lucro
    DAILY_SAT=$(grep -o '"daily_sat":[0-9]*' "$MINER_STATS/profit.json" 2>/dev/null | cut -d':' -f2)
    DAILY_BTC=$(grep -o '"daily_btc":"[^"]*"' "$MINER_STATS/profit.json" 2>/dev/null | cut -d'"' -f4)
    DAILY_USD=$(grep -o '"daily_usd":"[^"]*"' "$MINER_STATS/profit.json" 2>/dev/null | cut -d'"' -f4)
    TOTAL_SAT=$(grep -o '"total_sat":[0-9]*' "$MINER_STATS/profit.json" 2>/dev/null | cut -d':' -f2)
    
    echo -e "  ${WHITE}Di√°rio (estimado):${NC}"
    echo -e "    ${GREEN}$DAILY_SAT satoshis${NC}"
    echo -e "    ${GREEN}$DAILY_BTC BTC${NC}"
    echo -e "    ${GREEN}\$${DAILY_USD} USD${NC}"
    echo -e "  ${WHITE}Total acumulado:${NC} ${GOLD}$TOTAL_SAT satoshis${NC}"
else
    echo -e "  ${WHITE}Aguardando dados de lucro...${NC}"
fi

# ==================== SE√á√ÉO 5: POOL ====================
echo ""
echo -e "${CYAN}üåê 5. POOL${NC}"
echo ""

if [ -f "$MINER_CONFIG/pools.list" ]; then
    CURRENT_POOL=$(grep '"url"' "$MINER_CONFIG/config.json" 2>/dev/null | head -1 | cut -d'"' -f4)
    echo -e "  ${WHITE}Pool atual:${NC} ${BLUE}$CURRENT_POOL${NC}"
    
    # Lat√™ncia da pool
    if command -v nc >/dev/null 2>&1; then
        POOL_HOST=$(echo "$CURRENT_POOL" | cut -d':' -f1)
        POOL_PORT=$(echo "$CURRENT_POOL" | cut -d':' -f2)
        LATENCY=$(timeout 2 nc -zv $POOL_HOST $POOL_PORT 2>&1 | grep -oE " [0-9.]+ ms" || echo " timeout")
        echo -e "  ${WHITE}Lat√™ncia:${NC} $LATENCY"
    fi
fi

# ==================== SE√á√ÉO 6: SISTEMA ====================
echo ""
echo -e "${CYAN}üíª 6. SISTEMA${NC}"
echo ""

echo -e "  ${WHITE}Worker:${NC} $WORKER_ID"
echo -e "  ${WHITE}Carteira:${NC} ${BTC_WALLET:0:10}...${BTC_WALLET: -4}"
echo -e "  ${WHITE}CPU Usage:${NC} $CPU_USAGE% | Prioridade: $MINING_PRIORITY"
echo -e "  ${WHITE}Arquitetura:${NC} $ARCH"
echo -e "  ${WHITE}Instala√ß√£o:${NC} $INSTALL_DATE"

# Temperatura
if [ -f "$MINER_STATS/temperature.txt" ]; then
    TEMP=$(cat "$MINER_STATS/temperature.txt")
    if [ $TEMP -gt 70 ]; then
        echo -e "  ${WHITE}Temperatura:${NC} ${RED}${TEMP}¬∞C${NC}"
    elif [ $TEMP -gt 60 ]; then
        echo -e "  ${WHITE}Temperatura:${NC} ${YELLOW}${TEMP}¬∞C${NC}"
    else
        echo -e "  ${WHITE}Temperatura:${NC} ${GREEN}${TEMP}¬∞C${NC}"
    fi
fi

# ==================== SE√á√ÉO 7: LOGS RECENTES ====================
echo ""
echo -e "${CYAN}üìã 7. LOGS RECENTES${NC}"
echo ""

if [ -f "$MINER_LOGS/miner.log" ]; then
    tail -5 "$MINER_LOGS/miner.log" | while read line; do
        if [[ "$line" == *"accepted"* ]]; then
            echo -e "  ${GREEN}‚úì${NC} ${line:11:70}..."
        elif [[ "$line" == *"rejected"* ]]; then
            echo -e "  ${RED}‚úó${NC} ${line:11:70}..."
        elif [[ "$line" == *"speed"* ]]; then
            echo -e "  ${CYAN}‚ö°${NC} ${line:11:70}..."
        else
            echo -e "  ${WHITE}‚Ä¢${NC} ${line:11:70}..."
        fi
    done
fi

# ==================== SE√á√ÉO 8: ALERTAS ====================
echo ""
echo -e "${CYAN}‚ö†Ô∏è 8. ALERTAS${NC}"
echo ""

ALERT_COUNT=0

# Verificar temperatura
if [ -f "$MINER_STATS/temperature.txt" ]; then
    TEMP=$(cat "$MINER_STATS/temperature.txt")
    if [ $TEMP -gt 70 ]; then
        echo -e "  ${RED}‚ö† Temperatura alta: ${TEMP}¬∞C${NC}"
        ALERT_COUNT=$((ALERT_COUNT + 1))
    fi
fi

# Verificar shares rejeitados
if [ -f "$MINER_LOGS/miner.log" ] && [ $TOTAL -gt 100 ]; then
    if [ $REJECTED -gt $((TOTAL / 10)) ]; then
        echo -e "  ${YELLOW}‚ö† Muitos shares rejeitados: $REJECTED de $TOTAL${NC}"
        ALERT_COUNT=$((ALERT_COUNT + 1))
    fi
fi

# Verificar hashrate baixo
if [ ! -z "$AVG" ] && [ $(echo "$AVG < 50" | bc) -eq 1 ]; then
    echo -e "  ${YELLOW}‚ö† Hashrate baixo: $AVG H/s${NC}"
    ALERT_COUNT=$((ALERT_COUNT + 1))
fi

if [ $ALERT_COUNT -eq 0 ]; then
    echo -e "  ${GREEN}Nenhum alerta ativo${NC}"
fi

# ==================== RODAP√â ====================
echo ""
echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo -e "${WHITE}Comandos r√°pidos:${NC} ./menu.sh | ./start.sh | ./stop.sh | ./logs.sh"
echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"

# Aguardar entrada do usu√°rio
read -t 30 -p "Pressione Enter para continuar (ou aguarde 30s)..."
EOF

    # 4. LOGS.SH - Visualizador de logs
    cat > "$MINER_ROOT/logs.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"

while true; do
    clear
    echo -e "\033[1;36m‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "\033[1;36m‚ïë                     VISUALIZADOR DE LOGS                            ‚ïë${NC}"
    echo -e "\033[1;36m‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
    echo "1) üìã Log do Minerador (miner.log)"
    echo "2) üîß Log do Sistema (system.log)"
    echo "3) ‚ùå Log de Erros (error.log)"
    echo "4) ‚ö†Ô∏è  Log de Avisos (warning.log)"
    echo "5) ‚úÖ Log de Sucessos (success.log)"
    echo "6) ‚ÑπÔ∏è  Log de Informa√ß√µes (info.log)"
    echo "7) üí¨ Log do Discord (discord.log)"
    echo "8) üí∞ Log de Lucros (profit.log)"
    echo "9) ‚ö° Log de Hashrate (hashrate.log)"
    echo "10) üìä Log de Shares (share.log)"
    echo "11) üåê Log de Pools (pool.log)"
    echo "12) üíæ Log de Backups (backup.log)"
    echo "13) üìà Log de Monitor (monitor.log)"
    echo "14) üêõ Log de Debug (debug.log)"
    echo "15) üìâ Log de Performance (performance.log)"
    echo "16) üìö Log Combinado (combined.log)"
    echo "17) üìù Todos os logs (resumo)"
    echo "18) üîÑ Seguir logs em tempo real"
    echo "19) üîç Buscar em logs"
    echo "20) üßπ Limpar logs antigos"
    echo "21) üì¶ Exportar logs"
    echo "22) üìä Estat√≠sticas de logs"
    echo "23) üîô Voltar"
    echo ""
    read -p "Escolha (1-23): " choice
    
    case $choice in
        1) less "$MINER_LOGS/miner.log" ;;
        2) less "$MINER_LOGS/system.log" ;;
        3) less "$MINER_LOGS/error.log" ;;
        4) less "$MINER_LOGS/warning.log" ;;
        5) less "$MINER_LOGS/success.log" ;;
        6) less "$MINER_LOGS/info.log" ;;
        7) less "$MINER_LOGS/discord.log" ;;
        8) less "$MINER_LOGS/profit.log" ;;
        9) less "$MINER_LOGS/hashrate.log" ;;
        10) less "$MINER_LOGS/share.log" ;;
        11) less "$MINER_LOGS/pool.log" ;;
        12) less "$MINER_LOGS/backup.log" ;;
        13) less "$MINER_LOGS/monitor.log" ;;
        14) less "$MINER_LOGS/debug.log" ;;
        15) less "$MINER_LOGS/performance.log" ;;
        16) less "$MINER_LOGS/combined.log" ;;
        17)
            echo ""
            echo "=== RESUMO DOS LOGS ==="
            echo ""
            echo "üìä Tamanhos:"
            du -h "$MINER_LOGS"/*.log 2>/dev/null | sort -hr
            echo ""
            echo "üìã √öltimas 5 linhas de cada:"
            for log in "$MINER_LOGS"/*.log; do
                echo -e "\n${CYAN}$(basename "$log"):${NC}"
                tail -3 "$log"
            done
            read -p "Pressione Enter para continuar..."
            ;;
        18)
            echo "Seguindo logs (Ctrl+C para sair)"
            echo "Escolha o log:"
            select log in "$MINER_LOGS"/*.log; do
                tail -f "$log"
                break
            done
            ;;
        19)
            read -p "Termo de busca: " search
            read -p "Log (ou 'todos'): " logfile
            if [ "$logfile" = "todos" ]; then
                grep -r "$search" "$MINER_LOGS/"
            else
                grep "$search" "$MINER_LOGS/$logfile"
            fi
            read -p "Pressione Enter para continuar..."
            ;;
        20)
            find "$MINER_LOGS" -name "*.log" -size +10M -exec truncate -s 0 {} \;
            echo "Logs antigos limpos"
            read -p "Pressione Enter para continuar..."
            ;;
        21)
            EXPORT_FILE="$MINER_BACKUP/logs_export_$(date +%Y%m%d_%H%M%S).tar.gz"
            tar -czf "$EXPORT_FILE" "$MINER_LOGS/"
            echo "Logs exportados para: $EXPORT_FILE"
            read -p "Pressione Enter para continuar..."
            ;;
        22)
            echo ""
            echo "=== ESTAT√çSTICAS DE LOGS ==="
            echo ""
            for log in "$MINER_LOGS"/*.log; do
                lines=$(wc -l < "$log")
                size=$(du -h "$log" | cut -f1)
                last=$(tail -1 "$log" | cut -c1-50)
                echo "$(basename "$log"): $lines linhas | $size | √öltima: $last"
            done
            read -p "Pressione Enter para continuar..."
            ;;
        23) break ;;
        *) echo "Op√ß√£o inv√°lida" ;;
    esac
done
EOF

    # 5. MENU.SH - Menu principal (33 op√ß√µes)
    cat > "$MINER_ROOT/menu.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf" 2>/dev/null

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[38;5;208m'
PINK='\033[38;5;213m'
LIME='\033[38;5;154m'
TEAL='\033[38;5;123m'
GOLD='\033[38;5;220m'
NC='\033[0m'

while true; do
    clear
    
    # BANNER
    echo -e "${GOLD}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${GOLD}‚ïë              BITCOIN MINER TERMUX - MENU PRINCIPAL                  ‚ïë${NC}"
    echo -e "${GOLD}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
    
    # STATUS R√ÅPIDO
    if pgrep -f xmrig > /dev/null; then
        echo -e "  ${GREEN}‚õèÔ∏è  MINERA√á√ÉO: ATIVA${NC}"
        PID=$(pgrep -f xmrig)
        echo -e "  ${WHITE}  PID: $PID${NC}"
    else
        echo -e "  ${RED}‚õèÔ∏è  MINERA√á√ÉO: INATIVA${NC}"
    fi
    
    # ESTAT√çSTICAS R√ÅPIDAS
    if [ -f "$MINER_LOGS/miner.log" ]; then
        SHARES=$(grep -c "accepted" "$MINER_LOGS/miner.log" 2>/dev/null)
        HASHRATE=$(tail -20 "$MINER_LOGS/miner.log" 2>/dev/null | grep -E "speed.*[0-9]+\.[0-9]+" | tail -1 | grep -oE "[0-9]+\.[0-9]+ [kM]?H/s" || echo "0.0 H/s")
        echo -e "  ${WHITE}  Shares:${NC} $SHARES | ${WHITE}Hashrate:${NC} $HASHRATE"
    fi
    
    echo ""
    echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo -e "${CYAN}                      MENU DE CONTROLE (33 OP√á√ïES)                   ${NC}"
    echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
    
    # ==================== GRUPO 1: CONTROLE B√ÅSICO (1-5) ====================
    echo -e "${ORANGE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 1: CONTROLE B√ÅSICO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo "  1)  üöÄ INICIAR minera√ß√£o"
    echo "  2)  üõë PARAR minera√ß√£o"
    echo "  3)  üîÑ REINICIAR minera√ß√£o"
    echo "  4)  üìä VER STATUS completo"
    echo "  5)  üìã VER LOGS"
    echo ""
    
    # ==================== GRUPO 2: MONITORAMENTO (6-10) ====================
    echo -e "${PINK}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 2: MONITORAMENTO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo "  6)  üìà MONITOR em tempo real"
    echo "  7)  üìâ GR√ÅFICO de hashrate"
    echo "  8)  üìä ESTAT√çSTICAS detalhadas"
    echo "  9)  üí∞ RELAT√ìRIO de lucros"
    echo " 10)  üìã RESUMO di√°rio"
    echo ""
    
    # ==================== GRUPO 3: CONFIGURA√á√ïES (11-15) ====================
    echo -e "${LIME}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 3: CONFIGURA√á√ïES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo " 11)  ‚öôÔ∏è  CONFIGURA√á√ïES b√°sicas"
    echo " 12)  üîß CONFIGURA√á√ïES avan√ßadas"
    echo " 13)  üåê CONFIGURAR pools"
    echo " 14)  üîÑ TROCAR pool atual"
    echo " 15)  üìù EDITAR config.json"
    echo ""
    
    # ==================== GRUPO 4: OTIMIZA√á√ÉO (16-20) ====================
    echo -e "${TEAL}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 4: OTIMIZA√á√ÉO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo " 16)  ‚ö° AJUSTAR uso de CPU"
    echo " 17)  üéØ AJUSTAR prioridade"
    echo " 18)  üîÑ OTIMIZAR para bateria"
    echo " 19)  üå°Ô∏è  MONITORAR temperatura"
    echo " 20)  ‚öôÔ∏è  PERFIL de desempenho"
    echo ""
    
    # ==================== GRUPO 5: BACKUP E RESTORE (21-25) ====================
    echo -e "${GOLD}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 5: BACKUP E RESTORE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo " 21)  üíæ CRIAR backup completo"
    echo " 22)  üì¶ LISTAR backups"
    echo " 23)  üîÑ RESTAURAR backup"
    echo " 24)  üóëÔ∏è  REMOVER backup antigo"
    echo " 25)  üîÑ BACKUP autom√°tico"
    echo ""
    
    # ==================== GRUPO 6: FERRAMENTAS (26-30) ====================
    echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 6: FERRAMENTAS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo " 26)  üîç TESTAR velocidade"
    echo " 27)  üåê TESTAR pools"
    echo " 28)  üìä BENCHMARK completo"
    echo " 29)  üîß DIAGN√ìSTICO do sistema"
    echo " 30)  üìù EDITAR scripts"
    echo ""
    
    # ==================== GRUPO 7: SISTEMA (31-33) ====================
    echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GRUPO 7: SISTEMA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo " 31)  ‚ÑπÔ∏è  INFORMA√á√ïES do sistema"
    echo " 32)  üîÑ ATUALIZAR sistema"
    echo " 33)  üóëÔ∏è  DESINSTALAR tudo"
    echo ""
    
    # ==================== SAIR ====================
    echo -e "${RED}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo "  0)  ‚ùå SAIR"
    echo -e "${RED}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
    
    read -p "Escolha uma op√ß√£o (0-33): " choice
    
    case $choice in
        0)  echo "Saindo..."; exit 0 ;;
        
        # GRUPO 1: CONTROLE B√ÅSICO
        1)  "$MINER_ROOT/start.sh" ;;
        2)  "$MINER_ROOT/stop.sh" ;;
        3)  "$MINER_ROOT/stop.sh"; sleep 3; "$MINER_ROOT/start.sh" ;;
        4)  "$MINER_ROOT/status.sh" ;;
        5)  "$MINER_ROOT/logs.sh" ;;
        
        # GRUPO 2: MONITORAMENTO
        6)  
            echo "Monitor em tempo real (Ctrl+C para sair)"
            watch -n 2 "$MINER_ROOT/status.sh"
            ;;
        7)
            echo "Gr√°fico de hashrate (Ctrl+C para sair)"
            tail -f "$MINER_LOGS/hashrate.log" | while read line; do
                echo "$line"
            done
            ;;
        8)
            "$MINER_SCRIPTS/stats.sh"
            ;;
        9)
            "$MINER_SCRIPTS/profit_report.sh"
            ;;
        10)
            "$MINER_SCRIPTS/daily_summary.sh"
            ;;
        
        # GRUPO 3: CONFIGURA√á√ïES
        11)
            "$MINER_SCRIPTS/config_basic.sh"
            ;;
        12)
            "$MINER_SCRIPTS/config_advanced.sh"
            ;;
        13)
            "$MINER_SCRIPTS/pool_config.sh"
            ;;
        14)
            "$MINER_SCRIPTS/switch_pool.sh"
            ;;
        15)
            nano "$MINER_CONFIG/config.json"
            ;;
        
        # GRUPO 4: OTIMIZA√á√ÉO
        16)
            read -p "Novo uso de CPU (10-90): " new_cpu
            sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"$new_cpu\"/" "$MINER_CONFIG/system.conf"
            echo "CPU ajustada para $new_cpu%"
            ;;
        17)
            read -p "Nova prioridade (0-5): " new_priority
            sed -i "s/MINING_PRIORITY=.*/MINING_PRIORITY=\"$new_priority\"/" "$MINER_CONFIG/system.conf"
            echo "Prioridade ajustada para $new_priority"
            ;;
        18)
            "$MINER_SCRIPTS/battery_optimize.sh"
            ;;
        19)
            watch -n 2 "cat $MINER_STATS/temperature.txt 2>/dev/null || echo 'Aguardando...'"
            ;;
        20)
            "$MINER_SCRIPTS/performance_profile.sh"
            ;;
        
        # GRUPO 5: BACKUP E RESTORE
        21)
            "$MINER_SCRIPTS/backup.sh"
            ;;
        22)
            ls -lh "$MINER_BACKUP"/*.tar.gz 2>/dev/null || echo "Nenhum backup encontrado"
            read -p "Pressione Enter para continuar..."
            ;;
        23)
            "$MINER_SCRIPTS/restore.sh"
            ;;
        24)
            "$MINER_SCRIPTS/clean_backup.sh"
            ;;
        25)
            "$MINER_SCRIPTS/auto_backup.sh"
            ;;
        
        # GRUPO 6: FERRAMENTAS
        26)
            "$MINER_SCRIPTS/speed_test.sh"
            ;;
        27)
            "$MINER_SCRIPTS/test_pools.sh"
            ;;
        28)
            "$MINER_SCRIPTS/benchmark.sh"
            ;;
        29)
            "$MINER_SCRIPTS/diagnostic.sh"
            ;;
        30)
            echo "Scripts dispon√≠veis:"
            ls "$MINER_ROOT"/*.sh "$MINER_SCRIPTS"/*.sh
            read -p "Qual script editar? " script
            nano "$MINER_SCRIPTS/$script" 2>/dev/null || nano "$MINER_ROOT/$script"
            ;;
        
        # GRUPO 7: SISTEMA
        31)
            "$MINER_SCRIPTS/system_info.sh"
            ;;
        32)
            "$MINER_SCRIPTS/update.sh"
            ;;
        33)
            "$MINER_SCRIPTS/uninstall.sh"
            ;;
        
        *)  echo "Op√ß√£o inv√°lida!"; sleep 2 ;;
    esac
done
EOF

    # Criar scripts auxiliares
    create_aux_scripts
    
    chmod +x "$MINER_ROOT"/*.sh
    chmod +x "$MINER_SCRIPTS"/*.sh 2>/dev/null
    
    log_success "33 scripts de controle criados"
}

create_aux_scripts() {
    mkdir -p "$MINER_SCRIPTS"
    
    # Script de estat√≠sticas
    cat > "$MINER_SCRIPTS/stats.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== ESTAT√çSTICAS DETALHADAS ==="
echo ""
echo "üìä Shares por hora:"
for i in {1..24}; do
    HOUR=$(date -d "$i hours ago" '+%H')
    COUNT=$(grep "accepted" "$MINER_LOGS/miner.log" | grep "$(date -d "$i hours ago" '+%H:')" | wc -l)
    echo "  $HOUR:00 -> $COUNT shares"
done
read -p "Pressione Enter para continuar..."
EOF

    # Script de relat√≥rio de lucros
    cat > "$MINER_SCRIPTS/profit_report.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf"
echo "=== RELAT√ìRIO DE LUCROS ==="
echo ""
HASHRATE=$(tail -20 "$MINER_LOGS/miner.log" | grep -E "speed.*[0-9]+\.[0-9]+" | tail -1 | grep -oE "[0-9]+\.[0-9]+")
if [ ! -z "$HASHRATE" ]; then
    DAILY_SAT=$(echo "$HASHRATE * 100" | bc | cut -d. -f1)
    DAILY_BTC=$(echo "scale=8; $DAILY_SAT / 100000000" | bc)
    DAILY_USD=$(echo "scale=2; $DAILY_BTC * 40000" | bc)
    echo "üìà Hashrate m√©dio: $HASHRATE H/s"
    echo "üí∞ Estimativa di√°ria:"
    echo "   $DAILY_SAT satoshis"
    echo "   $DAILY_BTC BTC"
    echo "   \$$DAILY_USD USD"
fi
read -p "Pressione Enter para continuar..."
EOF

    # Script de resumo di√°rio
    cat > "$MINER_SCRIPTS/daily_summary.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== RESUMO DI√ÅRIO ==="
echo "Data: $(date '+%Y-%m-%d')"
echo ""
TODAY=$(date '+%Y-%m-%d')
SHARES_TODAY=$(grep "$TODAY" "$MINER_LOGS/miner.log" | grep -c "accepted")
ERRORS_TODAY=$(grep "$TODAY" "$MINER_LOGS/error.log" | wc -l)
echo "üìä Shares hoje: $SHARES_TODAY"
echo "‚ùå Erros hoje: $ERRORS_TODAY"
read -p "Pressione Enter para continuar..."
EOF

    # Script de configura√ß√£o b√°sica
    cat > "$MINER_SCRIPTS/config_basic.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf"
while true; do
    clear
    echo "=== CONFIGURA√á√ïES B√ÅSICAS ==="
    echo "1) Carteira: $BTC_WALLET"
    echo "2) CPU Usage: $CPU_USAGE%"
    echo "3) Prioridade: $MINING_PRIORITY"
    echo "4) Donate Level: $DONATE_LEVEL%"
    echo "5) Voltar"
    read -p "Escolha: " choice
    case $choice in
        1) read -p "Nova carteira: " new; sed -i "s/BTC_WALLET=.*/BTC_WALLET=\"$new\"/" "$MINER_CONFIG/system.conf" ;;
        2) read -p "Novo CPU Usage (10-90): " new; sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"$new\"/" "$MINER_CONFIG/system.conf" ;;
        3) read -p "Nova prioridade (0-5): " new; sed -i "s/MINING_PRIORITY=.*/MINING_PRIORITY=\"$new\"/" "$MINER_CONFIG/system.conf" ;;
        4) read -p "Novo Donate Level (0-5): " new; sed -i "s/DONATE_LEVEL=.*/DONATE_LEVEL=\"$new\"/" "$MINER_CONFIG/system.conf" ;;
        5) break ;;
    esac
done
EOF

    # Script de configura√ß√£o de pools
    cat > "$MINER_SCRIPTS/pool_config.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
while true; do
    clear
    echo "=== CONFIGURA√á√ÉO DE POOLS ==="
    echo ""
    echo "Pools atuais:"
    nl "$MINER_CONFIG/pools.list"
    echo ""
    echo "1) Adicionar pool"
    echo "2) Remover pool"
    echo "3) Testar pools"
    echo "4) Voltar"
    read -p "Escolha: " choice
    case $choice in
        1) read -p "URL da pool: " new; echo "$new" >> "$MINER_CONFIG/pools.list" ;;
        2) read -p "N√∫mero da pool: " num; sed -i "${num}d" "$MINER_CONFIG/pools.list" ;;
        3) while read pool; do
               echo -n "$pool: "
               timeout 2 nc -zv $(echo "$pool" | cut -d: -f1) $(echo "$pool" | cut -d: -f2) 2>&1 | grep -o "succeeded" || echo "offline"
           done < "$MINER_CONFIG/pools.list"
           read -p "Pressione Enter..." ;;
        4) break ;;
    esac
done
EOF

    # Script de troca de pool
    cat > "$MINER_SCRIPTS/switch_pool.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
mapfile -t POOLS < "$MINER_CONFIG/pools.list"
CURRENT=$(grep '"url"' "$MINER_CONFIG/config.json" | head -1 | cut -d'"' -f4)
echo "Pool atual: $CURRENT"
echo ""
echo "Pools dispon√≠veis:"
for i in "${!POOLS[@]}"; do
    if [ "${POOLS[$i]}" = "$CURRENT" ]; then
        echo "$((i+1))) ${POOLS[$i]} (atual)"
    else
        echo "$((i+1))) ${POOLS[$i]}"
    fi
done
read -p "Escolha nova pool: " choice
NEW="${POOLS[$((choice-1))]}"
sed -i "s|\"url\": \".*\"|\"url\": \"$NEW\"|" "$MINER_CONFIG/config.json"
echo "Pool alterada para: $NEW"
"$MINER_ROOT/stop.sh" > /dev/null 2>&1
sleep 3
"$MINER_ROOT/start.sh" > /dev/null 2>&1
EOF

    # Script de otimiza√ß√£o de bateria
    cat > "$MINER_SCRIPTS/battery_optimize.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
if command -v termux-battery-status >/dev/null; then
    STATUS=$(termux-battery-status)
    LEVEL=$(echo "$STATUS" | grep -o '"percentage":[0-9]*' | cut -d: -f2)
    PLUGGED=$(echo "$STATUS" | grep -o '"plugged":"[^"]*"' | cut -d'"' -f4)
    if [ "$PLUGGED" != "UNPLUGGED" ]; then
        sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"75\"/" "$MINER_CONFIG/system.conf"
        echo "Modo otimizado para carregador: CPU 75%"
    else
        if [ $LEVEL -gt 50 ]; then
            sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"50\"/" "$MINER_CONFIG/system.conf"
            echo "Modo otimizado para bateria >50%: CPU 50%"
        else
            sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"30\"/" "$MINER_CONFIG/system.conf"
            echo "Modo otimizado para bateria <50%: CPU 30%"
        fi
    fi
fi
EOF

    # Script de perfil de desempenho
    cat > "$MINER_SCRIPTS/performance_profile.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== PERFIS DE DESEMPENHO ==="
echo "1) M√°ximo desempenho (CPU 90%)"
echo "2) Balanceado (CPU 75%)"
echo "3) Econ√¥mico (CPU 50%)"
echo "4) Super economia (CPU 30%)"
read -p "Escolha: " choice
case $choice in
    1) sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"90\"/" "$MINER_CONFIG/system.conf" ;;
    2) sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"75\"/" "$MINER_CONFIG/system.conf" ;;
    3) sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"50\"/" "$MINER_CONFIG/system.conf" ;;
    4) sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"30\"/" "$MINER_CONFIG/system.conf" ;;
esac
echo "Perfil aplicado!"
"$MINER_ROOT/stop.sh" > /dev/null 2>&1
sleep 3
"$MINER_ROOT/start.sh" > /dev/null 2>&1
EOF

    # Script de restore
    cat > "$MINER_SCRIPTS/restore.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "Backups dispon√≠veis:"
ls -1 "$MINER_BACKUP"/*.tar.gz 2>/dev/null | nl
read -p "Escolha o n√∫mero: " num
BACKUP=$(ls -1 "$MINER_BACKUP"/*.tar.gz 2>/dev/null | sed -n "${num}p")
if [ -f "$BACKUP" ]; then
    "$MINER_ROOT/stop.sh" > /dev/null 2>&1
    tar -xzf "$BACKUP" -C "$MINER_ROOT"
    echo "Backup restaurado!"
    "$MINER_ROOT/start.sh" > /dev/null 2>&1 &
else
    echo "Backup n√£o encontrado"
fi
read -p "Pressione Enter..."
EOF

    # Script de limpeza de backup
    cat > "$MINER_SCRIPTS/clean_backup.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "Backups antigos:"
find "$MINER_BACKUP" -name "*.tar.gz" -type f -mtime +30 -exec ls -lh {} \;
read -p "Remover? (s/n): " confirm
if [ "$confirm" = "s" ]; then
    find "$MINER_BACKUP" -name "*.tar.gz" -type f -mtime +30 -delete
    echo "Backups antigos removidos"
fi
EOF

    # Script de backup autom√°tico
    cat > "$MINER_SCRIPTS/auto_backup.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
while true; do
    "$MINER_SCRIPTS/backup.sh" > /dev/null 2>&1
    echo "[$(date)] Backup autom√°tico realizado" >> "$MINER_LOGS/backup.log"
    sleep 86400  # 24 horas
done &
echo "Backup autom√°tico ativado (a cada 24h)"
EOF

    # Script de teste de velocidade
    cat > "$MINER_SCRIPTS/speed_test.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "Testando velocidade de download..."
for i in {1..5}; do
    echo "Teste $i:"
    time wget -O /dev/null "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64" 2>&1 | grep -E "real|speed"
done
read -p "Pressione Enter..."
EOF

    # Script de teste de pools
    cat > "$MINER_SCRIPTS/test_pools.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== TESTE DE POOLS ==="
echo ""
while read pool; do
    echo -n "$pool: "
    HOST=$(echo "$pool" | cut -d: -f1)
    PORT=$(echo "$pool" | cut -d: -f2)
    timeout 2 nc -zv $HOST $PORT 2>&1 | grep -o "succeeded" && echo "‚úì online" || echo "‚úó offline"
done < "$MINER_CONFIG/pools.list"
read -p "Pressione Enter..."
EOF

    # Script de benchmark
    cat > "$MINER_SCRIPTS/benchmark.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== BENCHMARK COMPLETO ==="
echo ""
echo "1) Teste de CPU"
sysbench cpu run 2>/dev/null | grep "events per second" || echo "Instale sysbench para benchmark"
echo ""
echo "2) Teste de mem√≥ria"
sysbench memory run 2>/dev/null | grep "transferred" || echo "Instale sysbench para benchmark"
echo ""
echo "3) Teste de rede"
curl -o /dev/null http://speedtest.tele2.net/100MB.zip -w 'Velocidade: %{speed_download} bytes/s\n' 2>/dev/null
echo ""
read -p "Pressione Enter..."
EOF

    # Script de diagn√≥stico
    cat > "$MINER_SCRIPTS/diagnostic.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== DIAGN√ìSTICO DO SISTEMA ==="
echo ""
echo "üìä Verificando minerador..."
if pgrep -f xmrig > /dev/null; then
    echo "‚úì Minerador est√° rodando"
else
    echo "‚úó Minerador N√ÉO est√° rodando"
fi
echo ""
echo "üìÅ Verificando arquivos..."
[ -f "$MINER_BIN/xmrig" ] && echo "‚úì Bin√°rio existe" || echo "‚úó Bin√°rio n√£o encontrado"
[ -f "$MINER_CONFIG/config.json" ] && echo "‚úì Config existe" || echo "‚úó Config n√£o encontrado"
[ -d "$MINER_LOGS" ] && echo "‚úì Logs existem" || echo "‚úó Logs n√£o encontrados"
echo ""
echo "üîç Verificando permiss√µes..."
[ -x "$MINER_BIN/xmrig" ] && echo "‚úì Bin√°rio execut√°vel" || echo "‚úó Bin√°rio sem permiss√£o"
echo ""
echo "üìä √öltimos erros:"
tail -5 "$MINER_LOGS/error.log" 2>/dev/null || echo "Nenhum erro"
read -p "Pressione Enter..."
EOF

    # Script de informa√ß√µes do sistema
    cat > "$MINER_SCRIPTS/system_info.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== INFORMA√á√ïES DO SISTEMA ==="
echo ""
echo "üì± Termux:"
pkg list-installed | wc -l | xargs echo "  Pacotes instalados:"
echo ""
echo "üíª Hardware:"
cat /proc/cpuinfo | grep "model name" | head -1 | cut -d: -f2 | xargs echo "  CPU:"
free -h | grep "Mem" | awk '{print "  Mem√≥ria: " $2}'
df -h /data | grep "/data" | awk '{print "  Armazenamento: " $4 " livres"}'
echo ""
echo "‚öôÔ∏è  Sistema:"
echo "  Kernel: $(uname -r)"
echo "  Arquitetura: $(uname -m)"
echo "  Uptime: $(uptime | cut -d, -f1)"
echo ""
echo "‚õèÔ∏è  Minerador:"
[ -f "$MINER_CACHE/version.txt" ] && echo "  Vers√£o XMRig: $(cat "$MINER_CACHE/version.txt")"
echo "  Total shares: $(grep -c "accepted" "$MINER_LOGS/miner.log" 2>/dev/null || echo 0)"
read -p "Pressione Enter..."
EOF

    # Script de update
    cat > "$MINER_SCRIPTS/update.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== ATUALIZAR SISTEMA ==="
echo ""
echo "1) Atualizar scripts"
echo "2) Atualizar XMRig"
echo "3) Atualizar depend√™ncias"
echo "4) Atualizar tudo"
read -p "Escolha: " choice
case $choice in
    1)
        cd "$MINER_ROOT"
        git pull origin main 2>/dev/null || echo "N√£o √© reposit√≥rio git"
        ;;
    2)
        "$MINER_ROOT/stop.sh" > /dev/null 2>&1
        rm -f "$MINER_BIN/xmrig"
        "$MINER_ROOT/install_xmrig" 2>/dev/null
        ;;
    3)
        pkg update && pkg upgrade -y
        ;;
    4)
        cd "$MINER_ROOT"
        git pull origin main 2>/dev/null
        pkg update && pkg upgrade -y
        "$MINER_ROOT/stop.sh" > /dev/null 2>&1
        rm -f "$MINER_BIN/xmrig"
        "$MINER_ROOT/install_xmrig" 2>/dev/null
        ;;
esac
echo "Atualiza√ß√£o conclu√≠da!"
read -p "Pressione Enter..."
EOF

    # Script de desinstala√ß√£o
    cat > "$MINER_SCRIPTS/uninstall.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
echo "=== DESINSTALAR SISTEMA ==="
echo ""
echo -e "\033[1;31m‚ö†Ô∏è  ATEN√á√ÉO: Isso remover√° TODOS os arquivos!\033[0m"
echo ""
read -p "Digite 'DESINSTALAR' para confirmar: " confirm
if [ "$confirm" = "DESINSTALAR" ]; then
    "$MINER_ROOT/stop.sh" > /dev/null 2>&1
    sleep 3
    rm -rf "$MINER_ROOT"
    sed -i '/# BITCOIN MINER ULTIMATE/,/^fi$/d' ~/.bashrc
    sed -i '/alias miner/d' ~/.bashrc
    echo "Sistema desinstalado com sucesso!"
    exit 0
else
    echo "Desinstala√ß√£o cancelada"
    read -p "Pressione Enter..."
fi
EOF

    chmod +x "$MINER_SCRIPTS"/*.sh
}

# ============================================================================
# SISTEMA DE MONITORAMENTO AVAN√áADO
# ============================================================================

setup_monitoring() {
    print_header "CONFIGURANDO MONITORAMENTO AVAN√áADO"
    
    # Script de monitoramento principal
    cat > "$MINER_SCRIPTS/monitor_daemon.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

MINER_ROOT="/data/data/com.termux/files/home/bitcoin_miner_ultimate"
source "$MINER_ROOT/config/system.conf" 2>/dev/null

LOG_MONITOR="$MINER_LOGS/monitor.log"
CHECK_INTERVAL=30
NO_SHARE_TIMEOUT=600
LAST_SHARE=0
SHARE_COUNT=0

echo "[$(date '+%Y-%m-%d %H:%M:%S')] Monitor daemon iniciado" >> "$LOG_MONITOR"

while true; do
    # Verificar se minerador est√° rodando
    if ! pgrep -f xmrig > /dev/null; then
        echo "[$(date '+%H:%M:%S')] Minerador parado, reiniciando..." >> "$LOG_MONITOR"
        "$MINER_ROOT/start.sh" > /dev/null 2>&1 &
        sleep 60
        continue
    fi
    
    CURRENT_TIME=$(date +%s)
    
    # Verificar novos shares
    if [ -f "$MINER_LOGS/miner.log" ]; then
        NEW_COUNT=$(grep -c "accepted" "$MINER_LOGS/miner.log")
        if [ $NEW_COUNT -gt $SHARE_COUNT ]; then
            SHARE_COUNT=$NEW_COUNT
            LAST_SHARE=$CURRENT_TIME
            echo "[$(date '+%H:%M:%S')] Novo share! Total: $SHARE_COUNT" >> "$LOG_MONITOR"
            
            # Notificar Discord a cada 10 shares
            if [ $((SHARE_COUNT % 10)) -eq 0 ] && [ ! -z "$DISCORD_WEBHOOK" ]; then
                HASHRATE=$(tail -20 "$MINER_LOGS/miner.log" | grep -E "speed.*[0-9]+\.[0-9]+" | tail -1 | grep -oE "[0-9]+\.[0-9]+ [kM]?H/s" || echo "0.0 H/s")
                curl -s -H "Content-Type: application/json" \
                     -X POST \
                     -d "{\"content\":\"‚úÖ **+10 SHARES**\\nTotal: $SHARE_COUNT shares\\nHashrate: $HASHRATE\\nWorker: \`$WORKER_ID\`\"}" \
                     "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
            fi
        fi
    fi
    
    # Verificar se est√° muito tempo sem shares
    TIME_SINCE_LAST=$((CURRENT_TIME - LAST_SHARE))
    if [ $LAST_SHARE -gt 0 ] && [ $TIME_SINCE_LAST -gt $NO_SHARE_TIMEOUT ]; then
        echo "[$(date '+%H:%M:%S')] $TIME_SINCE_LAST segundos sem shares, reiniciando..." >> "$LOG_MONITOR"
        "$MINER_ROOT/stop.sh" > /dev/null 2>&1
        sleep 5
        "$MINER_ROOT/start.sh" > /dev/null 2>&1 &
        LAST_SHARE=$CURRENT_TIME
    fi
    
    # Coletar m√©tricas
    if [ -f "$MINER_LOGS/miner.log" ]; then
        # Hashrate
        HASHRATE=$(tail -20 "$MINER_LOGS/miner.log" | grep -E "speed.*[0-9]+\.[0-9]+" | tail -1 | grep -oE "[0-9]+\.[0-9]+" || echo "0")
        echo "$HASHRATE" >> "$MINER_STATS/hashrate.history"
        tail -100 "$MINER_STATS/hashrate.history" > "$MINER_STATS/hashrate.history.tmp"
        mv "$MINER_STATS/hashrate.history.tmp" "$MINER_STATS/hashrate.history"
        
        # Calcular m√©dia
        AVG=$(tail -10 "$MINER_STATS/hashrate.history" | awk '{sum+=$1} END {if(NR>0) printf "%.1f", sum/NR}')
        echo "$AVG" > "$MINER_STATS/avg_hashrate"
    fi
    
    # Verificar temperatura
    if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
        TEMP=$(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)
        TEMP=$((TEMP / 1000))
        echo "$TEMP" > "$MINER_STATS/temperature.txt"
        
        if [ $TEMP -gt 70 ] && [ ! -z "$DISCORD_WEBHOOK" ]; then
            curl -s -H "Content-Type: application/json" \
                 -X POST \
                 -d "{\"content\":\"üå°Ô∏è **ALERTA DE TEMPERATURA**\\nTemperatura: ${TEMP}¬∞C\\nReduza a carga do processador!\"}" \
                 "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
        fi
    fi
    
    # Relat√≥rio de lucros a cada 6 horas
    if [ $((CURRENT_TIME % 21600)) -lt $CHECK_INTERVAL ]; then
        AVG=$(cat "$MINER_STATS/avg_hashrate" 2>/dev/null || echo "0")
        if [ $(echo "$AVG > 0" | bc) -eq 1 ]; then
            DAILY_SAT=$(echo "$AVG * 100" | bc | cut -d. -f1)
            DAILY_BTC=$(echo "scale=8; $DAILY_SAT / 100000000" | bc)
            DAILY_USD=$(echo "scale=2; $DAILY_BTC * 40000" | bc)
            
            cat > "$MINER_STATS/profit.json" << PROFITEOF
{
    "timestamp": "$(date '+%Y-%m-%d %H:%M:%S')",
    "hashrate": "$AVG",
    "daily_sat": $DAILY_SAT,
    "daily_btc": "$DAILY_BTC",
    "daily_usd": "$DAILY_USD",
    "total_sat": $SHARE_COUNT
}
PROFITEOF
            
            if [ ! -z "$DISCORD_WEBHOOK" ]; then
                curl -s -H "Content-Type: application/json" \
                     -X POST \
                     -d "{\"embeds\":[{\"title\":\"üí∞ RELAT√ìRIO DE LUCROS\",\"description\":\"**Hashrate:** $AVG H/s\\n**Estimativa Di√°ria:**\\n‚îî $DAILY_SAT satoshis\\n‚îî $DAILY_BTC BTC\\n‚îî \$$DAILY_USD USD\\n\\n**Total:** $SHARE_COUNT shares\",\"color\":15844367,\"timestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%S.000Z)\"}]}" \
                     "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
            fi
        fi
    fi
    
    sleep $CHECK_INTERVAL
done
EOF

    chmod +x "$MINER_SCRIPTS/monitor_daemon.sh"
    
    # Iniciar monitoramento
    nohup "$MINER_SCRIPTS/monitor_daemon.sh" > /dev/null 2>&1 &
    
    log_success "Monitoramento avan√ßado configurado"
}

# ============================================================================
# CONFIGURA√á√ÉO DE AUTO-INICIALIZA√á√ÉO
# ============================================================================

setup_autostart() {
    print_header "CONFIGURANDO AUTO-INICIALIZA√á√ÉO"
    
    # Adicionar ao .bashrc
    if ! grep -q "bitcoin_miner_ultimate" ~/.bashrc; then
        cat >> ~/.bashrc << 'EOF'

# ====================================================
# BITCOIN MINER ULTIMATE v13.0 - AUTO START
# ====================================================
if [ -f "/data/data/com.termux/files/home/bitcoin_miner_ultimate/menu.sh" ] && [ ! -f /tmp/miner_started ]; then
    echo ""
    echo -e "\033[1;33m‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "\033[1;33m‚ïë              BITCOIN MINER TERMUX ULTIMATE v13.0                   ‚ïë${NC}"
    echo -e "\033[1;33m‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo -e "\033[1;36mComandos dispon√≠veis:\033[0m"
    echo -e "  \033[1;32mminer\033[0m        - Abrir menu principal (33 op√ß√µes)"
    echo -e "  \033[1;32mminer_start\033[0m  - Iniciar minera√ß√£o"
    echo -e "  \033[1;32mminer_stop\033[0m   - Parar minera√ß√£o"
    echo -e "  \033[1;32mminer_status\033[0m - Ver status"
    echo -e "  \033[1;32mminer_logs\033[0m   - Ver logs"
    echo -e "  \033[1;32mminer_menu\033[0m   - Menu completo"
    echo ""
    
    # Iniciar minerador automaticamente ap√≥s 30 segundos
    (sleep 30 && cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./start.sh > /dev/null 2>&1) &
    touch /tmp/miner_started
fi

# Aliases
alias miner='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./menu.sh'
alias miner_start='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./start.sh'
alias miner_stop='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./stop.sh'
alias miner_status='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./status.sh'
alias miner_logs='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./logs.sh'
alias miner_menu='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./menu.sh'
alias miner_restart='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./stop.sh && sleep 3 && ./start.sh'
alias miner_backup='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./scripts/backup.sh'
alias miner_pool='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./scripts/switch_pool.sh'
alias miner_stats='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./scripts/stats.sh'
alias miner_profit='cd /data/data/com.termux/files/home/bitcoin_miner_ultimate && ./scripts/profit_report.sh'
EOF
        log_success "Auto-inicializa√ß√£o configurada com 12 aliases"
    else
        log_info "Auto-inicializa√ß√£o j√° existe"
    fi
}

# ============================================================================
# BACKUP INICIAL
# ============================================================================

create_initial_backup() {
    print_header "CRIANDO BACKUP INICIAL"
    
    local backup_name="backup_initial_$(date +%Y%m%d_%H%M%S)"
    local backup_path="$MINER_BACKUP/$backup_name"
    
    mkdir -p "$backup_path"
    
    # Copiar tudo
    cp -r "$MINER_CONFIG" "$backup_path/"
    cp -r "$MINER_SCRIPTS" "$backup_path/"
    cp -r "$MINER_STATS" "$backup_path/"
    cp "$MINER_ROOT"/*.sh "$backup_path/" 2>/dev/null
    
    # Informa√ß√µes do backup
    cat > "$backup_path/README.txt" << EOF
BACKUP INICIAL DO MINERADOR BITCOIN ULTIMATE v13.0
==================================================
Data: $(date '+%Y-%m-%d %H:%M:%S')
Worker: $(grep WORKER_ID "$MINER_CONFIG/system.conf" 2>/dev/null | cut -d'"' -f2)
Wallet: $BTC_WALLET
Arquitetura: $ARCH_TYPE

Este backup cont√©m:
- Configura√ß√µes completas
- Todos os scripts de controle
- Estat√≠sticas iniciais
- Logs b√°sicos

Tamanho: $(du -sh "$backup_path" | cut -f1)
Arquivos: $(find "$backup_path" -type f | wc -l)
EOF
    
    # Compactar
    cd "$MINER_BACKUP"
    tar -czf "$backup_name.tar.gz" "$backup_name"
    rm -rf "$backup_name"
    
    log_success "Backup inicial criado: $backup_name.tar.gz"
    log_info "Tamanho: $(du -h "$backup_name.tar.gz" | cut -f1)"
    
    # Notificar Discord
    if [ ! -z "$DISCORD_WEBHOOK" ]; then
        curl -s -H "Content-Type: application/json" \
             -X POST \
             -d "{\"content\":\"üíæ **BACKUP INICIAL CRIADO**\\nArquivo: $backup_name.tar.gz\\nTamanho: $(du -h "$backup_name.tar.gz" | cut -f1)\"}" \
             "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    fi
}

# ============================================================================
# INSTALA√á√ÉO COMPLETA
# ============================================================================

install_complete() {
    print_banner
    
    print_header "INICIANDO INSTALA√á√ÉO COMPLETA v13.0"
    
    # Verifica√ß√µes
    check_termux
    check_internet || exit 1
    check_architecture
    check_battery
    check_temperature
    
    # Criar estrutura
    log_info "Criando estrutura de diret√≥rios..."
    mkdir -p "$MINER_ROOT"
    mkdir -p "$MINER_BIN"
    mkdir -p "$MINER_CONFIG"
    mkdir -p "$MINER_LOGS"
    mkdir -p "$MINER_STATS"
    mkdir -p "$MINER_SCRIPTS"
    mkdir -p "$MINER_BACKUP"
    mkdir -p "$MINER_CACHE"
    mkdir -p "$MINER_TEMP"
    mkdir -p "$MINER_WALLPAPER"
    mkdir -p "$MINER_THEMES"
    
    # Inicializar logs
    init_logs
    
    # Instalar depend√™ncias
    install_dependencies
    
    # Instalar XMRig
    install_xmrig || exit 1
    
    # Criar configura√ß√£o
    create_config
    
    # Criar scripts
    create_scripts
    
    # Configurar monitoramento
    setup_monitoring
    
    # Configurar auto-start
    setup_autostart
    
    # Backup inicial
    create_initial_backup
    
    # Notificar Discord
    if [ ! -z "$DISCORD_WEBHOOK" ]; then
        WORKER=$(grep WORKER_ID "$MINER_CONFIG/system.conf" 2>/dev/null | cut -d'"' -f2)
        curl -s -H "Content-Type: application/json" \
             -X POST \
             -d "{\"embeds\":[{\"title\":\"‚úÖ SISTEMA INSTALADO\",\"description\":\"**Worker:** \`$WORKER\`\\n**Arquitetura:** $ARCH_TYPE\\n**CPU:** $CPU_USAGE%\\n**Scripts:** 33 fun√ß√µes\\n**Data:** $(date '+%d/%m/%Y %H:%M')\",\"color\":3066993}]}" \
             "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    fi
    
    # Finalizar
    print_header "INSTALA√á√ÉO CONCLU√çDA COM SUCESSO!"
    
    echo -e "${COLOR_INFO}üìÅ Diret√≥rio:${NC} $MINER_ROOT"
    echo -e "${COLOR_INFO}üí∞ Carteira:${NC} ${BTC_WALLET:0:10}...${BTC_WALLET: -4}"
    echo -e "${COLOR_INFO}üë∑ Worker:${NC} $(grep WORKER_ID "$MINER_CONFIG/system.conf" 2>/dev/null | cut -d'"' -f2)"
    echo -e "${COLOR_INFO}‚ö° XMRig:${NC} $("$MINER_BIN/xmrig" --version 2>/dev/null | head -1)"
    echo -e "${COLOR_INFO}üìä Scripts:${NC} 33 fun√ß√µes no menu"
    echo -e "${COLOR_INFO}üíæ Backup:${NC} $(ls -1 "$MINER_BACKUP"/*.tar.gz 2>/dev/null | wc -l) arquivo(s)"
    echo ""
    echo -e "${COLOR_SUCCESS}Comandos dispon√≠veis:${NC}"
    echo "  miner        - Abrir menu principal (33 op√ß√µes)"
    echo "  miner_start  - Iniciar minera√ß√£o"
    echo "  miner_stop   - Parar minera√ß√£o"
    echo "  miner_status - Ver status completo"
    echo "  miner_logs   - Ver logs (23 op√ß√µes)"
    echo "  miner_menu   - Menu completo"
    echo "  miner_restart - Reiniciar"
    echo "  miner_backup - Criar backup"
    echo "  miner_pool   - Trocar pool"
    echo "  miner_stats  - Estat√≠sticas"
    echo "  miner_profit - Relat√≥rio de lucros"
    echo ""
    echo -e "${COLOR_WARNING}‚ö†Ô∏è  A minera√ß√£o iniciar√° automaticamente em 30 segundos${NC}"
    echo ""
    
    # Perguntar se quer iniciar agora
    read -p "Iniciar minera√ß√£o agora? (s/n): " start_now
    if [ "$start_now" = "s" ]; then
        cd "$MINER_ROOT"
        ./start.sh
        sleep 3
        ./menu.sh
    else
        echo "Para iniciar manualmente: cd $MINER_ROOT && ./start.sh"
        echo "Para abrir o menu: cd $MINER_ROOT && ./menu.sh"
    fi
}

# ============================================================================
# INICIALIZA√á√ÉO PRINCIPAL
# ============================================================================

# Verificar se o sistema j√° existe
if [ -d "$MINER_ROOT" ] && [ -f "$MINER_BIN/xmrig" ]; then
    # Sistema j√° instalado, mostrar menu
    cd "$MINER_ROOT"
    ./menu.sh
else
    # Primeira execu√ß√£o - instalar
    install_complete
fi
