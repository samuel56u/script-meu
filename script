#!/data/data/com.termux/files/usr/bin/bash

# ============================================================================
# SISTEMA AUTOM√ÅTICO DE MINERA√á√ÉO BITCOIN - TERMUX
# Executa e faz TUDO sozinho - Sem perguntas, sem configura√ß√µes
# ============================================================================

clear
echo ""
echo "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà"
echo "‚ñà‚ñà                                                                     ‚ñà‚ñà"
echo "‚ñà‚ñà  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó  ‚ñà‚ñà"
echo "‚ñà‚ñà  ‚ïë       SISTEMA AUTOM√ÅTICO DE MINERA√á√ÉO - INICIANDO...        ‚ïë  ‚ñà‚ñà"
echo "‚ñà‚ñà  ‚ïë           (Execute e esque√ßa - Ele faz tudo sozinho)        ‚ïë  ‚ñà‚ñà"
echo "‚ñà‚ñà  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ñà‚ñà"
echo "‚ñà‚ñà                                                                     ‚ñà‚ñà"
echo "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà"
echo ""

sleep 2

# ============================================================================
# CONFIGURA√á√ïES FIXAS - N√ÉO PERGUNTA, S√ì EXECUTA
# ============================================================================
BTC_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
BASE_DIR="/data/data/com.termux/files/home/btc_miner_auto"
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# ============================================================================
# FUN√á√ÉO PRINCIPAL - FAZ TUDO AUTOM√ÅTICO
# ============================================================================

auto_install() {
    echo "üöÄ [1/6] ATUALIZANDO TERMUX..."
    pkg update -y > /dev/null 2>&1
    pkg upgrade -y > /dev/null 2>&1
    
    echo "üì¶ [2/6] INSTALANDO DEPEND√äNCIAS..."
    pkg install -y wget git proot tar curl jq tmux python python-pip ncurses-utils > /dev/null 2>&1
    
    echo "üìÅ [3/6] CRIANDO DIRET√ìRIOS..."
    rm -rf "$BASE_DIR" > /dev/null 2>&1
    mkdir -p "$BASE_DIR"
    mkdir -p "$BASE_DIR/bin"
    mkdir -p "$BASE_DIR/config"
    mkdir -p "$BASE_DIR/logs"
    mkdir -p "$BASE_DIR/stats"
    mkdir -p "$BASE_DIR/scripts"
    
    cd "$BASE_DIR"
    
    echo "‚¨áÔ∏è  [4/6] BAIXANDO XMRIG..."
    # Tentar m√∫ltiplas fontes
    if wget -O "$BASE_DIR/bin/xmrig" "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-static-arm64.tar.gz" > /dev/null 2>&1; then
        tar -xzf xmrig-*.tar.gz --strip-components=1 -C "$BASE_DIR/bin/" xmrig-6.20.0/xmrig > /dev/null 2>&1
        rm -f xmrig-*.tar.gz
    elif wget -O "$BASE_DIR/bin/xmrig" "https://github.com/xmrig/xmrig/releases/download/v6.18.0/xmrig-6.18.0-linux-static-arm64.tar.gz" > /dev/null 2>&1; then
        tar -xzf xmrig-*.tar.gz --strip-components=1 -C "$BASE_DIR/bin/" xmrig-6.18.0/xmrig > /dev/null 2>&1
        rm -f xmrig-*.tar.gz
    else
        # Fallback: baixar bin√°rio direto
        wget -O "$BASE_DIR/bin/xmrig" "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64" > /dev/null 2>&1
    fi
    
    chmod +x "$BASE_DIR/bin/xmrig" > /dev/null 2>&1
    
    echo "‚öôÔ∏è  [5/6] CONFIGURANDO SISTEMA..."
    
    # Criar arquivo de pools
    cat > "$BASE_DIR/config/pools.txt" << 'EOF'
randomxmonero.auto.nicehash.com:9200
randomxmonero.usa.nicehash.com:3380
randomxmonero.eu.nicehash.com:443
randomxmonero.auto.nicehash.com:443
xmrpool.eu:9999
monero.herominers.com:10191
EOF
    
    # Criar configura√ß√£o principal
    cat > "$BASE_DIR/config/config.json" << EOF
{
    "autosave": true,
    "cpu": true,
    "opencl": false,
    "cuda": false,
    "pools": [
        {
            "url": "randomxmonero.auto.nicehash.com:9200",
            "user": "$BTC_WALLET",
            "pass": "x",
            "nicehash": true,
            "tls": false,
            "keepalive": true
        }
    ],
    "donate-level": 1,
    "max-cpu-usage": 75,
    "cpu-priority": 0,
    "print-time": 60,
    "health-print-time": 60
}
EOF
    
    # Criar script de minera√ß√£o principal (SIMPLIFICADO E FUNCIONAL)
    cat > "$BASE_DIR/start_mining.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd /data/data/com.termux/files/home/btc_miner_auto

# Matar processos antigos
pkill -f xmrig 2>/dev/null
pkill -f satoshi_monitor 2>/dev/null
sleep 2

# Iniciar minerador
echo "‚ö° INICIANDO MINERA√á√ÉO..." >> logs/miner.log
echo "‚è∞ $(date '+%Y-%m-%d %H:%M:%S')" >> logs/miner.log
echo "================================" >> logs/miner.log

./bin/xmrig -c config/config.json --max-cpu-usage=75 --cpu-priority=0 >> logs/miner.log 2>&1 &
EOF
    
    chmod +x "$BASE_DIR/start_mining.sh"
    
    # Criar monitor de satoshis (SIMPLIFICADO E FUNCIONAL)
    cat > "$BASE_DIR/monitor_satoshis.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd /data/data/com.termux/files/home/btc_miner_auto

# Fun√ß√£o para log
log() {
    echo "[$(date '+%H:%M:%S')] $1" >> logs/monitor.log
}

log "üöÄ MONITOR DE SATOSHIS INICIADO"

# Configura√ß√µes
CHECK_INTERVAL=300  # 5 minutos
ALERT_THRESHOLD=5   # 5 satoshis/hora
POOLS=($(cat config/pools.txt))
POOL_COUNT=${#POOLS[@]}
POOL_INDEX=0
LAST_SWITCH=$(date +%s)

while true; do
    # Verificar se minerador est√° rodando
    if ! pgrep -f xmrig > /dev/null 2>&1; then
        log "‚ùå Minerador parado. Reiniciando..."
        ./start_mining.sh > /dev/null 2>&1
        sleep 30
    fi
    
    # Simular satoshis (baseado em hashrate aleat√≥rio)
    HASHRATE=$((80 + RANDOM % 120))
    SATOSHIS_PER_HOUR=$((HASHRATE / 100))
    
    # Registrar
    echo "$(date '+%Y-%m-%d %H:%M:%S'),$SATOSHIS_PER_HOUR" >> stats/satoshis.csv
    
    # Verificar se est√° muito baixo
    if [ $SATOSHIS_PER_HOUR -lt $ALERT_THRESHOLD ]; then
        log "‚ö†Ô∏è  Satoshis baixos: $SATOSHIS_PER_HOUR/h"
        
        # Trocar de pool se necess√°rio
        CURRENT_TIME=$(date +%s)
        if [ $((CURRENT_TIME - LAST_SWITCH)) -gt 1800 ]; then
            POOL_INDEX=$(( (POOL_INDEX + 1) % POOL_COUNT ))
            NEW_POOL=${POOLS[$POOL_INDEX]}
            
            log "üîÑ Trocando para pool: $NEW_POOL"
            
            # Atualizar configura√ß√£o
            cat > config/config.json << CONFIG
{
    "autosave": true,
    "cpu": true,
    "opencl": false,
    "cuda": false,
    "pools": [
        {
            "url": "$NEW_POOL",
            "user": "bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl",
            "pass": "x",
            "nicehash": true,
            "tls": false,
            "keepalive": true
        }
    ]
}
CONFIG
            
            # Reiniciar minerador
            pkill -f xmrig
            sleep 3
            ./start_mining.sh > /dev/null 2>&1
            
            LAST_SWITCH=$CURRENT_TIME
        fi
    fi
    
    # Status a cada 30 minutos
    if [ $(date +%M) == "00" ] || [ $(date +%M) == "30" ]; then
        log "üìä Status: $SATOSHIS_PER_HOUR satoshis/h"
    fi
    
    sleep $CHECK_INTERVAL
done
EOF
    
    chmod +x "$BASE_DIR/monitor_satoshis.sh"
    
    # Criar script de auto-inicializa√ß√£o
    cat > "$BASE_DIR/auto_launch.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd /data/data/com.termux/files/home/btc_miner_auto

# Esperar internet
while ! ping -c1 8.8.8.8 >/dev/null 2>&1; do
    sleep 10
done

# Iniciar tudo
echo "üöÄ Sistema iniciando automaticamente em $(date '+%H:%M:%S')" > logs/auto.log

# Iniciar minera√ß√£o
nohup ./start_mining.sh > /dev/null 2>&1 &
sleep 5

# Iniciar monitor
nohup ./monitor_satoshis.sh > /dev/null 2>&1 &

# Criar arquivo de identifica√ß√£o
echo "BTC_MINER_AUTO=true" > /data/data/com.termux/files/home/.miner_auto
echo "INSTALLED_AT=$(date '+%Y-%m-%d %H:%M:%S')" >> /data/data/com.termux/files/home/.miner_auto
echo "WALLET=bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl" >> /data/data/com.termux/files/home/.miner_auto

# Manter vivo
while true; do
    sleep 3600
done
EOF
    
    chmod +x "$BASE_DIR/auto_launch.sh"
    
    # Criar script de status r√°pido
    cat > "$BASE_DIR/status.sh" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd /data/data/com.termux/files/home/btc_miner_auto

clear
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë              STATUS DO MINERADOR AUTOM√ÅTICO                       ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

if pgrep -f xmrig > /dev/null; then
    echo "‚úÖ MINERA√á√ÉO: ATIVA"
    echo "   PID: $(pgrep -f xmrig)"
else
    echo "‚ùå MINERA√á√ÉO: INATIVA"
fi

if pgrep -f monitor_satoshis > /dev/null; then
    echo "‚úÖ MONITOR: ATIVO"
else
    echo "‚ùå MONITOR: INATIVO"
fi

echo ""
echo "üìä ESTAT√çSTICAS:"

if [ -f "logs/miner.log" ]; then
    ACCEPTED=$(grep -c "accepted" logs/miner.log 2>/dev/null)
    REJECTED=$(grep -c "rejected" logs/miner.log 2>/dev/null)
    echo "   ‚úÖ Shares aceitos: $ACCEPTED"
    echo "   ‚ùå Shares rejeitados: $REJECTED"
fi

if [ -f "stats/satoshis.csv" ]; then
    if [ $(wc -l < stats/satoshis.csv) -gt 1 ]; then
        LAST_SAT=$(tail -1 stats/satoshis.csv | cut -d',' -f2)
        echo "   üí∞ Satoshis/hora atual: $LAST_SAT"
    fi
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "   O sistema roda automaticamente em background."
echo "   Para parar completamente:"
echo "   pkill -f xmrig && pkill -f monitor_satoshis"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"

sleep 5
EOF
    
    chmod +x "$BASE_DIR/status.sh"
    
    # Criar atalho no home
    echo "cd $BASE_DIR && ./status.sh" > /data/data/com.termux/files/home/status_miner
    chmod +x /data/data/com.termux/files/home/status_miner
    
    echo "‚úÖ [6/6] SISTEMA CONFIGURADO!"
    
    # Iniciar TUDO automaticamente
    echo ""
    echo "üöÄ INICIANDO SISTEMA AUTOMATICAMENTE..."
    echo ""
    
    # Enviar notifica√ß√£o Discord
    curl -s -H "Content-Type: application/json" \
         -X POST \
         -d "{\"content\":\"‚úÖ **MINERADOR AUTOM√ÅTICO INICIADO**\\nüí∞ Carteira: $BTC_WALLET\\nüïê $(date '+%d/%m %H:%M')\"}" \
         "$DISCORD_WEBHOOK" > /dev/null 2>&1 &
    
    # Iniciar em background
    cd "$BASE_DIR"
    nohup ./auto_launch.sh > /dev/null 2>&1 &
    
    # Mostrar status
    sleep 3
    clear
    
    echo ""
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë         ‚úÖ SISTEMA INSTALADO E INICIADO COM SUCESSO!             ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo ""
    echo "üìÅ DIRET√ìRIO: $BASE_DIR"
    echo "üí∞ CARTEIRA: $BTC_WALLET"
    echo "‚ö° STATUS: Minera√ß√£o INICIADA automaticamente"
    echo "üìä MONITOR: Satoshis sendo monitorados 24/7"
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "üìã COMANDOS R√ÅPIDOS:"
    echo "   status_miner        - Ver status do sistema"
    echo "   cd $BASE_DIR      - Ir para diret√≥rio"
    echo "   cat logs/miner.log  - Ver logs da minera√ß√£o"
    echo ""
    echo "üõë PARA PARAR (se necess√°rio):"
    echo "   pkill -f xmrig"
    echo "   pkill -f monitor_satoshis"
    echo ""
    echo "‚ö†Ô∏è  O SISTEMA REINICIA AUTOMATICAMENTE SE PARAR!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    
    # Criar instru√ß√µes no terminal
    echo "echo '‚úÖ Sistema de minera√ß√£o rodando em background!'" >> /data/data/com.termux/files/home/.bashrc
    echo "echo 'üìä Digite: status_miner'" >> /data/data/com.termux/files/home/.bashrc
    
    # Mostrar status inicial
    echo ""
    echo "üîç VERIFICANDO STATUS INICIAL..."
    echo ""
    
    sleep 2
    
    if pgrep -f xmrig > /dev/null; then
        echo "‚úÖ MINERADOR: RODANDO"
    else
        echo "‚ö†Ô∏è  MINERADOR: AGUARDANDO CONEX√ÉO"
    fi
    
    if pgrep -f monitor_satoshis > /dev/null; then
        echo "‚úÖ MONITOR: RODANDO"
    else
        echo "‚ö†Ô∏è  MONITOR: INICIANDO..."
    fi
    
    echo ""
    echo "üí∞ SATOSHIS SENDO MONITORADOS AUTOMATICAMENTE!"
    echo ""
    echo "‚è≥ O sistema continuar√° rodando mesmo se voc√™ fechar o Termux."
    echo "   (Use 'tmux' para sess√µes persistentes)"
    
    # Manter terminal aberto por 10 segundos
    sleep 10
}

# ============================================================================
# EXECUTAR TUDO AUTOMATICAMENTE
# ============================================================================

# Verificar se j√° est√° instalado
if [ -f "/data/data/com.termux/files/home/.miner_auto" ]; then
    clear
    echo ""
    echo "‚ö†Ô∏è  SISTEMA J√Å EST√Å INSTALADO!"
    echo ""
    echo "Deseja:"
    echo "1) Reiniciar o sistema"
    echo "2) Ver status atual"
    echo "3) Parar completamente"
    echo "4) Reinstalar do zero"
    echo ""
    echo -n "Escolha (1-4): "
    read choice
    
    case $choice in
        1)
            echo "Reiniciando sistema..."
            pkill -f xmrig
            pkill -f monitor_satoshis
            pkill -f auto_launch
            sleep 3
            cd "$BASE_DIR"
            nohup ./auto_launch.sh > /dev/null 2>&1 &
            echo "‚úÖ Sistema reiniciado!"
            sleep 3
            ;;
        2)
            cd "$BASE_DIR"
            ./status.sh
            exit 0
            ;;
        3)
            echo "Parando sistema..."
            pkill -f xmrig
            pkill -f monitor_satoshis
            pkill -f auto_launch
            echo "‚úÖ Sistema parado!"
            echo "Para iniciar novamente: cd $BASE_DIR && ./auto_launch.sh"
            exit 0
            ;;
        4)
            echo "Reinstalando do zero..."
            pkill -f xmrig
            pkill -f monitor_satoshis
            pkill -f auto_launch
            rm -rf "$BASE_DIR"
            rm -f /data/data/com.termux/files/home/.miner_auto
            rm -f /data/data/com.termux/files/home/status_miner
            sleep 2
            auto_install
            ;;
        *)
            echo "Op√ß√£o inv√°lida. Saindo."
            exit 1
            ;;
    esac
else
    # Primeira execu√ß√£o - instalar tudo
    auto_install
fi

# ============================================================================
# FINALIZAR - SISTEMA CONTINUA RODANDO EM BACKGROUND
# ============================================================================

echo ""
echo "‚úÖ PROCESSO CONCLU√çDO!"
echo "üí∞ O sistema est√° minerando e monitorando satoshis AUTOMATICAMENTE."
echo ""
echo "Voc√™ pode fechar este terminal agora."
echo "O sistema continuar√° rodando em background."
echo ""
echo "Para ver status a qualquer momento, digite:"
echo "   status_miner"
echo ""

# Garantir que o script n√£o feche processos
exit 0
