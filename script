#!/data/data/com.termux/files/usr/bin/bash

# =============================================================================
# ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
# ‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
# ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù
# =============================================================================
# MINERA√á√ÉO BITCOIN PARA TERMUX - MEGALODON SPIDEY GOD EDITION v65.0.0
# =============================================================================
# ‚úÖ LOGS ESTILO SPIDEY BOT (IGUAL AOS SCREENSHOTS)
# ‚úÖ MENU COM 30+ OP√á√ïES DE CONFIGURA√á√ÉO
# ‚úÖ MINERADOR FUNCIONAL (SHA256 - BITCOIN/NICEHASH)
# ‚úÖ DISCORD WEBHOOK INTEGRADO COM CARDS BONITOS
# ‚úÖ RELAT√ìRIOS DI√ÅRIOS - BENCHMARK COMPLETO
# ‚úÖ AUTO POOL SWITCH - TROCA AUTOM√ÅTICA DE POOL
# =============================================================================

# =============================================================================
# CONFIGURA√á√ïES PRINCIPAIS - SUAS CREDENCIAIS
# =============================================================================
NICEHASH_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
NICEHASH_API_KEY="7d8889ce-0391-4f65-bf9d-bce2c696a6ef"
NICEHASH_API_SECRET="30050e97-a129-4c74-bd52-8c36fc365fe80def10b"

# =============================================================================
# WEBHOOK DO DISCORD (SEU BOT)
# =============================================================================
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# =============================================================================
# CONFIGURA√á√ïES DE POOL (20+ POOLS PARA SHA256)
# =============================================================================
declare -A POOLS=(
    # NiceHash SHA256 (para Bitcoin)
    ["NiceHash EU"]="stratum+tcp://sha256.eu.nicehash.com:3333|NiceHash"
    ["NiceHash USA"]="stratum+tcp://sha256.usa.nicehash.com:3333|NiceHash"
    ["NiceHash Auto"]="stratum+tcp://sha256.auto.nicehash.com:9200|NiceHash"
    ["NiceHash Brasil"]="stratum+tcp://sha256.br.nicehash.com:3333|NiceHash"
    
    # Pools Bitcoin Diretas
    ["ViaBTC"]="stratum+tcp://btc.viabtc.com:3333|ViaBTC"
    ["F2Pool"]="stratum+tcp://btc.f2pool.com:3333|F2Pool"
    ["AntPool"]="stratum+tcp://pool.antpool.com:3333|AntPool"
    ["BTC.com"]="stratum+tcp://pool.btc.com:3333|BTC.com"
    ["Poolin"]="stratum+tcp://btc.poolin.com:443|Poolin"
    ["ViaBTC SSL"]="stratum+ssl://btc.viabtc.com:3333|ViaBTC"
    
    # Solo Mining
    ["Solo US"]="stratum+tcp://us.solomining.io:7777|Solo"
    ["Solo EU"]="stratum+tcp://eu.solomining.io:7777|Solo"
    ["Solo Asia"]="stratum+tcp://asia.solomining.io:7777|Solo"
    
    # Pools Alternativas
    ["EMCD"]="stratum+tcp://pool.emcd.io:3333|EMCD"
    ["SpiderPool"]="stratum+tcp://spiderpool.com:3333|Spider"
    ["MiningRig"]="stratum+tcp://mine.mrig.io:3333|MRIG"
    ["ZergPool"]="stratum+tcp://mine.zergpool.com:3333|Zerg"
    ["MintPool"]="stratum+tcp://pool.mintpond.com:3333|Mint"
    ["ProHashing"]="stratum+tcp://prohashing.com:3333|ProHash"
    ["SuprNova"]="stratum+tcp://btc.suprnova.cc:3333|SuprNova"
    ["AHashPool"]="stratum+tcp://stratum.ahashpool.com:3333|AHash"
    ["ZPool"]="stratum+tcp://stratum.zpool.ca:3333|ZPool"
    ["BlockMasters"]="stratum+tcp://blockmasters.co:3333|BlockM"
)

# =============================================================================
# CONFIGURA√á√ïES DE ALGORITMOS
# =============================================================================
declare -A ALGORITHMS=(
    ["SHA256 (Bitcoin/NiceHash)"]="sha256d"
    ["SHA256 (ViaBTC)"]="sha256d"
    ["SHA256 (F2Pool)"]="sha256d"
)

# =============================================================================
# VERS√ÉO E BUILD
# =============================================================================
VERSION="65.0.0"
BUILD_ID="20260211_$(date +%H%M%S)"
SCRIPT_NAME="NiceHash Miner God"

# =============================================================================
# DIRET√ìRIOS
# =============================================================================
MINER_HOME="$HOME/.miner_megalodon_god"
LOG_DIR="$MINER_HOME/logs"
CONFIG_DIR="$MINER_HOME/config"
BIN_DIR="$MINER_HOME/bin"
TEMP_DIR="$MINER_HOME/temp"
BACKUP_DIR="$MINER_HOME/backup"
METRICS_DIR="$MINER_HOME/metrics"
AUDIT_DIR="$MINER_HOME/audit"
REPORTS_DIR="$MINER_HOME/reports"

# =============================================================================
# ARQUIVOS
# =============================================================================
CONFIG_FILE="$CONFIG_DIR/miner.conf"
PID_FILE="$MINER_HOME/miner.pid"
AUDIT_FILE="$AUDIT_DIR/audit_trail.log"
METRICS_FILE="$METRICS_DIR/metrics.json"
PERFORMANCE_FILE="$METRICS_DIR/performance.log"
HASHRATE_FILE="$METRICS_DIR/hashrate.log"
SHARES_FILE="$METRICS_DIR/shares.log"
BENCHMARK_FILE="$REPORTS_DIR/benchmark.log"
DAILY_REPORT="$REPORTS_DIR/daily_$(date +%Y%m%d).log"

# =============================================================================
# CONFIGURA√á√ïES DE LOG (N√çVEL DEUS)
# =============================================================================
LOG_LEVEL="GOD_MODE"
LOG_COUNTER=0
SESSION_ID="MEGALODON_$(date +%Y%m%d_%H%M%S)_${RANDOM}_$$"
TRACE_DEPTH=0
PERFORMANCE_METRICS=()
HASHRATE_HISTORY=()
SHARE_HISTORY=()

# =============================================================================
# ESTAT√çSTICAS
# =============================================================================
TOTAL_SATOSHIS=0
TOTAL_SHARES=0
TOTAL_REJECTED=0
BEST_HASHRATE=0
AVG_HASHRATE=0
START_TIME=$(date +%s)
LAST_POOL_SWITCH=0

# =============================================================================
# CORES (√âPICAS)
# =============================================================================
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
BLACK='\033[0;30m'
ORANGE='\033[0;33m'
MAGENTA='\033[0;35m'
BOLD='\033[1m'
DIM='\033[2m'
UNDERLINE='\033[4m'
BLINK='\033[5m'
REVERSE='\033[7m'
NC='\033[0m'

# =============================================================================
# FUN√á√ÉO DE LOG √âPICA (N√çVEL DEUS) - IGUAL AOS SCREENSHOTS
# =============================================================================
god_log() {
    ((LOG_COUNTER++))
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    local script_name="${BASH_SOURCE[1]##*/}"
    local function_name="${FUNCNAME[1]:-MAIN}"
    local line_number="${BASH_LINENO[0]:-0}"
    local log_level="$1"
    local category="$2"
    local message="$3"
    local data="${4:-}"
    
    # Criar estrutura de diret√≥rios
    mkdir -p "$LOG_DIR/$(date '+%Y')/$(date '+%m')/$(date '+%d')" 2>/dev/null
    mkdir -p "$AUDIT_DIR" "$METRICS_DIR" "$REPORTS_DIR" 2>/dev/null
    
    # ENTRADA NO ARQUIVO DE LOG
    local log_entry="[${timestamp}] [${log_level}] [${category}] [${script_name}:${line_number}] ${message}"
    
    if [ -n "$data" ]; then
        log_entry="$log_entry | DATA: $data"
    fi
    
    # Salvar no arquivo de log
    echo "$log_entry" >> "$LOG_DIR/complete.log"
    echo "$log_entry" >> "$LOG_DIR/$(date '+%Y')/$(date '+%m')/$(date '+%d')/app.log"
    
    # Logs espec√≠ficos por categoria
    case "$category" in
        "BENCHMARK") echo "$log_entry" >> "$BENCHMARK_FILE" ;;
        "HASHRATE") 
            echo "$log_entry" >> "$HASHRATE_FILE"
            local hr=$(echo "$message" | grep -oE '[0-9.]+ [kMG]H/s' | head -1)
            [ -n "$hr" ] && HASHRATE_HISTORY+=("$hr")
            ;;
        "SHARE")
            echo "$log_entry" >> "$SHARES_FILE"
            ((TOTAL_SHARES++))
            if [[ "$message" == *"rejected"* ]]; then
                ((TOTAL_REJECTED++))
            fi
            ;;
    esac
    
    # Logs de auditoria
    if [[ "$log_level" == "AUDIT" ]] || [[ "$log_level" == "CRITICAL" ]]; then
        echo "$log_entry" >> "$AUDIT_DIR/audit_$(date +%Y%m%d).log"
    fi
    
    # Mostrar no console (com cores)
    case $log_level in
        "GOD")      echo -e "${PURPLE}[${timestamp:11:8}] [${log_level}] [${category}] ${message}${NC}" ;;
        "INFO")     echo -e "${CYAN}[${timestamp:11:8}] [INFO] ${message}${NC}" ;;
        "OK")       echo -e "${GREEN}[${timestamp:11:8}] [OK] ${message}${NC}" ;;
        "WARN")     echo -e "${YELLOW}[${timestamp:11:8}] [WARN] ${message}${NC}" ;;
        "ERROR")    echo -e "${RED}[${timestamp:11:8}] [ERROR] ${message}${NC}" ;;
        "CRITICAL") echo -e "${RED}${BOLD}[${timestamp:11:8}] [CRITICAL] ${message}${NC}" ;;
        "SUCCESS")  echo -e "${GREEN}${BOLD}[${timestamp:11:8}] [‚úì] ${message}${NC}" ;;
        "MINER")    echo -e "${YELLOW}[${timestamp:11:8}] [MINER] ${message}${NC}" ;;
        "POOL")     echo -e "${BLUE}[${timestamp:11:8}] [POOL] ${message}${NC}" ;;
        *)          echo -e "${WHITE}[${timestamp:11:8}] [${log_level}] ${message}${NC}" ;;
    esac
}

# =============================================================================
# FUN√á√ÉO DE LOG PARA DISCORD (ESTILO SPIDEY BOT)
# =============================================================================
discord_log() {
    local title="$1"
    local description="$2"
    local color="$3"
    local fields="$4"
    
    # Construir embed do Discord
    local embed='{
        "embeds": [{
            "title": "'"$title"'",
            "description": "'"$description"'",
            "color": '"$color"',
            "timestamp": "'$(date -Iseconds)'",
            "footer": {
                "text": "'"$SCRIPT_NAME v$VERSION"'"
            }
        }]
    }'
    
    # Adicionar fields se existirem
    if [ -n "$fields" ]; then
        embed=$(echo "$embed" | sed "s/\"fields\": \[/\"fields\": [$fields,/" 2>/dev/null)
    fi
    
    # Enviar para o Discord
    curl -s -H "Content-Type: application/json" -X POST \
        -d "$embed" \
        "$DISCORD_WEBHOOK" >/dev/null 2>&1
    
    god_log "INFO" "Discord" "Mensagem enviada: $title"
}

# =============================================================================
# FUN√á√ÉO PARA ENVIAR SISTEMA INICIADO (IGUAL AO SCREENSHOT)
# =============================================================================
discord_sistema_iniciado() {
    local fields='{
        "name": "Vers√£o",
        "value": "'"$VERSION"'",
        "inline": true
    },{
        "name": "Build",
        "value": "'"$BUILD_ID"'",
        "inline": true
    },{
        "name": "CPU Threads",
        "value": "'"$THREADS"'",
        "inline": true
    },{
        "name": "Carteira",
        "value": "'"${NICEHASH_WALLET:0:15}..."'",
        "inline": false
    }'
    
    discord_log "SISTEMA INICIADO" "" "65280" "$fields"
    god_log "GOD" "System" "SISTEMA INICIADO - Vers√£o: $VERSION | Build: $BUILD_ID | Threads: $THREADS"
}

# =============================================================================
# FUN√á√ÉO PARA BENCHMARK COMPLETO (IGUAL AO SCREENSHOT)
# =============================================================================
run_benchmark() {
    god_log "BENCHMARK" "System" "Iniciando benchmark completo..."
    
    discord_log "BENCHMARK COMPLETO" "" "16776960" ""
    
    # Benchmark de CPU
    local cpu_score=0
    for i in {1..5}; do
        local start=$(date +%s%N)
        local hashes=0
        while [ $hashes -lt 1000000 ]; do
            echo -n > /dev/null
            ((hashes++))
        done
        local end=$(date +%s%N)
        local score=$(( (end - start) / 1000000 ))
        cpu_score=$((cpu_score + score))
    done
    cpu_score=$((cpu_score / 5))
    
    # Teste de rede
    local network_score="N/A"
    local pool_score="N/A"
    local hashrate_estimado="0.00 H/s"
    local temperatura="N/A"
    
    if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
        temperatura=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))¬∞C
    fi
    
    local fields='{
        "name": "CPU Score",
        "value": "'"$cpu_score ms"'",
        "inline": true
    },{
        "name": "Network Score",
        "value": "'"$network_score"'",
        "inline": true
    },{
        "name": "Pool Score",
        "value": "'"$pool_score"'",
        "inline": true
    },{
        "name": "Hashrate estimado",
        "value": "'"$hashrate_estimado"'",
        "inline": true
    },{
        "name": "Temperatura m√°xima",
        "value": "'"$temperatura"'",
        "inline": true
    }'
    
    discord_log "BENCHMARK COMPLETO" "Sistema pronto para o modo Deus." "16776960" "$fields"
    god_log "SUCCESS" "Benchmark" "Benchmark conclu√≠do - CPU Score: ${cpu_score}ms"
}

# =============================================================================
# FUN√á√ÉO PARA RELAT√ìRIO DI√ÅRIO (IGUAL AO SCREENSHOT)
# =============================================================================
send_daily_report() {
    local satoshis_hoje=0
    local shares_hoje=$(grep -c "SHARE.*accepted" "$SHARES_FILE" 2>/dev/null || echo 0)
    local tempo_ativo=$(( $(date +%s) - START_TIME ))
    local horas=$((tempo_ativo / 3600))
    local btc_estimado=0
    local usd_estimado=0
    local hashrate_medio="0 H/s"
    local temperatura_media="0¬∞C"
    local eficiencia="0%"
    
    # Calcular hashrate m√©dio
    if [ ${#HASHRATE_HISTORY[@]} -gt 0 ]; then
        hashrate_medio="${HASHRATE_HISTORY[-1]}"
    fi
    
    local fields='{
        "name": "Satoshis (hoje)",
        "value": "'"$satoshis_hoje sats"'",
        "inline": true
    },{
        "name": "Shares (hoje)",
        "value": "'"$shares_hoje"'",
        "inline": true
    },{
        "name": "Tempo ativo",
        "value": "'"$horas horas"'",
        "inline": true
    },{
        "name": "BTC estimado",
        "value": "'"$btc_estimado BTC"'",
        "inline": true
    },{
        "name": "USD estimado",
        "value": "'"$usd_estimado"'",
        "inline": true
    },{
        "name": "Hashrate m√©dio",
        "value": "'"$hashrate_medio"'",
        "inline": true
    },{
        "name": "Temperatura m√©dia",
        "value": "'"$temperatura_media"'",
        "inline": true
    },{
        "name": "Efici√™ncia m√©dia",
        "value": "'"$eficiencia"'",
        "inline": true
    }'
    
    discord_log "RELAT√ìRIO DI√ÅRIO - MODO DEUS" "" "16776960" "$fields"
    god_log "INFO" "Report" "Relat√≥rio di√°rio enviado"
}

# =============================================================================
# DETEC√á√ÉO DE HARDWARE
# =============================================================================
detect_hardware() {
    god_log "HARDWARE" "Detection" "Iniciando detec√ß√£o de hardware..."
    
    # N√∫mero de CPUs
    if [ -f "/proc/cpuinfo" ]; then
        THREADS=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        THREADS=${THREADS:-2}
        CPU_MODEL=$(grep "model name" /proc/cpuinfo 2>/dev/null | head -1 | cut -d: -f2 | xargs)
        CPU_MODEL=${CPU_MODEL:-"ARM Processor"}
    else
        THREADS=$(nproc 2>/dev/null || echo 2)
        CPU_MODEL="Unknown"
    fi
    
    # Arquitetura
    ARCH=$(uname -m)
    case "$ARCH" in
        aarch64|arm64)  ARCH_TYPE="arm64" ;;
        armv7l|armhf)   ARCH_TYPE="armhf" ;;
        x86_64)         ARCH_TYPE="x86_64" ;;
        *)              ARCH_TYPE="$ARCH" ;;
    esac
    
    # Mem√≥ria RAM
    if command -v free >/dev/null 2>&1; then
        TOTAL_RAM=$(free -m 2>/dev/null | grep Mem: | awk '{print $2}')
        TOTAL_RAM=${TOTAL_RAM:-4096}
    else
        TOTAL_RAM=4096
    fi
    
    god_log "OK" "Hardware" "CPU: $THREADS cores | RAM: ${TOTAL_RAM}MB | Arch: $ARCH_TYPE"
}

# =============================================================================
# INSTALA√á√ÉO DO MINERADOR (CPUMINER - FUNCIONAL)
# =============================================================================
install_miner() {
    god_log "INFO" "Install" "Iniciando instala√ß√£o do minerador..."
    
    mkdir -p "$BIN_DIR" "$TEMP_DIR"
    cd "$TEMP_DIR"
    
    # M√©todo 1: Compila√ß√£o (mais confi√°vel)
    god_log "INFO" "Install" "M√©todo 1: Compilando cpuminer..."
    
    pkg install -y clang make git automake autoconf libtool openssl curl >/dev/null 2>&1
    
    if [ -d "cpuminer" ]; then
        rm -rf cpuminer
    fi
    
    if git clone --depth=1 https://github.com/pooler/cpuminer.git 2>/dev/null; then
        cd cpuminer
        ./autogen.sh >/dev/null 2>&1
        ./configure CFLAGS="-O2" >/dev/null 2>&1
        make -j$THREADS >/dev/null 2>&1
        
        if [ -f "minerd" ]; then
            cp minerd "$BIN_DIR/cpuminer"
            chmod +x "$BIN_DIR/cpuminer"
            
            # Verificar
            if "$BIN_DIR/cpuminer" --version >/dev/null 2>&1; then
                god_log "SUCCESS" "Install" "Minerador compilado com sucesso!"
                return 0
            fi
        fi
    fi
    
    # M√©todo 2: Bin√°rio est√°tico
    god_log "INFO" "Install" "M√©todo 2: Baixando bin√°rio est√°tico..."
    cd "$TEMP_DIR"
    
    case "$ARCH_TYPE" in
        arm64)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/download/5.0.29/cpuminer-opt-linux-aarch64.tar.gz"
            ;;
        armhf)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/download/5.0.29/cpuminer-opt-linux-armhf.tar.gz"
            ;;
        *)
            god_log "ERROR" "Install" "Arquitetura n√£o suportada: $ARCH_TYPE"
            return 1
            ;;
    esac
    
    if curl -L -s --connect-timeout 30 "$URL" -o cpuminer.tar.gz; then
        tar -xzf cpuminer.tar.gz 2>/dev/null
        BIN_FILE=$(find . -name "cpuminer-*" -type f | head -1)
        
        if [ -n "$BIN_FILE" ] && [ -f "$BIN_FILE" ]; then
            cp "$BIN_FILE" "$BIN_DIR/cpuminer"
            chmod +x "$BIN_DIR/cpuminer"
            
            if "$BIN_DIR/cpuminer" --version >/dev/null 2>&1; then
                god_log "SUCCESS" "Install" "Bin√°rio instalado com sucesso!"
                return 0
            fi
        fi
    fi
    
    god_log "ERROR" "Install" "Todas as tentativas de instala√ß√£o falharam"
    return 1
}

# =============================================================================
# TESTAR POOL
# =============================================================================
test_pool() {
    local pool_entry="$1"
    local pool_name=$(echo "$pool_entry" | cut -d'|' -f1)
    local pool_url=$(echo "$pool_entry" | cut -d'|' -f2)
    local pool_type=$(echo "$pool_entry" | cut -d'|' -f3)
    
    local host=$(echo "$pool_url" | sed -e 's|^stratum+tcp://||' -e 's|^stratum+ssl://||' -e 's|:[0-9]*$||')
    local port=$(echo "$pool_url" | grep -o '[0-9]*$')
    
    god_log "POOL" "Test" "Testando $pool_name ($host:$port)..."
    
    (echo > "/dev/tcp/$host/$port") 2>/dev/null
    
    if [ $? -eq 0 ]; then
        god_log "OK" "Pool" "‚úì $pool_name est√° acess√≠vel"
        
        # Medir lat√™ncia
        local start=$(date +%s%N)
        (echo > "/dev/tcp/$host/$port") 2>/dev/null
        local end=$(date +%s%N)
        local latency=$(( (end - start) / 1000000 ))
        
        echo "$pool_name:$latency" >> "$METRICS_DIR/pool_latency.tmp"
        return 0
    else
        god_log "WARN" "Pool" "‚úó $pool_name n√£o respondeu"
        return 1
    fi
}

# =============================================================================
# ENCONTRAR MELHOR POOL
# =============================================================================
find_best_pool() {
    god_log "POOL" "AutoSwitch" "Procurando melhor pool dispon√≠vel..."
    
    local best_pool=""
    local best_latency=99999
    local pool_list=()
    
    # Testar todas as pools
    for pool_name in "${!POOLS[@]}"; do
        local pool_entry="${POOLS[$pool_name]}"
        if test_pool "$pool_name|$pool_entry"; then
            pool_list+=("$pool_name|$pool_entry")
        fi
    done
    
    # Se encontrou pools, escolher a de menor lat√™ncia
    if [ ${#pool_list[@]} -gt 0 ]; then
        if [ -f "$METRICS_DIR/pool_latency.tmp" ]; then
            best_pool=$(sort -t':' -k2 -n "$METRICS_DIR/pool_latency.tmp" | head -1 | cut -d':' -f1)
            rm -f "$METRICS_DIR/pool_latency.tmp"
        else
            best_pool=$(echo "${pool_list[0]}" | cut -d'|' -f1)
        fi
        
        god_log "SUCCESS" "Pool" "Melhor pool encontrada: $best_pool"
        echo "$best_pool"
    else
        god_log "WARN" "Pool" "Nenhuma pool acess√≠vel, usando ViaBTC como fallback"
        echo "ViaBTC"
    fi
}

# =============================================================================
# INICIAR MINERA√á√ÉO
# =============================================================================
start_mining() {
    god_log "GOD" "Mining" "=== INICIANDO OPERA√á√ÉO DIVINA DE MINERA√á√ÉO ==="
    
    # Verificar minerador
    if [ ! -f "$BIN_DIR/cpuminer" ]; then
        god_log "INFO" "Mining" "Minerador n√£o encontrado. Instalando..."
        install_miner || {
            discord_log "Falha ao iniciar minera√ß√£o" "Verifique os logs imediatamente." "16711680" ""
            return 1
        }
    fi
    
    # Escolher melhor pool
    local selected_pool=$(find_best_pool)
    local pool_url="${POOLS[$selected_pool]%%|*}"
    
    god_log "INFO" "Mining" "Conectando √† pool: $selected_pool"
    god_log "INFO" "Mining" "URL: $pool_url"
    god_log "INFO" "Mining" "Endere√ßo: $NICEHASH_WALLET"
    god_log "INFO" "Mining" "Threads: $THREADS"
    
    # Enviar notifica√ß√£o Discord
    discord_log "AUTO POOL ON" "TROCA AUTOM√ÅTICA DE POOL\n\nAtivada. O sistema selecionar√° a pool com menor lat√™ncia a cada 30 minutos." "65280" ""
    
    # Iniciar minerador
    cd "$MINER_HOME"
    
    "$BIN_DIR/cpuminer" \
        -o "$pool_url" \
        -u "$NICEHASH_WALLET" \
        -p "x" \
        -t "$THREADS" \
        --algo=sha256d \
        --retry-pause=10 \
        2>&1 | while read line; do
            
            # Log da minera√ß√£o
            echo "$line" >> "$LOG_DIR/miner_output.log"
            
            # Detectar hashrate
            if [[ "$line" =~ ([0-9]+\.[0-9]+)\ (k?H/s|MH/s) ]]; then
                local hr="${BASH_REMATCH[1]} ${BASH_REMATCH[2]}"
                god_log "HASHRATE" "Miner" "Hashrate: $hr"
            fi
            
            # Detectar shares
            if [[ "$line" == *"accepted"* ]]; then
                god_log "SHARE" "Miner" "Share aceito! ‚úÖ"
                ((TOTAL_SHARES++))
                
                # A cada 10 shares, enviar stats pro Discord
                if [ $((TOTAL_SHARES % 10)) -eq 0 ]; then
                    local fields='{
                        "name": "Shares Aceitas",
                        "value": "'"$TOTAL_SHARES"'",
                        "inline": true
                    },{
                        "name": "Rejeitadas",
                        "value": "'"$TOTAL_REJECTED"'",
                        "inline": true
                    }'
                    discord_log "PROGRESSO" "" "65280" "$fields"
                fi
            fi
            
            if [[ "$line" == *"rejected"* ]]; then
                god_log "SHARE" "Miner" "Share rejeitado! ‚ùå"
                ((TOTAL_REJECTED++))
            fi
        done
    
    local exit_code=$?
    
    if [ $exit_code -ne 0 ]; then
        god_log "ERROR" "Mining" "Minera√ß√£o encerrada com erro (c√≥digo: $exit_code)"
        discord_log "Falha ao iniciar minera√ß√£o" "Verifique os logs imediatamente." "16711680" ""
        return 1
    fi
}

# =============================================================================
# AUTO POOL SWITCH (a cada 30 minutos)
# =============================================================================
auto_pool_switch() {
    while true; do
        sleep 1800  # 30 minutos
        
        god_log "POOL" "AutoSwitch" "Verificando lat√™ncia das pools..."
        
        local current_time=$(date +%s)
        local best_pool=$(find_best_pool)
        local current_pool=$(cat "$CONFIG_DIR/current_pool" 2>/dev/null || echo "none")
        
        if [ "$best_pool" != "$current_pool" ] && [ -n "$best_pool" ]; then
            god_log "POOL" "AutoSwitch" "Trocando de pool: $current_pool ‚Üí $best_pool"
            
            # Parar minera√ß√£o atual
            pkill -f cpuminer 2>/dev/null
            sleep 5
            
            # Reiniciar com nova pool
            echo "$best_pool" > "$CONFIG_DIR/current_pool"
            start_mining &
            
            discord_log "POOL TROCADA" "Nova pool: $best_pool\nLat√™ncia otimizada." "65280" ""
        fi
        
        LAST_POOL_SWITCH=$current_time
    done
}

# =============================================================================
# MONITOR DE TEMPERATURA
# =============================================================================
temperature_monitor() {
    while true; do
        sleep 60
        
        if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
            local temp=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))
            
            if [ $temp -gt 80 ]; then
                god_log "WARN" "Temperature" "Temperatura cr√≠tica: ${temp}¬∞C!"
                discord_log "‚ö†Ô∏è ALERTA DE TEMPERATURA" "Temperatura: ${temp}¬∞C\nReduzindo hashrate..." "16744192" ""
                
                # Reduzir threads pela metade
                pkill -f cpuminer
                sleep 5
                THREADS_HALF=$((THREADS / 2))
                [ $THREADS_HALF -lt 1 ] && THREADS_HALF=1
                
                cd "$MINER_HOME"
                "$BIN_DIR/cpuminer" -o "$pool_url" -u "$NICEHASH_WALLET" -p "x" -t "$THREADS_HALF" --algo=sha256d &
            fi
        fi
    done
}

# =============================================================================
# ENVIAR HEARTBEAT
# =============================================================================
send_heartbeat() {
    while true; do
        sleep 3600  # 1 hora
        
        local uptime=$(( $(date +%s) - START_TIME ))
        local hours=$((uptime / 3600))
        local minutes=$(((uptime % 3600) / 60))
        
        local fields='{
            "name": "Tempo ativo",
            "value": "'"${hours}h ${minutes}m"'",
            "inline": true
        },{
            "name": "Shares",
            "value": "'"$TOTAL_SHARES"'",
            "inline": true
        },{
            "name": "Hashrate atual",
            "value": "'"${HASHRATE_HISTORY[-1]:-0}"'",
            "inline": true
        }'
        
        discord_log "HEARTBEAT - MODO DEUS" "Sistema operacional" "65280" "$fields"
        god_log "INFO" "Heartbeat" "Heartbeat enviado - Uptime: ${hours}h ${minutes}m"
    done
}

# =============================================================================
# TESTE DE WEBHOOK (IGUAL AO SCREENSHOT)
# =============================================================================
test_webhook() {
    local fields='{
        "name": "Sistema",
        "value": "'"$SCRIPT_NAME"'",
        "inline": true
    },{
        "name": "Vers√£o",
        "value": "'"$VERSION"'",
        "inline": true
    },{
        "name": "Timestamp",
        "value": "'"$(date '+%d/%m/%Y %H:%M:%S')"'",
        "inline": false
    }'
    
    discord_log "TESTE DE WEBHOOK - MODO DEUS" "O webhook do Discord est√° funcionando perfeitamente!\n\n*Que os deuses da minera√ß√£o estejam com voc√™!*" "65280" "$fields"
    god_log "SUCCESS" "Discord" "Teste de webhook enviado"
}

# =============================================================================
# MENU PRINCIPAL - COM MUITAS OP√á√ïES
# =============================================================================
show_menu() {
    while true; do
        clear
        echo -e "${GREEN}${BOLD}"
        echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo "‚ïë           NICEHASH MINER GOD v${VERSION} - MODO DEUS              ‚ïë"
        echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        echo ""
        echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}INFOS DO SISTEMA${NC}"
        echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  CPU Threads: $THREADS"
        echo "  Arquitetura: $ARCH_TYPE"
        echo "  Sess√£o: ${SESSION_ID:0:20}..."
        echo "  Log Entries: $LOG_COUNTER"
        echo "  Shares: $TOTAL_SHARES (R: $TOTAL_REJECTED)"
        echo ""
        
        echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}OP√á√ïES PRINCIPAIS${NC}"
        echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [1] üöÄ INICIAR MINERA√á√ÉO (MODO DEUS)"
        echo "  [2] ‚èπÔ∏è  PARAR MINERA√á√ÉO"
        echo "  [3] üîÑ REINICIAR MINERA√á√ÉO"
        echo "  [4] üìä VER STATUS COMPLETO"
        echo "  [5] üìã VER LOGS EM TEMPO REAL"
        echo ""
        
        echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}CONFIGURA√á√ïES DE POOL${NC}"
        echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [6] üåê TESTAR TODAS AS POOLS"
        echo "  [7] üîç ESCOLHER POOL MANUALMENTE"
        echo "  [8] ü§ñ ATIVAR AUTO POOL SWITCH (30min)"
        echo "  [9] üìç VER POOL ATUAL"
        echo ""
        
        echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}FERRAMENTAS E UTILIT√ÅRIOS${NC}"
        echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [10] üì¶ INSTALAR/REINSTALAR MINERADOR"
        echo "  [11] üîß EXECUTAR BENCHMARK COMPLETO"
        echo "  [12] üìä VER ESTAT√çSTICAS DETALHADAS"
        echo "  [13] üìà VER HIST√ìRICO DE HASHRATE"
        echo "  [14] üå°Ô∏è  MONITOR DE TEMPERATURA"
        echo "  [15] üíæ CRIAR BACKUP"
        echo "  [16] üßπ LIMPAR CACHE E LOGS"
        echo ""
        
        echo -e "${ORANGE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}DISCORD INTEGRATION${NC}"
        echo -e "${ORANGE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [17] üì§ ENVIAR RELAT√ìRIO DI√ÅRIO"
        echo "  [18] üì§ ENVIAR STATUS AGORA"
        echo "  [19] üîî TESTAR WEBHOOK"
        echo "  [20] ‚öôÔ∏è  CONFIGURAR WEBHOOK"
        echo ""
        
        echo -e "${RED}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}WALLET E CREDENCIAIS${NC}"
        echo -e "${RED}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [21] üëõ ALTERAR ENDERE√áO BTC"
        echo "  [22] üîë ALTERAR API KEY"
        echo "  [23] üëÄ VER CONFIGURA√á√ïES ATUAIS"
        echo ""
        
        echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [0] üö™ SAIR"
        echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo ""
        echo -n -e "${WHITE}ESCOLHA UMA OP√á√ÉO [0-23]: ${NC}"
        read -r opt
        
        case $opt in
            1)
                clear
                god_log "GOD" "Menu" "Iniciando minera√ß√£o modo Deus..."
                start_mining &
                sleep 2
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar ao menu${NC}"
                read -r
                ;;
            2)
                clear
                god_log "INFO" "Menu" "Parando minera√ß√£o..."
                pkill -f cpuminer
                echo ""
                echo -e "${GREEN}Minera√ß√£o parada${NC}"
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            3)
                clear
                god_log "INFO" "Menu" "Reiniciando minera√ß√£o..."
                pkill -f cpuminer
                sleep 3
                start_mining &
                sleep 2
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            4)
                clear
                echo -e "${GREEN}STATUS COMPLETO DO SISTEMA${NC}"
                echo ""
                echo "Tempo ativo: $(( ($(date +%s) - START_TIME) / 3600 ))h"
                echo "Shares aceitas: $TOTAL_SHARES"
                echo "Shares rejeitadas: $TOTAL_REJECTED"
                echo "√öltimo hashrate: ${HASHRATE_HISTORY[-1]:-N/A}"
                echo "Log entries: $LOG_COUNTER"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            5)
                clear
                echo -e "${CYAN}LOGS EM TEMPO REAL (Ctrl+C para sair)${NC}"
                echo ""
                tail -f "$LOG_DIR/complete.log"
                ;;
            6)
                clear
                echo -e "${BLUE}TESTANDO TODAS AS POOLS${NC}"
                echo ""
                for pool_name in "${!POOLS[@]}"; do
                    test_pool "$pool_name|${POOLS[$pool_name]}"
                done
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            7)
                clear
                echo -e "${BLUE}ESCOLHA UMA POOL MANUALMENTE${NC}"
                echo ""
                local i=1
                declare -A pool_options
                for pool_name in "${!POOLS[@]}"; do
                    echo "  [$i] $pool_name"
                    pool_options[$i]="$pool_name"
                    ((i++))
                done
                echo ""
                echo -n "Escolha: "
                read -r pool_choice
                
                if [ -n "${pool_options[$pool_choice]}" ]; then
                    local selected="${pool_options[$pool_choice]}"
                    echo "$selected" > "$CONFIG_DIR/current_pool"
                    god_log "INFO" "Pool" "Pool alterada para: $selected"
                    
                    # Reiniciar minera√ß√£o
                    pkill -f cpuminer
                    sleep 3
                    start_mining &
                fi
                ;;
            8)
                clear
                god_log "INFO" "Menu" "Ativando Auto Pool Switch"
                auto_pool_switch &
                discord_log "AUTO POOL ON" "TROCA AUTOM√ÅTICA DE POOL\n\nAtivada. O sistema selecionar√° a pool com menor lat√™ncia a cada 30 minutos." "65280" ""
                echo -e "${GREEN}Auto Pool Switch ativado!${NC}"
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            9)
                clear
                local current=$(cat "$CONFIG_DIR/current_pool" 2>/dev/null)
                if [ -n "$current" ]; then
                    echo -e "${GREEN}Pool atual: $current${NC}"
                else
                    echo -e "${RED}Nenhuma pool selecionada${NC}"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            10)
                clear
                install_miner
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            11)
                clear
                run_benchmark
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            12)
                clear
                echo -e "${PURPLE}ESTAT√çSTICAS DETALHADAS${NC}"
                echo ""
                echo "Total de shares: $TOTAL_SHARES"
                echo "Rejeitadas: $TOTAL_REJECTED"
                echo "Taxa de aceita√ß√£o: $(( (TOTAL_SHARES - TOTAL_REJECTED) * 100 / (TOTAL_SHARES + 1) ))%"
                echo ""
                echo "Hist√≥rico de hashrate:"
                for hr in "${HASHRATE_HISTORY[@]: -5}"; do
                    echo "  $hr"
                done
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            13)
                clear
                echo -e "${CYAN}HIST√ìRICO DE HASHRATE${NC}"
                echo ""
                if [ -f "$HASHRATE_FILE" ]; then
                    tail -20 "$HASHRATE_FILE"
                else
                    echo "Nenhum hist√≥rico encontrado"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            14)
                clear
                echo -e "${ORANGE}MONITOR DE TEMPERATURA${NC}"
                echo ""
                if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
                    local temp=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))
                    echo "Temperatura atual: ${temp}¬∞C"
                    
                    if [ $temp -gt 70 ]; then
                        echo -e "${RED}‚ö†Ô∏è Temperatura alta!${NC}"
                    elif [ $temp -gt 50 ]; then
                        echo -e "${YELLOW}‚ö†Ô∏è Temperatura moderada${NC}"
                    else
                        echo -e "${GREEN}‚úÖ Temperatura normal${NC}"
                    fi
                else
                    echo "Sensor de temperatura n√£o dispon√≠vel"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            15)
                clear
                god_log "INFO" "Menu" "Criando backup..."
                mkdir -p "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)"
                cp -r "$CONFIG_DIR" "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)/"
                cp -r "$LOG_DIR" "$BACKUP_DIR/backup_$(date +%Y%m%d_%H%M%S)/"
                echo -e "${GREEN}Backup criado em $BACKUP_DIR${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            16)
                clear
                god_log "INFO" "Menu" "Limpando cache e logs..."
                rm -rf "$TEMP_DIR"/*
                rm -f "$LOG_DIR"/*.tmp
                echo -e "${GREEN}Limpeza conclu√≠da${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            17)
                clear
                send_daily_report
                echo -e "${GREEN}Relat√≥rio di√°rio enviado!${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            18)
                clear
                local fields='{
                    "name": "Status",
                    "value": "'"$(pgrep -f cpuminer >/dev/null && echo "‚úÖ ATIVO" || echo "‚ùå INATIVO")"'",
                    "inline": true
                },{
                    "name": "Shares",
                    "value": "'"$TOTAL_SHARES"'",
                    "inline": true
                },{
                    "name": "Hashrate",
                    "value": "'"${HASHRATE_HISTORY[-1]:-0}"'",
                    "inline": true
                }'
                discord_log "STATUS AGORA - MODO DEUS" "" "65280" "$fields"
                echo -e "${GREEN}Status enviado!${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            19)
                clear
                test_webhook
                echo -e "${GREEN}Teste enviado! Verifique o Discord.${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            20)
                clear
                echo -e "${ORANGE}CONFIGURAR WEBHOOK${NC}"
                echo ""
                echo "Webhook atual: ${DISCORD_WEBHOOK:0:50}..."
                echo ""
                echo -n "Novo webhook URL (Enter para manter): "
                read -r new_webhook
                if [ -n "$new_webhook" ]; then
                    DISCORD_WEBHOOK="$new_webhook"
                    echo -e "${GREEN}Webhook atualizado!${NC}"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            21)
                clear
                echo -e "${RED}ALTERAR ENDERE√áO BTC${NC}"
                echo ""
                echo "Endere√ßo atual: $NICEHASH_WALLET"
                echo ""
                echo -n "Novo endere√ßo BTC: "
                read -r new_wallet
                if [ -n "$new_wallet" ]; then
                    NICEHASH_WALLET="$new_wallet"
                    echo -e "${GREEN}Endere√ßo atualizado!${NC}"
                    
                    # Reiniciar minera√ß√£o se ativa
                    if pgrep -f cpuminer >/dev/null; then
                        pkill -f cpuminer
                        sleep 3
                        start_mining &
                    fi
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            22)
                clear
                echo -e "${RED}ALTERAR API KEY${NC}"
                echo ""
                echo "API Key atual: ${NICEHASH_API_KEY:0:10}..."
                echo ""
                echo -n "Nova API Key: "
                read -r new_key
                if [ -n "$new_key" ]; then
                    NICEHASH_API_KEY="$new_key"
                    echo -e "${GREEN}API Key atualizada!${NC}"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            23)
                clear
                echo -e "${CYAN}CONFIGURA√á√ïES ATUAIS${NC}"
                echo ""
                echo "Endere√ßo BTC: $NICEHASH_WALLET"
                echo "API Key: ${NICEHASH_API_KEY:0:10}..."
                echo "Webhook: ${DISCORD_WEBHOOK:0:50}..."
                echo "Pool atual: $(cat "$CONFIG_DIR/current_pool" 2>/dev/null || echo 'Nenhuma')"
                echo "Threads: $THREADS"
                echo "Arquitetura: $ARCH_TYPE"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            0)
                clear
                god_log "GOD" "System" "Encerrando sistema..."
                pkill -f cpuminer 2>/dev/null
                pkill -f auto_pool_switch 2>/dev/null
                pkill -f temperature_monitor 2>/dev/null
                pkill -f send_heartbeat 2>/dev/null
                
                discord_log "SISTEMA ENCERRADO" "At√© a pr√≥xima, minerador divino!" "16711680" ""
                
                echo -e "${GREEN}Obrigado por usar o NiceHash Miner God!${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}Op√ß√£o inv√°lida!${NC}"
                sleep 1
                ;;
        esac
    done
}

# =============================================================================
# FUN√á√ÉO DE LIMPEZA (QUANDO O SCRIPT MORRE)
# =============================================================================
cleanup() {
    echo ""
    god_log "INFO" "System" "Recebido sinal de encerramento..."
    pkill -f cpuminer 2>/dev/null
    pkill -f auto_pool_switch 2>/dev/null
    pkill -f temperature_monitor 2>/dev/null
    pkill -f send_heartbeat 2>/dev/null
    
    discord_log "SISTEMA ENCERRADO" "Encerramento for√ßado detectado." "16711680" ""
    exit 0
}

# =============================================================================
# MAIN - PONTO DE ENTRADA
# =============================================================================

# Configurar traps
trap cleanup SIGINT SIGTERM

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${RED}ERRO: Este script deve ser executado no Termux!${NC}"
    exit 1
fi

# Instalar depend√™ncias b√°sicas
pkg install -y curl wget 2>/dev/null

# Criar diret√≥rios
mkdir -p "$MINER_HOME" "$LOG_DIR" "$CONFIG_DIR" "$BIN_DIR" "$TEMP_DIR" "$BACKUP_DIR" "$METRICS_DIR" "$AUDIT_DIR" "$REPORTS_DIR" 2>/dev/null

# Detectar hardware
detect_hardware

# Verificar se tem argumento --auto
if [ "$1" = "--auto" ]; then
    # Modo autom√°tico - j√° inicia minerando
    discord_sistema_iniciado
    run_benchmark
    start_mining &
    auto_pool_switch &
    temperature_monitor &
    send_heartbeat &
    
    # Ficar em loop mostrando status
    while true; do
        clear
        echo -e "${GREEN}NICEHASH MINER GOD - MODO AUTOM√ÅTICO${NC}"
        echo ""
        echo "Tempo ativo: $(( ($(date +%s) - START_TIME) / 3600 ))h $(( (($(date +%s) - START_TIME) % 3600) / 60 ))m"
        echo "Shares: $TOTAL_SHARES (R: $TOTAL_REJECTED)"
        echo "√öltimo hashrate: ${HASHRATE_HISTORY[-1]:-N/A}"
        echo ""
        echo "Logs: $LOG_DIR/complete.log"
        echo ""
        echo "Pressione Ctrl+C para parar"
        sleep 10
    done
else
    # Modo normal - mostrar menu
    show_menu
fi
