#!/data/data/com.termux/files/usr/bin/bash

# ============================================================================
# MINERADOR BITCOIN ULTIMATE - TERMUX v6.0 MEGA
# Sistema completo com TODOS os m√©todos de instala√ß√£o do XMRig
# ============================================================================

# ============================================================================
# SISTEMA DE CORES COMPLETO
# ============================================================================

# Cores b√°sicas
BLACK='\033[0;30m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[38;5;208m'
PINK='\033[38;5;213m'
LIME='\033[38;5;154m'
TEAL='\033[38;5;123m'
VIOLET='\033[38;5;129m'
GOLD='\033[38;5;220m'
SILVER='\033[38;5;248m'

# Cores de fundo
BG_BLACK='\033[40m'
BG_RED='\033[41m'
BG_GREEN='\033[42m'
BG_YELLOW='\033[43m'
BG_BLUE='\033[44m'
BG_MAGENTA='\033[45m'
BG_CYAN='\033[46m'
BG_WHITE='\033[47m'

# Estilos
BOLD='\033[1m'
DIM='\033[2m'
ITALIC='\033[3m'
UNDERLINE='\033[4m'
BLINK='\033[5m'
REVERSE='\033[7m'
HIDDEN='\033[8m'
STRIKE='\033[9m'

# Reset
NC='\033[0m'
RESET='\033[0m'

# Cores tem√°ticas
COLOR_TITLE="${PURPLE}${BOLD}"
COLOR_SUCCESS="${GREEN}${BOLD}"
COLOR_WARNING="${YELLOW}${BOLD}"
COLOR_ERROR="${RED}${BOLD}"
COLOR_INFO="${CYAN}${BOLD}"
COLOR_PROFIT="${GOLD}${BOLD}"
COLOR_HASHRATE="${LIME}${BOLD}"
COLOR_STATUS="${TEAL}${BOLD}"
COLOR_MENU="${BLUE}${BOLD}"
COLOR_OPTION="${WHITE}"
COLOR_INPUT="${CYAN}"
COLOR_LOGO="${ORANGE}${BOLD}${BLINK}"
COLOR_METHOD="${VIOLET}${BOLD}"

clear
echo ""
echo -e "${COLOR_LOGO}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${COLOR_LOGO}‚ïë          üöÄ MINERADOR BITCOIN ULTIMATE - TERMUX v6.0 MEGA           ‚ïë${NC}"
echo -e "${COLOR_LOGO}‚ïë           (${COLOR_SUCCESS}TODOS M√âTODOS DE INSTALA√á√ÉO XMRig${COLOR_LOGO})                         ‚ïë${NC}"
echo -e "${COLOR_LOGO}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""
echo -e "${COLOR_INFO}üì± Este script tenta TODOS os m√©todos para instalar XMRig:${NC}"
echo -e "${COLOR_METHOD}   1Ô∏è‚É£  Download direto do GitHub (bin√°rio ARM64)${NC}"
echo -e "${COLOR_METHOD}   2Ô∏è‚É£  Download via mirror alternativo${NC}"
echo -e "${COLOR_METHOD}   3Ô∏è‚É£  Compila√ß√£o a partir do c√≥digo fonte${NC}"
echo -e "${COLOR_METHOD}   4Ô∏è‚É£  Download de vers√µes antigas compat√≠veis${NC}"
echo -e "${COLOR_METHOD}   5Ô∏è‚É£  Uso de bin√°rios pr√©-compilados de terceiros${NC}"
echo -e "${COLOR_METHOD}   6Ô∏è‚É£  Download via wget/curl de m√∫ltiplas fontes${NC}"
echo -e "${COLOR_METHOD}   7Ô∏è‚É£  Instala√ß√£o via pacotes alternativos${NC}"
echo -e "${COLOR_METHOD}   8Ô∏è‚É£  Extra√ß√£o de arquivos locais se existirem${NC}"
echo ""
echo -e "${COLOR_SUCCESS}   ‚úÖ Se um m√©todo falhar, tenta o pr√≥ximo automaticamente!${NC}"
echo ""

sleep 3

# ============================================================================
# CONFIGURA√á√ïES PRINCIPAIS
# ============================================================================

# SUA CARTEIRA NICEHASH (TROQUE PELA SUA!)
NICEHASH_WALLET="3Jg8E9nQrN4L2q7V1tXwY5zP6bR8cD0mF2aH4jK5l"

# Webhook do Discord
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# Configura√ß√µes
CPU_USAGE="75"
THREADS="4"
PRIORITY="3"

# Diret√≥rios
BASE_DIR="$HOME/bitcoin_miner_mega"
BACKUP_DIR="$HOME/backup_miner_mega"
XMRIG_CACHE_DIR="$HOME/.cache/xmrig"

# ============================================================================
# LISTA COMPLETA DE M√âTODOS DE INSTALA√á√ÉO DO XMRIG
# ============================================================================

# Vers√µes do XMRig para tentar (do mais novo para o mais antigo)
XMRIG_VERSIONS=(
    "6.20.0"  # Mais recente
    "6.19.3"
    "6.19.2"
    "6.19.1"
    "6.19.0"
    "6.18.2"
    "6.18.1"
    "6.18.0"
    "6.17.0"
    "6.16.4"
    "6.16.3"
    "6.16.2"
    "6.16.1"
    "6.16.0"
    "6.15.3"
    "6.15.2"
    "6.15.1"
    "6.15.0"
    "6.14.1"
    "6.14.0"
)

# URLs para download do XMRig (TODAS AS POSS√çVEIS)
XMRIG_URLS=(
    # GitHub oficial - Releases
    "https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-linux-arm64.tar.gz"
    "https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-linux-arm64"
    "https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-linux-armhf.tar.gz"
    "https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-linux-armhf"
    
    # GitHub mirror 1
    "https://github.com/xmrig/xmrig/archive/refs/tags/v{VERSION}.tar.gz"
    
    # GitHub mirror 2
    "https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-generic-arm.tar.gz"
    
    # Mirrors alternativos
    "https://dl.miner.io/xmrig/v{VERSION}/xmrig-{VERSION}-linux-arm64.tar.gz"
    "https://dl.miner.io/xmrig/v{VERSION}/xmrig-{VERSION}-linux-arm64"
    "https://cdn.miner.rocks/xmrig/v{VERSION}/xmrig-{VERSION}-linux-arm64.tar.gz"
    "https://cdn.miner.rocks/xmrig/v{VERSION}/xmrig-{VERSION}-linux-arm64"
    
    # SourceForge
    "https://sourceforge.net/projects/xmrig/files/XMRig/{VERSION}/xmrig-{VERSION}-linux-arm64.tar.gz/download"
    
    # FossHub
    "https://www.fosshub.com/XMRig.html?dwl=xmrig-{VERSION}-linux-arm64.tar.gz"
    
    # Bin√°rios de terceiros
    "https://github.com/zealotcoder/xmrig-termux/releases/download/v{VERSION}/xmrig-{VERSION}-termux-arm64"
    "https://github.com/termux-miner/xmrig-builds/releases/download/v{VERSION}/xmrig-{VERSION}-termux-arm"
    "https://github.com/Android-Miner/xmrig-android/releases/download/v{VERSION}/xmrig-{VERSION}-android-arm64"
    
    # Reposit√≥rios APK (para Termux)
    "https://packages.termux.org/apt/termux-main/pool/main/x/xmrig/xmrig_{VERSION}_arm.deb"
    
    # URLs diretas para bin√°rios ARM
    "https://binaries.xmrig.com/xmrig-{VERSION}-linux-arm64"
    "https://binaries.xmrig.com/xmrig-{VERSION}-linux-armhf"
    
    # Archive.org (backup de vers√µes antigas)
    "https://web.archive.org/web/20230101000000/https://github.com/xmrig/xmrig/releases/download/v{VERSION}/xmrig-{VERSION}-linux-arm64.tar.gz"
)

# Reposit√≥rios Git para compila√ß√£o
GIT_REPOS=(
    "https://github.com/xmrig/xmrig.git"
    "https://github.com/xmrig/xmrig --branch v{VERSION}"
    "https://gitlab.com/xmrig/xmrig.git"
    "https://github.com/zealotcoder/xmrig-termux.git"
    "https://github.com/termux-miner/xmrig-termux-build.git"
)

# ============================================================================
# FUN√á√ïES DO SISTEMA
# ============================================================================

print_logo() {
    clear
    echo ""
    echo -e "${COLOR_LOGO}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${COLOR_LOGO}‚ïë  ${COLOR_TITLE}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ${COLOR_LOGO}‚ïë${NC}"
    echo -e "${COLOR_LOGO}‚ïë  ${COLOR_TITLE}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì ${GOLD}TERMUX XMRig INSTALLER${COLOR_TITLE} ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ${COLOR_LOGO}‚ïë${NC}"
    echo -e "${COLOR_LOGO}‚ïë  ${COLOR_TITLE}‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ${COLOR_LOGO}‚ïë${NC}"
    echo -e "${COLOR_LOGO}‚ïë              ${GOLD}üöÄ MINERADOR BITCOIN ULTIMATE v6.0 MEGA ${GOLD}             ‚ïë${NC}"
    echo -e "${COLOR_LOGO}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

print_header() {
    clear
    echo ""
    echo -e "${COLOR_TITLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${COLOR_TITLE}‚ïë              ${GOLD}MINERADOR BITCOIN ULTIMATE - v6.0 MEGA${COLOR_TITLE}              ‚ïë${NC}"
    echo -e "${COLOR_TITLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

print_separator() {
    echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
}

print_double_separator() {
    echo -e "${GOLD}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
}

print_success() {
    echo -e "${COLOR_SUCCESS}[‚úì]${NC} ${GREEN}$1${NC}"
}

print_warning() {
    echo -e "${COLOR_WARNING}[!]${NC} ${YELLOW}$1${NC}"
}

print_error() {
    echo -e "${COLOR_ERROR}[‚úó]${NC} ${RED}$1${NC}"
}

print_info() {
    echo -e "${COLOR_INFO}[i]${NC} ${CYAN}$1${NC}"
}

print_method() {
    echo -e "${COLOR_METHOD}[üîß]${NC} ${VIOLET}$1${NC}"
}

print_progress() {
    echo -e "${COLOR_MENU}[${BLUE}‚Üí${NC}] ${BLUE}$1${NC}"
}

print_input() {
    echo -ne "${COLOR_INPUT}$1${NC}"
}

# ============================================================================
# FUN√á√ïES DE INSTALA√á√ÉO DO XMRIG (TODOS OS M√âTODOS)
# ============================================================================

# M√©todo 1: Download direto do GitHub (bin√°rio ARM64)
method_github_direct() {
    print_method "M√©todo 1: Download direto do GitHub (bin√°rio ARM64)"
    
    local version="$1"
    local target_file="$2"
    
    print_progress "Tentando GitHub releases: v$version"
    
    # Tentar v√°rias URLs do GitHub
    local github_urls=(
        "https://github.com/xmrig/xmrig/releases/download/v$version/xmrig-$version-linux-arm64.tar.gz"
        "https://github.com/xmrig/xmrig/releases/download/v$version/xmrig-$version-linux-arm64"
        "https://github.com/xmrig/xmrig/releases/download/v$version/xmrig-$version-linux-armhf.tar.gz"
        "https://github.com/xmrig/xmrig/releases/download/v$version/xmrig-$version-linux-armhf"
    )
    
    for url in "${github_urls[@]}"; do
        print_progress "Tentando: $(basename "$url")"
        
        if wget -q --timeout=20 --tries=2 "$url" -O xmrig_temp 2>/dev/null || \
           curl -s -L --connect-timeout 20 --max-time 30 "$url" -o xmrig_temp 2>/dev/null; then
            
            # Verificar se √© um arquivo tar.gz
            if [[ "$url" == *.tar.gz ]]; then
                print_progress "Extraindo arquivo tar.gz..."
                tar -xzf xmrig_temp 2>/dev/null
                find . -name "xmrig" -type f -exec mv {} "$target_file" \; 2>/dev/null
                rm -f xmrig_temp
            else
                # √â um bin√°rio direto
                mv xmrig_temp "$target_file"
            fi
            
            if [ -f "$target_file" ]; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via GitHub bem sucedido!"
                return 0
            fi
        fi
        rm -f xmrig_temp 2>/dev/null
    done
    
    return 1
}

# M√©todo 2: Mirror alternativo
method_mirror() {
    print_method "M√©todo 2: Mirror alternativo"
    
    local version="$1"
    local target_file="$2"
    
    print_progress "Tentando mirrors alternativos..."
    
    local mirrors=(
        "https://dl.miner.io/xmrig/v$version/xmrig-$version-linux-arm64.tar.gz"
        "https://dl.miner.io/xmrig/v$version/xmrig-$version-linux-arm64"
        "https://cdn.miner.rocks/xmrig/v$version/xmrig-$version-linux-arm64.tar.gz"
        "https://cdn.miner.rocks/xmrig/v$version/xmrig-$version-linux-arm64"
        "https://binaries.xmrig.com/xmrig-$version-linux-arm64"
        "https://binaries.xmrig.com/xmrig-$version-linux-armhf"
    )
    
    for mirror in "${mirrors[@]}"; do
        print_progress "Tentando mirror: $(echo "$mirror" | cut -d'/' -f3)"
        
        if wget -q --timeout=20 --tries=2 "$mirror" -O xmrig_temp 2>/dev/null; then
            
            if [[ "$mirror" == *.tar.gz ]]; then
                tar -xzf xmrig_temp 2>/dev/null
                find . -name "xmrig" -type f -exec mv {} "$target_file" \; 2>/dev/null
                rm -f xmrig_temp
            else
                mv xmrig_temp "$target_file"
            fi
            
            if [ -f "$target_file" ]; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via mirror bem sucedido!"
                return 0
            fi
        fi
    done
    
    return 1
}

# M√©todo 3: Compila√ß√£o a partir do c√≥digo fonte
method_compile_source() {
    print_method "M√©todo 3: Compila√ß√£o a partir do c√≥digo fonte"
    
    local version="$1"
    local target_file="$2"
    
    print_progress "Instalando depend√™ncias para compila√ß√£o..."
    
    # Instalar todas as depend√™ncias necess√°rias
    pkg install -y git build-essential cmake automake libtool autoconf \
        libuv-dev libssl-dev hwloc-dev libmicrohttpd-dev gperf 2>/dev/null
    
    if [ $? -ne 0 ]; then
        print_warning "Falha ao instalar depend√™ncias de compila√ß√£o"
        return 1
    fi
    
    # Criar diret√≥rio para compila√ß√£o
    mkdir -p /tmp/xmrig_build
    cd /tmp/xmrig_build
    
    # Clonar reposit√≥rio
    print_progress "Clonando reposit√≥rio do XMRig..."
    
    if git clone https://github.com/xmrig/xmrig.git 2>/dev/null; then
        cd xmrig
        
        # Verificar tag espec√≠fica se vers√£o for especificada
        if [ ! -z "$version" ] && [ "$version" != "latest" ]; then
            git checkout "v$version" 2>/dev/null
        fi
        
        # Criar diret√≥rio de build
        mkdir build
        cd build
        
        # Configurar
        print_progress "Configurando compila√ß√£o..."
        cmake .. -DWITH_HTTPD=OFF -DWITH_TLS=OFF -DWITH_OPENCL=OFF -DWITH_CUDA=OFF 2>/dev/null
        
        if [ $? -ne 0 ]; then
            print_warning "Falha na configura√ß√£o do CMake"
            return 1
        fi
        
        # Compilar
        print_progress "Compilando XMRig (isso pode levar alguns minutos)..."
        make -j$(nproc) 2>/dev/null
        
        if [ $? -eq 0 ] && [ -f "xmrig" ]; then
            cp xmrig "$target_file"
            chmod +x "$target_file"
            
            # Limpar
            cd ~
            rm -rf /tmp/xmrig_build
            
            print_success "‚úÖ Compila√ß√£o do XMRig bem sucedida!"
            return 0
        fi
    fi
    
    cd ~
    rm -rf /tmp/xmrig_build 2>/dev/null
    return 1
}

# M√©todo 4: Reposit√≥rios de terceiros (Termux espec√≠fico)
method_termux_repo() {
    print_method "M√©todo 4: Reposit√≥rios de terceiros (Termux)"
    
    local target_file="$2"
    
    print_progress "Tentando reposit√≥rios Termux espec√≠ficos..."
    
    # Tentar instalar via reposit√≥rios alternativos
    local termux_repos=(
        "https://github.com/zealotcoder/xmrig-termux/releases"
        "https://github.com/termux-miner/xmrig-builds/releases"
        "https://github.com/Android-Miner/xmrig-android/releases"
    )
    
    # Primeiro, tentar encontrar qualquer bin√°rio arm64
    for repo in "${termux_repos[@]}"; do
        print_progress "Verificando: $(echo "$repo" | cut -d'/' -f3)"
        
        # Tentar baixar o √∫ltimo release
        if wget -q "$repo/latest/download/xmrig" -O "$target_file" 2>/dev/null; then
            chmod +x "$target_file"
            print_success "‚úÖ Download de reposit√≥rio Termux bem sucedido!"
            return 0
        fi
    done
    
    return 1
}

# M√©todo 5: Download via m√∫ltiplas ferramentas (wget, curl, axel, aria2)
method_multi_download() {
    print_method "M√©todo 5: Download via m√∫ltiplas ferramentas"
    
    local version="$1"
    local target_file="$2"
    
    print_progress "Tentando todas as ferramentas de download..."
    
    # URLs para tentar
    local urls=(
        "https://github.com/xmrig/xmrig/releases/download/v$version/xmrig-$version-linux-arm64"
        "https://binaries.xmrig.com/xmrig-$version-linux-arm64"
    )
    
    for url in "${urls[@]}"; do
        print_progress "URL: $url"
        
        # Tentar com wget
        if command -v wget >/dev/null 2>&1; then
            print_progress "Tentando wget..."
            if wget -q --timeout=30 --tries=3 "$url" -O "$target_file" 2>/dev/null; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via wget bem sucedido!"
                return 0
            fi
        fi
        
        # Tentar com curl
        if command -v curl >/dev/null 2>&1; then
            print_progress "Tentando curl..."
            if curl -s -L --connect-timeout 30 --max-time 45 "$url" -o "$target_file" 2>/dev/null; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via curl bem sucedido!"
                return 0
            fi
        fi
        
        # Tentar com axel (se instalado)
        if command -v axel >/dev/null 2>&1; then
            print_progress "Tentando axel (download acelerado)..."
            if axel -q -n 4 --timeout=30 "$url" -o "$target_file" 2>/dev/null; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via axel bem sucedido!"
                return 0
            fi
        fi
        
        # Tentar com aria2 (se instalado)
        if command -v aria2c >/dev/null 2>&1; then
            print_progress "Tentando aria2..."
            if aria2c -q --timeout=30 --max-tries=3 "$url" -o "$target_file" 2>/dev/null; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via aria2 bem sucedido!"
                return 0
            fi
        fi
    done
    
    return 1
}

# M√©todo 6: Extrair de arquivos locais se existirem
method_local_files() {
    print_method "M√©todo 6: Procurando arquivos locais existentes"
    
    local target_file="$2"
    
    print_progress "Procurando XMRig em locais comuns..."
    
    # Locais onde o XMRig pode j√° estar instalado
    local possible_locations=(
        "/data/data/com.termux/files/usr/bin/xmrig"
        "/data/data/com.termux/files/usr/local/bin/xmrig"
        "$HOME/bin/xmrig"
        "$HOME/.local/bin/xmrig"
        "/sdcard/Download/xmrig"
        "/sdcard/xmrig"
        "$HOME/xmrig"
        "$HOME/xmrig-*/xmrig"
        "/storage/emulated/0/Download/xmrig"
        "$HOME/storage/downloads/xmrig"
    )
    
    for location in "${possible_locations[@]}"; do
        if [ -f "$location" ]; then
            print_progress "Encontrado em: $location"
            cp "$location" "$target_file"
            chmod +x "$target_file"
            print_success "‚úÖ XMRig encontrado localmente!"
            return 0
        fi
    done
    
    # Procurar em qualquer lugar no diret√≥rio home
    print_progress "Buscando recursivamente no diret√≥rio home..."
    local found_file=$(find "$HOME" -name "xmrig" -type f -executable 2>/dev/null | head -1)
    
    if [ ! -z "$found_file" ]; then
        print_progress "Encontrado em: $found_file"
        cp "$found_file" "$target_file"
        chmod +x "$target_file"
        print_success "‚úÖ XMRig encontrado via busca local!"
        return 0
    fi
    
    return 1
}

# M√©todo 7: Usar bin√°rios compat√≠veis de outros projetos
method_compatible_binaries() {
    print_method "M√©todo 7: Bin√°rios compat√≠veis de outros projetos"
    
    local target_file="$2"
    
    print_progress "Tentando bin√°rios compat√≠veis..."
    
    # Projetos que podem ter bin√°rios compat√≠veis
    local compatible_projects=(
        "https://github.com/fireice-uk/xmr-stak/releases/latest/download/xmr-stak-linux-arm64"
        "https://github.com/SChernykh/p2pool/releases/latest/download/p2pool-arm64"
        "https://github.com/trexminer/T-Rex/releases/latest/download/t-rex-arm64"
    )
    
    for project_url in "${compatible_projects[@]}"; do
        print_progress "Tentando: $(echo "$project_url" | cut -d'/' -f3)"
        
        if wget -q --timeout=20 "$project_url" -O "$target_file" 2>/dev/null; then
            chmod +x "$target_file"
            print_warning "‚ö†Ô∏è  Usando bin√°rio compat√≠vel (pode n√£o ser XMRig)"
            print_warning "   Algumas funcionalidades podem n√£o estar dispon√≠veis"
            return 0
        fi
    done
    
    return 1
}

# M√©todo 8: Instala√ß√£o via gerenciador de pacotes alternativo
method_package_manager() {
    print_method "M√©todo 8: Gerenciadores de pacotes alternativos"
    
    local target_file="$2"
    
    print_progress "Tentando gerenciadores de pacotes..."
    
    # Tentar instalar via apt se dispon√≠vel
    if command -v apt >/dev/null 2>&1; then
        print_progress "Tentando apt..."
        pkg install xmrig -y 2>/dev/null
        
        if [ $? -eq 0 ] && command -v xmrig >/dev/null 2>&1; then
            cp $(which xmrig) "$target_file"
            print_success "‚úÖ Instala√ß√£o via apt bem sucedida!"
            return 0
        fi
    fi
    
    # Tentar instalar via dpkg
    if command -v dpkg >/dev/null 2>&1; then
        print_progress "Tentando dpkg..."
        
        # Procurar por pacotes .deb
        local deb_packages=(
            "https://packages.termux.org/apt/termux-main/pool/main/x/xmrig/xmrig_*_arm.deb"
            "https://github.com/termux-miner/xmrig-termux/releases/latest/download/xmrig-termux.deb"
        )
        
        for deb_url in "${deb_packages[@]}"; do
            print_progress "Tentando baixar: $deb_url"
            
            if wget -q "$deb_url" -O /tmp/xmrig.deb 2>/dev/null; then
                dpkg -i /tmp/xmrig.deb 2>/dev/null
                rm -f /tmp/xmrig.deb
                
                if command -v xmrig >/dev/null 2>&1; then
                    cp $(which xmrig) "$target_file"
                    print_success "‚úÖ Instala√ß√£o via dpkg bem sucedida!"
                    return 0
                fi
            fi
        done
    fi
    
    return 1
}

# M√©todo 9: Download via IPFS/Web3
method_ipfs() {
    print_method "M√©todo 9: Download via IPFS/Web3"
    
    local target_file="$2"
    
    print_progress "Tentando redes descentralizadas..."
    
    # IPFS hashes para XMRig (pode estar desatualizado)
    local ipfs_hashes=(
        "QmXmrigHash1234567890"  # Placeholder
    )
    
    if command -v ipfs >/dev/null 2>&1; then
        for hash in "${ipfs_hashes[@]}"; do
            print_progress "Tentando IPFS hash: $hash"
            if ipfs get "$hash" -o "$target_file" 2>/dev/null; then
                chmod +x "$target_file"
                print_success "‚úÖ Download via IPFS bem sucedido!"
                return 0
            fi
        done
    fi
    
    return 1
}

# M√©todo 10: Usar emulador para bin√°rio x86_64 (√∫ltimo recurso)
method_emulation() {
    print_method "M√©todo 10: Usar emula√ß√£o (qemu)"
    
    local target_file="$2"
    
    print_progress "Tentando instalar emulador qemu..."
    
    # Instalar qemu-user se dispon√≠vel
    pkg install -y qemu-user-x86_64 qemu-user-arm 2>/dev/null
    
    if [ $? -eq 0 ]; then
        # Tentar baixar bin√°rio x86_64 e usar qemu para emular
        print_progress "Baixando bin√°rio x86_64 para emula√ß√£o..."
        
        if wget -q "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-x64.tar.gz" -O /tmp/xmrig_x64.tar.gz 2>/dev/null; then
            tar -xzf /tmp/xmrig_x64.tar.gz -C /tmp/
            find /tmp -name "xmrig" -type f -exec mv {} "$target_file" \; 2>/dev/null
            
            if [ -f "$target_file" ]; then
                # Criar wrapper para usar qemu
                cat > "${target_file}.wrapper" << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
exec qemu-x86_64 "$(dirname "$0")/xmrig" "$@"
EOF
                chmod +x "${target_file}.wrapper"
                mv "${target_file}.wrapper" "$target_file"
                
                print_warning "‚ö†Ô∏è  Usando emula√ß√£o x86_64 (MAIS LENTO)"
                print_warning "   Desempenho ser√° reduzido significativamente"
                return 0
            fi
        fi
    fi
    
    return 1
}

# M√©todo 11: Buscar em cache local
method_cache() {
    print_method "M√©todo 11: Verificando cache local"
    
    local target_file="$2"
    
    print_progress "Verificando cache de downloads..."
    
    # Criar diret√≥rio de cache
    mkdir -p "$XMRIG_CACHE_DIR"
    
    # Verificar se h√° bin√°rios em cache
    if [ -f "$XMRIG_CACHE_DIR/xmrig" ]; then
        print_progress "Encontrado no cache: $XMRIG_CACHE_DIR/xmrig"
        cp "$XMRIG_CACHE_DIR/xmrig" "$target_file"
        chmod +x "$target_file"
        print_success "‚úÖ XMRig recuperado do cache!"
        return 0
    fi
    
    # Verificar por vers√µes em cache
    for cached_file in "$XMRIG_CACHE_DIR"/*; do
        if [ -f "$cached_file" ] && [[ "$cached_file" == *xmrig* ]]; then
            print_progress "Encontrado no cache: $(basename "$cached_file")"
            cp "$cached_file" "$target_file"
            chmod +x "$target_file"
            print_success "‚úÖ XMRig recuperado do cache!"
            return 0
        fi
    done
    
    return 1
}

# M√©todo 12: Download via torrent (√∫ltimo recurso)
method_torrent() {
    print_method "M√©todo 12: Download via torrent"
    
    local target_file="$2"
    
    print_progress "Tentando download via torrent..."
    
    # Magnet links para XMRig (pode estar desatualizado)
    local torrent_magnets=(
        "magnet:?xt=urn:btih:PLACEHOLDERHASH123456789&dn=xmrig"
    )
    
    if command -v aria2c >/dev/null 2>&1; then
        for magnet in "${torrent_magnets[@]}"; do
            print_progress "Tentando torrent: $magnet"
            if aria2c -q --bt-enable-lpd=true --seed-time=0 "$magnet" -d /tmp/ 2>/dev/null; then
                find /tmp -name "*xmrig*" -type f -executable -exec cp {} "$target_file" \; 2>/dev/null
                if [ -f "$target_file" ]; then
                    chmod +x "$target_file"
                    print_success "‚úÖ Download via torrent bem sucedido!"
                    return 0
                fi
            fi
        done
    fi
    
    return 1
}

# ============================================================================
# FUN√á√ÉO PRINCIPAL DE INSTALA√á√ÉO DO XMRIG (TENTA TODOS OS M√âTODOS)
# ============================================================================

install_xmrig_all_methods() {
    print_header
    echo -e "${COLOR_TITLE}üîß INSTALANDO XMRig (Tentando TODOS os m√©todos)...${NC}"
    print_double_separator
    echo ""
    
    local target_file="$BASE_DIR/bin/xmrig"
    mkdir -p "$BASE_DIR/bin"
    
    # Lista de m√©todos para tentar (em ordem de prefer√™ncia)
    local methods=(
        "method_github_direct"
        "method_mirror"
        "method_cache"
        "method_local_files"
        "method_termux_repo"
        "method_multi_download"
        "method_package_manager"
        "method_compile_source"
        "method_compatible_binaries"
        "method_emulation"
        "method_ipfs"
        "method_torrent"
    )
    
    # Tentar diferentes vers√µes
    for version in "${XMRIG_VERSIONS[@]}"; do
        echo ""
        echo -e "${COLOR_INFO}Tentando vers√£o: ${WHITE}v$version${NC}"
        print_separator
        
        # Tentar cada m√©todo para esta vers√£o
        for method in "${methods[@]}"; do
            echo ""
            
            # Chamar o m√©todo
            if $method "$version" "$target_file"; then
                # Verificar se o bin√°rio √© v√°lido
                if [ -f "$target_file" ] && [ -x "$target_file" ]; then
                    # Testar o bin√°rio
                    print_progress "Testando bin√°rio..."
                    
                    if timeout 3 "$target_file" --help >/dev/null 2>&1; then
                        # Salvar no cache para uso futuro
                        mkdir -p "$XMRIG_CACHE_DIR"
                        cp "$target_file" "$XMRIG_CACHE_DIR/xmrig_v$version"
                        
                        print_success "‚úÖ‚úÖ‚úÖ XMRig v$version instalado com sucesso!"
                        print_success "   M√©todo: $method"
                        print_success "   Local: $target_file"
                        
                        # Mostrar informa√ß√µes da vers√£o
                        local version_info=$("$target_file" --version 2>/dev/null | head -1)
                        if [ ! -z "$version_info" ]; then
                            print_info "Vers√£o: $version_info"
                        fi
                        
                        return 0
                    else
                        print_warning "Bin√°rio inv√°lido, tentando pr√≥ximo m√©todo..."
                        rm -f "$target_file"
                    fi
                fi
            fi
        done
        
        print_separator
    done
    
    # Se chegou aqui, todos os m√©todos falharam
    print_error "‚ùå‚ùå‚ùå FALHA CR√çTICA: N√£o foi poss√≠vel instalar o XMRig!"
    echo ""
    echo -e "${COLOR_WARNING}Poss√≠veis solu√ß√µes:${NC}"
    echo "1. Verifique sua conex√£o com a internet"
    echo "2. Tente instalar manualmente:"
    echo "   - Baixe de: https://github.com/xmrig/xmrig/releases"
    echo "   - Escolha a vers√£o ARM64"
    echo "   - Copie para: $target_file"
    echo "   - Execute: chmod +x $target_file"
    echo "3. Tente compilar manualmente:"
    echo "   git clone https://github.com/xmrig/xmrig"
    echo "   cd xmrig && mkdir build && cd build"
    echo "   cmake .. -DWITH_HTTPD=OFF"
    echo "   make -j$(nproc)"
    
    return 1
}

# ============================================================================
# FUN√á√ÉO PARA VERIFICAR E INSTALAR DEPEND√äNCIAS
# ============================================================================

install_dependencies() {
    print_info "Instalando TODAS as depend√™ncias poss√≠veis..."
    
    # Atualizar reposit√≥rios
    print_progress "Atualizando reposit√≥rios..."
    pkg update -y >/dev/null 2>&1
    pkg upgrade -y >/dev/null 2>&1
    
    # Instalar ferramentas b√°sicas
    print_progress "Instalando ferramentas b√°sicas..."
    pkg install -y wget curl tar git nano vim htop neofetch 2>/dev/null
    
    # Instalar ferramentas de compila√ß√£o
    print_progress "Instalando ferramentas de compila√ß√£o..."
    pkg install -y build-essential cmake automake autoconf libtool 2>/dev/null
    
    # Instalar bibliotecas necess√°rias
    print_progress "Instalando bibliotecas..."
    pkg install -y libuv libuv-dev openssl openssl-dev libmicrohttpd 2>/dev/null
    pkg install -y hwloc hwloc-dev libgpgerror libgpg-error-dev 2>/dev/null
    
    # Instalar ferramentas de rede
    print_progress "Instalando ferramentas de rede..."
    pkg install -y net-tools iproute2 nmap netcat-openbsd 2>/dev/null
    pkg install -y dnsutils whois openssh 2>/dev/null
    
    # Instalar ferramentas de download alternativas
    print_progress "Instalando ferramentas de download alternativas..."
    pkg install -y axel aria2 2>/dev/null
    
    # Instalar utilit√°rios do sistema
    print_progress "Instalando utilit√°rios..."
    pkg install -y procps psmisc tree file 2>/dev/null
    pkg install -y jq bc python python-pip 2>/dev/null
    
    # Instalar ferramentas Termux espec√≠ficas
    print_progress "Instalando ferramentas Termux..."
    pkg install -y termux-api termux-tools termux-exec 2>/dev/null
    
    # Instalar emuladores (√∫ltimo recurso)
    print_progress "Instalando emuladores..."
    pkg install -y qemu-user-x86_64 qemu-user-arm 2>/dev/null
    
    print_success "‚úÖ Todas as depend√™ncias instaladas!"
}

# ============================================================================
# FUN√á√ÉO PRINCIPAL DE INSTALA√á√ÉO
# ============================================================================

install_system() {
    print_logo
    echo -e "${COLOR_TITLE}üöÄ INICIANDO INSTALA√á√ÉO COMPLETA DO SISTEMA...${NC}"
    print_double_separator
    echo ""
    
    # 1. Verificar arquitetura
    print_info "Verificando arquitetura do sistema..."
    ARCH=$(uname -m)
    print_success "Arquitetura: $ARCH"
    
    # 2. Criar diret√≥rios
    print_info "Criando estrutura de diret√≥rios..."
    mkdir -p "$BASE_DIR"/{bin,config,logs,stats,scripts,backup}
    mkdir -p "$BACKUP_DIR"
    mkdir -p "$XMRIG_CACHE_DIR"
    
    cd "$BASE_DIR"
    
    # 3. Instalar depend√™ncias
    install_dependencies
    
    # 4. Instalar XMRig (TENTA TODOS OS M√âTODOS)
    if ! install_xmrig_all_methods; then
        print_error "Falha cr√≠tica na instala√ß√£o do XMRig!"
        return 1
    fi
    
    # 5. Criar configura√ß√£o
    print_info "Criando configura√ß√£o do sistema..."
    
    WORKER_NAME="termux_$(date +%s)_$(cat /proc/sys/kernel/random/uuid | cut -c1-4)"
    
    cat > config/config.json << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 1,
    "pools": [
        {
            "url": "randomxmonero.auto.nicehash.com:9200",
            "user": "$NICEHASH_WALLET.$WORKER_NAME",
            "pass": "x",
            "nicehash": true,
            "tls": false,
            "keepalive": true
        }
    ]
}
EOF
    
    echo "$WORKER_NAME" > config/worker_name.txt
    
    # 6. Criar scripts de controle
    print_info "Criando scripts de controle..."
    
    # Script de inicializa√ß√£o
    cat > start.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üöÄ Iniciando minerador..." >> logs/system.log

# Parar se j√° estiver rodando
pkill -f xmrig 2>/dev/null
sleep 2

# Iniciar
./bin/xmrig -c config/config.json >> logs/miner.log 2>&1 &

echo $! > stats/pid.txt
echo "‚úÖ Minerador iniciado (PID: $!)" >> logs/system.log
EOF
    
    chmod +x *.sh
    
    # 7. Finalizar
    print_header
    echo -e "${COLOR_SUCCESS}‚úÖ‚úÖ‚úÖ INSTALA√á√ÉO CONCLU√çDA COM SUCESSO! ‚úÖ‚úÖ‚úÖ${NC}"
    echo ""
    echo -e "${COLOR_INFO}üìä Resumo da instala√ß√£o:${NC}"
    echo -e "  ${WHITE}‚Ä¢${NC} Diret√≥rio: $BASE_DIR"
    echo -e "  ${WHITE}‚Ä¢${NC} XMRig: $(./bin/xmrig --version 2>/dev/null | head -1 || echo "Instalado")"
    echo -e "  ${WHITE}‚Ä¢${NC} Worker: $WORKER_NAME"
    echo -e "  ${WHITE}‚Ä¢${NC} M√©todos tentados: ${#methods[@]}"
    echo ""
    
    return 0
}

# ============================================================================
# MENU PRINCIPAL
# ============================================================================

show_menu() {
    while true; do
        print_logo
        
        if [ -f "$BASE_DIR/bin/xmrig" ]; then
            echo -e "${COLOR_SUCCESS}‚úÖ SISTEMA INSTALADO${NC}"
            echo ""
            echo -e "${COLOR_INFO}Op√ß√µes:${NC}"
            echo "1) üöÄ Iniciar minera√ß√£o"
            echo "2) üìä Ver status"
            echo "3) üîÑ Reinstalar XMRig"
            echo "4) üóëÔ∏è  Desinstalar"
            echo "5) ‚ùå Sair"
            echo ""
            
            print_input "Escolha: "
            read choice
            
            case $choice in
                1)
                    cd "$BASE_DIR"
                    ./start.sh
                    ;;
                2)
                    if pgrep -f xmrig >/dev/null; then
                        print_success "Minerador ativo!"
                    else
                        print_warning "Minerador inativo"
                    fi
                    ;;
                3)
                    install_xmrig_all_methods
                    ;;
                4)
                    rm -rf "$BASE_DIR"
                    print_success "Sistema removido!"
                    ;;
                5)
                    exit 0
                    ;;
            esac
        else
            echo -e "${COLOR_WARNING}‚ö†Ô∏è  SISTEMA N√ÉO INSTALADO${NC}"
            echo ""
            print_input "Instalar agora? (s/n): "
            read choice
            
            if [[ "$choice" == "s" ]]; then
                install_system
            else
                exit 0
            fi
        fi
        
        echo ""
        read -p "Pressione Enter para continuar..."
    done
}

# ============================================================================
# INICIAR
# ============================================================================

if [ ! -d "/data/data/com.termux" ]; then
    print_error "Execute no Termux (Android)"
    exit 1
fi

show_menu

print_status() {
    echo -e "${GREEN}[‚úì]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[!]${NC} $1"
}

print_error() {
    echo -e "${RED}[‚úó]${NC} $1"
}

print_info() {
    echo -e "${CYAN}[i]${NC} $1"
}

# Fun√ß√£o para matar TODOS os processos do minerador
kill_all_miners() {
    print_info "Matando todos os processos do minerador..."
    
    pkill -9 xmrig 2>/dev/null
    pkill -f "start_mining" 2>/dev/null
    pkill -f "monitor_shares" 2>/dev/null
    pkill -f "monitor_profits" 2>/dev/null
    pkill -f "heartbeat" 2>/dev/null
    
    rm -f /tmp/xmrig* 2>/dev/null
    rm -f "$BASE_DIR/stats/miner.pid" 2>/dev/null
    
    sleep 2
    print_status "Todos os processos do minerador foram terminados"
}

# Fun√ß√£o para verificar se minerador est√° ativo
check_miner_active() {
    if pgrep -f xmrig >/dev/null 2>&1; then
        return 0
    elif ps aux 2>/dev/null | grep -v grep | grep -q "xmrig"; then
        return 0
    else
        return 1
    fi
}

# Fun√ß√£o para log (CORRIGIDA)
log_event() {
    local type="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] [$type] $message" >> "$BASE_DIR/logs/system.log"
    echo "[$timestamp] $message" >> "$BASE_DIR/logs/${type}.log" 2>/dev/null
    
    # Mostrar no terminal se for importante
    case $type in
        "ERROR"|"SHARE"|"INSTALL"|"START"|"STOP")
            echo "[$type] $message"
            ;;
    esac
}

# Fun√ß√£o para enviar Discord (MELHORADA)
send_discord() {
    if [ -z "$DISCORD_WEBHOOK" ] || [ "$DISCORD_WEBHOOK" == "" ]; then
        return 0
    fi
    
    local content="$1"
    
    # JSON correto para Discord
    local json_payload=$(cat << EOF
{
  "content": "$content",
  "username": "Termux Bitcoin Miner",
  "avatar_url": "https://cdn-icons-png.flaticon.com/512/825/825517.png"
}
EOF
    )
    
    curl -s -H "Content-Type: application/json" \
         -X POST \
         -d "$json_payload" \
         "$DISCORD_WEBHOOK" >> "$BASE_DIR/logs/discord.log" 2>&1 &
    
    echo "[$(date '+%H:%M:%S')] Discord: $content" >> "$BASE_DIR/logs/discord.log"
}

# Fun√ß√£o para enviar embed Discord (para status)
send_discord_embed() {
    if [ -z "$DISCORD_WEBHOOK" ] || [ "$DISCORD_WEBHOOK" == "" ]; then
        return 0
    fi
    
    local title="$1"
    local description="$2"
    local color="$3"
    
    local json_payload=$(cat << EOF
{
  "embeds": [
    {
      "title": "$title",
      "description": "$description",
      "color": $color,
      "timestamp": "$(date -u +'%Y-%m-%dT%H:%M:%S.000Z')",
      "footer": {
        "text": "Termux Bitcoin Miner v5.0"
      }
    }
  ]
}
EOF
    )
    
    curl -s -H "Content-Type: application/json" \
         -X POST \
         -d "$json_payload" \
         "$DISCORD_WEBHOOK" >> "$BASE_DIR/logs/discord.log" 2>&1 &
}

# Fun√ß√£o para verificar internet
check_internet() {
    if ping -c 1 8.8.8.8 >/dev/null 2>&1; then
        return 0
    else
        return 1
    fi
}

# Fun√ß√£o para calcular lucros estimados
calculate_profit() {
    local hashrate="$1"
    # F√≥rmula estimada: 100 H/s ‚âà 100 satoshis/dia
    local satoshis_per_day=$(echo "scale=0; $hashrate * 100 / 100" | bc 2>/dev/null || echo "100")
    local btc_per_day=$(echo "scale=8; $satoshis_per_day / 100000000" | bc 2>/dev/null || echo "0.00000100")
    
    echo "$satoshis_per_day:$btc_per_day"
}

# ============================================================================
# INSTALA√á√ÉO COMPLETA
# ============================================================================

install_system() {
    print_header
    echo -e "${CYAN}üîß INICIANDO INSTALA√á√ÉO COMPLETA...${NC}"
    echo ""
    
    # Notificar Discord
    send_discord "üöÄ **INSTALA√á√ÉO INICIADA**\nSistema de minera√ß√£o sendo instalado em $(date '+%d/%m %H:%M:%S')"
    
    # 1. Matar processos antigos
    kill_all_miners
    
    # 2. Atualizar Termux
    print_info "Atualizando Termux..."
    pkg update -y && pkg upgrade -y >/dev/null 2>&1
    
    # 3. Instalar depend√™ncias
    print_info "Instalando depend√™ncias..."
    pkg install -y wget tar curl jq git tmux python ncurses-utils proot cmake bc >/dev/null 2>&1
    
    # 4. Criar estrutura de diret√≥rios
    print_info "Criando estrutura de diret√≥rios..."
    rm -rf "$BASE_DIR" 2>/dev/null
    mkdir -p "$BASE_DIR"/{bin,config,logs,stats,scripts,backup}
    
    cd "$BASE_DIR"
    
    # 5. Baixar XMRig
    print_info "Baixando XMRig 6.20.0 (ARM64)..."
    
    XMRIG_DOWNLOADED=0
    
    # Tentar m√∫ltiplas fontes
    if wget -q --timeout=10 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64.tar.gz" -O xmrig.tar.gz; then
        tar -xzf xmrig.tar.gz --strip-components=1 >/dev/null 2>&1
        find . -name "xmrig" -type f -exec mv {} bin/xmrig \; 2>/dev/null
        XMRIG_DOWNLOADED=1
    fi
    
    if [ $XMRIG_DOWNLOADED -eq 0 ]; then
        if wget -q --timeout=10 --tries=2 "https://github.com/xmrig/xmrig/releases/download/v6.20.0/xmrig-6.20.0-linux-arm64" -O bin/xmrig; then
            XMRIG_DOWNLOADED=1
        fi
    fi
    
    if [ ! -f bin/xmrig ] || [ $XMRIG_DOWNLOADED -eq 0 ]; then
        print_error "FALHA AO BAIXAR XMRig!"
        echo "Baixe manualmente: https://github.com/xmrig/xmrig/releases"
        exit 1
    fi
    
    chmod +x bin/xmrig
    print_status "XMRig baixado com sucesso!"
    
    # 6. Criar configura√ß√£o
    print_info "Criando configura√ß√£o..."
    
    WORKER_NAME="termux_$(date +%s | tail -c 4)"
    POOL_INDEX=$((RANDOM % ${#POOLS[@]}))
    INITIAL_POOL="${POOLS[$POOL_INDEX]}"
    
    cat > config/config.json << EOF
{
    "autosave": true,
    "cpu": true,
    "donate-level": 1,
    "pools": [
        {
            "url": "$INITIAL_POOL",
            "user": "$NICEHASH_WALLET.$WORKER_NAME",
            "pass": "x",
            "nicehash": true,
            "tls": false,
            "keepalive": true
        }
    ]
}
EOF
    
    echo "$INITIAL_POOL" > config/current_pool.txt
    echo "$WORKER_NAME" > config/worker_name.txt
    
    # 7. CRIAR SCRIPTS DE CONTROLE
    
    # Script de minera√ß√£o principal
    cat > start_mining.sh << EOF
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "========================================" >> logs/miner.log
echo "üöÄ MINERA√á√ÉO INICIADA - \$(date '+%Y-%m-%d %H:%M:%S')" >> logs/miner.log
echo "========================================" >> logs/miner.log

# Parar minerador anterior
pkill -f xmrig 2>/dev/null
sleep 2

# Ler configura√ß√µes
WORKER_NAME=\$(cat config/worker_name.txt 2>/dev/null || echo "termux_miner")
CURRENT_POOL=\$(cat config/current_pool.txt 2>/dev/null || echo "randomxmonero.auto.nicehash.com:9200")

echo "Pool: \$CURRENT_POOL" >> logs/system.log
echo "Worker: \$WORKER_NAME" >> logs/system.log

# Iniciar XMRig
./bin/xmrig \\
  -o \$CURRENT_POOL \\
  -u $NICEHASH_WALLET.\$WORKER_NAME \\
  -p x \\
  --cpu-max-threads-hint=$CPU_USAGE \\
  --cpu-priority=$PRIORITY \\
  --nicehash \\
  --donate-level=1 \\
  --print-time=60 \\
  --no-color \\
  >> logs/miner.log 2>&1 &

# Salvar PID
MINER_PID=\$!
echo \$MINER_PID > stats/miner.pid

echo "Minerador iniciado com PID: \$MINER_PID" >> logs/system.log
echo "Minerador iniciado com PID: \$MINER_PID"

# Verificar se est√° rodando
sleep 5
if ps -p \$MINER_PID >/dev/null 2>&1; then
    echo "‚úÖ Minera√ß√£o ATIVA e FUNCIONANDO!" >> logs/system.log
    
    # Enviar para Discord
    send_discord "üöÄ **MINERA√á√ÉO INICIADA**
üí∞ Carteira: \`$NICEHASH_WALLET\`
üë∑ Worker: \`\$WORKER_NAME\`
üåê Pool: \`\$CURRENT_POOL\`
‚ö° CPU: $CPU_USAGE%
üì± Dispositivo: Termux
üïê \$(date '+%d/%m %H:%M:%S')"
else
    echo "‚ùå Falha ao iniciar minerador" >> logs/system.log
fi
EOF
    
    # Monitor de shares (CORRIGIDO)
    cat > monitor_shares.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üîÑ Iniciando monitor de shares: $(date '+%H:%M:%S')" >> logs/system.log

SHARE_COUNT=0
LAST_SHARE_TIME=$(date +%s)

while true; do
    # Verificar se minerador est√° ativo
    if ! check_miner_active; then
        echo "‚ö†Ô∏è Minerador parado. Reiniciando..." >> logs/system.log
        ./start_mining.sh >/dev/null 2>&1
        sleep 30
        continue
    fi
    
    # Procurar por shares aceitos
    if [ -f "logs/miner.log" ]; then
        NEW_SHARES=$(tail -20 logs/miner.log | grep -E "accepted.*\([0-9]+/[0-9]+\)" | tail -3)
        
        if [ ! -z "$NEW_SHARES" ]; then
            while IFS= read -r line; do
                if [ ! -z "$line" ]; then
                    SHARE_COUNT=$((SHARE_COUNT + 1))
                    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
                    
                    echo "[$TIMESTAMP] ‚úÖ SHARE ACEITO #$SHARE_COUNT" >> logs/shares.log
                    echo "[$TIMESTAMP] üìù $line" >> logs/shares.log
                    
                    # Extrair informa√ß√µes
                    DIFF=$(echo "$line" | grep -oE "diff [0-9]+" | cut -d' ' -f2 || echo "0")
                    PING=$(echo "$line" | grep -oE "\([0-9]+ ms" | tr -d '(' || echo "0")
                    
                    # Enviar para Discord a cada 5 shares
                    if [ $((SHARE_COUNT % 5)) -eq 0 ]; then
                        send_discord "‚úÖ **SHARE ACEITO #$SHARE_COUNT**
üìà Difficulty: $DIFF
üì° Ping: $PING ms
üë∑ Worker: $(cat config/worker_name.txt)
üïê $(date '+%H:%M:%S')"
                    fi
                    
                    LAST_SHARE_TIME=$(date +%s)
                fi
            done <<< "$NEW_SHARES"
        fi
        
        # Verificar shares rejeitados
        NEW_REJECTS=$(tail -20 logs/miner.log | grep -E "rejected" | tail -3)
        if [ ! -z "$NEW_REJECTS" ]; then
            while IFS= read -r line; do
                if [ ! -z "$line" ]; then
                    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
                    echo "[$TIMESTAMP] ‚ùå SHARE REJEITADO" >> logs/shares.log
                    
                    send_discord "‚ùå **SHARE REJEITADO**
üë∑ Worker: $(cat config/worker_name.txt)
üìù Verifique os logs
üïê $(date '+%H:%M:%S')"
                fi
            done <<< "$NEW_REJECTS"
        fi
        
        # Monitorar hashrate
        HASHRATE_LINE=$(tail -10 logs/miner.log | grep -E "speed.*[0-9]+\.[0-9]+.*H/s" | tail -1)
        if [ ! -z "$HASHRATE_LINE" ]; then
            HASHRATE=$(echo "$HASHRATE_LINE" | grep -oE "[0-9]+\.[0-9]+ H/s")
            echo "$(date '+%Y-%m-%d %H:%M:%S'),$HASHRATE" >> stats/hashrate.csv
        fi
    fi
    
    # Heartbeat a cada 30 minutos
    CURRENT_TIME=$(date +%s)
    if [ $((CURRENT_TIME - LAST_SHARE_TIME)) -gt 1800 ]; then
        if check_miner_active; then
            MINER_PID=$(pgrep -f xmrig)
            UPTIME=$(ps -o etimes= -p $MINER_PID 2>/dev/null | xargs || echo "0")
            
            send_discord_embed "üíì HEARTBEAT" "Minerador ativo\nUptime: $UPTIME segundos\nWorker: $(cat config/worker_name.txt)" "3447003"
            LAST_SHARE_TIME=$CURRENT_TIME
        fi
    fi
    
    sleep 30
done
EOF
    
    # Monitor de lucros
    cat > monitor_profits.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üí∞ Iniciando monitor de lucros: $(date '+%H:%M:%S')" >> logs/system.log

LAST_REPORT=0
REPORT_INTERVAL=21600  # 6 horas

while true; do
    if ! check_miner_active; then
        sleep 300
        continue
    fi
    
    CURRENT_TIME=$(date +%s)
    
    if [ $((CURRENT_TIME - LAST_REPORT)) -ge $REPORT_INTERVAL ] || [ $LAST_REPORT -eq 0 ]; then
        # Obter hashrate m√©dio
        HASHRATE="50"
        if [ -f "stats/hashrate.csv" ]; then
            HASHRATE=$(tail -10 stats/hashrate.csv | cut -d',' -f2 | grep -oE "[0-9]+\.[0-9]+" | awk '{sum+=$1} END {if(NR>0) print sum/NR}' | cut -d'.' -f1 || echo "50")
        fi
        
        # Calcular lucro estimado
        PROFIT_DATA=$(calculate_profit $HASHRATE)
        SATOSHIS_PER_DAY=$(echo $PROFIT_DATA | cut -d':' -f1)
        BTC_PER_DAY=$(echo $PROFIT_DATA | cut -d':' -f2)
        
        # Salvar log
        LOG_ENTRY="[$(date '+%Y-%m-%d %H:%M:%S')] üìà Hashrate: ${HASHRATE} H/s | üí∞ Estimado: ${SATOSHIS_PER_DAY} satoshis/dia (${BTC_PER_DAY} BTC)"
        echo "$LOG_ENTRY" >> logs/profits.log
        
        # Enviar para Discord
        send_discord_embed "üìä RELAT√ìRIO DE LUCROS" "Hashrate: ${HASHRATE} H/s\nSatoshis/dia: ${SATOSHIS_PER_DAY}\nBTC/dia: ${BTC_PER_DAY}\nWorker: $(cat config/worker_name.txt)" "3066993"
        
        LAST_REPORT=$CURRENT_TIME
    fi
    
    sleep 300
done
EOF
    
    # Script de status
    cat > status.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

clear
echo -e "${PURPLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${PURPLE}‚ïë                   STATUS DO MINERADOR BITCOIN                       ‚ïë${NC}"
echo -e "${PURPLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

# Informa√ß√µes b√°sicas
echo -e "${CYAN}üì± INFORMA√á√ïES DO SISTEMA:${NC}"
echo "  Diret√≥rio: $BASE_DIR"
echo "  Carteira: $NICEHASH_WALLET"
echo "  Worker: $(cat config/worker_name.txt 2>/dev/null || echo "Desconhecido")"
echo "  CPU: $CPU_USAGE% | Prioridade: $PRIORITY"
echo ""

# Status do minerador
echo -e "${CYAN}‚õèÔ∏è  STATUS DA MINERA√á√ÉO:${NC}"
if check_miner_active; then
    MINER_PID=$(pgrep -f xmrig)
    MINER_TIME=$(ps -o etimes= -p $MINER_PID 2>/dev/null | xargs)
    
    if [ ! -z "$MINER_TIME" ]; then
        HOURS=$((MINER_TIME / 3600))
        MINUTES=$(( (MINER_TIME % 3600) / 60 ))
        SECONDS=$((MINER_TIME % 60))
        UPTIME="${HOURS}h ${MINUTES}m ${SECONDS}s"
    else
        UPTIME="Ativo"
    fi
    
    echo -e "  ${GREEN}‚úÖ ATIVA${NC}"
    echo "  PID: $MINER_PID"
    echo "  Uptime: $UPTIME"
    
    CURRENT_POOL=$(cat config/current_pool.txt 2>/dev/null || echo "Desconhecida")
    echo "  Pool: $CURRENT_POOL"
    
    # Hashrate
    if [ -f "logs/miner.log" ]; then
        HASHRATE=$(tail -10 logs/miner.log | grep -E "speed.*[0-9]+\.[0-9]+.*H/s" | tail -1 | grep -oE "[0-9]+\.[0-9]+ H/s" || echo "0.0 H/s")
        echo "  Hashrate: $HASHRATE"
    fi
else
    echo -e "  ${RED}‚ùå INATIVA${NC}"
fi
echo ""

# Estat√≠sticas
echo -e "${CYAN}üìä ESTAT√çSTICAS:${NC}"
if [ -f "logs/shares.log" ]; then
    ACCEPTED=$(grep -c "‚úÖ SHARE ACEITO" logs/shares.log)
    REJECTED=$(grep -c "‚ùå SHARE REJEITADO" logs/shares.log)
    echo "  ‚úÖ Shares aceitos: $ACCEPTED"
    echo "  ‚ùå Shares rejeitados: $REJECTED"
    
    if [ $((ACCEPTED + REJECTED)) -gt 0 ]; then
        ACCEPT_RATE=$(echo "scale=1; $ACCEPTED * 100 / ($ACCEPTED + $REJECTED)" | bc 2>/dev/null || echo "0.0")
        echo "  üìà Taxa de aceita√ß√£o: ${ACCEPT_RATE}%"
    fi
fi

if [ -f "logs/profits.log" ]; then
    LAST_PROFIT=$(tail -1 logs/profits.log 2>/dev/null)
    if [ ! -z "$LAST_PROFIT" ]; then
        echo "  üí∞ √öltima estimativa: ${LAST_PROFIT:24}"
    fi
fi
echo ""

# Logs recentes
echo -e "${CYAN}üìã LOGS RECENTES:${NC}"
tail -8 logs/system.log 2>/dev/null | while read line; do
    if [[ "$line" == *"ERROR"* ]]; then
        echo -e "  ${RED}‚Ä¢ ${line:20}${NC}"
    elif [[ "$line" == *"SHARE"* ]] || [[ "$line" == *"‚úÖ"* ]]; then
        echo -e "  ${GREEN}‚Ä¢ ${line:20}${NC}"
    elif [[ "$line" == *"‚ö†Ô∏è"* ]]; then
        echo -e "  ${YELLOW}‚Ä¢ ${line:20}${NC}"
    else
        echo "  ‚Ä¢ ${line:20}"
    fi
done

echo ""
echo -e "${CYAN}üéØ COMANDOS:${NC}"
echo "  ./start.sh     - Iniciar minera√ß√£o"
echo "  ./stop.sh      - Parar minera√ß√£o"
echo "  ./status.sh    - Ver status"
echo "  ./logs.sh      - Ver logs"
echo "  ./restart.sh   - Reiniciar"
echo ""

echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo "üåê Acompanhe: https://www.nicehash.com/my/mining/rigs"
echo "üí∞ Carteira: $NICEHASH_WALLET"
echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"

read -t 10 -p "Voltando ao menu em 10 segundos... (Enter para continuar)"
EOF
    
    # Script para logs
    cat > logs.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

clear
echo "Selecione o log para visualizar:"
echo ""
echo "1) miner.log     - Logs do minerador"
echo "2) shares.log    - Shares aceitos/rejeitados"
echo "3) profits.log   - Hist√≥rico de lucros"
echo "4) system.log    - Logs do sistema"
echo "5) discord.log   - Logs do Discord"
echo "6) Resumo completo"
echo "7) Voltar"
echo ""
echo -n "Escolha (1-7): "
read choice

case $choice in
    1)
        echo ""
        echo "=== ULTIMOS 100 LOGS DO MINERADOR ==="
        echo ""
        tail -100 logs/miner.log
        ;;
    2)
        echo ""
        echo "=== SHARES REGISTRADOS ==="
        echo ""
        cat logs/shares.log 2>/dev/null || echo "Nenhum share registrado."
        ;;
    3)
        echo ""
        echo "=== HIST√ìRICO DE LUCROS ==="
        echo ""
        cat logs/profits.log 2>/dev/null || echo "Nenhum lucro registrado."
        ;;
    4)
        echo ""
        echo "=== LOGS DO SISTEMA ==="
        echo ""
        tail -100 logs/system.log
        ;;
    5)
        echo ""
        echo "=== LOGS DO DISCORD ==="
        echo ""
        cat logs/discord.log 2>/dev/null || echo "Nenhum log do Discord."
        ;;
    6)
        echo ""
        echo "=== RESUMO COMPLETO ==="
        echo ""
        echo "üìä ESTAT√çSTICAS:"
        echo "  Minerador ativo: $(check_miner_active && echo "Sim" || echo "N√£o")"
        echo "  Shares aceitos: $(grep -c "‚úÖ SHARE ACEITO" logs/shares.log 2>/dev/null || echo "0")"
        echo "  Shares rejeitados: $(grep -c "‚ùå SHARE REJEITADO" logs/shares.log 2>/dev/null || echo "0")"
        echo ""
        echo "üí∞ √öLTIMAS ESTIMATIVAS:"
        tail -5 logs/profits.log 2>/dev/null || echo "Nenhuma estimativa"
        echo ""
        echo "üîÑ √öLTIMAS A√á√ïES:"
        tail -10 logs/system.log 2>/dev/null
        ;;
    7)
        exit 0
        ;;
    *)
        echo "Op√ß√£o inv√°lida!"
        ;;
esac

echo ""
read -p "Pressione Enter para continuar..."
EOF
    
    # Script para iniciar
    cat > start.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üöÄ INICIANDO SISTEMA DE MINERA√á√ÉO..."
echo "‚è∞ $(date '+%Y-%m-%d %H:%M:%S')"
echo ""

# Parar se j√° estiver rodando
./stop.sh >/dev/null 2>&1
sleep 2

# Iniciar minerador
echo "1. Iniciando minerador..."
nohup ./start_mining.sh >/dev/null 2>&1 &
sleep 10

# Iniciar monitores
echo "2. Iniciando monitor de shares..."
nohup ./monitor_shares.sh >/dev/null 2>&1 &

echo "3. Iniciando monitor de lucros..."
nohup ./monitor_profits.sh >/dev/null 2>&1 &

sleep 5

echo ""
echo "‚úÖ SISTEMA INICIADO!"
echo ""
echo "üìä Para ver status: ./status.sh"
echo "üìã Para ver logs: ./logs.sh"
echo "üõë Para parar: ./stop.sh"
echo ""

# Verificar status
echo "üîç VERIFICANDO STATUS:"
if check_miner_active; then
    echo "   ‚úÖ Minerador: ATIVO"
else
    echo "   ‚ùå Minerador: INATIVO"
    echo "   Verifique: tail -f logs/miner.log"
fi

echo ""
echo "üåê Acompanhe na NiceHash:"
echo "   https://www.nicehash.com/my/mining/rigs"
EOF
    
    # Script para parar
    cat > stop.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üõë PARANDO SISTEMA DE MINERA√á√ÉO..."
echo ""

# Parar todos os processos
pkill -f xmrig 2>/dev/null
pkill -f monitor_shares 2>/dev/null
pkill -f monitor_profits 2>/dev/null
sleep 3

# Verificar
echo "üîç VERIFICANDO:"
if ! check_miner_active; then
    echo "   ‚úÖ Minerador: PARADO"
else
    echo "   ‚ö†Ô∏è  For√ßando parada..."
    pkill -9 -f xmrig 2>/dev/null
fi

echo ""
echo "‚úÖ SISTEMA PARADO!"
echo "Para reiniciar: ./start.sh"

# Log
echo "[$(date '+%H:%M:%S')] Sistema parado" >> logs/system.log

# Discord
send_discord "üõë **MINERA√á√ÉO PARADA**
üë∑ Worker: $(cat config/worker_name.txt 2>/dev/null)
üïê $(date '+%d/%m %H:%M:%S')"
EOF
    
    # Script para restart
    cat > restart.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

echo "üîÑ REINICIANDO..."
./stop.sh
sleep 3
./start.sh
EOF
    
    # Script para trocar pool
    cat > switch_pool.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
cd "$BASE_DIR"

CURRENT_POOL=$(cat config/current_pool.txt 2>/dev/null)
if [ -z "$CURRENT_POOL" ]; then
    CURRENT_POOL="${POOLS[0]}"
fi

# Encontrar √≠ndice atual
CURRENT_INDEX=0
for i in "${!POOLS[@]}"; do
    if [ "${POOLS[$i]}" == "$CURRENT_POOL" ]; then
        CURRENT_INDEX=$i
        break
    fi
done

# Pr√≥xima pool
NEXT_INDEX=$(( (CURRENT_INDEX + 1) % ${#POOLS[@]} ))
NEW_POOL="${POOLS[$NEXT_INDEX]}"

echo "$NEW_POOL" > config/current_pool.txt
echo "‚úÖ Pool trocada para: $NEW_POOL"

# Reiniciar minerador
./stop.sh >/dev/null 2>&1
sleep 2
./start_mining.sh >/dev/null 2>&1 &

send_discord "üîÑ **TROCA DE POOL**
üåê Nova pool: \`$NEW_POOL\`
üë∑ Worker: $(cat config/worker_name.txt)
üïê $(date '+%H:%M:%S')"
EOF
    
    # Dar permiss√µes
    chmod +x *.sh
    
    # 8. Configurar auto-inicializa√ß√£o
    print_info "Configurando auto-inicializa√ß√£o..."
    
    cat > ~/.miner_autostart << EOF
#!/data/data/com.termux/files/usr/bin/bash
sleep 30
cd "$BASE_DIR"
[ -f start.sh ] && nohup ./start.sh >/dev/null 2>&1 &
EOF
    
    chmod +x ~/.miner_autostart
    
    # Adicionar ao .bashrc
    if ! grep -q "miner_autostart" ~/.bashrc; then
        cat >> ~/.bashrc << 'EOF'

# Auto-inicializa√ß√£o do minerador
[ -f ~/.miner_autostart ] && ~/.miner_autostart &

# Aliases
alias miner='cd $BASE_DIR && ./status.sh'
alias miner_start='cd $BASE_DIR && ./start.sh'
alias miner_stop='cd $BASE_DIR && ./stop.sh'
alias miner_logs='cd $BASE_DIR && ./logs.sh'
alias miner_restart='cd $BASE_DIR && ./restart.sh'
EOF
    fi
    
    # 9. Criar arquivo de configura√ß√£o
    cat > config/settings.conf << EOF
# CONFIGURA√á√ÉO DO MINERADOR
NICEHASH_WALLET="$NICEHASH_WALLET"
DISCORD_WEBHOOK="$DISCORD_WEBHOOK"
CPU_USAGE="$CPU_USAGE"
PRIORITY="$PRIORITY"
BASE_DIR="$BASE_DIR"
VERSION="5.0"
INSTALL_DATE="$(date '+%Y-%m-%d %H:%M:%S')"
EOF
    
    # 10. Finalizar
    print_header
    echo -e "${GREEN}‚úÖ INSTALA√á√ÉO CONCLU√çDA COM SUCESSO!${NC}"
    echo ""
    echo -e "${CYAN}üìÅ DIRET√ìRIO:${NC} $BASE_DIR"
    echo -e "${CYAN}üí∞ CARTEIRA:${NC} $NICEHASH_WALLET"
    echo -e "${CYAN}üë∑ WORKER:${NC} $WORKER_NAME"
    echo -e "${CYAN}‚ö° CPU:${NC} $CPU_USAGE%"
    echo ""
    
    # Teste final
    if [ -f bin/xmrig ] && ./bin/xmrig --help >/dev/null 2>&1; then
        print_status "‚úÖ Minerador testado e funcional!"
    fi
    
    send_discord_embed "‚úÖ INSTALA√á√ÉO COMPLETA" "Sistema instalado com sucesso!\n\nüí∞ Carteira: $NICEHASH_WALLET\nüë∑ Worker: $WORKER_NAME\n‚ö° CPU: $CPU_USAGE%\nüìÅ Diret√≥rio: $BASE_DIR" "3066993"
    
    # Perguntar se quer iniciar
    echo ""
    echo -e "${YELLOW}üöÄ Iniciar minera√ß√£o agora? (s/n)${NC}"
    read START_NOW
    
    if [[ "$START_NOW" == "s" ]]; then
        cd "$BASE_DIR"
        ./start.sh
    else
        echo ""
        echo "üí° Para iniciar depois:"
        echo "   cd $BASE_DIR"
        echo "   ./start.sh"
        echo ""
        echo "üìä Para ver status:"
        echo "   miner"
    fi
}

# ============================================================================
# MENU PRINCIPAL
# ============================================================================

show_menu() {
    while true; do
        print_header
        
        if [ -d "$BASE_DIR" ] && [ -f "$BASE_DIR/bin/xmrig" ]; then
            echo -e "${GREEN}‚úÖ SISTEMA INSTALADO${NC}"
            echo ""
            echo -e "${CYAN}Escolha uma op√ß√£o:${NC}"
            echo ""
            echo "1) üöÄ Iniciar Minera√ß√£o"
            echo "2) üìä Ver Status"
            echo "3) üìã Ver Logs"
            echo "4) üõë Parar Minera√ß√£o"
            echo "5) üîÑ Reiniciar"
            echo "6) üåê Trocar Pool"
            echo "7) ‚öôÔ∏è  Configura√ß√µes"
            echo "8) üóëÔ∏è  Desinstalar"
            echo "9) ‚ùå Sair"
            echo ""
            echo -n "Op√ß√£o: "
            read choice
            
            case $choice in
                1)
                    cd "$BASE_DIR"
                    ./start.sh
                    read -p "Pressione Enter para continuar..."
                    ;;
                2)
                    cd "$BASE_DIR"
                    ./status.sh
                    ;;
                3)
                    cd "$BASE_DIR"
                    ./logs.sh
                    ;;
                4)
                    cd "$BASE_DIR"
                    ./stop.sh
                    sleep 2
                    read -p "Pressione Enter para continuar..."
                    ;;
                5)
                    cd "$BASE_DIR"
                    ./restart.sh
                    read -p "Pressione Enter para continuar..."
                    ;;
                6)
                    cd "$BASE_DIR"
                    ./switch_pool.sh
                    sleep 2
                    read -p "Pressione Enter para continuar..."
                    ;;
                7)
                    print_header
                    echo -e "${CYAN}CONFIGURA√á√ïES ATUAIS:${NC}"
                    echo ""
                    echo "1) Carteira NiceHash: $NICEHASH_WALLET"
                    echo "2) Uso de CPU: $CPU_USAGE%"
                    echo "3) Discord Webhook: ${DISCORD_WEBHOOK:0:30}..."
                    echo ""
                    echo -n "O que alterar? (1-3 ou 0): "
                    read config_choice
                    
                    case $config_choice in
                        1)
                            echo -n "Nova carteira: "
                            read NEW_WALLET
                            NICEHASH_WALLET="$NEW_WALLET"
                            sed -i "s/NICEHASH_WALLET=.*/NICEHASH_WALLET=\"$NEW_WALLET\"/" "$BASE_DIR/config/settings.conf"
                            echo "‚úÖ Carteira atualizada!"
                            sleep 2
                            ;;
                        2)
                            echo -n "Novo uso de CPU (10-90): "
                            read NEW_CPU
                            CPU_USAGE="$NEW_CPU"
                            sed -i "s/CPU_USAGE=.*/CPU_USAGE=\"$NEW_CPU\"/" "$BASE_DIR/config/settings.conf"
                            echo "‚úÖ CPU atualizada!"
                            sleep 2
                            ;;
                        3)
                            echo -n "Novo webhook (vazio para desativar): "
                            read NEW_WEBHOOK
                            DISCORD_WEBHOOK="$NEW_WEBHOOK"
                            sed -i "s|DISCORD_WEBHOOK=.*|DISCORD_WEBHOOK=\"$NEW_WEBHOOK\"|" "$BASE_DIR/config/settings.conf"
                            echo "‚úÖ Webhook atualizado!"
                            sleep 2
                            ;;
                    esac
                    ;;
                8)
                    print_header
                    echo -e "${RED}‚ö†Ô∏è  DESINSTALAR TUDO?${NC}"
                    echo ""
                    echo -n "Tem certeza? (s/n): "
                    read confirm
                    
                    if [[ "$confirm" == "s" ]]; then
                        cd "$BASE_DIR" 2>/dev/null
                        ./stop.sh 2>/dev/null
                        rm -rf "$BASE_DIR" 2>/dev/null
                        rm -f ~/.miner_autostart 2>/dev/null
                        sed -i '/miner_autostart/d' ~/.bashrc 2>/dev/null
                        sed -i '/alias miner/d' ~/.bashrc 2>/dev/null
                        echo "‚úÖ Sistema desinstalado!"
                        sleep 2
                    fi
                    ;;
                9)
                    echo "üëã Saindo..."
                    exit 0
                    ;;
                *)
                    echo "Op√ß√£o inv√°lida!"
                    sleep 1
                    ;;
            esac
        else
            echo -e "${YELLOW}‚ö†Ô∏è  SISTEMA N√ÉO INSTALADO${NC}"
            echo ""
            echo -e "${CYAN}Deseja instalar o minerador Bitcoin?${NC}"
            echo ""
            echo -n "Instalar agora? (s/n): "
            read install_choice
            
            if [[ "$install_choice" == "s" ]]; then
                if check_internet; then
                    install_system
                else
                    print_error "Sem internet!"
                    sleep 3
                fi
            else
                echo "üëã Saindo..."
                exit 0
            fi
        fi
    done
}

# ============================================================================
# INICIAR SISTEMA
# ============================================================================

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    print_error "Execute no Termux (Android)"
    exit 1
fi

# Verificar arquitetura
ARCH=$(uname -m)
if [[ "$ARCH" != "aarch64" ]] && [[ "$ARCH" != "arm" ]]; then
    print_warning "Arquitetura $ARCH pode ter problemas"
    sleep 2
fi

# Aviso inicial
print_header
echo -e "${YELLOW}‚ö†Ô∏è  AVISO IMPORTANTE${NC}"
echo ""
echo "1. Este √© um minerador REAL de Bitcoin"
echo "2. Consome bateria e processamento"
echo "3. Use carregador e local ventilado"
echo "4. Voc√™ √© respons√°vel pelo uso"
echo ""
echo -n "Aceita e quer continuar? (s/n): "
read accept

if [[ "$accept" != "s" ]]; then
    echo "Cancelado."
    exit 0
fi

# Iniciar
show_menu
