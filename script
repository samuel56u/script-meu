#!/data/data/com.termux/files/usr/bin/bash

# =============================================================================
# ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
# ‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
# ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
# ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù
# =============================================================================
# MINERA√á√ÉO BITCOIN PARA TERMUX - MEGALODON SPIDEY GOD EDITION v66.0.0
# =============================================================================
# ‚úÖ CORRE√á√ÉO: POOLS FUNCIONAIS E TESTADAS
# ‚úÖ TIMEOUT REDUZIDO PARA 10 SEGUNDOS
# ‚úÖ M√öLTIPLOS FALLBACKS AUTOM√ÅTICOS
# =============================================================================

# =============================================================================
# CONFIGURA√á√ïES PRINCIPAIS
# =============================================================================
NICEHASH_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"

# =============================================================================
# POOLS TESTADAS E FUNCIONAIS (COM M√öLTIPLAS OP√á√ïES)
# =============================================================================
declare -A POOLS=(
    # NiceHash - Portas alternativas (funcionam melhor)
    ["NiceHash EU 3333"]="stratum+tcp://sha256.eu.nicehash.com:3333"
    ["NiceHash EU 3334"]="stratum+tcp://sha256.eu.nicehash.com:3334"
    ["NiceHash EU 3335"]="stratum+tcp://sha256.eu.nicehash.com:3335"
    ["NiceHash USA 3333"]="stratum+tcp://sha256.usa.nicehash.com:3333"
    ["NiceHash USA 3334"]="stratum+tcp://sha256.usa.nicehash.com:3334"
    ["NiceHash USA 3335"]="stratum+tcp://sha256.usa.nicehash.com:3335"
    ["NiceHash Auto"]="stratum+tcp://sha256.auto.nicehash.com:9200"
    
    # Pools de Bitcoin diretas (mais est√°veis)
    ["ViaBTC"]="stratum+tcp://btc.viabtc.com:3333"
    ["ViaBTC SSL"]="stratum+ssl://btc.viabtc.com:443"
    ["F2Pool"]="stratum+tcp://btc.f2pool.com:3333"
    ["F2Pool SSL"]="stratum+ssl://btc.f2pool.com:443"
    ["AntPool"]="stratum+tcp://pool.antpool.com:3333"
    ["AntPool SSL"]="stratum+ssl://pool.antpool.com:443"
    ["BTC.com"]="stratum+tcp://pool.btc.com:3333"
    ["BTC.com SSL"]="stratum+ssl://pool.btc.com:443"
    ["Poolin"]="stratum+tcp://btc.poolin.com:443"
    
    # Pools de backup (sempre funcionam)
    ["Solo US"]="stratum+tcp://us.solomining.io:7777"
    ["Solo EU"]="stratum+tcp://eu.solomining.io:7777"
    ["Solo Asia"]="stratum+tcp://asia.solomining.io:7777"
    
    # Pools alternativas
    ["EMCD"]="stratum+tcp://pool.emcd.io:3333"
    ["SpiderPool"]="stratum+tcp://spiderpool.com:3333"
    ["ZergPool"]="stratum+tcp://mine.zergpool.com:3333"
)

# =============================================================================
# VERS√ÉO
# =============================================================================
VERSION="66.0.0"
BUILD_ID="20260214_$(date +%H%M%S)"
SCRIPT_NAME="NiceHash Miner God"

# =============================================================================
# DIRET√ìRIOS
# =============================================================================
MINER_HOME="$HOME/.miner_megalodon_god"
LOG_DIR="$MINER_HOME/logs"
BIN_DIR="$MINER_HOME/bin"
TEMP_DIR="$MINER_HOME/temp"

# =============================================================================
# ESTAT√çSTICAS
# =============================================================================
TOTAL_SHARES=0
TOTAL_REJECTED=0
START_TIME=$(date +%s)

# =============================================================================
# CORES
# =============================================================================
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'
BOLD='\033[1m'

# =============================================================================
# FUN√á√ÉO DE LOG
# =============================================================================
god_log() {
    local timestamp=$(date '+%H:%M:%S')
    local log_level="$1"
    local category="$2"
    local message="$3"
    
    mkdir -p "$LOG_DIR"
    echo "[$timestamp] [$log_level] [$category] $message" >> "$LOG_DIR/complete.log"
    
    case $log_level in
        "GOD")   echo -e "${PURPLE}[$timestamp] [$log_level] [$category] $message${NC}" ;;
        "INFO")  echo -e "${CYAN}[$timestamp] [INFO] $message${NC}" ;;
        "OK")    echo -e "${GREEN}[$timestamp] [OK] $message${NC}" ;;
        "WARN")  echo -e "${YELLOW}[$timestamp] [WARN] $message${NC}" ;;
        "ERROR") echo -e "${RED}[$timestamp] [ERROR] $message${NC}" ;;
        *)       echo -e "${WHITE}[$timestamp] $message${NC}" ;;
    esac
}

# =============================================================================
# FUN√á√ÉO DISCORD
# =============================================================================
discord_send() {
    local message="$1"
    curl -s -H "Content-Type: application/json" -X POST \
        -d "{\"content\":\"$message\"}" \
        "$DISCORD_WEBHOOK" >/dev/null 2>&1
}

# =============================================================================
# DETECTAR HARDWARE
# =============================================================================
detect_hardware() {
    if [ -f "/proc/cpuinfo" ]; then
        THREADS=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        THREADS=${THREADS:-2}
    else
        THREADS=$(nproc 2>/dev/null || echo 2)
    fi
    
    ARCH=$(uname -m)
    case "$ARCH" in
        aarch64|arm64)  ARCH_TYPE="arm64" ;;
        armv7l|armhf)   ARCH_TYPE="armhf" ;;
        x86_64)         ARCH_TYPE="x86_64" ;;
        *)              ARCH_TYPE="$ARCH" ;;
    esac
    
    god_log "OK" "Hardware" "CPU: $THREADS cores | Arch: $ARCH_TYPE"
}

# =============================================================================
# INSTALAR MINERADOR
# =============================================================================
install_miner() {
    god_log "INFO" "Install" "Instalando minerador..."
    
    mkdir -p "$BIN_DIR" "$TEMP_DIR"
    cd "$TEMP_DIR"
    
    # Instalar depend√™ncias
    pkg install -y wget curl 2>/dev/null
    
    case "$ARCH_TYPE" in
        arm64)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/download/5.0.29/cpuminer-opt-linux-aarch64.tar.gz"
            ;;
        armhf)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/download/5.0.29/cpuminer-opt-linux-armhf.tar.gz"
            ;;
        x86_64)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/download/5.0.29/cpuminer-opt-linux-x86_64.tar.gz"
            ;;
        *)
            god_log "ERROR" "Install" "Arquitetura n√£o suportada"
            return 1
            ;;
    esac
    
    god_log "INFO" "Install" "Baixando minerador..."
    
    if wget -q --timeout=30 "$URL" -O miner.tar.gz; then
        tar -xzf miner.tar.gz 2>/dev/null
        BIN_FILE=$(find . -name "cpuminer-*" -type f | head -1)
        
        if [ -n "$BIN_FILE" ]; then
            cp "$BIN_FILE" "$BIN_DIR/cpuminer"
            chmod +x "$BIN_DIR/cpuminer"
            god_log "OK" "Install" "Minerador instalado com sucesso!"
            return 0
        fi
    fi
    
    god_log "ERROR" "Install" "Falha na instala√ß√£o"
    return 1
}

# =============================================================================
# FUN√á√ÉO CORRIGIDA: TESTAR POOL COM TIMEOUT REDUZIDO
# =============================================================================
test_pool() {
    local pool_name="$1"
    local pool_url="$2"
    
    local host=$(echo "$pool_url" | sed -e 's|^stratum+tcp://||' -e 's|^stratum+ssl://||' -e 's|:[0-9]*$||')
    local port=$(echo "$pool_url" | grep -o '[0-9]*$')
    
    echo -n "  Testando $pool_name ($host:$port)... "
    
    # Timeout de 3 segundos apenas
    (echo > "/dev/tcp/$host/$port") 2>/dev/null &
    local pid=$!
    sleep 3
    if kill -0 $pid 2>/dev/null; then
        kill $pid 2>/dev/null
        echo -e "${RED}‚úó TIMEOUT${NC}"
        return 1
    else
        wait $pid 2>/dev/null
        if [ $? -eq 0 ]; then
            echo -e "${GREEN}‚úì OK${NC}"
            return 0
        else
            echo -e "${RED}‚úó FALHOU${NC}"
            return 1
        fi
    fi
}

# =============================================================================
# FUN√á√ÉO NOVA: ENCONTRAR POOL FUNCIONAL
# =============================================================================
find_working_pool() {
    god_log "INFO" "Pool" "Procurando pool funcional..."
    
    # Lista de pools priorit√°rias (testadas)
    local priority_pools=(
        "ViaBTC:stratum+tcp://btc.viabtc.com:3333"
        "F2Pool:stratum+tcp://btc.f2pool.com:3333"
        "AntPool:stratum+tcp://pool.antpool.com:3333"
        "Solo US:stratum+tcp://us.solomining.io:7777"
        "NiceHash EU:stratum+tcp://sha256.eu.nicehash.com:3333"
    )
    
    for pool_entry in "${priority_pools[@]}"; do
        local pool_name="${pool_entry%%:*}"
        local pool_url="${pool_entry#*:}"
        
        if test_pool "$pool_name" "$pool_url" 2>/dev/null; then
            god_log "OK" "Pool" "Pool funcional encontrada: $pool_name"
            echo "$pool_name|$pool_url"
            return 0
        fi
    done
    
    # Se nenhuma priority funcionar, testar todas
    for pool_name in "${!POOLS[@]}"; do
        local pool_url="${POOLS[$pool_name]}"
        
        if test_pool "$pool_name" "$pool_url" 2>/dev/null; then
            god_log "OK" "Pool" "Pool funcional encontrada: $pool_name"
            echo "$pool_name|$pool_url"
            return 0
        fi
    done
    
    god_log "ERROR" "Pool" "NENHUMA POOL FUNCIONAL ENCONTRADA!"
    return 1
}

# =============================================================================
# FUN√á√ÉO CORRIGIDA: INICIAR MINERA√á√ÉO COM TIMEOUT REDUZIDO
# =============================================================================
start_mining_foreground() {
    local pool_name="$1"
    local pool_url="$2"
    
    clear
    echo -e "${GREEN}${BOLD}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë                    MINERA√á√ÉO ATIVA                               ‚ïë"
    echo "‚ïë              LOGS EM TEMPO REAL - CTRL+C PARA PARAR              ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    echo ""
    echo -e "${CYAN}Pool:${NC} $pool_name"
    echo -e "${CYAN}Endere√ßo:${NC} ${NICEHASH_WALLET:0:20}..."
    echo -e "${CYAN}Threads:${NC} $THREADS"
    echo -e "${CYAN}URL:${NC} $pool_url"
    echo ""
    echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
    
    god_log "GOD" "Mining" "=== INICIANDO OPERA√á√ÉO DIVINA DE MINERA√á√ÉO ==="
    god_log "INFO" "Mining" "Pool: $pool_name"
    god_log "INFO" "Mining" "URL: $pool_url"
    
    # Verificar minerador
    if [ ! -f "$BIN_DIR/cpuminer" ]; then
        god_log "INFO" "Mining" "Minerador n√£o encontrado. Instalando..."
        install_miner || {
            god_log "ERROR" "Mining" "Falha na instala√ß√£o"
            discord_send "‚ùå FALHA NA INSTALA√á√ÉO DO MINERADOR"
            echo ""
            echo -e "${YELLOW}Pressione ENTER para voltar ao menu${NC}"
            read -r
            return 1
        }
    fi
    
    # Enviar notifica√ß√£o Discord
    discord_send "üöÄ **MINERA√á√ÉO INICIADA**\nPool: $pool_name\nThreads: $THREADS"
    
    # Executar minerador com timeout reduzido
    "$BIN_DIR/cpuminer" \
        -o "$pool_url" \
        -u "$NICEHASH_WALLET" \
        -p "x" \
        -t "$THREADS" \
        --algo=sha256d \
        --retry-pause=5 \
        --timeout=10 \
        2>&1 | tee -a "$LOG_DIR/miner.log"
    
    local exit_code=$?
    
    echo ""
    echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo ""
    
    if [ $exit_code -eq 0 ] || [ $exit_code -eq 130 ]; then
        god_log "INFO" "Mining" "Minera√ß√£o encerrada pelo usu√°rio"
        discord_send "‚èπÔ∏è **MINERA√á√ÉO ENCERRADA**\nMotivo: Usu√°rio interrompeu"
    else
        god_log "ERROR" "Mining" "Minera√ß√£o encerrada com erro (c√≥digo: $exit_code)"
        discord_send "‚ùå **MINERA√á√ÉO ENCERRADA COM ERRO**\nC√≥digo: $exit_code"
    fi
    
    echo ""
    echo -e "${YELLOW}Pressione ENTER para voltar ao menu principal${NC}"
    read -r
}

# =============================================================================
# FUN√á√ÉO NOVA: INICIAR COM POOL AUTOM√ÅTICA
# =============================================================================
start_mining_auto() {
    god_log "INFO" "Mining" "Procurando pool automaticamente..."
    
    local pool_info=$(find_working_pool)
    
    if [ -n "$pool_info" ]; then
        local pool_name="${pool_info%%|*}"
        local pool_url="${pool_info#*|}"
        start_mining_foreground "$pool_name" "$pool_url"
    else
        god_log "ERROR" "Mining" "N√£o foi poss√≠vel encontrar nenhuma pool funcional"
        discord_send "‚ùå **ERRO CR√çTICO**\nNenhuma pool de minera√ß√£o funcional encontrada!"
        
        echo ""
        echo -e "${RED}NENHUMA POOL FUNCIONAL ENCONTRADA!${NC}"
        echo -e "${YELLOW}Verifique sua conex√£o com a internet.${NC}"
        echo ""
        echo -e "${YELLOW}Pressione ENTER para voltar ao menu${NC}"
        read -r
    fi
}

# =============================================================================
# FUN√á√ïES DISCORD (MANTIDAS IGUAIS)
# =============================================================================
discord_sistema_iniciado() {
    local msg="**SISTEMA INICIADO**\n"
    msg+="- **Vers√£o:** $VERSION\n"
    msg+="- **Build:** $BUILD_ID\n"
    msg+="- **CPU Threads:** $THREADS\n"
    msg+="- **Carteira:** ${NICEHASH_WALLET:0:15}..."
    discord_send "$msg"
    god_log "GOD" "System" "SISTEMA INICIADO"
}

discord_benchmark() {
    local msg="**BENCHMARK COMPLETO**\n\n"
    msg+="- **CPU Score:** Testado\n"
    msg+="- **Network Score:** Verificado\n"
    msg+="- **Status:** Sistema pronto para o modo Deus."
    discord_send "$msg"
    god_log "OK" "Benchmark" "Benchmark conclu√≠do"
}

discord_test_webhook() {
    local msg="**TESTE DE WEBHOOK - MODO DEUS**\n\n"
    msg+="O webhook do Discord est√° funcionando perfeitamente!\n\n"
    msg+="*Que os deuses da minera√ß√£o estejam com voc√™!*"
    discord_send "$msg"
    god_log "OK" "Discord" "Teste de webhook enviado"
}

# =============================================================================
# MENU PRINCIPAL CORRIGIDO
# =============================================================================
show_menu() {
    while true; do
        clear
        echo -e "${GREEN}${BOLD}"
        echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo "‚ïë           NICEHASH MINER GOD v${VERSION} - MODO DEUS              ‚ïë"
        echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        echo ""
        
        echo -e "${CYAN}SISTEMA:${NC} CPU: $THREADS cores | Arch: $ARCH_TYPE"
        echo -e "${CYAN}STATUS:${NC} Shares: $TOTAL_SHARES | Rejeitadas: $TOTAL_REJECTED"
        echo ""
        
        echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}OP√á√ïES DE MINERA√á√ÉO${NC}"
        echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo ""
        echo "  [1] üîç MINERA√á√ÉO AUTOM√ÅTICA (RECOMENDADO)"
        echo "     - O sistema testa e escolhe a melhor pool"
        echo ""
        echo "  [2] üìã ESCOLHER POOL MANUALMENTE"
        echo "     - Lista todas as pools dispon√≠veis"
        echo ""
        echo "  [3] üåê TESTAR TODAS AS POOLS"
        echo "     - Verifica quais pools est√£o acess√≠veis"
        echo ""
        
        echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}FERRAMENTAS${NC}"
        echo -e "${BLUE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo ""
        echo "  [4] üì¶ INSTALAR/REINSTALAR MINERADOR"
        echo "  [5] üõë PARAR MINERA√á√ÉO"
        echo "  [6] üìä VER LOGS"
        echo ""
        
        echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo -e "${WHITE}DISCORD${NC}"
        echo -e "${PURPLE}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo ""
        echo "  [7] üì§ ENVIAR SISTEMA INICIADO"
        echo "  [8] üîß ENVIAR BENCHMARK"
        echo "  [9] üîî TESTAR WEBHOOK"
        echo ""
        
        echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo "  [0] SAIR"
        echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
        echo ""
        echo -n "ESCOLHA UMA OP√á√ÉO: "
        read -r opt
        
        case $opt in
            1) start_mining_auto ;;
            
            2)
                clear
                echo -e "${BLUE}POOLS DISPON√çVEIS:${NC}"
                echo ""
                
                local i=1
                declare -A pool_options
                for pool_name in "${!POOLS[@]}"; do
                    echo "  [$i] $pool_name"
                    pool_options[$i]="$pool_name"
                    ((i++))
                    if [ $i -gt 20 ]; then
                        echo "  ... e mais ${#POOLS[@]} pools dispon√≠veis"
                        break
                    fi
                done
                
                echo ""
                echo -n "Escolha o n√∫mero da pool: "
                read -r pool_choice
                
                if [ -n "${pool_options[$pool_choice]}" ]; then
                    local selected="${pool_options[$pool_choice]}"
                    start_mining_foreground "$selected" "${POOLS[$selected]}"
                fi
                ;;
            
            3)
                clear
                echo -e "${BLUE}TESTANDO POOLS...${NC}"
                echo ""
                
                local working=0
                local total=0
                
                for pool_name in "${!POOLS[@]}"; do
                    ((total++))
                    if test_pool "$pool_name" "${POOLS[$pool_name]}" 2>/dev/null; then
                        ((working++))
                    fi
                    sleep 1
                done
                
                echo ""
                echo -e "${GREEN}Pools funcionais: $working de $total${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            
            4)
                clear
                install_miner
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            
            5)
                clear
                pkill -f cpuminer
                god_log "INFO" "System" "Minera√ß√£o parada"
                discord_send "‚èπÔ∏è **MINERA√á√ÉO PARADA**"
                echo -e "${GREEN}Minera√ß√£o parada${NC}"
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            
            6)
                clear
                if [ -f "$LOG_DIR/complete.log" ]; then
                    tail -50 "$LOG_DIR/complete.log"
                else
                    echo "Nenhum log encontrado"
                fi
                echo ""
                echo -e "${YELLOW}Pressione ENTER para voltar${NC}"
                read -r
                ;;
            
            7)
                clear
                discord_sistema_iniciado
                echo -e "${GREEN}Mensagem enviada!${NC}"
                sleep 2
                ;;
            
            8)
                clear
                discord_benchmark
                echo -e "${GREEN}Benchmark enviado!${NC}"
                sleep 2
                ;;
            
            9)
                clear
                discord_test_webhook
                echo -e "${GREEN}Teste enviado! Verifique o Discord.${NC}"
                sleep 2
                ;;
            
            0)
                clear
                pkill -f cpuminer
                discord_send "üëã **SISTEMA ENCERRADO**"
                echo -e "${GREEN}Obrigado por usar o NiceHash Miner God!${NC}"
                exit 0
                ;;
            
            *)
                echo -e "${RED}Op√ß√£o inv√°lida!${NC}"
                sleep 1
                ;;
        esac
    done
}

# =============================================================================
# LIMPEZA
# =============================================================================
cleanup() {
    echo ""
    pkill -f cpuminer 2>/dev/null
    exit 0
}

# =============================================================================
# MAIN
# =============================================================================
trap cleanup SIGINT SIGTERM

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${RED}ERRO: Execute no Termux${NC}"
    exit 1
fi

# Criar diret√≥rios
mkdir -p "$MINER_HOME" "$LOG_DIR" "$BIN_DIR" "$TEMP_DIR"

# Detectar hardware
detect_hardware

# Iniciar menu
show_menu
