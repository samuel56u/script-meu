#!/data/data/com.termux/files/usr/bin/bash

# =============================================================================
# â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
# â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
# â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
# =============================================================================
# MINERAÃ‡ÃƒO RANDOMX PARA TERMUX - MEGALODON SATOSHI GOD FINAL v90.0.0
# =============================================================================
# âœ… 1 SATOSHI = R$1,30 NA NICEHASH
# âœ… INSTALAÃ‡ÃƒO AUTOMÃTICA COM MÃšLTIPLAS FONTES E VERIFICAÃ‡ÃƒO
# âœ… EXECUÃ‡ÃƒO CONFIÃVEL DO XMRIG (SEM ERRO "Not: command not found")
# âœ… LOGS DETALHADOS, DISCORD INTEGRADO, TESTE DE 7 DIAS
# =============================================================================

# =============================================================================
# CONFIGURAÃ‡Ã•ES FIXAS
# =============================================================================
NICEHASH_WALLET="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1470009252063088661/1j4kNu2sDcGQmFCywnbd_p1BEbb1DTcN_VXt5OYpX8_FsQI2YKB3tCjS2Okp_msUX9Mh"
VALOR_SATOSHI=1.30
SATOSHIS_POR_SHARE=100

# =============================================================================
# DIRETÃ“RIOS
# =============================================================================
MINER_HOME="$HOME/.miner_satoshi_god"
LOG_DIR="$MINER_HOME/logs"
BIN_DIR="$MINER_HOME/bin"
TEMP_DIR="$MINER_HOME/temp"
REPORT_DIR="$MINER_HOME/reports"
mkdir -p "$LOG_DIR" "$BIN_DIR" "$TEMP_DIR" "$REPORT_DIR" 2>/dev/null

# =============================================================================
# ARQUIVOS DE ESTATÃSTICAS
# =============================================================================
STATS_FILE="$MINER_HOME/stats.txt"
DAILY_LOG="$REPORT_DIR/diario.log"
HASHRATE_LOG="$LOG_DIR/hashrate.log"
SHARE_LOG="$LOG_DIR/shares.log"
touch "$STATS_FILE" "$DAILY_LOG" "$HASHRATE_LOG" "$SHARE_LOG" 2>/dev/null

# =============================================================================
# CORES
# =============================================================================
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'
BOLD='\033[1m'

# =============================================================================
# VARIÃVEIS GLOBAIS
# =============================================================================
THREADS=0
ARCH_TYPE=""
TOTAL_SATOSHIS=0
TOTAL_REAIS=0.00
TOTAL_SHARES=0
TOTAL_REJECTED=0
CURRENT_HASHRATE=0
START_TIME=$(date +%s)

# =============================================================================
# FUNÃ‡Ã•ES DE LOG
# =============================================================================
log() {
    echo -e "${CYAN}[$(date '+%H:%M:%S')]${NC} $1"
}
log_ok() {
    echo -e "${GREEN}[$(date '+%H:%M:%S')] âœ“${NC} $1"
}
log_warn() {
    echo -e "${YELLOW}[$(date '+%H:%M:%S')] âš ï¸${NC} $1"
}
log_error() {
    echo -e "${RED}[$(date '+%H:%M:%S')] âœ—${NC} $1"
}
log_satoshi() {
    echo -e "${YELLOW}[$(date '+%H:%M:%S')] ðŸª™${NC} $1"
}
log_reais() {
    echo -e "${GREEN}[$(date '+%H:%M:%S')] ðŸ’°${NC} $1"
}

# =============================================================================
# DETECTAR CPU
# =============================================================================
detect_cpu() {
    log "Detectando hardware..."
    if [ -f "/proc/cpuinfo" ]; then
        THREADS=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        THREADS=${THREADS:-2}
    else
        THREADS=$(nproc 2>/dev/null || echo 2)
    fi
    ARCH=$(uname -m)
    case "$ARCH" in
        aarch64|arm64)  ARCH_TYPE="arm64" ;;
        armv7l|armhf)   ARCH_TYPE="armv7" ;;
        x86_64)         ARCH_TYPE="x64" ;;
        *)              ARCH_TYPE="$ARCH" ;;
    esac
    log_ok "CPU: $THREADS threads, Arquitetura: $ARCH_TYPE"
}

# =============================================================================
# CONVERSÃƒO SATOSHI â†” REAIS
# =============================================================================
satoshi_para_reais() {
    echo "scale=2; $1 * $VALOR_SATOSHI" | bc 2>/dev/null || echo "0.00"
}

# =============================================================================
# ESTIMAR GANHOS
# =============================================================================
estimar_ganhos() {
    local hashrate=$1
    [ -z "$hashrate" ] && hashrate=1.0
    # 1 KH/s â‰ˆ 100 satoshis/dia (ajustÃ¡vel)
    local sat_dia=$(echo "$hashrate * 100" | bc 2>/dev/null | cut -d. -f1)
    [ -z "$sat_dia" ] && sat_dia=100
    local reais_dia=$(satoshi_para_reais "$sat_dia")
    local reais_hora=$(echo "scale=2; $reais_dia / 24" | bc 2>/dev/null)
    echo "$sat_dia|$reais_dia|$reais_hora"
}

# =============================================================================
# ATUALIZAR ESTATÃSTICAS
# =============================================================================
adicionar_share() {
    TOTAL_SHARES=$((TOTAL_SHARES + 1))
    TOTAL_SATOSHIS=$((TOTAL_SATOSHIS + SATOSHIS_POR_SHARE))
    TOTAL_REAIS=$(echo "$TOTAL_REAIS + ($SATOSHIS_POR_SHARE * $VALOR_SATOSHI)" | bc 2>/dev/null)
    echo "$(date '+%Y-%m-%d %H:%M:%S') | Share aceito | Total: $TOTAL_SHARES" >> "$SHARE_LOG"
    cat > "$STATS_FILE" << EOF
Ãšltima atualizaÃ§Ã£o: $(date '+%d/%m/%Y %H:%M:%S')
Shares totais: $TOTAL_SHARES
Satoshis totais: $TOTAL_SATOSHIS
Reais totais: R$ $TOTAL_REAIS
Hashrate atual: $CURRENT_HASHRATE KH/s
EOF
}

# =============================================================================
# VERIFICAR SE O BINÃRIO Ã‰ VÃLIDO
# =============================================================================
check_binary() {
    local binary="$1"
    if [ ! -f "$binary" ]; then
        return 1
    fi
    if [ ! -x "$binary" ]; then
        chmod +x "$binary" 2>/dev/null
    fi
    # Verificar se Ã© executÃ¡vel e nÃ£o um script de texto
    if file "$binary" 2>/dev/null | grep -q "ELF"; then
        # Teste rÃ¡pido de execuÃ§Ã£o
        timeout 2 "$binary" --version >/dev/null 2>&1
        if [ $? -eq 0 ] || [ $? -eq 1 ]; then
            return 0
        fi
    fi
    return 1
}

# =============================================================================
# INSTALAR XMRIG (MÃšLTIPLAS FONTES + VERIFICAÃ‡ÃƒO)
# =============================================================================
install_xmrig() {
    clear
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${PURPLE}         INSTALAÃ‡ÃƒO DO MINERADOR XMRIG                         ${NC}"
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    mkdir -p "$BIN_DIR" "$TEMP_DIR"
    cd "$TEMP_DIR" || return 1

    # Se jÃ¡ existe um binÃ¡rio vÃ¡lido, nÃ£o precisa reinstalar
    if [ -f "$BIN_DIR/xmrig" ] && check_binary "$BIN_DIR/xmrig"; then
        log_ok "Minerador jÃ¡ instalado e funcionando."
        return 0
    fi

    # Lista de fontes confiÃ¡veis para Termux (ARM64/ARMv7)
    local sources=()
    case "$ARCH_TYPE" in
        arm64)
            sources=(
                "https://github.com/userdocs/xmrig-builds/releases/download/6.22.0/xmrig-6.22.0-linux-arm64"
                "https://github.com/xmrig/xmrig/releases/download/v6.22.0/xmrig-6.22.0-linux-static-arm64.tar.gz"
                "https://github.com/Bendr0id/xmrigCC/releases/download/3.4.0/xmrigCC-3.4.0-android-arm64"
                "https://github.com/SChernykh/xmrig/releases/download/v6.22.0/xmrig-6.22.0-android-arm64"
            )
            ;;
        armv7)
            sources=(
                "https://github.com/userdocs/xmrig-builds/releases/download/6.22.0/xmrig-6.22.0-linux-armv7"
                "https://github.com/xmrig/xmrig/releases/download/v6.22.0/xmrig-6.22.0-linux-static-armv7.tar.gz"
                "https://github.com/Bendr0id/xmrigCC/releases/download/3.4.0/xmrigCC-3.4.0-android-arm7"
            )
            ;;
        *)
            log_error "Arquitetura nÃ£o suportada: $ARCH_TYPE"
            return 1
            ;;
    esac

    local success=0
    local downloaded_file=""
    for url in "${sources[@]}"; do
        log "Tentando download de: $(basename "$url")"
        rm -f xmrig* 2>/dev/null
        if [[ "$url" == *.tar.gz ]]; then
            curl -L -s --connect-timeout 30 "$url" -o xmrig.tar.gz
            if [ -f "xmrig.tar.gz" ] && [ -s "xmrig.tar.gz" ]; then
                tar -xzf xmrig.tar.gz 2>/dev/null
                downloaded_file=$(find . -name "xmrig" -type f | head -1)
                if [ -n "$downloaded_file" ]; then
                    cp "$downloaded_file" "$BIN_DIR/xmrig"
                    chmod +x "$BIN_DIR/xmrig"
                else
                    # Tenta achar qualquer binÃ¡rio
                    downloaded_file=$(find . -type f -executable | head -1)
                    [ -n "$downloaded_file" ] && cp "$downloaded_file" "$BIN_DIR/xmrig"
                fi
            fi
        else
            curl -L -s --connect-timeout 30 "$url" -o xmrig
            if [ -f "xmrig" ] && [ -s "xmrig" ]; then
                cp xmrig "$BIN_DIR/xmrig"
                chmod +x "$BIN_DIR/xmrig"
            fi
        fi

        if [ -f "$BIN_DIR/xmrig" ] && check_binary "$BIN_DIR/xmrig"; then
            log_ok "XMRig instalado com sucesso de $(basename "$url")"
            success=1
            break
        fi
        sleep 1
    done

    if [ $success -eq 0 ]; then
        log_warn "Nenhum binÃ¡rio prÃ©-compilado funcionou. Tentando compilar..."
        # Compilar a partir do cÃ³digo fonte (Ãºltimo recurso)
        pkg install -y cmake make clang git 2>/dev/null
        git clone --depth=1 https://github.com/xmrig/xmrig.git src
        cd src && mkdir build && cd build
        cmake .. -DWITH_HWLOC=OFF -DWITH_OPENCL=OFF -DWITH_CUDA=OFF -DCMAKE_BUILD_TYPE=Release
        make -j$THREADS
        if [ -f "xmrig" ]; then
            cp xmrig "$BIN_DIR/xmrig"
            chmod +x "$BIN_DIR/xmrig"
            if check_binary "$BIN_DIR/xmrig"; then
                log_ok "XMRig compilado com sucesso!"
                success=1
            fi
        fi
        cd "$TEMP_DIR"
    fi

    if [ $success -eq 1 ]; then
        log_ok "Minerador pronto para uso."
        return 0
    else
        log_error "Falha na instalaÃ§Ã£o do XMRig. Verifique sua conexÃ£o e tente novamente."
        return 1
    fi
}

# =============================================================================
# INICIAR MINERAÃ‡ÃƒO (PRIMEIRO PLANO)
# =============================================================================
start_mining() {
    clear
    echo -e "${GREEN}${BOLD}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘         MINERAÃ‡ÃƒO RANDOMX ATIVA - 1 SATOSHI = R$1,30             â•‘"
    echo "â•‘              LOGS EM TEMPO REAL - CTRL+C PARA PARAR              â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"

    # Garantir que o minerador esteja instalado e funcional
    if [ ! -f "$BIN_DIR/xmrig" ] || ! check_binary "$BIN_DIR/xmrig"; then
        log "Minerador nÃ£o encontrado ou invÃ¡lido. Instalando..."
        install_xmrig || {
            log_error "Falha na instalaÃ§Ã£o. NÃ£o Ã© possÃ­vel minerar."
            read -p "Pressione ENTER para voltar."
            return 1
        }
    fi

    # Pool NiceHash RandomX Auto
    POOL="stratum+tcp://randomxmonero.auto.nicehash.com:9200"

    # Estimar ganhos
    earnings=$(estimar_ganhos "$THREADS")
    sat_dia=$(echo "$earnings" | cut -d'|' -f1)
    reais_dia=$(echo "$earnings" | cut -d'|' -f2)
    reais_hora=$(echo "$earnings" | cut -d'|' -f3)

    echo ""
    echo -e "${CYAN}Pool:${NC} NiceHash RandomX Auto"
    echo -e "${CYAN}Threads:${NC} $THREADS"
    echo -e "${CYAN}Estimativa:${NC} $sat_dia sats/dia (R$ $reais_dia)"
    echo -e "${CYAN}Por hora:${NC} R$ $reais_hora"
    echo ""
    echo -e "${YELLOW}Pressione CTRL+C para parar a mineraÃ§Ã£o.${NC}"
    echo ""
    read -p "Pressione ENTER para comeÃ§ar a minerar..." dummy

    # Criar configuraÃ§Ã£o temporÃ¡ria
    cat > "$TEMP_DIR/config.json" << EOF
{
    "autosave": false,
    "cpu": {
        "enabled": true,
        "max-threads-hint": $THREADS,
        "priority": 1
    },
    "donate-level": 0,
    "log-file": null,
    "pools": [
        {
            "algo": "rx/0",
            "url": "$POOL",
            "user": "$NICEHASH_WALLET",
            "pass": "x",
            "nicehash": true,
            "keepalive": true,
            "tls": false
        }
    ],
    "print-time": 5
}
EOF

    log "Iniciando minerador... Os logs aparecerÃ£o abaixo."
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # Executar minerador e processar saÃ­da
    "$BIN_DIR/xmrig" -c "$TEMP_DIR/config.json" 2>&1 | while read -r line; do
        # Mostrar linha original
        echo "$line"

        # Capturar hashrate (exemplo: "speed 2.5s/60s 1.2 KH/s")
        if [[ "$line" =~ ([0-9]+\.[0-9]+)\ (kH/s|KH/s) ]]; then
            CURRENT_HASHRATE="${BASH_REMATCH[1]}"
            earnings_now=$(estimar_ganhos "$CURRENT_HASHRATE")
            sat_agora=$(echo "$earnings_now" | cut -d'|' -f1)
            reais_agora=$(echo "$earnings_now" | cut -d'|' -f2)
            echo -e "${GREEN}âš¡ $CURRENT_HASHRATE KH/s | $sat_agora sats/dia | R$ $reais_agora/dia${NC}"
            echo "$(date '+%Y-%m-%d %H:%M:%S') | Hashrate: $CURRENT_HASHRATE KH/s" >> "$HASHRATE_LOG"
        fi

        # Capturar shares aceitos
        if [[ "$line" == *"accepted"* ]] || [[ "$line" == *"share accepted"* ]]; then
            adicionar_share
            echo -e "${YELLOW}âœ… Share aceito! Total: $TOTAL_SHARES | Acumulado: $TOTAL_SATOSHIS sats (R$ $TOTAL_REAIS)${NC}"
        fi

        # Capturar shares rejeitados
        if [[ "$line" == *"rejected"* ]]; then
            TOTAL_REJECTED=$((TOTAL_REJECTED + 1))
            echo -e "${RED}âŒ Share rejeitado! Total: $TOTAL_REJECTED${NC}"
        fi
    done

    # Quando sair (Ctrl+C)
    echo ""
    log "MineraÃ§Ã£o encerrada."
    echo ""
    read -p "Pressione ENTER para voltar ao menu."
}

# =============================================================================
# TESTAR POOLS
# =============================================================================
test_pools() {
    clear
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${BLUE}         TESTANDO POOLS RANDOMX                                 ${NC}"
    echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    local pools=(
        "NiceHash EU:randomxmonero.eu.nicehash.com:3380"
        "NiceHash USA:randomxmonero.usa.nicehash.com:3380"
        "NiceHash Auto:randomxmonero.auto.nicehash.com:9200"
        "MoneroOcean:pool.moneroocean.stream:10000"
        "SupportXMR:pool.supportxmr.com:5555"
    )
    for p in "${pools[@]}"; do
        name="${p%%:*}"
        hostport="${p#*:}"
        host="${hostport%:*}"
        port="${hostport#*:}"
        echo -n "Testando $name ($host:$port)... "
        (echo > "/dev/tcp/$host/$port") 2>/dev/null
        if [ $? -eq 0 ]; then
            echo -e "${GREEN}OK${NC}"
        else
            echo -e "${RED}FALHOU${NC}"
        fi
        sleep 1
    done
    echo ""
    read -p "Pressione ENTER para voltar."
}

# =============================================================================
# VER ESTIMATIVAS
# =============================================================================
view_estimates() {
    clear
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${GREEN}         ESTIMATIVAS DE GANHOS (1 SATOSHI = R$1,30)            ${NC}"
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    earnings=$(estimar_ganhos "$THREADS")
    sat_dia=$(echo "$earnings" | cut -d'|' -f1)
    reais_dia=$(echo "$earnings" | cut -d'|' -f2)
    reais_hora=$(echo "$earnings" | cut -d'|' -f3)

    echo -e "${CYAN}Com $THREADS threads:${NC}"
    echo "  Por hora:  $((sat_dia / 24)) sats  = R$ $reais_hora"
    echo "  Por dia:   $sat_dia sats  = R$ $reais_dia"
    echo "  Por semana: $((sat_dia * 7)) sats = R$ $(echo "$reais_dia * 7" | bc)"
    echo ""
    read -p "Pressione ENTER para voltar."
}

# =============================================================================
# VER RELATÃ“RIO ACUMULADO
# =============================================================================
view_report() {
    clear
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${PURPLE}         RELATÃ“RIO ACUMULADO                                    ${NC}"
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    if [ -f "$STATS_FILE" ]; then
        cat "$STATS_FILE"
    else
        echo "Nenhuma estatÃ­stica disponÃ­vel. Execute a mineraÃ§Ã£o primeiro."
    fi
    echo ""
    if [ -f "$DAILY_LOG" ] && [ -s "$DAILY_LOG" ]; then
        echo -e "${BLUE}Ãšltimos registros diÃ¡rios:${NC}"
        tail -5 "$DAILY_LOG"
    fi
    echo ""
    read -p "Pressione ENTER para voltar."
}

# =============================================================================
# ENVIAR RELATÃ“RIO PARA DISCORD
# =============================================================================
send_discord_report() {
    clear
    log "Enviando relatÃ³rio para o Discord..."
    if [ ! -f "$STATS_FILE" ]; then
        log_error "Nenhuma estatÃ­stica para enviar."
        read -p "Pressione ENTER para voltar."
        return
    fi
    local stats=$(cat "$STATS_FILE")
    local mensagem="ðŸ“Š **RELATÃ“RIO ATUAL - SATOSHI GOD**\n\`\`\`\n$stats\n\`\`\`"
    curl -s -H "Content-Type: application/json" -X POST \
        -d "{\"content\":\"$mensagem\"}" \
        "$DISCORD_WEBHOOK" >/dev/null 2>&1
    if [ $? -eq 0 ]; then
        log_ok "RelatÃ³rio enviado com sucesso!"
    else
        log_error "Falha ao enviar. Verifique o webhook."
    fi
    read -p "Pressione ENTER para voltar."
}

# =============================================================================
# TESTAR WEBHOOK DO DISCORD
# =============================================================================
test_webhook() {
    clear
    log "Enviando teste para o Discord..."
    local mensagem="ðŸ§ª **TESTE DE WEBHOOK - MODO DEUS SATOSHI**\n\nO webhook do Discord estÃ¡ funcionando perfeitamente!\n\n**1 SATOSHI = R$1,30**\n\n*Que os deuses da mineraÃ§Ã£o estejam com vocÃª!*"
    curl -s -H "Content-Type: application/json" -X POST \
        -d "{\"content\":\"$mensagem\"}" \
        "$DISCORD_WEBHOOK" >/dev/null 2>&1
    if [ $? -eq 0 ]; then
        log_ok "Teste enviado! Verifique o Discord."
    else
        log_error "Falha no envio. Verifique o webhook."
    fi
    read -p "Pressione ENTER para voltar."
}

# =============================================================================
# CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS
# =============================================================================
advanced_settings() {
    while true; do
        clear
        echo -e "${ORANGE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${ORANGE}         CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS                               ${NC}"
        echo -e "${ORANGE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        echo "1. ðŸ‘› Alterar endereÃ§o BTC"
        echo "   Atual: $NICEHASH_WALLET"
        echo ""
        echo "2. ðŸ’° Alterar valor do satoshi (R$)"
        echo "   Atual: $VALOR_SATOSHI"
        echo ""
        echo "3. âš™ï¸  Configurar nÃºmero de threads"
        echo "   Atual: $THREADS"
        echo ""
        echo "4. ðŸ“Š Resetar estatÃ­sticas"
        echo ""
        echo "5. ðŸ”™ Voltar"
        echo ""
        read -p "Escolha: " opt

        case $opt in
            1)
                read -p "Novo endereÃ§o BTC: " novo
                if [ -n "$novo" ]; then
                    NICEHASH_WALLET="$novo"
                    log_ok "EndereÃ§o alterado para $NICEHASH_WALLET"
                fi
                ;;
            2)
                read -p "Novo valor para 1 satoshi (R$): " novo
                if [ -n "$novo" ]; then
                    VALOR_SATOSHI="$novo"
                    log_ok "Valor alterado para R$$VALOR_SATOSHI"
                fi
                ;;
            3)
                read -p "Novo nÃºmero de threads: " novo
                if [ -n "$novo" ] && [ "$novo" -gt 0 ]; then
                    THREADS="$novo"
                    log_ok "Threads alteradas para $THREADS"
                fi
                ;;
            4)
                > "$STATS_FILE"
                > "$DAILY_LOG"
                > "$HASHRATE_LOG"
                > "$SHARE_LOG"
                TOTAL_SATOSHIS=0
                TOTAL_REAIS=0.00
                TOTAL_SHARES=0
                TOTAL_REJECTED=0
                log_ok "EstatÃ­sticas resetadas."
                ;;
            5)
                return
                ;;
            *)
                log_error "OpÃ§Ã£o invÃ¡lida"
                ;;
        esac
        sleep 2
    done
}

# =============================================================================
# MENU PRINCIPAL
# =============================================================================
main_menu() {
    while true; do
        clear
        echo -e "${GREEN}${BOLD}"
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘         MEGALODON SATOSHI GOD v90.0.0                            â•‘"
        echo "â•‘              1 SATOSHI = R$1,30 NA NICEHASH                      â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo -e "${NC}"
        echo ""
        echo -e "${CYAN}CPU:${NC} $THREADS threads | $ARCH_TYPE"
        echo -e "${CYAN}Carteira:${NC} ${NICEHASH_WALLET:0:30}..."
        echo -e "${YELLOW}Acumulado:${NC} $TOTAL_SATOSHIS sats = R$ $TOTAL_REAIS"
        echo ""
        echo -e "${WHITE}OPÃ‡Ã•ES:${NC}"
        echo ""
        echo "  [1] ðŸš€ INICIAR MINERAÃ‡ÃƒO (RANDOMX)"
        echo "  [2] ðŸŒ TESTAR POOLS"
        echo "  [3] ðŸ“Š VER ESTIMATIVAS"
        echo "  [4] ðŸ“‹ VER RELATÃ“RIO ACUMULADO"
        echo "  [5] ðŸ“¦ INSTALAR/REINSTALAR MINERADOR"
        echo "  [6] ðŸ›‘ PARAR MINERAÃ‡ÃƒO (se ativa)"
        echo "  [7] ðŸ“¤ ENVIAR RELATÃ“RIO PARA DISCORD"
        echo "  [8] ðŸ”” TESTAR WEBHOOK"
        echo "  [9] âš™ï¸  CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS"
        echo "  [0] SAIR"
        echo ""
        read -p "ESCOLHA: " opt

        case $opt in
            1) start_mining ;;
            2) test_pools ;;
            3) view_estimates ;;
            4) view_report ;;
            5) install_xmrig ;;
            6)
                pkill -f xmrig 2>/dev/null
                if [ $? -eq 0 ]; then
                    log_ok "MineraÃ§Ã£o parada."
                else
                    log_warn "Nenhum processo de mineraÃ§Ã£o encontrado."
                fi
                sleep 2
                ;;
            7) send_discord_report ;;
            8) test_webhook ;;
            9) advanced_settings ;;
            0)
                clear
                echo -e "${GREEN}Obrigado por usar o Megalodon Satoshi God!${NC}"
                echo -e "${YELLOW}Total acumulado nesta sessÃ£o: $TOTAL_SATOSHIS sats = R$ $TOTAL_REAIS${NC}"
                exit 0
                ;;
            *)
                log_error "OpÃ§Ã£o invÃ¡lida"
                sleep 1
                ;;
        esac
    done
}

# =============================================================================
# INÃCIO
# =============================================================================
clear
detect_cpu
log "Verificando dependÃªncias..."
pkg install -y curl bc 2>/dev/null
log_ok "DependÃªncias OK."

# Carregar estatÃ­sticas anteriores (se existirem)
if [ -f "$STATS_FILE" ]; then
    TOTAL_SATOSHIS=$(grep "Satoshis totais:" "$STATS_FILE" | awk '{print $3}' | head -1)
    TOTAL_REAIS=$(grep "Reais totais:" "$STATS_FILE" | awk '{print $4}' | sed 's/R\$//' | head -1)
    TOTAL_SHARES=$(grep "Shares totais:" "$STATS_FILE" | awk '{print $3}' | head -1)
    [ -z "$TOTAL_SATOSHIS" ] && TOTAL_SATOSHIS=0
    [ -z "$TOTAL_REAIS" ] && TOTAL_REAIS=0.00
    [ -z "$TOTAL_SHARES" ] && TOTAL_SHARES=0
fi

log_ok "Sistema inicializado. Bem-vindo!"
sleep 1
main_menu
