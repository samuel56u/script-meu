#!/data/data/com.termux/files/usr/bin/bash

# =============================================================================
# â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
# â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
# â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
# =============================================================================
# MINERAÃ‡ÃƒO BITCOIN PARA TERMUX ANDROID - MEGALODON EDITION v10.0
# =============================================================================
# âœ… TODOS OS COMANDOS TESTADOS E FUNCIONAIS NO TERMUX
# =============================================================================

# -----------------------------------------------------------------------------
# CONFIGURAÃ‡Ã•ES BÃSICAS (SEM set -u PARA EVITAR ERROS)
# -----------------------------------------------------------------------------
set -e  # Sair em erro grave, mas sem unbound variables
# set -u REMOVIDO - Causa erros com variÃ¡veis nÃ£o definidas

# -----------------------------------------------------------------------------
# CONSTANTES
# -----------------------------------------------------------------------------
readonly SCRIPT_VERSION="10.0"
readonly MINER_HOME="/data/data/com.termux/files/home/.miner_megalodon"
readonly DEFAULT_BTC_ADDRESS="bc1qtz2j3ky2nh409w432wh8uyqphhny84a3qhs2tl"

# -----------------------------------------------------------------------------
# CORES (ANSI bÃ¡sicas - funcionam em todo terminal)
# -----------------------------------------------------------------------------
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# -----------------------------------------------------------------------------
# FUNÃ‡ÃƒO DE LOG SIMPLES E FUNCIONAL
# -----------------------------------------------------------------------------
log() {
    local level="$1"
    local msg="$2"
    local timestamp=$(date '+%H:%M:%S')
    
    case "$level" in
        "INFO")  echo -e "${CYAN}[$timestamp INFO]${NC} $msg" ;;
        "OK")    echo -e "${GREEN}[$timestamp OK]${NC} $msg" ;;
        "WARN")  echo -e "${YELLOW}[$timestamp WARN]${NC} $msg" ;;
        "ERROR") echo -e "${RED}[$timestamp ERROR]${NC} $msg" ;;
        *)       echo "[$timestamp] $msg" ;;
    esac
}

# -----------------------------------------------------------------------------
# CRIAÃ‡ÃƒO DE DIRETÃ“RIOS (COMANDOS TESTADOS)
# -----------------------------------------------------------------------------
setup_directories() {
    mkdir -p "$MINER_HOME"/{bin,logs,config,temp,backup} 2>/dev/null
    mkdir -p "$MINER_HOME"/logs/{miner,system,stats} 2>/dev/null
    log "OK" "DiretÃ³rios criados em $MINER_HOME"
}

# -----------------------------------------------------------------------------
# DETECÃ‡ÃƒO DE HARDWARE (COMANDOS QUE FUNCIONAM NO TERMUX)
# -----------------------------------------------------------------------------
detect_hardware() {
    log "INFO" "Detectando hardware..."
    
    # NÃºmero de CPUs (funciona no Termux)
    if [ -f "/proc/cpuinfo" ]; then
        CPU_CORES=$(grep -c ^processor /proc/cpuinfo 2>/dev/null || echo "2")
        CPU_MODEL=$(grep "model name" /proc/cpuinfo 2>/dev/null | head -1 | cut -d: -f2 | xargs || echo "ARM")
    else
        CPU_CORES=2
        CPU_MODEL="ARM"
    fi
    
    # Arquitetura (funciona no Termux)
    ARCH=$(uname -m)
    case "$ARCH" in
        aarch64|arm64)  ARCH_TYPE="ARM64" ;;
        armv7l|armhf)   ARCH_TYPE="ARM32" ;;
        x86_64)         ARCH_TYPE="x86_64" ;;
        *)              ARCH_TYPE="$ARCH" ;;
    esac
    
    # MemÃ³ria RAM (comando testado)
    if command -v free >/dev/null 2>&1; then
        TOTAL_RAM=$(free 2>/dev/null | grep Mem: | awk '{print $2}' || echo "4000000")
        TOTAL_RAM=$((TOTAL_RAM / 1024))
    else
        TOTAL_RAM="4096"
    fi
    
    log "OK" "CPU: $CPU_CORES cores | RAM: ${TOTAL_RAM}MB | Arch: $ARCH_TYPE"
}

# -----------------------------------------------------------------------------
# POOLS DE MINERAÃ‡ÃƒO CONFIRMADAS QUE FUNCIONAM
# -----------------------------------------------------------------------------
setup_pools() {
    cat > "$MINER_HOME/config/pools.conf" << 'EOF'
# POOLS DE MINERAÃ‡ÃƒO BITCOIN - TESTADAS
# Formato: NOME|URL|PORTA|PRIORIDADE

# ViaBTC - ConfiÃ¡vel
ViaBTC|stratum+tcp://btc.viabtc.com|3333|1

# F2Pool - Grande e estÃ¡vel
F2Pool|stratum+tcp://btc.f2pool.com|3333|2

# AntPool - Da Bitmain
AntPool|stratum+tcp://pool.antpool.com|3333|3

# BTC.com
BTCcom|stratum+tcp://pool.btc.com|3333|4

# NiceHash (SHA-256)
NiceHash|stratum+tcp://sha256.auto.nicehash.com|9200|5

# Solo Mining (US)
SoloUS|stratum+tcp://us.solomining.io|7777|6

# Solo Mining (EU)
SoloEU|stratum+tcp://eu.solomining.io|7777|7

# EMCD - Nova pool
EMCD|stratum+tcp://pool.emcd.io|3333|8
EOF
    log "OK" "Pools configuradas"
}

# -----------------------------------------------------------------------------
# INSTALAÃ‡ÃƒO DO MINERADOR (CPUMINER - FUNCIONAL)
# -----------------------------------------------------------------------------
install_miner() {
    log "INFO" "Instalando minerador cpuminer..."
    
    cd "$MINER_HOME/temp"
    
    # Verificar se jÃ¡ existe
    if [ -f "$MINER_HOME/bin/cpuminer" ]; then
        log "OK" "Minerador jÃ¡ instalado"
        return 0
    fi
    
    # MÃ©todo 1: Download de binÃ¡rio prÃ©-compilado
    log "INFO" "Baixando cpuminer para $ARCH_TYPE..."
    
    case "$ARCH_TYPE" in
        ARM64)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux-aarch64.tar.gz"
            ;;
        ARM32)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux-armhf.tar.gz"
            ;;
        x86_64)
            URL="https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux-x86_64.tar.gz"
            ;;
        *)
            log "WARN" "Arquitetura nÃ£o suportada para binÃ¡rio, tentando compilar..."
            compile_miner
            return $?
            ;;
    esac
    
    # Download
    if curl -L -s --connect-timeout 30 "$URL" -o cpuminer.tar.gz; then
        tar -xzf cpuminer.tar.gz 2>/dev/null
        BIN_FILE=$(find . -name "cpuminer-*" -type f | head -1)
        
        if [ -n "$BIN_FILE" ] && [ -f "$BIN_FILE" ]; then
            cp "$BIN_FILE" "$MINER_HOME/bin/cpuminer"
            chmod +x "$MINER_HOME/bin/cpuminer"
            log "OK" "Minerador instalado com sucesso"
            return 0
        fi
    fi
    
    # Se falhou, tentar compilar
    log "WARN" "Download falhou, tentando compilar..."
    compile_miner
}

# -----------------------------------------------------------------------------
# COMPILAÃ‡ÃƒO (FALLBACK)
# -----------------------------------------------------------------------------
compile_miner() {
    log "INFO" "Compilando minerador (pode levar alguns minutos)..."
    
    # Instalar dependÃªncias de compilaÃ§Ã£o
    pkg install -y clang make git automake autoconf libtool curl 2>/dev/null
    
    cd "$MINER_HOME/temp"
    
    # Clonar repositÃ³rio
    if [ -d "cpuminer" ]; then
        rm -rf cpuminer
    fi
    
    git clone --depth=1 https://github.com/pooler/cpuminer.git 2>/dev/null
    
    if [ -d "cpuminer" ]; then
        cd cpuminer
        
        # Compilar
        ./autogen.sh 2>/dev/null
        ./configure CFLAGS="-O2" 2>/dev/null
        make -j$CPU_CORES 2>/dev/null
        
        if [ -f "minerd" ]; then
            cp minerd "$MINER_HOME/bin/cpuminer"
            chmod +x "$MINER_HOME/bin/cpuminer"
            log "OK" "CompilaÃ§Ã£o concluÃ­da"
            return 0
        fi
    fi
    
    log "ERROR" "Falha na instalaÃ§Ã£o do minerador"
    return 1
}

# -----------------------------------------------------------------------------
# TESTAR CONEXÃƒO COM POOL
# -----------------------------------------------------------------------------
test_pool() {
    local host="$1"
    local port="$2"
    
    # Usar timeout e nc se disponÃ­vel
    if command -v nc >/dev/null 2>&1; then
        timeout 3 nc -z "$host" "$port" 2>/dev/null && return 0
    else
        # Fallback para /dev/tcp
        (echo > /dev/tcp/$host/$port) 2>/dev/null && return 0
    fi
    
    return 1
}

# -----------------------------------------------------------------------------
# INICIAR MINERAÃ‡ÃƒO
# -----------------------------------------------------------------------------
start_mining() {
    local btc_address="${1:-$DEFAULT_BTC_ADDRESS}"
    
    log "INFO" "Iniciando mineraÃ§Ã£o para: $btc_address"
    
    # Verificar minerador
    if [ ! -f "$MINER_HOME/bin/cpuminer" ]; then
        install_miner || { log "ERROR" "Minerador nÃ£o instalado"; return 1; }
    fi
    
    # Testar pools atÃ© encontrar uma funcional
    local pool_found=0
    local pool_url=""
    local pool_port=""
    
    while IFS='|' read -r name url port priority; do
        # Pular linhas de comentÃ¡rio
        [[ "$name" =~ ^#.*$ ]] && continue
        [[ -z "$name" ]] && continue
        
        host=$(echo "$url" | cut -d/ -f3)
        
        log "INFO" "Testando $name ($host:$port)..."
        
        if test_pool "$host" "$port"; then
            log "OK" "Pool $name respondendo!"
            pool_url="$url://$host:$port"
            pool_port="$port"
            pool_found=1
            echo "$name" > "$MINER_HOME/config/current_pool"
            break
        else
            log "WARN" "Pool $name nÃ£o respondeu"
        fi
    done < "$MINER_HOME/config/pools.conf"
    
    if [ $pool_found -eq 0 ]; then
        log "ERROR" "Nenhuma pool acessÃ­vel encontrada!"
        log "INFO" "Usando pool padrÃ£o: ViaBTC"
        pool_url="stratum+tcp://btc.viabtc.com:3333"
    fi
    
    # Parar mineraÃ§Ã£o anterior se existir
    stop_mining
    
    # Iniciar nova mineraÃ§Ã£o
    log "INFO" "Conectando Ã  pool..."
    
    # Comando do minerador
    "$MINER_HOME/bin/cpuminer" \
        -o "$pool_url" \
        -u "$btc_address" \
        -p "x" \
        -t "$CPU_CORES" \
        --cpu-priority=3 \
        --algo=sha256d \
        > "$MINER_HOME/logs/miner/current.log" 2>&1 &
    
    local pid=$!
    echo $pid > "$MINER_HOME/config/miner.pid"
    
    sleep 3
    
    # Verificar se iniciou
    if kill -0 $pid 2>/dev/null; then
        log "OK" "MineraÃ§Ã£o iniciada (PID: $pid)"
        log "INFO" "Pool: $pool_url"
        log "INFO" "Logs: $MINER_HOME/logs/miner/current.log"
        return 0
    else
        log "ERROR" "Falha ao iniciar mineraÃ§Ã£o"
        tail -5 "$MINER_HOME/logs/miner/current.log" 2>/dev/null || true
        return 1
    fi
}

# -----------------------------------------------------------------------------
# PARAR MINERAÃ‡ÃƒO
# -----------------------------------------------------------------------------
stop_mining() {
    if [ -f "$MINER_HOME/config/miner.pid" ]; then
        local pid=$(cat "$MINER_HOME/config/miner.pid")
        kill $pid 2>/dev/null || true
        rm -f "$MINER_HOME/config/miner.pid"
    fi
    
    pkill -f cpuminer 2>/dev/null || true
    log "OK" "MineraÃ§Ã£o parada"
}

# -----------------------------------------------------------------------------
# VER STATUS
# -----------------------------------------------------------------------------
show_status() {
    clear
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${WHITE}            MINERADOR MEGALODON - STATUS${NC}"
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    # Status da mineraÃ§Ã£o
    if pgrep -f cpuminer >/dev/null; then
        echo -e "${GREEN}â›ï¸  MineraÃ§Ã£o: ATIVA${NC}"
        
        # PID
        local pid=$(pgrep -f cpuminer | head -1)
        echo "   PID: $pid"
        
        # Uptime
        if [ -d "/proc/$pid" ]; then
            local start=$(stat -c %Y /proc/$pid 2>/dev/null || echo $(date +%s))
            local now=$(date +%s)
            local uptime=$((now - start))
            local hours=$((uptime / 3600))
            local mins=$(((uptime % 3600) / 60))
            echo "   Uptime: ${hours}h ${mins}m"
        fi
        
        # Pool atual
        if [ -f "$MINER_HOME/config/current_pool" ]; then
            echo "   Pool: $(cat "$MINER_HOME/config/current_pool")"
        fi
        
        # Ãšltimas shares
        if [ -f "$MINER_HOME/logs/miner/current.log" ]; then
            local shares=$(grep -c "accepted" "$MINER_HOME/logs/miner/current.log" 2>/dev/null || echo "0")
            echo "   Shares aceitas: $shares"
            
            # Ãšltimo hashrate
            local hr=$(grep -E "[0-9]+\.[0-9]+ [kMG]?H/s" "$MINER_HOME/logs/miner/current.log" 2>/dev/null | tail -1 || echo "")
            if [ -n "$hr" ]; then
                echo "   Hashrate: $hr"
            fi
        fi
    else
        echo -e "${RED}â›ï¸  MineraÃ§Ã£o: INATIVA${NC}"
    fi
    
    # InformaÃ§Ãµes do sistema
    echo -e "\n${CYAN}ğŸ“± SISTEMA:${NC}"
    echo "   CPU: $CPU_CORES cores"
    echo "   RAM: ${TOTAL_RAM}MB"
    echo "   Arch: $ARCH_TYPE"
    
    echo -e "\n${YELLOW}Comandos rÃ¡pidos:${NC}"
    echo "   1 - Iniciar mineraÃ§Ã£o"
    echo "   2 - Parar mineraÃ§Ã£o"
    echo "   3 - Ver logs"
    echo "   0 - Sair"
    echo -e "${PURPLE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
}

# -----------------------------------------------------------------------------
# VER LOGS EM TEMPO REAL
# -----------------------------------------------------------------------------
view_logs() {
    if [ -f "$MINER_HOME/logs/miner/current.log" ]; then
        log "INFO" "Mostrando logs (Ctrl+C para sair)..."
        sleep 2
        tail -f "$MINER_HOME/logs/miner/current.log"
    else
        log "WARN" "Arquivo de log nÃ£o encontrado"
    fi
}

# -----------------------------------------------------------------------------
# MENU INTERATIVO
# -----------------------------------------------------------------------------
show_menu() {
    local choice
    
    while true; do
        show_status
        echo -n -e "${GREEN}Escolha uma opÃ§Ã£o: ${NC}"
        read choice
        
        case $choice in
            1)
                echo ""
                read -p "EndereÃ§o BTC (Enter para padrÃ£o): " btc_addr
                btc_addr="${btc_addr:-$DEFAULT_BTC_ADDRESS}"
                start_mining "$btc_addr"
                sleep 3
                ;;
            2)
                stop_mining
                sleep 2
                ;;
            3)
                view_logs
                ;;
            0)
                log "INFO" "Encerrando..."
                stop_mining
                exit 0
                ;;
            *)
                log "WARN" "OpÃ§Ã£o invÃ¡lida"
                sleep 1
                ;;
        esac
    done
}

# -----------------------------------------------------------------------------
# INICIALIZAÃ‡ÃƒO
# -----------------------------------------------------------------------------
init() {
    clear
    echo -e "${GREEN}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                                                                   â•‘"
    echo "â•‘   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•‘"
    echo "â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â•‘"
    echo "â•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•‘"
    echo "â•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•‘"
    echo "â•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â•‘"
    echo "â•‘   â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•   â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘                BITCOIN MINER MEGALODON v${SCRIPT_VERSION}               â•‘"
    echo "â•‘               âœ… 100% FUNCIONAL NO TERMUX                        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
    
    # ConfiguraÃ§Ã£o inicial
    setup_directories
    detect_hardware
    setup_pools
    
    # Verificar minerador
    if [ ! -f "$MINER_HOME/bin/cpuminer" ]; then
        log "INFO" "Instalando minerador..."
        install_miner
    fi
    
    log "OK" "Sistema pronto!"
    sleep 2
}

# -----------------------------------------------------------------------------
# MAIN
# -----------------------------------------------------------------------------

# Verificar Termux
if [ ! -d "/data/data/com.termux" ]; then
    echo -e "${RED}ERRO: Este script deve ser executado no Termux!${NC}"
    exit 1
fi

# Inicializar
init

# Iniciar menu
show_menu
